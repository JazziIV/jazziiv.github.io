function enumerate(e,t,n,r,i){function s(e){return e.split("\\").join("\\\\").split("\n").join("\\n").split("'").join("\\'").split('"').join('\\"')}if(!e)return"{falsy}";var o,u;t===!0&&(t=10),t<1&&(t=!1),i||(i=0);var a="";t&&(a="    ");var f=e.___originalKeys||e;for(u in f){if(u==="___originalKeys"||!n&&!f.hasOwnProperty(u)||r&&!!r[u])continue;(o||(o=[])).push("    "+(u.match(/^[a-zA-Z_][a-zA-Z0-9_]*$/)?u:'"'+u+'"')+": "+function(){try{return typeof e[u]=="string"?'"'+s(e[u])+'"':typeof e[u]=="number"?e[u]:typeof e[u]=="function"?e[u].toString().split("\n").join("\n"+a):t?enumerate(e[u],t-1,n,r,undefined,i+1).split("\n").join("\n"+a):e[u]}catch(o){return o}}())}return o?" {\n"+o.join(",\n")+"\n}":"{}"}function bench(e,t,n){isNaN(t)||(n=t,t=null),t||(t=arguments.callee.blankFunction||(arguments.callee.blankFunction=function(){})),n||(n=50);var r=10,i=100,s=new Date*2,o=new Date*1;for(var u=0;new Date*1-o<n&&r<i;u++)e();var a=new Date*1,f=new Date*1;for(var l=0;new Date*1-o<s&&l<u;l++)t();var c=new Date*1,h=(a-o-(c-f))/u*1e6,p=(a-o)/u*1e6,d=(c-f)/u*1e6;return arguments.callee.output="Per iteration:\n  Corrected: "+h/1e3+"µs\n  Uncorrected: "+p/1e3+"µs\n  Control and Iteration: "+d/1e3+"µs",h}function cons(){var me=arguments.callee,cons=me.cons;if(cons)return me.show();cons=me.cons=document.createElement("div"),cons.style.cssText="position:absolute; z-index:100000; left:0px; top:0px; width:100%; height:100%; pointer-events:none;",cons.innerHTML='<span style="white-space:pre; position:absolute; padding:10px; left:20px; top:20px; right:20px; bottom:40px; overflow:auto; background:rgba(0,0,0,0.7); color:white;"><span style="position:absolute; bottom:0; left:0;"></span></span>'
;var span=cons.lastChild.firstChild,input=document.createElement("input");input.style.cssText="position:absolute; left:10px; bottom:10px; right:10px; z-index:100001;",input.onkeypress=function(e){if(e.which===13){var value=this.value,ret;try{ret=eval(value)}catch(e){ret=e+""}span.innerHTML=span.innerHTML+"\n\n"+'<span style="color:gray;">'+escape(value)+"</span>\n"+escape(ret)}},input.ontouchstart=input.onmousedown=function(e){cancelHide()};var escape=me.escape=function(e){return(e+"").split("<").join("&lt;").split(">").join("&gt;")},clear=me.clear=function(){return span.innerHTML="","done"},exit=me.exit=function(){cons.parentNode&&cons.parentNode.removeChild(cons),input.parentNode&&input.parentNode.removeChild(input),me._hideTimeout=null},hide=me.hide=exit,show=me.show=function(){var e=!cons.parentNode;return document.body.appendChild(cons),document.body.appendChild(input),e},peek=me.peek=function(){show()&&scheduleHide()},log=me.log=function(e){peek(),span.innerHTML=span.innerHTML+"\n\n"+escape(e)},scheduleHide=function(){me._hideTimeout||(me._hideTimeout=setTimeout(exit,2e3))},cancelHide=function(){clearTimeout(me._hideTimeout)}}(function(e,t){function H(e){var t=e.length,n=w.type(e);return w.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===n||"function"!==n&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function j(e){var t=B[e]={};return w.each(e.match(S)||[],function(e,n){t[n]=!0}),t}function q(e,n,r,i){if(w.acceptData(e)){var s,o,u=w.expando,a=e.nodeType,f=a?w.cache:e,l=a?e[u]:e[u]&&u;if(l&&f[l]&&(i||f[l].data)||r!==t||"string"!=typeof n)return l||(l=a?e[u]=c.pop()||w.guid++
:u),f[l]||(f[l]=a?{}:{toJSON:w.noop}),("object"==typeof n||"function"==typeof n)&&(i?f[l]=w.extend(f[l],n):f[l].data=w.extend(f[l].data,n)),o=f[l],i||(o.data||(o.data={}),o=o.data),r!==t&&(o[w.camelCase(n)]=r),"string"==typeof n?(s=o[n],null==s&&(s=o[w.camelCase(n)])):s=o,s}}function R(e,t,n){if(w.acceptData(e)){var r,i,s=e.nodeType,o=s?w.cache:e,u=s?e[w.expando]:w.expando;if(o[u]){if(t&&(r=n?o[u]:o[u].data)){w.isArray(t)?t=t.concat(w.map(t,w.camelCase)):t in r?t=[t]:(t=w.camelCase(t),t=t in r?[t]:t.split(" ")),i=t.length;while(i--)delete r[t[i]];if(n?!z(r):!w.isEmptyObject(r))return}(n||(delete o[u].data,z(o[u])))&&(s?w.cleanData([e],!0):w.support.deleteExpando||o!=o.window?delete o[u]:o[u]=null)}}}function U(e,n,r){if(r===t&&1===e.nodeType){var i="data-"+n.replace(I,"-$1").toLowerCase();if(r=e.getAttribute(i),"string"==typeof r){try{r="true"===r?!0:"false"===r?!1:"null"===r?null:+r+""===r?+r:F.test(r)?w.parseJSON(r):r}catch(s){}w.data(e,n,r)}else r=t}return r}function z(e){var t;for(t in e)if(("data"!==t||!w.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}function it(){return!0}function st(){return!1}function ot(){try{return o.activeElement}catch(e){}}function ct(e,t){do e=e[t];while(e&&1!==e.nodeType);return e}function ht(e,t,n){if(w.isFunction(t))return w.grep(e,function(e,r){return!!t.call(e,r,e)!==n});if(t.nodeType)return w.grep(e,function(e){return e===t!==n});if("string"==typeof t){if(ut.test(t))return w.filter(t,e,n);t=w.filter(t,e)}return w.grep(e,function(e){return w.inArray(e,t)>=0!==n})}function pt(e){var t=dt.split("|"),n=e.createDocumentFragment();if(n.createElement
)while(t.length)n.createElement(t.pop());return n}function Mt(e,t){return w.nodeName(e,"table")&&w.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function _t(e){return e.type=(null!==w.find.attr(e,"type"))+"/"+e.type,e}function Dt(e){var t=Ct.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function Pt(e,t){var n,r=0;for(;null!=(n=e[r]);r++)w._data(n,"globalEval",!t||w._data(t[r],"globalEval"))}function Ht(e,t){if(1===t.nodeType&&w.hasData(e)){var n,r,i,s=w._data(e),o=w._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;i>r;r++)w.event.add(t,n,u[n][r])}o.data&&(o.data=w.extend({},o.data))}}function Bt(e,t){var n,r,i;if(1===t.nodeType){if(n=t.nodeName.toLowerCase(),!w.support.noCloneEvent&&t[w.expando]){i=w._data(t);for(r in i.events)w.removeEvent(t,r,i.handle);t.removeAttribute(w.expando)}"script"===n&&t.text!==e.text?(_t(t).text=e.text,Dt(t)):"object"===n?(t.parentNode&&(t.outerHTML=e.outerHTML),w.support.html5Clone&&e.innerHTML&&!w.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&xt.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.defaultSelected=t.selected=e.defaultSelected:("input"===n||"textarea"===n)&&(t.defaultValue=e.defaultValue)}}function jt(e,n){var r,s,o=0,u=typeof e.getElementsByTagName!==i?e.getElementsByTagName(n||"*"):typeof e.querySelectorAll!==i?e.querySelectorAll(n||"*"):t;if(!u)for(u=[],r=e.childNodes||e;null!=(s=r[o]);o++)!n||w.nodeName(s,n)?u.push(s):
w.merge(u,jt(s,n));return n===t||n&&w.nodeName(e,n)?w.merge([e],u):u}function Ft(e){xt.test(e.type)&&(e.defaultChecked=e.checked)}function tn(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=en.length;while(i--)if(t=en[i]+n,t in e)return t;return r}function nn(e,t){return e=t||e,"none"===w.css(e,"display")||!w.contains(e.ownerDocument,e)}function rn(e,t){var n,r,i,s=[],o=0,u=e.length;for(;u>o;o++)r=e[o],r.style&&(s[o]=w._data(r,"olddisplay"),n=r.style.display,t?(s[o]||"none"!==n||(r.style.display=""),""===r.style.display&&nn(r)&&(s[o]=w._data(r,"olddisplay",an(r.nodeName)))):s[o]||(i=nn(r),(n&&"none"!==n||!i)&&w._data(r,"olddisplay",i?n:w.css(r,"display"))));for(o=0;u>o;o++)r=e[o],r.style&&(t&&"none"!==r.style.display&&""!==r.style.display||(r.style.display=t?s[o]||"":"none"));return e}function sn(e,t,n){var r=$t.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function on(e,t,n,r,i){var s=n===(r?"border":"content")?4:"width"===t?1:0,o=0;for(;4>s;s+=2)"margin"===n&&(o+=w.css(e,n+Zt[s],!0,i)),r?("content"===n&&(o-=w.css(e,"padding"+Zt[s],!0,i)),"margin"!==n&&(o-=w.css(e,"border"+Zt[s]+"Width",!0,i))):(o+=w.css(e,"padding"+Zt[s],!0,i),"padding"!==n&&(o+=w.css(e,"border"+Zt[s]+"Width",!0,i)));return o}function un(e,t,n){var r=!0,i="width"===t?e.offsetWidth:e.offsetHeight,s=qt(e),o=w.support.boxSizing&&"border-box"===w.css(e,"boxSizing",!1,s);if(0>=i||null==i){if(i=Rt(e,t,s),(0>i||null==i)&&(i=e.style[t]),Jt.test(i))return i;r=o&&(w.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+on(e,t,n||(o?"border":"content"),r,s)+"px"}function an
(e){var t=o,n=Qt[e];return n||(n=fn(e,t),"none"!==n&&n||(It=(It||w("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(It[0].contentWindow||It[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),n=fn(e,t),It.detach()),Qt[e]=n),n}function fn(e,t){var n=w(t.createElement(e)).appendTo(t.body),r=w.css(n[0],"display");return n.remove(),r}function vn(e,t,n,r){var i;if(w.isArray(t))w.each(t,function(t,i){n||cn.test(e)?r(e,i):vn(e+"["+("object"==typeof i?t:"")+"]",i,n,r)});else if(n||"object"!==w.type(t))r(e,t);else for(i in t)vn(e+"["+i+"]",t[i],n,r)}function _n(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var r,i=0,s=t.toLowerCase().match(S)||[];if(w.isFunction(n))while(r=s[i++])"+"===r[0]?(r=r.slice(1)||"*",(e[r]=e[r]||[]).unshift(n)):(e[r]=e[r]||[]).push(n)}}function Dn(e,n,r,i){function u(a){var f;return s[a]=!0,w.each(e[a]||[],function(e,a){var l=a(n,r,i);return"string"!=typeof l||o||s[l]?o?!(f=l):t:(n.dataTypes.unshift(l),u(l),!1)}),f}var s={},o=e===An;return u(n.dataTypes[0])||!s["*"]&&u("*")}function Pn(e,n){var r,i,s=w.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((s[i]?e:r||(r={}))[i]=n[i]);return r&&w.extend(!0,e,r),e}function Hn(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes;while("*"===f[0])f.shift(),s===t&&(s=e.mimeType||n.getResponseHeader("Content-Type"));if(s)for(u in a)if(a[u]&&a[u].test(s)){f.unshift(u);break}if(f[0]in r)o=f[0];else{for(u in r){if(!f[0]||e.converters[u+" "+f[0]]){o=u;break}i||(i=u)}o=o||i}return o?(o!==f[0]&&f.unshift(o),r[o]):t}function Bn
(e,t,n,r){var i,s,o,u,a,f={},l=e.dataTypes.slice();if(l[1])for(o in e.converters)f[o.toLowerCase()]=e.converters[o];s=l.shift();while(s)if(e.responseFields[s]&&(n[e.responseFields[s]]=t),!a&&r&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),a=s,s=l.shift())if("*"===s)s=a;else if("*"!==a&&a!==s){if(o=f[a+" "+s]||f["* "+s],!o)for(i in f)if(u=i.split(" "),u[1]===s&&(o=f[a+" "+u[0]]||f["* "+u[0]])){o===!0?o=f[i]:f[i]!==!0&&(s=u[0],l.unshift(u[1]));break}if(o!==!0)if(o&&e["throws"])t=o(t);else try{t=o(t)}catch(c){return{state:"parsererror",error:o?c:"No conversion from "+a+" to "+s}}}return{state:"success",data:t}}function zn(){try{return new e.XMLHttpRequest}catch(t){}}function Wn(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function Yn(){return setTimeout(function(){Xn=t}),Xn=w.now()}function Zn(e,t,n){var r,i=(Gn[t]||[]).concat(Gn["*"]),s=0,o=i.length;for(;o>s;s++)if(r=i[s].call(n,t,e))return r}function er(e,t,n){var r,i,s=0,o=Qn.length,u=w.Deferred().always(function(){delete a.elem}),a=function(){if(i)return!1;var t=Xn||Yn(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,s=1-r,o=0,a=f.tweens.length;for(;a>o;o++)f.tweens[o].run(s);return u.notifyWith(e,[f,s,n]),1>s&&a?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:w.extend({},t),opts:w.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Xn||Yn(),duration:n.duration,tweens:[],createTween:function(t,n){var r=w.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(r),r},stop:function(t){var n=0,r=t?f.tweens.length:0;if(i)return this;for(i=!0
;r>n;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;for(tr(l,f.opts.specialEasing);o>s;s++)if(r=Qn[s].call(f,e,l,f.opts))return r;return w.map(l,Zn,f),w.isFunction(f.opts.start)&&f.opts.start.call(e,f),w.fx.timer(w.extend(a,{elem:e,anim:f,queue:f.opts.queue})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function tr(e,t){var n,r,i,s,o;for(n in e)if(r=w.camelCase(n),i=t[r],s=e[n],w.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=w.cssHooks[r],o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}function nr(e,t,n){var r,i,s,o,u,a,f=this,l={},c=e.style,h=e.nodeType&&nn(e),p=w._data(e,"fxshow");n.queue||(u=w._queueHooks(e,"fx"),null==u.unqueued&&(u.unqueued=0,a=u.empty.fire,u.empty.fire=function(){u.unqueued||a()}),u.unqueued++,f.always(function(){f.always(function(){u.unqueued--,w.queue(e,"fx").length||u.empty.fire()})})),1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[c.overflow,c.overflowX,c.overflowY],"inline"===w.css(e,"display")&&"none"===w.css(e,"float")&&(w.support.inlineBlockNeedsLayout&&"inline"!==an(e.nodeName)?c.zoom=1:c.display="inline-block")),n.overflow&&(c.overflow="hidden",w.support.shrinkWrapBlocks||f.always(function(){c.overflow=n.overflow[0],c.overflowX=n.overflow[1],c.overflowY=n.overflow[2]}));for(r in t)if(i=t[r],$n.exec(i)){if(delete t[r],s=s||"toggle"===i,i===(h?"hide":"show"))continue;l[r]=p&&p[r]||w.style(e,r)}if(!w.isEmptyObject(l)){p?"hidden"in p&&(h=p.hidden):p=w._data(e,"fxshow",{}
),s&&(p.hidden=!h),h?w(e).show():f.done(function(){w(e).hide()}),f.done(function(){var t;w._removeData(e,"fxshow");for(t in l)w.style(e,t,l[t])});for(r in l)o=Zn(h?p[r]:0,r,f),r in p||(p[r]=o.start,h&&(o.end=o.start,o.start="width"===r||"height"===r?1:0))}}function rr(e,t,n,r,i){return new rr.prototype.init(e,t,n,r,i)}function ir(e,t){var n,r={height:e},i=0;for(t=t?1:0;4>i;i+=2-t)n=Zt[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function sr(e){return w.isWindow(e)?e:9===e.nodeType?e.defaultView||e.parentWindow:!1}var n,r,i=typeof t,s=e.location,o=e.document,u=o.documentElement,a=e.jQuery,f=e.$,l={},c=[],h="1.10.2",p=c.concat,d=c.push,v=c.slice,m=c.indexOf,g=l.toString,y=l.hasOwnProperty,b=h.trim,w=function(e,t){return new w.fn.init(e,t,r)},E=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,S=/\S+/g,x=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,T=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,N=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,C=/^[\],:{}\s]*$/,k=/(?:^|:|,)(?:\s*\[)+/g,L=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,A=/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,O=/^-ms-/,M=/-([\da-z])/gi,_=function(e,t){return t.toUpperCase()},D=function(e){(o.addEventListener||"load"===e.type||"complete"===o.readyState)&&(P(),w.ready())},P=function(){o.addEventListener?(o.removeEventListener("DOMContentLoaded",D,!1),e.removeEventListener("load",D,!1)):(o.detachEvent("onreadystatechange",D),e.detachEvent("onload",D))};w.fn=w.prototype={jquery:h,constructor:w,init:function(e,n,r){var i,s;if(!e)return this;if("string"==typeof e){if(i="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.
length>=3?[null,e,null]:T.exec(e),!i||!i[1]&&n)return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e);if(i[1]){if(n=n instanceof w?n[0]:n,w.merge(this,w.parseHTML(i[1],n&&n.nodeType?n.ownerDocument||n:o,!0)),N.test(i[1])&&w.isPlainObject(n))for(i in n)w.isFunction(this[i])?this[i](n[i]):this.attr(i,n[i]);return this}if(s=o.getElementById(i[2]),s&&s.parentNode){if(s.id!==i[2])return r.find(e);this.length=1,this[0]=s}return this.context=o,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):w.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),w.makeArray(e,this))},selector:"",length:0,toArray:function(){return v.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=w.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return w.each(this,e,t)},ready:function(e){return w.ready.promise().done(e),this},slice:function(){return this.pushStack(v.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,n=+e+(0>e?t:0);return this.pushStack(n>=0&&t>n?[this[n]]:[])},map:function(e){return this.pushStack(w.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:d,sort:[].sort,splice:[].splice},w.fn.init.prototype=w.fn,w.extend=w.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;for("boolean"==typeof u&&(l=u,u=arguments[1]||{},a=2),"object"==typeof 
u||w.isFunction(u)||(u={}),f===a&&(u=this,--a);f>a;a++)if(null!=(s=arguments[a]))for(i in s)e=u[i],r=s[i],u!==r&&(l&&r&&(w.isPlainObject(r)||(n=w.isArray(r)))?(n?(n=!1,o=e&&w.isArray(e)?e:[]):o=e&&w.isPlainObject(e)?e:{},u[i]=w.extend(l,o,r)):r!==t&&(u[i]=r));return u},w.extend({expando:"jQuery"+(h+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===w&&(e.$=f),t&&e.jQuery===w&&(e.jQuery=a),w},isReady:!1,readyWait:1,holdReady:function(e){e?w.readyWait++:w.ready(!0)},ready:function(e){if(e===!0?!--w.readyWait:!w.isReady){if(!o.body)return setTimeout(w.ready);w.isReady=!0,e!==!0&&--w.readyWait>0||(n.resolveWith(o,[w]),w.fn.trigger&&w(o).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===w.type(e)},isArray:Array.isArray||function(e){return"array"===w.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?l[g.call(e)]||"object":typeof e},isPlainObject:function(e){var n;if(!e||"object"!==w.type(e)||e.nodeType||w.isWindow(e))return!1;try{if(e.constructor&&!y.call(e,"constructor")&&!y.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}if(w.support.ownLast)for(n in e)return y.call(e,n);for(n in e);return n===t||y.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw Error(e)},parseHTML:function(e,t,n){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(n=t,t=!1),t=t||o;var r=N.exec(e),i=!n&&[];return r?[t.createElement(r[1])]:(r=
w.buildFragment([e],t,i),i&&w(i).remove(),w.merge([],r.childNodes))},parseJSON:function(n){return e.JSON&&e.JSON.parse?e.JSON.parse(n):null===n?n:"string"==typeof n&&(n=w.trim(n),n&&C.test(n.replace(L,"@").replace(A,"]").replace(k,"")))?Function("return "+n)():(w.error("Invalid JSON: "+n),t)},parseXML:function(n){var r,i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return r&&r.documentElement&&!r.getElementsByTagName("parsererror").length||w.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&w.trim(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(O,"ms-").replace(M,_)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,i=0,s=e.length,o=H(e);if(n){if(o){for(;s>i;i++)if(r=t.apply(e[i],n),r===!1)break}else for(i in e)if(r=t.apply(e[i],n),r===!1)break}else if(o){for(;s>i;i++)if(r=t.call(e[i],i,e[i]),r===!1)break}else for(i in e)if(r=t.call(e[i],i,e[i]),r===!1)break;return e},trim:b&&!b.call("﻿ ")?function(e){return null==e?"":b.call(e)}:function(e){return null==e?"":(e+"").replace(x,"")},makeArray:function(e,t){var n=t||[];return null!=e&&(H(Object(e))?w.merge(n,"string"==typeof e?[e]:e):d.call(n,e)),n},inArray:function(e,t,n){var r;if(t){if(m)return m.call(t,e,n);for(r=t.length,n=n?0>n?Math.max(0,r+n):n:0;r>n;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if("number"==typeof 
r)for(;r>s;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;for(n=!!n;o>s;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,t,n){var r,i=0,s=e.length,o=H(e),u=[];if(o)for(;s>i;i++)r=t(e[i],i,n),null!=r&&(u[u.length]=r);else for(i in e)r=t(e[i],i,n),null!=r&&(u[u.length]=r);return p.apply([],u)},guid:1,proxy:function(e,n){var r,i,s;return"string"==typeof n&&(s=e[n],n=e,e=s),w.isFunction(e)?(r=v.call(arguments,2),i=function(){return e.apply(n||this,r.concat(v.call(arguments)))},i.guid=e.guid=e.guid||w.guid++,i):t},access:function(e,n,r,i,s,o,u){var a=0,f=e.length,l=null==r;if("object"===w.type(r)){s=!0;for(a in r)w.access(e,n,a,r[a],!0,o,u)}else if(i!==t&&(s=!0,w.isFunction(i)||(u=!0),l&&(u?(n.call(e,i),n=null):(l=n,n=function(e,t,n){return l.call(w(e),n)})),n))for(;f>a;a++)n(e[a],r,u?i:i.call(e[a],a,n(e[a],r)));return s?e:l?n.call(e):f?n(e[0],r):o},now:function(){return(new Date).getTime()},swap:function(e,t,n,r){var i,s,o={};for(s in t)o[s]=e.style[s],e.style[s]=t[s];i=n.apply(e,r||[]);for(s in t)e.style[s]=o[s];return i}}),w.ready.promise=function(t){if(!n)if(n=w.Deferred(),"complete"===o.readyState)setTimeout(w.ready);else if(o.addEventListener)o.addEventListener("DOMContentLoaded",D,!1),e.addEventListener("load",D,!1);else{o.attachEvent("onreadystatechange",D),e.attachEvent("onload",D);var r=!1;try{r=null==e.frameElement&&o.documentElement}catch(i){}r&&r.doScroll&&function s(){if(!w.isReady){try{r.doScroll("left")}catch(e){return setTimeout(s,50)}P(),w.ready()}}()}return n.promise(t)},w.each
("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){l["[object "+t+"]"]=t.toLowerCase()}),r=w(o),function(e,t){function ot(e,t,n,i){var s,o,u,a,f,l,p,m,g,w;if((t?t.ownerDocument||t:E)!==h&&c(t),t=t||h,n=n||[],!e||"string"!=typeof e)return n;if(1!==(a=t.nodeType)&&9!==a)return[];if(d&&!i){if(s=Z.exec(e))if(u=s[1]){if(9===a){if(o=t.getElementById(u),!o||!o.parentNode)return n;if(o.id===u)return n.push(o),n}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(u))&&y(t,o)&&o.id===u)return n.push(o),n}else{if(s[2])return H.apply(n,t.getElementsByTagName(e)),n;if((u=s[3])&&r.getElementsByClassName&&t.getElementsByClassName)return H.apply(n,t.getElementsByClassName(u)),n}if(r.qsa&&(!v||!v.test(e))){if(m=p=b,g=t,w=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){l=mt(e),(p=t.getAttribute("id"))?m=p.replace(nt,"\\$&"):t.setAttribute("id",m),m="[id='"+m+"'] ",f=l.length;while(f--)l[f]=m+gt(l[f]);g=$.test(e)&&t.parentNode||t,w=l.join(",")}if(w)try{return H.apply(n,g.querySelectorAll(w)),n}catch(S){}finally{p||t.removeAttribute("id")}}}return Nt(e.replace(W,"$1"),t,n,i)}function ut(){function t(n,r){return e.push(n+=" ")>s.cacheLength&&delete t[e.shift()],t[n]=r}var e=[];return t}function at(e){return e[b]=!0,e}function ft(e){var t=h.createElement("div");try{return!!e(t)}catch(n){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function lt(e,t){var n=e.split("|"),r=e.length;while(r--)s.attrHandle[n[r]]=t}function ct(e,t){var n=t&&e,r=n&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||O)-(~e.sourceIndex||O);if(r)return r;
if(n)while(n=n.nextSibling)if(n===t)return-1;return e?1:-1}function ht(e){return function(t){var n=t.nodeName.toLowerCase();return"input"===n&&t.type===e}}function pt(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function dt(e){return at(function(t){return t=+t,at(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function vt(){}function mt(e,t){var n,r,i,o,u,a,f,l=N[e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=s.preFilter;while(u){(!n||(r=X.exec(u)))&&(r&&(u=u.slice(r[0].length)||u),a.push(i=[])),n=!1,(r=V.exec(u))&&(n=r.shift(),i.push({value:n,type:r[0].replace(W," ")}),u=u.slice(n.length));for(o in s.filter)!(r=G[o].exec(u))||f[o]&&!(r=f[o](r))||(n=r.shift(),i.push({value:n,type:o,matches:r}),u=u.slice(n.length));if(!n)break}return t?u.length:u?ot.error(e):N(e,a).slice(0)}function gt(e){var t=0,n=e.length,r="";for(;n>t;t++)r+=e[t].value;return r}function yt(e,t,n){var r=t.dir,s=n&&"parentNode"===r,o=x++;return t.first?function(t,n,i){while(t=t[r])if(1===t.nodeType||s)return e(t,n,i)}:function(t,n,u){var a,f,l,c=S+" "+o;if(u){while(t=t[r])if((1===t.nodeType||s)&&e(t,n,u))return!0}else while(t=t[r])if(1===t.nodeType||s)if(l=t[b]||(t[b]={}),(f=l[r])&&f[0]===c){if((a=f[1])===!0||a===i)return a===!0}else if(f=l[r]=[c],f[1]=e(t,n,u)||i,f[1]===!0)return!0}}function bt(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function wt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=null!=t;for(;a>u;u++)(s=e[u])&&(!n||n(s,r,i))&&(o.push(s),f&&t.push
(u));return o}function Et(e,t,n,r,i,s){return r&&!r[b]&&(r=Et(r)),i&&!i[b]&&(i=Et(i,s)),at(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||Tt(t||"*",u.nodeType?[u]:u,[]),m=!e||!s&&t?v:wt(v,h,e,u,a),g=n?i||(s?e:d||r)?[]:o:m;if(n&&n(m,g,u,a),r){f=wt(g,p),r(f,[],u,a),l=f.length;while(l--)(c=f[l])&&(g[p[l]]=!(m[p[l]]=c))}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?j.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=wt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):H.apply(o,g)})}function St(e){var t,n,r,i=e.length,o=s.relative[e[0].type],u=o||s.relative[" "],a=o?1:0,l=yt(function(e){return e===t},u,!0),c=yt(function(e){return j.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==f)||((t=n).nodeType?l(e,n,r):c(e,n,r))}];for(;i>a;a++)if(n=s.relative[e[a].type])h=[yt(bt(h),n)];else{if(n=s.filter[e[a].type].apply(null,e[a].matches),n[b]){for(r=++a;i>r;r++)if(s.relative[e[r].type])break;return Et(a>1&&bt(h),a>1&&gt(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(W,"$1"),n,r>a&&St(e.slice(a,r)),i>r&&St(e=e.slice(r)),i>r&&gt(e))}h.push(n)}return bt(h)}function xt(e,t){var n=0,r=t.length>0,o=e.length>0,u=function(u,a,l,c,p){var d,v,m,g=[],y=0,b="0",w=u&&[],E=null!=p,x=f,T=u||o&&s.find.TAG("*",p&&a.parentNode||a),N=S+=null==x?1:Math.random()||.1;for(E&&(f=a!==h&&a,i=n);null!=(d=T[b]);b++){if(o&&d){v=0;while(m=e[v++])if(m(d,a,l)){c.push(d);break}E&&(S=N,i=++n)}r&&((d=!m&&d)&&y--,u&&w.push(d))}if(y+=b,r&&b!==y){v=0;while(m=t[v++])m(w,g,a,l);if(u){if(y>0)while(b--)w[b]||g[b]||(g[b]=D.call(
c));g=wt(g)}H.apply(c,g),E&&!u&&g.length>0&&y+t.length>1&&ot.uniqueSort(c)}return E&&(S=N,f=x),w};return r?at(u):u}function Tt(e,t,n){var r=0,i=t.length;for(;i>r;r++)ot(e,t[r],n);return n}function Nt(e,t,n,i){var o,u,f,l,c,h=mt(e);if(!i&&1===h.length){if(u=h[0]=h[0].slice(0),u.length>2&&"ID"===(f=u[0]).type&&r.getById&&9===t.nodeType&&d&&s.relative[u[1].type]){if(t=(s.find.ID(f.matches[0].replace(rt,it),t)||[])[0],!t)return n;e=e.slice(u.shift().value.length)}o=G.needsContext.test(e)?0:u.length;while(o--){if(f=u[o],s.relative[l=f.type])break;if((c=s.find[l])&&(i=c(f.matches[0].replace(rt,it),$.test(u[0].type)&&t.parentNode||t))){if(u.splice(o,1),e=i.length&&gt(u),!e)return H.apply(n,i),n;break}}}return a(e,h)(i,t,!d,n,$.test(e)),n}var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b="sizzle"+ -(new Date),E=e.document,S=0,x=0,T=ut(),N=ut(),C=ut(),k=!1,L=function(e,t){return e===t?(k=!0,0):0},A=typeof t,O=1<<31,M={}.hasOwnProperty,_=[],D=_.pop,P=_.push,H=_.push,B=_.slice,j=_.indexOf||function(e){var t=0,n=this.length;for(;n>t;t++)if(this[t]===e)return t;return-1},F="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",I="[\\x20\\t\\r\\n\\f]",q="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",R=q.replace("w","w#"),U="\\["+I+"*("+q+")"+I+"*(?:([*^$|!~]?=)"+I+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+R+")|)|)"+I+"*\\]",z=":("+q+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+U.replace(3,8)+")*)|.*)\\)|)",W=RegExp("^"+I+"+|((?:^|[^\\\\])(?:\\\\.)*)"+I+"+$","g"),X=RegExp("^"+I+"*,"+I+"*"),V=RegExp("^"+I+"*([>+~]|"+I+")"+I+"*"
),$=RegExp(I+"*[+~]"),J=RegExp("="+I+"*([^\\]'\"]*)"+I+"*\\]","g"),K=RegExp(z),Q=RegExp("^"+R+"$"),G={ID:RegExp("^#("+q+")"),CLASS:RegExp("^\\.("+q+")"),TAG:RegExp("^("+q.replace("w","w*")+")"),ATTR:RegExp("^"+U),PSEUDO:RegExp("^"+z),CHILD:RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+I+"*(even|odd|(([+-]|)(\\d*)n|)"+I+"*(?:([+-]|)"+I+"*(\\d+)|))"+I+"*\\)|)","i"),bool:RegExp("^(?:"+F+")$","i"),needsContext:RegExp("^"+I+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+I+"*((?:-\\d)?\\d*)"+I+"*\\)|)(?=[^-]|$)","i")},Y=/^[^{]+\{\s*\[native \w/,Z=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,et=/^(?:input|select|textarea|button)$/i,tt=/^h\d$/i,nt=/'|\\/g,rt=RegExp("\\\\([\\da-f]{1,6}"+I+"?|("+I+")|.)","ig"),it=function(e,t,n){var r="0x"+t-65536;return r!==r||n?t:0>r?String.fromCharCode(r+65536):String.fromCharCode(55296|r>>10,56320|1023&r)};try{H.apply(_=B.call(E.childNodes),E.childNodes),_[E.childNodes.length].nodeType}catch(st){H={apply:_.length?function(e,t){P.apply(e,B.call(t))}:function(e,t){var n=e.length,r=0;while(e[n++]=t[r++]);e.length=n-1}}}u=ot.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},r=ot.support={},c=ot.setDocument=function(e){var n=e?e.ownerDocument||e:E,i=n.defaultView;return n!==h&&9===n.nodeType&&n.documentElement?(h=n,p=n.documentElement,d=!u(n),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",function(){c()}),r.attributes=ft(function(e){return e.className="i",!e.getAttribute("className")}),r.getElementsByTagName=ft(function(e){return e.appendChild(n.createComment("")),!e.getElementsByTagName
("*").length}),r.getElementsByClassName=ft(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),r.getById=ft(function(e){return p.appendChild(e).id=b,!n.getElementsByName||!n.getElementsByName(b).length}),r.getById?(s.find.ID=function(e,t){if(typeof t.getElementById!==A&&d){var n=t.getElementById(e);return n&&n.parentNode?[n]:[]}},s.filter.ID=function(e){var t=e.replace(rt,it);return function(e){return e.getAttribute("id")===t}}):(delete s.find.ID,s.filter.ID=function(e){var t=e.replace(rt,it);return function(e){var n=typeof e.getAttributeNode!==A&&e.getAttributeNode("id");return n&&n.value===t}}),s.find.TAG=r.getElementsByTagName?function(e,n){return typeof n.getElementsByTagName!==A?n.getElementsByTagName(e):t}:function(e,t){var n,r=[],i=0,s=t.getElementsByTagName(e);if("*"===e){while(n=s[i++])1===n.nodeType&&r.push(n);return r}return s},s.find.CLASS=r.getElementsByClassName&&function(e,n){return typeof n.getElementsByClassName!==A&&d?n.getElementsByClassName(e):t},m=[],v=[],(r.qsa=Y.test(n.querySelectorAll))&&(ft(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||v.push("\\["+I+"*(?:value|"+F+")"),e.querySelectorAll(":checked").length||v.push(":checked")}),ft(function(e){var t=n.createElement("input");t.setAttribute("type","hidden"),e.appendChild(t).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&v.push("[*^$]="+I+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||v.push(":enabled",":disabled"),e.querySelectorAll
("*,:x"),v.push(",.*:")})),(r.matchesSelector=Y.test(g=p.webkitMatchesSelector||p.mozMatchesSelector||p.oMatchesSelector||p.msMatchesSelector))&&ft(function(e){r.disconnectedMatch=g.call(e,"div"),g.call(e,"[s!='']:x"),m.push("!=",z)}),v=v.length&&RegExp(v.join("|")),m=m.length&&RegExp(m.join("|")),y=Y.test(p.contains)||p.compareDocumentPosition?function(e,t){var n=9===e.nodeType?e.documentElement:e,r=t&&t.parentNode;return e===r||!!r&&1===r.nodeType&&!!(n.contains?n.contains(r):e.compareDocumentPosition&&16&e.compareDocumentPosition(r))}:function(e,t){if(t)while(t=t.parentNode)if(t===e)return!0;return!1},L=p.compareDocumentPosition?function(e,t){if(e===t)return k=!0,0;var i=t.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(t);return i?1&i||!r.sortDetached&&t.compareDocumentPosition(e)===i?e===n||y(E,e)?-1:t===n||y(E,t)?1:l?j.call(l,e)-j.call(l,t):0:4&i?-1:1:e.compareDocumentPosition?-1:1}:function(e,t){var r,i=0,s=e.parentNode,o=t.parentNode,u=[e],a=[t];if(e===t)return k=!0,0;if(!s||!o)return e===n?-1:t===n?1:s?-1:o?1:l?j.call(l,e)-j.call(l,t):0;if(s===o)return ct(e,t);r=e;while(r=r.parentNode)u.unshift(r);r=t;while(r=r.parentNode)a.unshift(r);while(u[i]===a[i])i++;return i?ct(u[i],a[i]):u[i]===E?-1:a[i]===E?1:0},n):h},ot.matches=function(e,t){return ot(e,null,null,t)},ot.matchesSelector=function(e,t){if((e.ownerDocument||e)!==h&&c(e),t=t.replace(J,"='$1']"),!(!r.matchesSelector||!d||m&&m.test(t)||v&&v.test(t)))try{var n=g.call(e,t);if(n||r.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(i){}return ot(t,h,null,[e]).length>0
},ot.contains=function(e,t){return(e.ownerDocument||e)!==h&&c(e),y(e,t)},ot.attr=function(e,n){(e.ownerDocument||e)!==h&&c(e);var i=s.attrHandle[n.toLowerCase()],o=i&&M.call(s.attrHandle,n.toLowerCase())?i(e,n,!d):t;return o===t?r.attributes||!d?e.getAttribute(n):(o=e.getAttributeNode(n))&&o.specified?o.value:null:o},ot.error=function(e){throw Error("Syntax error, unrecognized expression: "+e)},ot.uniqueSort=function(e){var t,n=[],i=0,s=0;if(k=!r.detectDuplicates,l=!r.sortStable&&e.slice(0),e.sort(L),k){while(t=e[s++])t===e[s]&&(i=n.push(s));while(i--)e.splice(n[i],1)}return e},o=ot.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(1===i||9===i||11===i){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=o(e)}else if(3===i||4===i)return e.nodeValue}else for(;t=e[r];r++)n+=o(t);return n},s=ot.selectors={cacheLength:50,createPseudo:at,match:G,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(rt,it),e[3]=(e[4]||e[5]||"").replace(rt,it),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||ot.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&ot.error(e[0]),e},PSEUDO:function(e){var n,r=!e[5]&&e[2];return G.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:r&&K.test(r)&&(n=mt(r,!0))&&(n=r.indexOf(")",r.length-n)-r.length)&&(e[0]=e[0].slice(0,n),e[2
]=r.slice(0,n)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(rt,it).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=T[e+" "];return t||(t=RegExp("(^|"+I+")"+e+"("+I+"|$)"))&&T(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==A&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var i=ot.attr(r,e);return null==i?"!="===t:t?(i+="","="===t?i===n:"!="===t?i!==n:"^="===t?n&&0===i.indexOf(n):"*="===t?n&&i.indexOf(n)>-1:"$="===t?n&&i.slice(-n.length)===n:"~="===t?(" "+i+" ").indexOf(n)>-1:"|="===t?i===n||i.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r,i){var s="nth"!==e.slice(0,3),o="last"!==e.slice(-4),u="of-type"===t;return 1===r&&0===i?function(e){return!!e.parentNode}:function(t,n,a){var f,l,c,h,p,d,v=s!==o?"nextSibling":"previousSibling",m=t.parentNode,g=u&&t.nodeName.toLowerCase(),y=!a&&!u;if(m){if(s){while(v){c=t;while(c=c[v])if(u?c.nodeName.toLowerCase()===g:1===c.nodeType)return!1;d=v="only"===e&&!d&&"nextSibling"}return!0}if(d=[o?m.firstChild:m.lastChild],o&&y){l=m[b]||(m[b]={}),f=l[e]||[],p=f[0]===S&&f[1],h=f[0]===S&&f[2],c=p&&m.childNodes[p];while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if(1===c.nodeType&&++h&&c===t){l[e]=[S,p,h];break}}else if(y&&(f=(t[b]||(t[b]={}))[e])&&f[0]===S)h=f[1];else while(c=++p&&c&&c[v]||(h=p=0)||d.pop())if((u?c.nodeName.toLowerCase()===g:1===c.nodeType)&&++h&&(y&&((c[b]||(c[b]={}))[e]=[S,h]),c===t))break;return h-=i,h===r||0===h%r&&h/r>=0}}},PSEUDO:function(e,t){var n,r=s.
pseudos[e]||s.setFilters[e.toLowerCase()]||ot.error("unsupported pseudo: "+e);return r[b]?r(t):r.length>1?(n=[e,e,"",t],s.setFilters.hasOwnProperty(e.toLowerCase())?at(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=j.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:at(function(e){var t=[],n=[],r=a(e.replace(W,"$1"));return r[b]?at(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)(s=o[u])&&(e[u]=!(t[u]=s))}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:at(function(e){return function(t){return ot(e,t).length>0}}),contains:at(function(e){return function(t){return(t.textContent||t.innerText||o(t)).indexOf(e)>-1}}),lang:at(function(e){return Q.test(e||"")||ot.error("unsupported lang: "+e),e=e.replace(rt,it).toLowerCase(),function(t){var n;do if(n=d?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return n=n.toLowerCase(),n===e||0===n.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var n=e.location&&e.location.hash;return n&&n.slice(1)===t.id},root:function(e){return e===p},focus:function(e){return e===h.activeElement&&(!h.hasFocus||h.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1
;return!0},parent:function(e){return!s.pseudos.empty(e)},header:function(e){return tt.test(e.nodeName)},input:function(e){return et.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:dt(function(){return[0]}),last:dt(function(e,t){return[t-1]}),eq:dt(function(e,t,n){return[0>n?n+t:n]}),even:dt(function(e,t){var n=0;for(;t>n;n+=2)e.push(n);return e}),odd:dt(function(e,t){var n=1;for(;t>n;n+=2)e.push(n);return e}),lt:dt(function(e,t,n){var r=0>n?n+t:n;for(;--r>=0;)e.push(r);return e}),gt:dt(function(e,t,n){var r=0>n?n+t:n;for(;t>++r;)e.push(r);return e})}},s.pseudos.nth=s.pseudos.eq;for(n in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})s.pseudos[n]=ht(n);for(n in{submit:!0,reset:!0})s.pseudos[n]=pt(n);vt.prototype=s.filters=s.pseudos,s.setFilters=new vt,a=ot.compile=function(e,t){var n,r=[],i=[],s=C[e+" "];if(!s){t||(t=mt(e)),n=t.length;while(n--)s=St(t[n]),s[b]?r.push(s):i.push(s);s=C(e,xt(i,r))}return s},r.sortStable=b.split("").sort(L).join("")===b,r.detectDuplicates=k,c(),r.sortDetached=ft(function(e){return 1&e.compareDocumentPosition(h.createElement("div"))}),ft(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||lt("type|href|height|width",function(e,n,r){return r?t:e.getAttribute(n,"type"===n.toLowerCase()?1:2)}),r.attributes&&ft(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value","")
,""===e.firstChild.getAttribute("value")})||lt("value",function(e,n,r){return r||"input"!==e.nodeName.toLowerCase()?t:e.defaultValue}),ft(function(e){return null==e.getAttribute("disabled")})||lt(F,function(e,n,r){var i;return r?t:(i=e.getAttributeNode(n))&&i.specified?i.value:e[n]===!0?n.toLowerCase():null}),w.find=ot,w.expr=ot.selectors,w.expr[":"]=w.expr.pseudos,w.unique=ot.uniqueSort,w.text=ot.getText,w.isXMLDoc=ot.isXML,w.contains=ot.contains}(e);var B={};w.Callbacks=function(e){e="string"==typeof e?B[e]||j(e):w.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){for(r=e.memory&&t,i=!0,o=u||0,u=0,s=a.length,n=!0;a&&s>o;o++)if(a[o].apply(t[0],t[1])===!1&&e.stopOnFalse){r=!1;break}n=!1,a&&(f?f.length&&l(f.shift()):r?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function i(t){w.each(t,function(t,n){var r=w.type(n);"function"===r?e.unique&&c.has(n)||a.push(n):n&&n.length&&"string"!==r&&i(n)})})(arguments),n?s=a.length:r&&(u=t,l(r))}return this},remove:function(){return a&&w.each(arguments,function(e,t){var r;while((r=w.inArray(t,a,r))>-1)a.splice(r,1),n&&(s>=r&&s--,o>=r&&o--)}),this},has:function(e){return e?w.inArray(e,a)>-1:!!a&&!!a.length},empty:function(){return a=[],s=0,this},disable:function(){return a=f=r=t,this},disabled:function(){return!a},lock:function(){return f=t,r||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return!a||i&&!f||(t=t||[],t=[e,t.slice?t.slice():t],n?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!i}};return c},w.extend({Deferred:function(e){var t=
[["resolve","done",w.Callbacks("once memory"),"resolved"],["reject","fail",w.Callbacks("once memory"),"rejected"],["notify","progress",w.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return w.Deferred(function(n){w.each(t,function(t,s){var o=s[0],u=w.isFunction(e[t])&&e[t];i[s[1]](function(){var e=u&&u.apply(this,arguments);e&&w.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[o+"With"](this===r?n.promise():this,u?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?w.extend(e,r):r}},i={};return r.pipe=r.then,w.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[1^e][2].disable,t[2][2].lock),i[s[0]]=function(){return i[s[0]+"With"](this===i?r:this,arguments),this},i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=v.call(arguments),r=n.length,i=1!==r||e&&w.isFunction(e.promise)?r:0,s=1===i?e:w.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?v.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1)for(u=Array(r),a=Array(r),f=Array(r);r>t;t++)n[t]&&w.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i;return i||s.resolveWith(f,n),s.promise()}}),w.support=function(t){var n,r,s,u,a,f,l,c,h,p=o.createElement("div");if(p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName
("*")||[],r=p.getElementsByTagName("a")[0],!r||!r.style||!n.length)return t;u=o.createElement("select"),f=u.appendChild(o.createElement("option")),s=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t.getSetAttribute="t"!==p.className,t.leadingWhitespace=3===p.firstChild.nodeType,t.tbody=!p.getElementsByTagName("tbody").length,t.htmlSerialize=!!p.getElementsByTagName("link").length,t.style=/top/.test(r.getAttribute("style")),t.hrefNormalized="/a"===r.getAttribute("href"),t.opacity=/^0.5/.test(r.style.opacity),t.cssFloat=!!r.style.cssFloat,t.checkOn=!!s.value,t.optSelected=f.selected,t.enctype=!!o.createElement("form").enctype,t.html5Clone="<:nav></:nav>"!==o.createElement("nav").cloneNode(!0).outerHTML,t.inlineBlockNeedsLayout=!1,t.shrinkWrapBlocks=!1,t.pixelPosition=!1,t.deleteExpando=!0,t.noCloneEvent=!0,t.reliableMarginRight=!0,t.boxSizingReliable=!0,s.checked=!0,t.noCloneChecked=s.cloneNode(!0).checked,u.disabled=!0,t.optDisabled=!f.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}s=o.createElement("input"),s.setAttribute("value",""),t.input=""===s.getAttribute("value"),s.value="t",s.setAttribute("type","radio"),t.radioValue="t"===s.value,s.setAttribute("checked","t"),s.setAttribute("name","t"),a=o.createDocumentFragment(),a.appendChild(s),t.appendChecked=s.checked,t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,p.attachEvent&&(p.attachEvent("onclick",function(){t.noCloneEvent=!1}),p.cloneNode(!0).click());for(h in{submit:!0,change:!0,focusin:!0})p.setAttribute(l="on"+h,"t"),t[h+"Bubbles"]=l in e||p.attributes[l].expando===!1
;p.style.backgroundClip="content-box",p.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===p.style.backgroundClip;for(h in w(t))break;return t.ownLast="0"!==h,w(function(){var n,r,s,u="padding:0;margin:0;border:0;display:block;box-sizing:content-box;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;",a=o.getElementsByTagName("body")[0];a&&(n=o.createElement("div"),n.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",a.appendChild(n).appendChild(p),p.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=p.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",c=0===s[0].offsetHeight,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=c&&0===s[0].offsetHeight,p.innerHTML="",p.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",w.swap(a,null!=a.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===p.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(p,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(p,null)||{width:"4px"}).width,r=p.appendChild(o.createElement("div")),r.style.cssText=p.style.cssText=u,r.style.marginRight=r.style.width="0",p.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(r,null)||{}).marginRight)),typeof p.style.zoom!==i&&(p.innerHTML="",p.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===p.offsetWidth,p.
style.display="block",p.innerHTML="<div></div>",p.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==p.offsetWidth,t.inlineBlockNeedsLayout&&(a.style.zoom=1)),a.removeChild(n),n=p=s=r=null)}),n=u=a=f=r=s=null,t}({});var F=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,I=/([A-Z])/g;w.extend({cache:{},noData:{applet:!0,embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(e){return e=e.nodeType?w.cache[e[w.expando]]:e[w.expando],!!e&&!z(e)},data:function(e,t,n){return q(e,t,n)},removeData:function(e,t){return R(e,t)},_data:function(e,t,n){return q(e,t,n,!0)},_removeData:function(e,t){return R(e,t,!0)},acceptData:function(e){if(e.nodeType&&1!==e.nodeType&&9!==e.nodeType)return!1;var t=e.nodeName&&w.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),w.fn.extend({data:function(e,n){var r,i,s=null,o=0,u=this[0];if(e===t){if(this.length&&(s=w.data(u),1===u.nodeType&&!w._data(u,"parsedAttrs"))){for(r=u.attributes;r.length>o;o++)i=r[o].name,0===i.indexOf("data-")&&(i=w.camelCase(i.slice(5)),U(u,i,s[i]));w._data(u,"parsedAttrs",!0)}return s}return"object"==typeof e?this.each(function(){w.data(this,e)}):arguments.length>1?this.each(function(){w.data(this,e,n)}):u?U(u,e,w.data(u,e)):null},removeData:function(e){return this.each(function(){w.removeData(this,e)})}}),w.extend({queue:function(e,n,r){var i;return e?(n=(n||"fx")+"queue",i=w._data(e,n),r&&(!i||w.isArray(r)?i=w._data(e,n,w.makeArray(r)):i.push(r)),i||[]):t},dequeue:function(e,t){t=t||"fx";var n=w.queue(e,t),r=n.length,i=n.shift(),s=w._queueHooks(e,t),o=function(){w.dequeue(e,t)};"inprogress"===
i&&(i=n.shift(),r--),i&&("fx"===t&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return w._data(e,n)||w._data(e,n,{empty:w.Callbacks("once memory").add(function(){w._removeData(e,t+"queue"),w._removeData(e,n)})})}}),w.fn.extend({queue:function(e,n){var r=2;return"string"!=typeof e&&(n=e,e="fx",r--),r>arguments.length?w.queue(this[0],e):n===t?this:this.each(function(){var t=w.queue(this,e,n);w._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&w.dequeue(this,e)})},dequeue:function(e){return this.each(function(){w.dequeue(this,e)})},delay:function(e,t){return e=w.fx?w.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=w.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};"string"!=typeof e&&(n=e,e=t),e=e||"fx";while(u--)r=w._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var W,X,V=/[\t\r\n\f]/g,$=/\r/g,J=/^(?:input|select|textarea|button|object)$/i,K=/^(?:a|area)$/i,Q=/^(?:checked|selected)$/i,G=w.support.getSetAttribute,Y=w.support.input;w.fn.extend({attr:function(e,t){return w.access(this,w.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){w.removeAttr(this,e)})},prop:function(e,t){return w.access(this,w.prop,e,t,arguments.length>1)},removeProp:function(e){return e=w.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(
e){var t,n,r,i,s,o=0,u=this.length,a="string"==typeof e&&e;if(w.isFunction(e))return this.each(function(t){w(this).addClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(S)||[];u>o;o++)if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(V," "):" ")){s=0;while(i=t[s++])0>r.indexOf(" "+i+" ")&&(r+=i+" ");n.className=w.trim(r)}return this},removeClass:function(e){var t,n,r,i,s,o=0,u=this.length,a=0===arguments.length||"string"==typeof e&&e;if(w.isFunction(e))return this.each(function(t){w(this).removeClass(e.call(this,t,this.className))});if(a)for(t=(e||"").match(S)||[];u>o;o++)if(n=this[o],r=1===n.nodeType&&(n.className?(" "+n.className+" ").replace(V," "):"")){s=0;while(i=t[s++])while(r.indexOf(" "+i+" ")>=0)r=r.replace(" "+i+" "," ");n.className=e?w.trim(r):""}return this},toggleClass:function(e,t){var n=typeof e;return"boolean"==typeof t&&"string"===n?t?this.addClass(e):this.removeClass(e):w.isFunction(e)?this.each(function(n){w(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n){var t,r=0,s=w(this),o=e.match(S)||[];while(t=o[r++])s.hasClass(t)?s.removeClass(t):s.addClass(t)}else(n===i||"boolean"===n)&&(this.className&&w._data(this,"__className__",this.className),this.className=this.className||e===!1?"":w._data(this,"__className__")||"")})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;r>n;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(V," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(arguments.length)return i=w.isFunction(e),this.each(function(
n){var s;1===this.nodeType&&(s=i?e.call(this,n,w(this).val()):e,null==s?s="":"number"==typeof s?s+="":w.isArray(s)&&(s=w.map(s,function(e){return null==e?"":e+""})),r=w.valHooks[this.type]||w.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,s,"value")!==t||(this.value=s))});if(s)return r=w.valHooks[s.type]||w.valHooks[s.nodeName.toLowerCase()],r&&"get"in r&&(n=r.get(s,"value"))!==t?n:(n=s.value,"string"==typeof n?n.replace($,""):null==n?"":n)}}),w.extend({valHooks:{option:{get:function(e){var t=w.find.attr(e,"value");return null!=t?t:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s="select-one"===e.type||0>i,o=s?null:[],u=s?i+1:r.length,a=0>i?u:s?i:0;for(;u>a;a++)if(n=r[a],!(!n.selected&&a!==i||(w.support.optDisabled?n.disabled:null!==n.getAttribute("disabled"))||n.parentNode.disabled&&w.nodeName(n.parentNode,"optgroup"))){if(t=w(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n,r,i=e.options,s=w.makeArray(t),o=i.length;while(o--)r=i[o],(r.selected=w.inArray(w(r).val(),s)>=0)&&(n=!0);return n||(e.selectedIndex=-1),s}}},attr:function(e,n,r){var s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return typeof e.getAttribute===i?w.prop(e,n,r):(1===u&&w.isXMLDoc(e)||(n=n.toLowerCase(),s=w.attrHooks[n]||(w.expr.match.bool.test(n)?X:W)),r===t?s&&"get"in s&&null!==(o=s.get(e,n))?o:(o=w.find.attr(e,n),null==o?t:o):null!==r?s&&"set"in s&&(o=s.set(e,r,n))!==t?o:(e.setAttribute(n,r+""),r):(w.removeAttr(e,n),t))},removeAttr:function(e,t){var n,r,i=0,s=t&&t.match(S);if(s&&1===e.nodeType)while(n=s[i++])r=w.propFix[n]||n,w.expr.match.bool.test(n)?
Y&&G||!Q.test(n)?e[r]=!1:e[w.camelCase("default-"+n)]=e[r]=!1:w.attr(e,n,""),e.removeAttribute(G?n:r)},attrHooks:{type:{set:function(e,t){if(!w.support.radioValue&&"radio"===t&&w.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(e&&3!==u&&8!==u&&2!==u)return o=1!==u||!w.isXMLDoc(e),o&&(n=w.propFix[n]||n,s=w.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&null!==(i=s.get(e,n))?i:e[n]},propHooks:{tabIndex:{get:function(e){var t=w.find.attr(e,"tabindex");return t?parseInt(t,10):J.test(e.nodeName)||K.test(e.nodeName)&&e.href?0:-1}}}}),X={set:function(e,t,n){return t===!1?w.removeAttr(e,n):Y&&G||!Q.test(n)?e.setAttribute(!G&&w.propFix[n]||n,n):e[w.camelCase("default-"+n)]=e[n]=!0,n}},w.each(w.expr.match.bool.source.match(/\w+/g),function(e,n){var r=w.expr.attrHandle[n]||w.find.attr;w.expr.attrHandle[n]=Y&&G||!Q.test(n)?function(e,n,i){var s=w.expr.attrHandle[n],o=i?t:(w.expr.attrHandle[n]=t)!=r(e,n,i)?n.toLowerCase():null;return w.expr.attrHandle[n]=s,o}:function(e,n,r){return r?t:e[w.camelCase("default-"+n)]?n.toLowerCase():null}}),Y&&G||(w.attrHooks.value={set:function(e,n,r){return w.nodeName(e,"input")?(e.defaultValue=n,t):W&&W.set(e,n,r)}}),G||(W={set:function(e,n,r){var i=e.getAttributeNode(r);return i||e.setAttributeNode(i=e.ownerDocument.createAttribute(r)),i.value=n+="","value"===r||n===e.getAttribute(r)?n:t}},w.expr.attrHandle.id=w.expr.attrHandle.name=w.expr.attrHandle.coords=function(e,n,r){var i;return r?t:(i=
e.getAttributeNode(n))&&""!==i.value?i.value:null},w.valHooks.button={get:function(e,n){var r=e.getAttributeNode(n);return r&&r.specified?r.value:t},set:W.set},w.attrHooks.contenteditable={set:function(e,t,n){W.set(e,""===t?!1:t,n)}},w.each(["width","height"],function(e,n){w.attrHooks[n]={set:function(e,r){return""===r?(e.setAttribute(n,"auto"),r):t}}})),w.support.hrefNormalized||w.each(["href","src"],function(e,t){w.propHooks[t]={get:function(e){return e.getAttribute(t,4)}}}),w.support.style||(w.attrHooks.style={get:function(e){return e.style.cssText||t},set:function(e,t){return e.style.cssText=t+""}}),w.support.optSelected||(w.propHooks.selected={get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}),w.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){w.propFix[this.toLowerCase()]=this}),w.support.enctype||(w.propFix.enctype="encoding"),w.each(["radio","checkbox"],function(){w.valHooks[this]={set:function(e,n){return w.isArray(n)?e.checked=w.inArray(w(e).val(),n)>=0:t}},w.support.checkOn||(w.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var Z=/^(?:input|select|textarea)$/i,et=/^key/,tt=/^(?:mouse|contextmenu)|click/,nt=/^(?:focusinfocus|focusoutblur)$/,rt=/^([^.]*)(?:\.(.+)|)$/;w.event={global:{},add:function(e,n,r,s,o){var u,a,f,l,c,h,p,d,v,m,g,y=w._data(e);if(y){r.handler&&(l=r,r=l.handler,o=l.selector),r.guid||(r.guid=w.guid++),(a=y.events)||(a=y.events={}),(h=y.handle)||(h=y.handle=function(
e){return typeof w===i||e&&w.event.triggered===e.type?t:w.event.dispatch.apply(h.elem,arguments)},h.elem=e),n=(n||"").match(S)||[""],f=n.length;while(f--)u=rt.exec(n[f])||[],v=g=u[1],m=(u[2]||"").split(".").sort(),v&&(c=w.event.special[v]||{},v=(o?c.delegateType:c.bindType)||v,c=w.event.special[v]||{},p=w.extend({type:v,origType:g,data:s,handler:r,guid:r.guid,selector:o,needsContext:o&&w.expr.match.needsContext.test(o),namespace:m.join(".")},l),(d=a[v])||(d=a[v]=[],d.delegateCount=0,c.setup&&c.setup.call(e,s,m,h)!==!1||(e.addEventListener?e.addEventListener(v,h,!1):e.attachEvent&&e.attachEvent("on"+v,h))),c.add&&(c.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),o?d.splice(d.delegateCount++,0,p):d.push(p),w.event.global[v]=!0);e=null}},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,v,m=w.hasData(e)&&w._data(e);if(m&&(l=m.events)){t=(t||"").match(S)||[""],f=t.length;while(f--)if(u=rt.exec(t[f])||[],p=v=u[1],d=(u[2]||"").split(".").sort(),p){c=w.event.special[p]||{},p=(r?c.delegateType:c.bindType)||p,h=l[p]||[],u=u[2]&&RegExp("(^|\\.)"+d.join("\\.(?:.*\\.|)")+"(\\.|$)"),a=s=h.length;while(s--)o=h[s],!i&&v!==o.origType||n&&n.guid!==o.guid||u&&!u.test(o.namespace)||r&&r!==o.selector&&("**"!==r||!o.selector)||(h.splice(s,1),o.selector&&h.delegateCount--,c.remove&&c.remove.call(e,o));a&&!h.length&&(c.teardown&&c.teardown.call(e,d,m.handle)!==!1||w.removeEvent(e,p,m.handle),delete l[p])}else for(p in l)w.event.remove(e,p+t[f],n,r,!0);w.isEmptyObject(l)&&(delete m.handle,w._removeData(e,"events"))}},trigger:function(n,r,i,s){var u,a,f,l,c,h,p,d=[i||o],v=y.call(n,"type")?n
.type:n,m=y.call(n,"namespace")?n.namespace.split("."):[];if(f=h=i=i||o,3!==i.nodeType&&8!==i.nodeType&&!nt.test(v+w.event.triggered)&&(v.indexOf(".")>=0&&(m=v.split("."),v=m.shift(),m.sort()),a=0>v.indexOf(":")&&"on"+v,n=n[w.expando]?n:new w.Event(v,"object"==typeof n&&n),n.isTrigger=s?2:3,n.namespace=m.join("."),n.namespace_re=n.namespace?RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,n.result=t,n.target||(n.target=i),r=null==r?[n]:w.makeArray(r,[n]),c=w.event.special[v]||{},s||!c.trigger||c.trigger.apply(i,r)!==!1)){if(!s&&!c.noBubble&&!w.isWindow(i)){for(l=c.delegateType||v,nt.test(l+v)||(f=f.parentNode);f;f=f.parentNode)d.push(f),h=f;h===(i.ownerDocument||o)&&d.push(h.defaultView||h.parentWindow||e)}p=0;while((f=d[p++])&&!n.isPropagationStopped())n.type=p>1?l:c.bindType||v,u=(w._data(f,"events")||{})[n.type]&&w._data(f,"handle"),u&&u.apply(f,r),u=a&&f[a],u&&w.acceptData(f)&&u.apply&&u.apply(f,r)===!1&&n.preventDefault();if(n.type=v,!s&&!n.isDefaultPrevented()&&(!c._default||c._default.apply(d.pop(),r)===!1)&&w.acceptData(i)&&a&&i[v]&&!w.isWindow(i)){h=i[a],h&&(i[a]=null),w.event.triggered=v;try{i[v]()}catch(g){}w.event.triggered=t,h&&(i[a]=h)}return n.result}},dispatch:function(e){e=w.event.fix(e);var n,r,i,s,o,u=[],a=v.call(arguments),f=(w._data(this,"events")||{})[e.type]||[],l=w.event.special[e.type]||{};if(a[0]=e,e.delegateTarget=this,!l.preDispatch||l.preDispatch.call(this,e)!==!1){u=w.event.handlers.call(this,e,f),n=0;while((s=u[n++])&&!e.isPropagationStopped()){e.currentTarget=s.elem,o=0;while((i=s.handlers[o++])&&!e.isImmediatePropagationStopped())(!e.
namespace_re||e.namespace_re.test(i.namespace))&&(e.handleObj=i,e.data=i.data,r=((w.event.special[i.origType]||{}).handle||i.handler).apply(s.elem,a),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()))}return l.postDispatch&&l.postDispatch.call(this,e),e.result}},handlers:function(e,n){var r,i,s,o,u=[],a=n.delegateCount,f=e.target;if(a&&f.nodeType&&(!e.button||"click"!==e.type))for(;f!=this;f=f.parentNode||this)if(1===f.nodeType&&(f.disabled!==!0||"click"!==e.type)){for(s=[],o=0;a>o;o++)i=n[o],r=i.selector+" ",s[r]===t&&(s[r]=i.needsContext?w(r,this).index(f)>=0:w.find(r,this,null,[f]).length),s[r]&&s.push(i);s.length&&u.push({elem:f,handlers:s})}return n.length>a&&u.push({elem:this,handlers:n.slice(a)}),u},fix:function(e){if(e[w.expando])return e;var t,n,r,i=e.type,s=e,u=this.fixHooks[i];u||(this.fixHooks[i]=u=tt.test(i)?this.mouseHooks:et.test(i)?this.keyHooks:{}),r=u.props?this.props.concat(u.props):this.props,e=new w.Event(s),t=r.length;while(t--)n=r[t],e[n]=s[n];return e.target||(e.target=s.srcElement||o),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,u.filter?u.filter(e,s):e},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,i,s
,u=n.button,a=n.fromElement;return null==e.pageX&&null!=n.clientX&&(i=e.target.ownerDocument||o,s=i.documentElement,r=i.body,e.pageX=n.clientX+(s&&s.scrollLeft||r&&r.scrollLeft||0)-(s&&s.clientLeft||r&&r.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||r&&r.scrollTop||0)-(s&&s.clientTop||r&&r.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),e.which||u===t||(e.which=1&u?1:2&u?3:4&u?2:0),e}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ot()&&this.focus)try{return this.focus(),!1}catch(e){}},delegateType:"focusin"},blur:{trigger:function(){return this===ot()&&this.blur?(this.blur(),!1):t},delegateType:"focusout"},click:{trigger:function(){return w.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):t},_default:function(e){return w.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,n,r){var i=w.extend(new w.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?w.event.trigger(i,null,t):w.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},w.removeEvent=o.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]===i&&(e[r]=null),e.detachEvent(r,n))},w.Event=function(e,n){return this instanceof w.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?it:st):this.type=e,n&&w.extend(this,n),this.timeStamp=e&&
e.timeStamp||w.now(),this[w.expando]=!0,t):new w.Event(e,n)},w.Event.prototype={isDefaultPrevented:st,isPropagationStopped:st,isImmediatePropagationStopped:st,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=it,e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=it,e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=it,this.stopPropagation()}},w.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){w.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj;return(!i||i!==r&&!w.contains(r,i))&&(e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t),n}}}),w.support.submitBubbles||(w.event.special.submit={setup:function(){return w.nodeName(this,"form")?!1:(w.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=w.nodeName(n,"input")||w.nodeName(n,"button")?n.form:t;r&&!w._data(r,"submitBubbles")&&(w.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),w._data(r,"submitBubbles",!0))}),t)},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&w.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){return w.nodeName(this,"form")?!1:(w.event.remove(this,"._submit"),t)}}),w.support.changeBubbles||(w.event.special.change={setup:function(){return Z.test(this.nodeName)?(("checkbox"===this.type||"radio"===this.type)&&(w.event.add(this,"propertychange._change"
,function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),w.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),w.event.simulate("change",this,e,!0)})),!1):(w.event.add(this,"beforeactivate._change",function(e){var t=e.target;Z.test(t.nodeName)&&!w._data(t,"changeBubbles")&&(w.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||w.event.simulate("change",this.parentNode,e,!0)}),w._data(t,"changeBubbles",!0))}),t)},handle:function(e){var n=e.target;return this!==n||e.isSimulated||e.isTrigger||"radio"!==n.type&&"checkbox"!==n.type?e.handleObj.handler.apply(this,arguments):t},teardown:function(){return w.event.remove(this,"._change"),!Z.test(this.nodeName)}}),w.support.focusinBubbles||w.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){w.event.simulate(t,e.target,w.event.fix(e),!0)};w.event.special[t]={setup:function(){0===n++&&o.addEventListener(e,r,!0)},teardown:function(){0===--n&&o.removeEventListener(e,r,!0)}}}),w.fn.extend({on:function(e,n,r,i,s){var o,u;if("object"==typeof e){"string"!=typeof n&&(r=r||n,n=t);for(o in e)this.on(o,n,r,e[o],s);return this}if(null==r&&null==i?(i=n,r=n=t):null==i&&("string"==typeof n?(i=r,r=t):(i=r,r=n,n=t)),i===!1)i=st;else if(!i)return this;return 1===s&&(u=i,i=function(e){return w().off(e),u.apply(this,arguments)},i.guid=u.guid||(u.guid=w.guid++)),this.each(function(){w.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=
e.handleObj,w(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if("object"==typeof e){for(s in e)this.off(s,n,e[s]);return this}return(n===!1||"function"==typeof n)&&(r=n,n=t),r===!1&&(r=st),this.each(function(){w.event.remove(this,e,r,n)})},trigger:function(e,t){return this.each(function(){w.event.trigger(e,t,this)})},triggerHandler:function(e,n){var r=this[0];return r?w.event.trigger(e,n,r,!0):t}});var ut=/^.[^:#\[\.,]*$/,at=/^(?:parents|prev(?:Until|All))/,ft=w.expr.match.needsContext,lt={children:!0,contents:!0,next:!0,prev:!0};w.fn.extend({find:function(e){var t,n=[],r=this,i=r.length;if("string"!=typeof e)return this.pushStack(w(e).filter(function(){for(t=0;i>t;t++)if(w.contains(r[t],this))return!0}));for(t=0;i>t;t++)w.find(e,r[t],n);return n=this.pushStack(i>1?w.unique(n):n),n.selector=this.selector?this.selector+" "+e:e,n},has:function(e){var t,n=w(e,this),r=n.length;return this.filter(function(){for(t=0;r>t;t++)if(w.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ht(this,e||[],!0))},filter:function(e){return this.pushStack(ht(this,e||[],!1))},is:function(e){return!!ht(this,"string"==typeof e&&ft.test(e)?w(e):e||[],!1).length},closest:function(e,t){var n,r=0,i=this.length,s=[],o=ft.test(e)||"string"!=typeof e?w(e,t||this.context):0;for(;i>r;r++)for(n=this[r];n&&n!==t;n=n.parentNode)if(11>n.nodeType&&(o?o.index(n)>-1:1===n.nodeType&&w.find.matchesSelector(n,e))){n=s.push(n);break}return this.pushStack(s.length>1?w.unique(s):s)},index:function(e){return e?"string"==typeof e?w.inArray(this[0],w(e)):
w.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var n="string"==typeof e?w(e,t):w.makeArray(e&&e.nodeType?[e]:e),r=w.merge(this.get(),n);return this.pushStack(w.unique(r))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),w.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return w.dir(e,"parentNode")},parentsUntil:function(e,t,n){return w.dir(e,"parentNode",n)},next:function(e){return ct(e,"nextSibling")},prev:function(e){return ct(e,"previousSibling")},nextAll:function(e){return w.dir(e,"nextSibling")},prevAll:function(e){return w.dir(e,"previousSibling")},nextUntil:function(e,t,n){return w.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return w.dir(e,"previousSibling",n)},siblings:function(e){return w.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return w.sibling(e.firstChild)},contents:function(e){return w.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:w.merge([],e.childNodes)}},function(e,t){w.fn[e]=function(n,r){var i=w.map(this,t,n);return"Until"!==e.slice(-5)&&(r=n),r&&"string"==typeof r&&(i=w.filter(r,i)),this.length>1&&(lt[e]||(i=w.unique(i)),at.test(e)&&(i=i.reverse())),this.pushStack(i)}}),w.extend({filter:function(e,t,n){var r=t[0];return n&&(e=":not("+e+")"),1===t.length&&1===r.nodeType?w.find.matchesSelector(r,e)?[r]:[]:w.find.matches(e,w.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,n,r){var i=[],s=e[n];while(s&&9!==s.nodeType&&(r===t||1!==s.nodeType||!w(s).
is(r)))1===s.nodeType&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var dt="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",vt=/ jQuery\d+="(?:null|\d+)"/g,mt=RegExp("<(?:"+dt+")[\\s/>]","i"),gt=/^\s+/,yt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,bt=/<([\w:]+)/,wt=/<tbody/i,Et=/<|&#?\w+;/,St=/<(?:script|style|link)/i,xt=/^(?:checkbox|radio)$/i,Tt=/checked\s*(?:[^=]|=\s*.checked.)/i,Nt=/^$|\/(?:java|ecma)script/i,Ct=/^true\/(.*)/,kt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Lt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:w.support.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]},At=pt(o),Ot=At.appendChild(o.createElement("div"));Lt.optgroup=Lt.option,Lt.tbody=Lt.tfoot=Lt.colgroup=Lt.caption=Lt.thead,Lt.th=Lt.td,w.fn.extend({text:function(e){return w.access(this,function(e){return e===t?w.text(this):this.empty().append((this[0]&&this[0].ownerDocument||o).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Mt(this,e);t.appendChild(e)}})},prepend
:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=Mt(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){var n,r=e?w.filter(e,this):this,i=0;for(;null!=(n=r[i]);i++)t||1!==n.nodeType||w.cleanData(jt(n)),n.parentNode&&(t&&w.contains(n.ownerDocument,n)&&Pt(jt(n,"script")),n.parentNode.removeChild(n));return this},empty:function(){var e,t=0;for(;null!=(e=this[t]);t++){1===e.nodeType&&w.cleanData(jt(e,!1));while(e.firstChild)e.removeChild(e.firstChild);e.options&&w.nodeName(e,"select")&&(e.options.length=0)}return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return w.clone(this,e,t)})},html:function(e){return w.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(vt,""):t;if(!("string"!=typeof e||St.test(e)||!w.support.htmlSerialize&&mt.test(e)||!w.support.leadingWhitespace&&gt.test(e)||Lt[(bt.exec(e)||["",""])[1].toLowerCase()])){e=e.replace(yt,"<$1></$2>");try{for(;i>r;r++)n=this[r]||{},1===n.nodeType&&(w.cleanData(jt(n,!1)),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=w.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(n){var r=e[t++],i=e[t++
];i&&(r&&r.parentNode!==i&&(r=this.nextSibling),w(this).remove(),i.insertBefore(n,r))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,n){e=p.apply([],e);var r,i,s,o,u,a,f=0,l=this.length,c=this,h=l-1,d=e[0],v=w.isFunction(d);if(v||!(1>=l||"string"!=typeof d||w.support.checkClone)&&Tt.test(d))return this.each(function(r){var i=c.eq(r);v&&(e[0]=d.call(this,r,i.html())),i.domManip(e,t,n)});if(l&&(a=w.buildFragment(e,this[0].ownerDocument,!1,!n&&this),r=a.firstChild,1===a.childNodes.length&&(a=r),r)){for(o=w.map(jt(a,"script"),_t),s=o.length;l>f;f++)i=a,f!==h&&(i=w.clone(i,!0,!0),s&&w.merge(o,jt(i,"script"))),t.call(this[f],i,f);if(s)for(u=o[o.length-1].ownerDocument,w.map(o,Dt),f=0;s>f;f++)i=o[f],Nt.test(i.type||"")&&!w._data(i,"globalEval")&&w.contains(u,i)&&(i.src?w._evalUrl(i.src):w.globalEval((i.text||i.textContent||i.innerHTML||"").replace(kt,"")));a=r=null}return this}}),w.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){w.fn[e]=function(e){var n,r=0,i=[],s=w(e),o=s.length-1;for(;o>=r;r++)n=r===o?this:this.clone(!0),w(s[r])[t](n),d.apply(i,n.get());return this.pushStack(i)}}),w.extend({clone:function(e,t,n){var r,i,s,o,u,a=w.contains(e.ownerDocument,e);if(w.support.html5Clone||w.isXMLDoc(e)||!mt.test("<"+e.nodeName+">")?s=e.cloneNode(!0):(Ot.innerHTML=e.outerHTML,Ot.removeChild(s=Ot.firstChild)),!(w.support.noCloneEvent&&w.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||w.isXMLDoc(e)))for(r=jt(s),u=jt(e),o=0;null!=(i=u[o]);++o)r[o]&&Bt(i,r[o]
);if(t)if(n)for(u=u||jt(e),r=r||jt(s),o=0;null!=(i=u[o]);o++)Ht(i,r[o]);else Ht(e,s);return r=jt(s,"script"),r.length>0&&Pt(r,!a&&jt(e,"script")),r=u=i=null,s},buildFragment:function(e,t,n,r){var i,s,o,u,a,f,l,c=e.length,h=pt(t),p=[],d=0;for(;c>d;d++)if(s=e[d],s||0===s)if("object"===w.type(s))w.merge(p,s.nodeType?[s]:s);else if(Et.test(s)){u=u||h.appendChild(t.createElement("div")),a=(bt.exec(s)||["",""])[1].toLowerCase(),l=Lt[a]||Lt._default,u.innerHTML=l[1]+s.replace(yt,"<$1></$2>")+l[2],i=l[0];while(i--)u=u.lastChild;if(!w.support.leadingWhitespace&&gt.test(s)&&p.push(t.createTextNode(gt.exec(s)[0])),!w.support.tbody){s="table"!==a||wt.test(s)?"<table>"!==l[1]||wt.test(s)?0:u:u.firstChild,i=s&&s.childNodes.length;while(i--)w.nodeName(f=s.childNodes[i],"tbody")&&!f.childNodes.length&&s.removeChild(f)}w.merge(p,u.childNodes),u.textContent="";while(u.firstChild)u.removeChild(u.firstChild);u=h.lastChild}else p.push(t.createTextNode(s));u&&h.removeChild(u),w.support.appendChecked||w.grep(jt(p,"input"),Ft),d=0;while(s=p[d++])if((!r||-1===w.inArray(s,r))&&(o=w.contains(s.ownerDocument,s),u=jt(h.appendChild(s),"script"),o&&Pt(u),n)){i=0;while(s=u[i++])Nt.test(s.type||"")&&n.push(s)}return u=null,h},cleanData:function(e,t){var n,r,s,o,u=0,a=w.expando,f=w.cache,l=w.support.deleteExpando,h=w.event.special;for(;null!=(n=e[u]);u++)if((t||w.acceptData(n))&&(s=n[a],o=s&&f[s])){if(o.events)for(r in o.events)h[r]?w.event.remove(n,r):w.removeEvent(n,r,o.handle);f[s]&&(delete f[s],l?delete n[a]:typeof n.removeAttribute!==i?n.removeAttribute(a):n[a]=null,c.push(s))}},_evalUrl:function(e){return w
.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),w.fn.extend({wrapAll:function(e){if(w.isFunction(e))return this.each(function(t){w(this).wrapAll(e.call(this,t))});if(this[0]){var t=w(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&1===e.firstChild.nodeType)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return w.isFunction(e)?this.each(function(t){w(this).wrapInner(e.call(this,t))}):this.each(function(){var t=w(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=w.isFunction(e);return this.each(function(n){w(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){w.nodeName(this,"body")||w(this).replaceWith(this.childNodes)}).end()}});var It,qt,Rt,Ut=/alpha\([^)]*\)/i,zt=/opacity\s*=\s*([^)]*)/,Wt=/^(top|right|bottom|left)$/,Xt=/^(none|table(?!-c[ea]).+)/,Vt=/^margin/,$t=RegExp("^("+E+")(.*)$","i"),Jt=RegExp("^("+E+")(?!px)[a-z%]+$","i"),Kt=RegExp("^([+-])=("+E+")","i"),Qt={BODY:"block"},Gt={position:"absolute",visibility:"hidden",display:"block"},Yt={letterSpacing:0,fontWeight:400},Zt=["Top","Right","Bottom","Left"],en=["Webkit","O","Moz","ms"];w.fn.extend({css:function(e,n){return w.access(this,function(e,n,r){var i,s,o={},u=0;if(w.isArray(n)){for(s=qt(e),i=n.length;i>u;u++)o[n[u]]=w.css(e,n[u],!1,s);return o}return r!==t?w.style(e,n,r):w.css(e,n)},e,n,arguments.length>1)},show:function(){return rn(this,!0)},hide:function(){return rn(this)},toggle:function(e){return"boolean"==typeof 
e?e?this.show():this.hide():this.each(function(){nn(this)?w(this).show():w(this).hide()})}}),w.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Rt(e,"opacity");return""===n?"1":n}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":w.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,u,a=w.camelCase(n),f=e.style;if(n=w.cssProps[a]||(w.cssProps[a]=tn(f,a)),u=w.cssHooks[n]||w.cssHooks[a],r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];if(o=typeof r,"string"===o&&(s=Kt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(w.css(e,n)),o="number"),!(null==r||"number"===o&&isNaN(r)||("number"!==o||w.cssNumber[a]||(r+="px"),w.support.clearCloneStyle||""!==r||0!==n.indexOf("background")||(f[n]="inherit"),u&&"set"in u&&(r=u.set(e,r,i))===t)))try{f[n]=r}catch(l){}}},css:function(e,n,r,i){var s,o,u,a=w.camelCase(n);return n=w.cssProps[a]||(w.cssProps[a]=tn(e.style,a)),u=w.cssHooks[n]||w.cssHooks[a],u&&"get"in u&&(o=u.get(e,!0,r)),o===t&&(o=Rt(e,n,i)),"normal"===o&&n in Yt&&(o=Yt[n]),""===r||r?(s=parseFloat(o),r===!0||w.isNumeric(s)?s||0:o):o}}),e.getComputedStyle?(qt=function(t){return e.getComputedStyle(t,null)},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u.getPropertyValue(n)||u[n]:t,f=e.style;return u&&(""!==a||w.contains(e.ownerDocument,e)||(a=w.style(e,n)),Jt.test(a)&&Vt.test(n)&&(i=f.width,s=f.minWidth,o=f.maxWidth,f.minWidth=f.maxWidth=f.width=a,a=u.width,f.width=i,f.minWidth=s,f.maxWidth=o)),a}):o.documentElement
.currentStyle&&(qt=function(e){return e.currentStyle},Rt=function(e,n,r){var i,s,o,u=r||qt(e),a=u?u[n]:t,f=e.style;return null==a&&f&&f[n]&&(a=f[n]),Jt.test(a)&&!Wt.test(n)&&(i=f.left,s=e.runtimeStyle,o=s&&s.left,o&&(s.left=e.currentStyle.left),f.left="fontSize"===n?"1em":a,a=f.pixelLeft+"px",f.left=i,o&&(s.left=o)),""===a?"auto":a}),w.each(["height","width"],function(e,n){w.cssHooks[n]={get:function(e,r,i){return r?0===e.offsetWidth&&Xt.test(w.css(e,"display"))?w.swap(e,Gt,function(){return un(e,n,i)}):un(e,n,i):t},set:function(e,t,r){var i=r&&qt(e);return sn(e,t,r?on(e,n,r,w.support.boxSizing&&"border-box"===w.css(e,"boxSizing",!1,i),i):0)}}}),w.support.opacity||(w.cssHooks.opacity={get:function(e,t){return zt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=w.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=r&&r.filter||n.filter||"";n.zoom=1,(t>=1||""===t)&&""===w.trim(s.replace(Ut,""))&&n.removeAttribute&&(n.removeAttribute("filter"),""===t||r&&!r.filter)||(n.filter=Ut.test(s)?s.replace(Ut,i):s+" "+i)}}),w(function(){w.support.reliableMarginRight||(w.cssHooks.marginRight={get:function(e,n){return n?w.swap(e,{display:"inline-block"},Rt,[e,"marginRight"]):t}}),!w.support.pixelPosition&&w.fn.position&&w.each(["top","left"],function(e,n){w.cssHooks[n]={get:function(e,r){return r?(r=Rt(e,n),Jt.test(r)?w(e).position()[n]+"px":r):t}}})}),w.expr&&w.expr.filters&&(w.expr.filters.hidden=function(e){return 0>=e.offsetWidth&&0>=e.offsetHeight||!w.support.reliableHiddenOffsets&&"none"===
(e.style&&e.style.display||w.css(e,"display"))},w.expr.filters.visible=function(e){return!w.expr.filters.hidden(e)}),w.each({margin:"",padding:"",border:"Width"},function(e,t){w.cssHooks[e+t]={expand:function(n){var r=0,i={},s="string"==typeof n?n.split(" "):[n];for(;4>r;r++)i[e+Zt[r]+t]=s[r]||s[r-2]||s[0];return i}},Vt.test(e)||(w.cssHooks[e+t].set=sn)});var ln=/%20/g,cn=/\[\]$/,hn=/\r?\n/g,pn=/^(?:submit|button|image|reset|file)$/i,dn=/^(?:input|select|textarea|keygen)/i;w.fn.extend({serialize:function(){return w.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=w.prop(this,"elements");return e?w.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!w(this).is(":disabled")&&dn.test(this.nodeName)&&!pn.test(e)&&(this.checked||!xt.test(e))}).map(function(e,t){var n=w(this).val();return null==n?null:w.isArray(n)?w.map(n,function(e){return{name:t.name,value:e.replace(hn,"\r\n")}}):{name:t.name,value:n.replace(hn,"\r\n")}}).get()}}),w.param=function(e,n){var r,i=[],s=function(e,t){t=w.isFunction(t)?t():null==t?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=w.ajaxSettings&&w.ajaxSettings.traditional),w.isArray(e)||e.jquery&&!w.isPlainObject(e))w.each(e,function(){s(this.name,this.value)});else for(r in e)vn(r,e[r],n,s);return i.join("&").replace(ln,"+")},w.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){w.fn[t
]=function(e,n){return arguments.length>0?this.on(t,null,e,n):this.trigger(t)}}),w.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)}});var mn,gn,yn=w.now(),bn=/\?/,wn=/#.*$/,En=/([?&])_=[^&]*/,Sn=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,xn=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Tn=/^(?:GET|HEAD)$/,Nn=/^\/\//,Cn=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,kn=w.fn.load,Ln={},An={},On="*/".concat("*");try{gn=s.href}catch(Mn){gn=o.createElement("a"),gn.href="",gn=gn.href}mn=Cn.exec(gn.toLowerCase())||[],w.fn.load=function(e,n,r){if("string"!=typeof e&&kn)return kn.apply(this,arguments);var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),w.isFunction(n)?(r=n,n=t):n&&"object"==typeof n&&(o="POST"),u.length>0&&w.ajax({url:e,type:o,dataType:"html",data:n}).done(function(e){s=arguments,u.html(i?w("<div>").append(w.parseHTML(e)).find(i):e)}).complete(r&&function(e,t){u.each(r,s||[e.responseText,t,e])}),this},w.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){w.fn[t]=function(e){return this.on(t,e)}}),w.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:gn,type:"GET",isLocal:xn.test(mn[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":On,text:"text/plain",html
:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":w.parseJSON,"text xml":w.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?Pn(Pn(e,w.ajaxSettings),t):Pn(w.ajaxSettings,e)},ajaxPrefilter:_n(Ln),ajaxTransport:_n(An),ajax:function(e,n){function N(e,n,r,i){var l,g,y,E,S,T=n;2!==b&&(b=2,u&&clearTimeout(u),f=t,o=i||"",x.readyState=e>0?4:0,l=e>=200&&300>e||304===e,r&&(E=Hn(c,x,r)),E=Bn(c,E,x,l),l?(c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(w.lastModified[s]=S),S=x.getResponseHeader("etag"),S&&(w.etag[s]=S)),204===e||"HEAD"===c.type?T="nocontent":304===e?T="notmodified":(T=E.state,g=E.data,y=E.error,l=!y)):(y=T,(e||!T)&&(T="error",0>e&&(e=0))),x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[g,T,x]):d.rejectWith(h,[x,T,y]),x.statusCode(m),m=t,a&&p.trigger(l?"ajaxSuccess":"ajaxError",[x,c,l?g:y]),v.fireWith(h,[x,T]),a&&(p.trigger("ajaxComplete",[x,c]),--w.active||w.event.trigger("ajaxStop")))}"object"==typeof e&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=w.ajaxSetup({},n),h=c.context||c,p=c.context&&(h.nodeType||h.jquery)?w(h):w.event,d=w.Deferred(),v=w.Callbacks("once memory"),m=c.statusCode||{},g={},y={},b=0,E="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!l){l={};while(t=Sn.exec(o))l[t[1].toLowerCase()]=t[2]}t=l[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?o:null
},setRequestHeader:function(e,t){var n=e.toLowerCase();return b||(e=y[n]=y[n]||e,g[e]=t),this},overrideMimeType:function(e){return b||(c.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)m[t]=[m[t],e[t]];else x.always(e[x.status]);return this},abort:function(e){var t=e||E;return f&&f.abort(t),N(0,t),this}};if(d.promise(x).complete=v.add,x.success=x.done,x.error=x.fail,c.url=((e||c.url||gn)+"").replace(wn,"").replace(Nn,mn[1]+"//"),c.type=n.method||n.type||c.method||c.type,c.dataTypes=w.trim(c.dataType||"*").toLowerCase().match(S)||[""],null==c.crossDomain&&(r=Cn.exec(c.url.toLowerCase()),c.crossDomain=!(!r||r[1]===mn[1]&&r[2]===mn[2]&&(r[3]||("http:"===r[1]?"80":"443"))===(mn[3]||("http:"===mn[1]?"80":"443")))),c.data&&c.processData&&"string"!=typeof c.data&&(c.data=w.param(c.data,c.traditional)),Dn(Ln,c,n,x),2===b)return x;a=c.global,a&&0===w.active++&&w.event.trigger("ajaxStart"),c.type=c.type.toUpperCase(),c.hasContent=!Tn.test(c.type),s=c.url,c.hasContent||(c.data&&(s=c.url+=(bn.test(s)?"&":"?")+c.data,delete c.data),c.cache===!1&&(c.url=En.test(s)?s.replace(En,"$1_="+yn++):s+(bn.test(s)?"&":"?")+"_="+yn++)),c.ifModified&&(w.lastModified[s]&&x.setRequestHeader("If-Modified-Since",w.lastModified[s]),w.etag[s]&&x.setRequestHeader("If-None-Match",w.etag[s])),(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+("*"!==c.dataTypes[0]?", "+On+"; q=0.01":""):c.accepts["*"]);for(i in c.headers)x.setRequestHeader
(i,c.headers[i]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&2!==b){E="abort";for(i in{success:1,error:1,complete:1})x[i](c[i]);if(f=Dn(An,c,n,x)){x.readyState=1,a&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{b=1,f.send(g,N)}catch(T){if(!(2>b))throw T;N(-1,T)}}else N(-1,"No Transport");return x}return x.abort()},getJSON:function(e,t,n){return w.get(e,t,n,"json")},getScript:function(e,n){return w.get(e,t,n,"script")}}),w.each(["get","post"],function(e,n){w[n]=function(e,r,i,s){return w.isFunction(r)&&(s=s||i,i=r,r=t),w.ajax({url:e,type:n,dataType:s,data:r,success:i})}}),w.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return w.globalEval(e),e}}}),w.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),w.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=o.head||w("head")[0]||o.documentElement;return{send:function(t,i){n=o.createElement("script"),n.async=!0,e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,t){(t||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),n=null,t||i(200,"success"))},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(t,!0)}}}});var jn=[],Fn=/(=)\?(?=&|$)|\?\?/;w.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=jn.pop()||w.expando+"_"+
yn++;return this[e]=!0,e}}),w.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.jsonp!==!1&&(Fn.test(n.url)?"url":"string"==typeof n.data&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Fn.test(n.data)&&"data");return a||"jsonp"===n.dataTypes[0]?(s=n.jsonpCallback=w.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,a?n[a]=n[a].replace(Fn,"$1"+s):n.jsonp!==!1&&(n.url+=(bn.test(n.url)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||w.error(s+" was not called"),u[0]},n.dataTypes[0]="json",o=e[s],e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,jn.push(s)),u&&w.isFunction(o)&&o(u[0]),u=o=t}),"script"):t});var In,qn,Rn=0,Un=e.ActiveXObject&&function(){var e;for(e in In)In[e](t,!0)};w.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&zn()||Wn()}:zn,qn=w.ajaxSettings.xhr(),w.support.cors=!!qn&&"withCredentials"in qn,qn=w.support.ajax=!!qn,qn&&w.ajaxTransport(function(n){if(!n.crossDomain||w.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();if(n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async),n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),n.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c;try{if(r&&(i||4===a.readyState))if(r=t,o&&(a.onreadystatechange=w.noop,Un&&delete In[o]),i)4!==a.readyState&&a.
abort();else{c={},u=a.status,f=a.getAllResponseHeaders(),"string"==typeof a.responseText&&(c.text=a.responseText);try{l=a.statusText}catch(h){l=""}u||!n.isLocal||n.crossDomain?1223===u&&(u=204):u=c.text?200:404}}catch(p){i||s(-1,p)}c&&s(u,l,c,f)},n.async?4===a.readyState?setTimeout(r):(o=++Rn,Un&&(In||(In={},w(e).unload(Un)),In[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(t,!0)}}}});var Xn,Vn,$n=/^(?:toggle|show|hide)$/,Jn=RegExp("^(?:([+-])=|)("+E+")([a-z%]*)$","i"),Kn=/queueHooks$/,Qn=[nr],Gn={"*":[function(e,t){var n=this.createTween(e,t),r=n.cur(),i=Jn.exec(t),s=i&&i[3]||(w.cssNumber[e]?"":"px"),o=(w.cssNumber[e]||"px"!==s&&+r)&&Jn.exec(w.css(n.elem,e)),u=1,a=20;if(o&&o[3]!==s){s=s||o[3],i=i||[],o=+r||1;do u=u||".5",o/=u,w.style(n.elem,e,o+s);while(u!==(u=n.cur()/r)&&1!==u&&--a)}return i&&(o=n.start=+o||+r||0,n.unit=s,n.end=i[1]?o+(i[1]+1)*i[2]:+i[2]),n}]};w.Animation=w.extend(er,{tweener:function(e,t){w.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;i>r;r++)n=e[r],Gn[n]=Gn[n]||[],Gn[n].unshift(t)},prefilter:function(e,t){t?Qn.unshift(e):Qn.push(e)}}),w.Tween=rr,rr.prototype={constructor:rr,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(w.cssNumber[n]?"":"px")},cur:function(){var e=rr.propHooks[this.prop];return e&&e.get?e.get(this):rr.propHooks._default.get(this)},run:function(e){var t,n=rr.propHooks[this.prop];return this.pos=t=this.options.duration?w.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this
.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):rr.propHooks._default.set(this),this}},rr.prototype.init.prototype=rr.prototype,rr.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=w.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){w.fx.step[e.prop]?w.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[w.cssProps[e.prop]]||w.cssHooks[e.prop])?w.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},rr.propHooks.scrollTop=rr.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},w.each(["toggle","show","hide"],function(e,t){var n=w.fn[t];w.fn[t]=function(e,r,i){return null==e||"boolean"==typeof e?n.apply(this,arguments):this.animate(ir(t,!0),e,r,i)}}),w.fn.extend({fadeTo:function(e,t,n,r){return this.filter(nn).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=w.isEmptyObject(e),s=w.speed(t,n,r),o=function(){var t=er(this,w.extend({},e),s);(i||w._data(this,"finish"))&&t.stop(!0)};return o.finish=o,i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return"string"!=typeof e&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=w.timers,o=w._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Kn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem!==this||null!=e&&s[n].queue!==e||(s[n].anim.stop(
r),t=!1,s.splice(n,1));(t||!r)&&w.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,n=w._data(this),r=n[e+"queue"],i=n[e+"queueHooks"],s=w.timers,o=r?r.length:0;for(n.finish=!0,w.queue(this,e,[]),i&&i.stop&&i.stop.call(this,!0),t=s.length;t--;)s[t].elem===this&&s[t].queue===e&&(s[t].anim.stop(!0),s.splice(t,1));for(t=0;o>t;t++)r[t]&&r[t].finish&&r[t].finish.call(this);delete n.finish})}}),w.each({slideDown:ir("show"),slideUp:ir("hide"),slideToggle:ir("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){w.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),w.speed=function(e,t,n){var r=e&&"object"==typeof e?w.extend({},e):{complete:n||!n&&t||w.isFunction(e)&&e,duration:e,easing:n&&t||t&&!w.isFunction(t)&&t};return r.duration=w.fx.off?0:"number"==typeof r.duration?r.duration:r.duration in w.fx.speeds?w.fx.speeds[r.duration]:w.fx.speeds._default,(null==r.queue||r.queue===!0)&&(r.queue="fx"),r.old=r.complete,r.complete=function(){w.isFunction(r.old)&&r.old.call(this),r.queue&&w.dequeue(this,r.queue)},r},w.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},w.timers=[],w.fx=rr.prototype.init,w.fx.tick=function(){var e,n=w.timers,r=0;for(Xn=w.now();n.length>r;r++)e=n[r],e()||n[r]!==e||n.splice(r--,1);n.length||w.fx.stop(),Xn=t},w.fx.timer=function(e){e()&&w.timers.push(e)&&w.fx.start()},w.fx.interval=13,w.fx.start=function(){Vn||(Vn=setInterval(w.fx.tick,w.fx.interval))},w.fx.stop=function(){clearInterval(Vn),Vn=null},w.fx.speeds={slow:600,fast:200,_default
:400},w.fx.step={},w.expr&&w.expr.filters&&(w.expr.filters.animated=function(e){return w.grep(w.timers,function(t){return e===t.elem}).length}),w.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){w.offset.setOffset(this,e,t)});var n,r,s={top:0,left:0},o=this[0],u=o&&o.ownerDocument;if(u)return n=u.documentElement,w.contains(n,o)?(typeof o.getBoundingClientRect!==i&&(s=o.getBoundingClientRect()),r=sr(u),{top:s.top+(r.pageYOffset||n.scrollTop)-(n.clientTop||0),left:s.left+(r.pageXOffset||n.scrollLeft)-(n.clientLeft||0)}):s},w.offset={setOffset:function(e,t,n){var r=w.css(e,"position");"static"===r&&(e.style.position="relative");var i=w(e),s=i.offset(),o=w.css(e,"top"),u=w.css(e,"left"),a=("absolute"===r||"fixed"===r)&&w.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),w.isFunction(t)&&(t=t.call(e,n,s)),null!=t.top&&(f.top=t.top-s.top+c),null!=t.left&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},w.fn.extend({position:function(){if(this[0]){var e,t,n={top:0,left:0},r=this[0];return"fixed"===w.css(r,"position")?t=r.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),w.nodeName(e[0],"html")||(n=e.offset()),n.top+=w.css(e[0],"borderTopWidth",!0),n.left+=w.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-w.css(r,"marginTop",!0),left:t.left-n.left-w.css(r,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||u;while(e&&!w.nodeName(e,"html")&&"static"===w.css(e,"position"))e=e.offsetParent;return e||u})}}),w.each({scrollLeft
:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);w.fn[e]=function(i){return w.access(this,function(e,i,s){var o=sr(e);return s===t?o?n in o?o[n]:o.document.documentElement[i]:e[i]:(o?o.scrollTo(r?w(o).scrollLeft():s,r?s:w(o).scrollTop()):e[i]=s,t)},e,i,arguments.length,null)}}),w.each({Height:"height",Width:"width"},function(e,n){w.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){w.fn[i]=function(i,s){var o=arguments.length&&(r||"boolean"!=typeof i),u=r||(i===!0||s===!0?"margin":"border");return w.access(this,function(n,r,i){var s;return w.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?w.css(n,r,u):w.style(n,r,i,u)},n,o?i:t,o,null)}})}),w.fn.size=function(){return this.length},w.fn.andSelf=w.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=w:(e.jQuery=e.$=w,"function"==typeof define&&define.amd&&define("jquery",[],function(){return w}))})(window);var B,Browser=B=function(){var e=navigator.userAgent.toLowerCase(),t=((e.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1]||"").split(".");for(var n=0;n<t.length;n++)t[n]=parseInt(t[n],10);var r=0;for(n=0;n<t.length;n++)r+=Math.pow(10,3*(0-n))*t[n];t=r;var i={safari:/webkit/.test(e)?t:NaN,chrome:/chrome/.test(e)?t:NaN,opera:/opera/.test(e)?t:NaN,msie:/msie \d+\.\d+|trident\/\d+\.\d.+; rv:\d+\.\d+[;\)]/.test(e)?t:NaN,mozilla:/mozilla/.test(e)&&!/(compatible|webkit)/.test(e)?t:NaN,mobileSafari:/apple.*mobile.*safari/.test(e)?
t:NaN,iPad:!!/ipad/.test(e)&&(!!/applewebkit/.test(e)&&parseFloat(e.substring(e.indexOf("os ")+"os ".length,e.indexOf(" like mac os x")).split("_").join("."))||!0),iPhone:!!/iphone/.test(e)&&(!!/applewebkit/.test(e)&&parseFloat(e.substring(e.indexOf("os ")+"os ".length,e.indexOf(" like mac os x")).split("_").join("."))||!0),android:!!/android/.test(e),silk:!!/silk/.test(e),windows:!!/(windows)/.test(e),mac:!!/(macintosh)/.test(e)||!!/(mac os x)/.test(e)};i.lion=!!/mac os x 10_7/.test(e)&&!/like mac os x 10_7/.test(e),i.mobile=i.iPad||i.iPhone||i.android,i.onlyiOS=i.iPad||i.iPhone,i.desktop=!i.mobile,i.iPhone=i.iPhone||i.android,i.iOS=i.iPad||i.iPhone,i.iPhone5=i.iPhone&&window.devicePixelRatio===2&&window.screen.availHeight===548,i.iPhone4=i.iPhone&&window.devicePixelRatio===2,i.iPhone3=i.iPhone&&!i.iPhone4,i.standalone=navigator.standalone,i.rightToLeft=!!window.RIGHT_TO_LEFT,i.leftToRight=!i.rightToLeft,i.silk&&(i.mobile=!0,i.android=!0,i.mac=!1,i.desktop=!1,i.safari=NaN),i._origKeys={};for(n in i)i._origKeys[n]=i[n];return i.uA=e,i.version=t,i.windowsMajorVersion=i.windows?e.match(/windows\s+nt\s+(\d)/)[1]:null,i.winXP=i.windowsMajorVersion==="5",i.win7=i.windowsMajorVersion==="6",i}();B.s=function(){var e=function(){var e=B.safari,t=B.mozilla,n=B.msie,r=B.chrome;if(r)return parseInt(B.uA.substring(B.uA.indexOf("chrome/")+"chrome/".length),10);if(e){var i=navigator.userAgent,s=i.indexOf("Version/")+8,o;return s===7?!0:(e=i.substring(s,i.indexOf(" ",s)),o=e.indexOf(".")+1,e=e.substring(0,o||e.length)+(o?e.substring(o).split(".").join(""):""),parseFloat(e))}var u=2e-7;if(t>=4
)return Math.floor(t);if(t>=1.009002-u)return 3.6;if(t>=1.009001-u)return 3.5;if(t>=1.009-u)return 3;if(t>=1.008001-u)return 2;if(t>=1.008-u)return 1.5;if(t)return 1;if(n>=5)return Math.floor(n);if(n)return 5}(),t={};for(var n in B._origKeys)B._origKeys.hasOwnProperty(n)&&(t[n]=B[n]?e:B[n]);return t.version=e,t}(),B.addBodyClassNames=function(){var e=document.body,t=e.className,n,r;for(var i in B._origKeys){if(!B.hasOwnProperty(i)||i==="_origKeys"||!B[i])continue;t+=" "+i}B.s.version&&(n="v"+B.s.version.toString().split(".").join("-"),t+=" "+n),r="v"+Math.floor(B.s.version),n!==r&&(t+=" "+r),window.devicePixelRatio>=2&&(t+=" doubleres"),document.body.className=t;try{e.parentNode.className=e.className}finally{}},Function.prototype.base=function(){},cons(),function(){var e=function(e,t){if(!e||!t)return!1;var n=e.className;return n.length>0&&(n==t||(new RegExp("(^|\\s)"+t+"(\\s|$)")).test(n))},t=function(t,n){if(!t||!n)return;e(t,n)||(t.className+=(t.className?" ":"")+n)},n=function(e,t){if(!e||!t)return;e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},r=function(e){return t(this[0],e),this},i=function(e){return n(this[0],e),this};window.$||(window.$=function(e){var t=[e];return t.addClass=r,t.removeClass=i,t})}(),Core={_runningCoreGuid:0,objects:[],_argPasser:[],_argPassers:[],_argPasserCount:0,emptyArray:[],ie8EmptyArray:B.msie<=8?[]:undefined,noOp:function(){},SUPER_KEYS:"__SUPER_KEYS__"},Core.guidFor=function(e){if(!e)return e;var t=typeof e;return t==="function"||t==="object"||t==="xml"?e.hasOwnProperty("coreGuid"
)&&e.coreGuid||(e.coreGuid=++Core._runningCoreGuid):e},Core.getPathFrom=function(e,t){return Core.Object.prototype.resolvePropertyPath.call(e,"."+t)},(Core.cloneFunction=function(e){var t=e.clonedFrom;if(t)return t.clone();var n=function(){var e=arguments.callee.clonedFrom,t=e.base,n;return e.base=arguments.callee.base,n=arguments.callee.clonedFrom.apply(this,arguments),e.base=t,n};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return n.clonedFrom=e,n.toString=arguments.callee._cloneFunction_toString,n})._cloneFunction_toString=function(){return"Clone of "+this.clonedFrom.toString()},Core.cloneHash=function(e,t){var n=arguments[arguments.length-1]===YES,r=t instanceof Object?t:{},i,s;if(!n)for(i in e)e.hasOwnProperty(i)&&(r[i]=e[i]);else for(i in e)e.hasOwnProperty(i)&&(s=e[i],s instanceof Array?s=s.concat([]):s instanceof Object&&(s=Core.cloneHash(s,YES)),r[i]=s);return r},Array.prototype.remove=function(e){var t=0,n=this,r=0,i=n.length,s;for(;t<i-r;t++)n[t]===e&&(r++,t--),r&&(n[s=t+1]=n[s+r]);return n.length-=r,n},Array.prototype.indexOf=function(e){if(!e)return-1;for(var t=0,n;n=this[t];t++)if(n===e)return t;return-1},Array.prototype.insertAtIndex=function(e,t){if(isNaN(t))return;if(t===0)return this.unshift(e);for(var n=this.length;n>t;n--)this[n]=this[n-1];return this[t]=e,this},Array.prototype.contains=function(e){for(var t=this.length-1;t>=0;t--)if(this[t]===e)return!0;return!1},String.prototype.w=function(){return this.split(/\s+/)},String.prototype.fmt=function(){if(this.search("%@")<0&&this.search("%{"))return this+"";var e=arguments[0],t=this.toString(),n;if(typeof 
e=="object"){for(n in e)e.hasOwnProperty(n)&&(t=t.split("%{"+n+"}").join(e[n]));return t}var r=Array.prototype.slice.call(arguments);for(var i=0,s;i<r.length;i+=1)this.indexOf("%@"+(i+1))>=0?t=t.replace("%@"+(i+1),r[i]):t=t.replace("%@",r[i]);return t},String.prototype.loc=function(){Core.Locale.currentLocale||Core.Locale.createCurrentLocale();var e=Core.Locale.currentLocale,t=e.locString(this.toString()),n=Array.prototype.slice.call(arguments);return t&&(t=String.prototype.fmt.apply(t,n)),t},Function.prototype.observes=Function.prototype.runsOn=function(){var e=!this._listens,t=this._listens||(this._listens=[]);e&&(t.length=0);for(var n=0,r,i,s=arguments.length;n<s;n++)r=arguments[n],(i=r.lastIndexOf("."))>0&&i===r.indexOf(".")&&(r="window."+r),t.push(r);return this},Function.prototype.property=function(){this.isProperty=!0;var e=!this._dependentKeys;if(!arguments.length)return this._dependentKeys&&delete this._dependentKeys,this;var t=this._dependentKeys||(this._dependentKeys=[]);e&&(t.length=0);for(var n=0,r=arguments.length;n<r;n++)t.push(arguments[n]);return this},Core.processSuperKeys=function(e,t){if(!e||!t)return;var n,r,i,s,o;if(!(n=e[t])||n[0]!==Core.SUPER_KEYS)return n;(e[t]=n=n.concat([])).shift();if(!(r=e.base)||!(i=r[t]))return n;for(s=i.length-1;o=i[s];s--)n.unshift(o);return n},YES=!0,NO=!1,require("core/utils"),Core.ObjectPrototypeMembers={className:"Object",isCoreObject:YES,isDestroyed:NO,init:function(){this.hasOwnProperty("coreGuid")||(this.coreGuid=++Core._runningCoreGuid),Core.objects[this.coreGuid]=this},destroy:function(){if(this.isDestroyed){Core.warn
("%@ has already been destroyed".fmt(this));return}this.trigger("destroy"),this.isDestroyed=YES},mixin:function(t){if(!arguments.length)return this;var n=arguments.length,r=this._type,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b;for(i=0;i<n;i++){if(!(u=arguments[i]))continue;c=!!u.isMixin;for(l in u){if(!u.hasOwnProperty(l)||l==="isMixin")continue;m=l.substring(0,7)==="static_"&&!!r,g=l,m&&(l=l.substring(7)),v=m?r:this,a=v[l],f=u[g];if(h=v[l+"Override"])if(h instanceof Function||(h=v[h])instanceof Function)f=h.call(v,f,a,l);if(p=v._overrideSuffixes)for(s=0;d=p[s];s++)l.slice(-d.length)===d&&(h=v["*"+d+"Override"])&&(h instanceof Function||(h=v[h])instanceof Function)&&(f=h.call(v,f,a,l));if(f===a)continue;y=a instanceof Function,b=f instanceof Function,y&&b&&(c&&(f=Core.cloneFunction(f)),f.base=a,m||(a._listens&&v.unlisten(a),a._dependentKeys&&v.deregisterDependentKey(l,a))),b&&!f.isClass&&(f._mixinName=g,v._symbolicatedName&&!f.displayName&&(f.displayName=v._symbolicatedName+"#"+g)),!m&&b&&(f._listens&&v.listen(f),f._dependentKeys&&v.registerDependentKey(l,f)),v[l]=f}}return this},_overrideSuffixes:["Override"],"*OverrideOverride":function(e,t,n){if(typeof n!="string"||n.charAt(0)!=="*")return e;var r=n.substring(1).slice(0,-8),i=this._overrideSuffixes;if(i)for(var s=0,o;o=i[s];s++)if(r===o)return e;return this.ensureOwn("_overrideSuffixes").push(r),e},ensureOwn:function(t){var n=this[t],r;if(this.hasOwnProperty(t))return n;if(!n||typeof n=="number"||typeof n=="string")return n;if(n instanceof Function)return this[t]=Core.cloneFunction(n);if(n instanceof Array)return this[t]=[].concat(n
);if(n instanceof Element)return this[t]=n.cloneNode(!0);if(n instanceof Object)return this[t]=Core.cloneHash(n)},trigger:function(t){if(this.isDestroyed)return;var n=this["__"+t+"Listeners__"],r=arguments.length>1,i=undefined,s,o;if(!n)return;if(r){o=Core._argPasserCount++,s=Core._argPassers[o]||(Core._argPassers[o]=[]);for(var u=1,a=arguments.length;u<a;u++)s.push(arguments[u])}s||(s=Core.ie8EmptyArray);if(n)for(var f=0,l=n.length,c;f<l;f++)(c=n[f])&&c.apply(this,s);return r&&(Core._argPasserCount--,s.length=0),i},listen:function(t,n){if(!t)return;if(!n){if(typeof t=="string")return;n=t;var r=n._listens;if(r){r[0]===Core.SUPER_KEYS&&(r=Core.processSuperKeys(n,"_listens"));for(var i=0;t=r[i];i++)this.listen(t,n)}return}var s="__"+t+"Listeners__";if(!this.hasOwnProperty(s))if(!this[s])this[s]=[];else{for(var o=[],u=0,a=this[s].length;u<a;u++)o.push(this[s][u]);this[s]=o}this[s].push(n)},unlisten:function(t,n){if(!t)return;if(!n){n=t;var r=n._listens;if(r)for(var i=0;t=r[i];i++)this.unlisten(t,n);return}var s="__"+t+"Listeners__";if(!this[s])return;if(!this.hasOwnProperty(s)){for(var o=[],u=0,a=this[s].length;u<a;u++)o.push(this[s][u]);this[s]=o}for(var f=0,l=this[s],c=l.length;f<c;f++)l[f]===n&&(l[f]=undefined)},clearTrigger:function(e){var t=this["__"+e+"Listeners__"];if(!t)return;t.length=0},toString:function(){return"["+this.className+(this.coreGuid?":"+this.coreGuid:"")+"]"},get:function(t){var n=this[t];return n instanceof Function&&n.isProperty&&(n=n.call(this,t)),n},set:function(t,n){var r=this[t],i;return r instanceof Function&&r.isProperty?(i=this["set"+t.charAt(0).
toUpperCase()+t.substring(1)],i?i.call(this,n):r.call(this,t,n)):this[t]=n,this.trigger(t,t),n},setIfChanged:function(t,n){var r=this[t];return this[t]=n,n!==r?(this.trigger(t,t),!0):!1},suspendTriggers:function(){if(this._suspendedTrigger)return;this._suspendedTrigger=this.trigger,this.trigger=this._cacheTriggerCallFor},discardSuspendedTriggers:function(){this._triggerCache&&(this._triggerCache.length=0);if(this._triggerCacheHash)for(var e in this._triggerCacheHash)this._triggerCacheHash.hasOwnProperty(e)&&delete this._triggerCacheHash[e]},resumeTriggers:function(){if(!this._suspendedTrigger)return;this.trigger=this._suspendedTrigger,this._suspendedTrigger=null;var e,t=this._triggerCache,n=this._tmpTrgCopy||(this._tmpTrgCopy=[]);n.length=0;for(var r=0,i=t.length;r<i;r++)n[r]=t[r];this._triggerCache.length=0;for(r in this._triggerCacheHash)this._triggerCacheHash.hasOwnProperty(r)&&delete this._triggerCacheHash[r];for(r=0;e=n[r];r++)this.trigger(e,e)},_cacheTriggerCallFor:function(e){if(arguments[2])return this._suspendedTrigger.apply(this,arguments);var t=this._triggerCache||(this._triggerCache=[]),n=this._triggerCacheHash||(this._triggerCacheHash={});if(n[e]===(n[e]=YES))return;t.push(e)},registerDependentKey:function(e,t,n){if(!e)return;var r;if(!n){n=t;if(!n)return;t=e;if(r=n._dependentKeys){r[0]===Core.SUPER_KEYS&&(r=Core.processSuperKeys(n,"_dependentKeys"));for(var i=0;e=r[i];i++)this.registerDependentKey(e,t,n)}return}this.listen(e,n._triggerProvider||(n._triggerProvider=function(){this.trigger(t,t)}))},deregisterDependentKey:function(e,t,n){if(!e)return;var r;if(!n){
n=t;if(!n)return;t=e;if(r=n._dependentKeys)for(var i=0;e=r[i];i++)this.deregisterDependentKey(e,t,n);return}var s=n._triggerProvider;if(!s)return;this.unlisten(e,s)},concatenate:function(e,t,n){return typeof e!="string"||!!t&&typeof t!="string"?t?t.concat(e):e:(t||"")+e}},require("core/object_members"),Core.Object=function(e){if(e==="__noinit__")return;this._isCreating=!0,this.mixin.apply(this,arguments),delete this._isCreating,this.init()},Core.Object.prototype=Core.ObjectPrototypeMembers,Core.Object.prototype.mixin.call(Core.Object,{isClass:!0,create:function(){var t=new this("__noinit__");return t._isCreating=!0,t.mixin.apply(t,arguments),delete t._isCreating,t.init(),t},extend:function(){var t=function(e){if(e==="__noinit__")return;this._isCreating=!0,this.mixin.apply(this,arguments),delete this._isCreating,this.init()};for(var n in this)this.hasOwnProperty(n)&&(t[n]=this[n]);var r=new this("__noinit__");return r._type=t,r._symbolicatedName=null,r.mixin.apply(r,arguments),t.prototype=r,t.superclass=this,t},reopen:function(){return this.prototype.mixin.apply(this.prototype,arguments),this}}),require("core/object"),Core.Object.reopen({resolvePropertyPath:function(t){if(!t)return this;var n=t.indexOf("."),r,i=!1,s,o;if(n===-1)return this.get(t);r=this,n?r=window:t=t.substring(1);while(n!==-1){n=t.indexOf("."),i=n===-1,o=t.substring(0,i?t.length:n),r=r.get instanceof Function?r.get(o):r[o];if(!r||i)return r;t=t.substring(n+1)}},getPath:function(t){return this.resolvePropertyPath("."+t)},init:function(){var e=this._eavesdrops;typeof e=="string"&&(e=[e]);for(var t=0,n;e&&(n=e[
t]);t++)this.eavesdropObjectAtPath(n);this._hasEavesdroppedInitialObjects=YES,arguments.callee.base.apply(this,arguments),this.trigger("init")},eavesdropObjectAtPath:function(e){var t=this.resolvePropertyPath(e);if(t&&t.addEavesdropper)t.addEavesdropper(this,e);else{var n=this._IGNORE_OBSERVATION_WARNINGS_FOR_PATHS;if(n&&n[e.split(".").join("#")])return;Core.debug&&Core.debug("Can't observe properties on object",t,"at path",e,"from ",this)}},listen:function(t,n){if(t instanceof Function)return arguments.callee.base.apply(this,arguments);var r=t.lastIndexOf(".");if(r===-1)return arguments.callee.base.apply(this,arguments);var i=t.substring(0,r),s=this.ensureOwn("_eavesdrops")||(this._eavesdrops=[]);for(var o=0,u;u=s[o];o++)if(u===i)return arguments.callee.base.apply(this,arguments);return s.push(t.substring(0,r)),this._hasEavesdroppedInitialObjects&&this.eavesdropObjectAtPath(i),arguments.callee.base.apply(this,arguments)},addEavesdropper:function(e,t){if(!e)return;var n=this._eavesdroppers||(this._eavesdroppers=[]);for(var r=0,i;i=n[r];r++)if(i===e)return;n.push(e),(this._eavesdropperPaths||(this._eavesdropperPaths=[])).push(t)},removeEavesdropper:function(e){if(!e)return;var t=this._eavesdroppers;if(!t)return;for(var n=0,r;r=t[n];n++){if(r!==e)continue;t.splice(n,1),this._eavesdropperPaths.splice(n,1);return}},trigger:function(){var t=arguments.callee.base.apply(this,arguments),n=arguments[0],r=this._eavesdroppers,i=this._eavesdropperPaths,s=0,o,u;if(n.indexOf(".")+1)return t;for(;r&&(o=r[s])&&(u=i[s]);s++)arguments[0]=u+"."+n,o.trigger.apply(o,arguments);return t},"*BindingOverride"
:function(e,t,n){if(typeof e!="string")return e;n=n.slice(0,-7);var r=e.substring(0,5)==="hard:";r&&(e=e.substring(5));var i=e.indexOf(":"),s=e.substring(0,i);e=e.substring(i+1);var o=e.lastIndexOf("."),u=e.substring(0,o),a=e.substring(o+1),f=NO,l=r?"set":"setIfChanged";return s!=="from"&&this.listen(this[n+"BindingTo"]=function(){if(f)return;f=YES;var e=this.resolvePropertyPath(u),t=this[n],r;t instanceof Function&&t.isProperty&&(t=this.get(n));if(r=this[n+"OutgoingTransform"])t=r.call(this,t);e&&e[l](a,t,YES),f=NO}.observes(n)),s!=="to"&&this.listen(this[n+"BindingFrom"]=function(){if(f)return;f=YES;var t=this.resolvePropertyPath(e),r;if(r=this[n+"IncomingTransform"])t=r.call(this,t);this[l](n,t,YES),f=NO}.observes(e,"init")),e},destroy:function(){var e=this._eavesdrops||this.constructor.prototype._eavesdrops||[];for(var t=0,n;n=e[t];t+=1)n=this.resolvePropertyPath(n),n&&n.removeEavesdropper(this);return this._eavesdroppers=[],this._eavesdropperPaths=[],arguments.callee.base.apply(this,arguments)}}),Core.NOT=function(e){return!e},require("core/external_observability"),Core.Namespace=Core.Object.extend({isNamespace:YES,shouldAutoSymbolicate:NO,shouldWriteClassNames:NO,static_instances:[],ownerNamespace:window,define:function(e,t){typeof e=="string"&&(e={key:e}),e.name&&(e.key=e.name,delete e.name),(this._metadataByKey||(this._metadataByKey={}))[e.key]=e,(this._metadataByGuid||(this._metadataByGuid={}))[Core.guidFor(t)]=e;var n=this.set.call(this,e.key,t);return t&&this.symbolicateItem(e.key),n},symbolicate:function(){if(this._hasSymbolicated===(this._hasSymbolicated=YES))return;
for(var e in this){if(!this.hasOwnProperty(e))continue;this.symbolicateItem(e)}},handleAutoSymbolication:function(){if(!this.shouldAutoSymbolicate)return;this.symbolicate()}.observes("Core.finalizeCore"),symbolicateItem:function(t){var n=this[t],r,i,s;if(!n)return;if(!n.isMixin&&!n.isCoreObject&&!n.isClass)return;i=this.get("selfName")+"."+t,n.isClass&&(n=n.prototype,n._symbolicatedName=i,this.shouldWriteClassNames&&!n.hasOwnProperty("className")&&(n.className=i));for(r in n){if(!n.hasOwnProperty(r))continue;(s=n[r])instanceof Function&&!s.isClass&&!s.displayName&&(s.displayName=i+"#"+r)}},selfName:function(){if(this._selfName)return this._selfName;var t=this.ownerNamespace,n;for(var r in t)(!t.hasOwnProperty||t.hasOwnProperty(r))&&t[r]===this&&(n=r);return n||(n=this.toString()),t.isNamespace&&(n=t.get("selfName")+"."+n),this._selfPath=n}.property(),trackInstances:function(){Core.Namespace.instances.push(this)}.observes("init"),contentsToString:function(e){var t=this.get("selfName");t+="\n";if(!this._metadataByKey)return t;var n,r,i,s;for(n in this._metadataByKey){t+="  "+n+"\n";if(e)if(s=this[n])if(s=s.isClass?s.prototype:s.isMixin||s.isCoreObject?s:null)for(r in s)s.hasOwnProperty(r)&&(i=s[r])instanceof Function&&!i.isClass&&(t+="    "+(i.displayName||i.name||i)+"\n")}return t},static_projectContentsToString:function(e){for(var t=0,n="",r=Core.Namespace.instances,i;i=r[t];t++)n+=this.instances[t].contentsToString(e);return n},static_symbolicateAll:function(){for(var e=0,t;t=this.instances[e];e++)t.symbolicate()}}),Core.Namespace.create(Core,{init:function(){Core=this,arguments
.callee.base.apply(this,arguments)}}),require("core/namespace"),Core.Animator=Anim=Core.Namespace.create({fps:60,tasks:[],speedMultiplier:1,frameCount:0,isActive:!1,isInFrame:!1,extraStatus:{},enableOldIE:!0,_frameTimeNoiseLevelingWindowSize:30,_frameNoiseLevelerLog:[],_movingAverageFrameTime:function(){for(var e=0,t=Anim._frameNoiseLevelerLog,n=0,r=t.length;e<r;e++)n+=t[e];return Math.round(10*n/(r||1))/10},initialSetup:function(){this.stop(),this.useRAF=this.IS_MOBILE&&window.requestAnimationFrame&&window.cancelRequestAnimationFrame,this.lock16=this.IS_MOBILE&&!this.useRAF}.observes("init"),nextFrame:function(t,n){Anim.isInFrame=!0;var r,i=Anim._frameNoiseLevelerLog,s=Anim._frameTimeNoiseLevelingWindowSize,o,u;o=Anim._lastFrameTime===-1?(new Date).valueOf():Anim._lastFrameTime,Anim._lastFrameTime=(new Date).valueOf(),u=o=Anim._lastFrameTime-o,Anim.now=Anim._lastFrameTime,Anim.firstActiveFrame&&(o=0),o>=300&&o>=(r=Math.max(Anim._movingAverageFrameTime(),60))*5?i.unshift(r/2):i.unshift(o),i.length<=s||(i.length=s),Anim.frameTime=o;if(!Anim.shouldSkipFrame||!Anim.shouldSkipFrame()){Anim.trigger("preframe");for(var a=0,f;f=Anim.tasks[a];a++)f.running&&!f.paused&&f.elapse(Math.min(o,3e4)*Anim.speedMultiplier);for(a=0;f=Anim.tasks[a];a++)f.running||(f._inTasks=!1,Anim.tasks.splice(a--,1));Anim.trigger("frame"),Anim.isActive=!!Anim.tasks.length,Anim.frameCount++}Anim.frameRate=Math.round(1e5/u)/100,Anim.computeTime=(new Date).valueOf()-Anim.now;var l=Math.round(1e3/Anim.fps);Anim.timeoutWaitTime=Math.max(0,l-Anim.computeTime),Anim.clearNextTimeout(),!n&&Anim.isActive?Anim.useRAF?
Anim._timeout=window.requestAnimationFrame(Anim.nextFrame,document.body):Anim._timeout=setTimeout(Anim.nextFrame,Anim.lock16?16:Anim.timeoutWaitTime):Anim.stop(),Anim.firstActiveFrame&&(Anim.firstActiveFrame=!1),Anim.isInFrame=!1},start:function(){if(this.isActive||this.isInFrame)return;this.firstActiveFrame=!0,this.isActive=!0,this._lastFrameTime=-1,this.frameTime=1e3/this.fps,this.frameRate=1e3/this.frameTime,this.computeTime=0,this.trigger("start"),this.nextFrame()},stop:function(){this.isActive=!1,this.frameTime=Infinity,this.frameRate=0,this.computeTime=NaN,this.timeoutWaitTime=NaN,this.clearNextTimeout(),this.trigger("stop")},clearNextTimeout:function(){if(!this._timeout)return;this.useRAF?window.cancelRequestAnimationFrame(this._timeout):clearTimeout(this._timeout),this._timeout=0},handleTask:function(e){if(!e||e.isDestroyed)return;if(!e._inTasks){if(e.name)for(var t=0,n=Anim.tasks,r;r=n[t];t++)r.name===e.name&&r.stop();Anim.tasks.push(e)}e._inTasks=!0,Anim.start()},tellStop:function(){arguments._isArgs_=!0,this.performMethodOn("stop",arguments)},tellFinish:function(){arguments._isArgs_=!0,this.performMethodOn("finish",arguments)},performMethodOn:function(e,t){var n=1,r=arguments;t&&t._isArgs_&&(n=0,r=t);for(var i=n,s,o=r.length;i<o;i++)(s=r[i])&&s[e]&&s[e]()},IS_OLD_IE:navigator.userAgent.indexOf("MSIE ")!==-1&&parseInt((navigator.userAgent+"").charAt(navigator.userAgent.indexOf("MSIE ")+"MSIE ".length),10)<=8,IS_MOBILE:!!(/ipad/.test(navigator.userAgent.toLowerCase())||/iphone/.test(navigator.userAgent.toLowerCase())||/ipod/.test(navigator.userAgent.toLowerCase())||/android/
.test(navigator.userAgent.toLowerCase())),getOpacity:function(e){if(!e)return-1;var t;return(t=e.anim$opacity||e.getAttribute("anim$opacity"))&&(t=parseFloat(t))||t===0?t:(t=e.style.opacity||Core.getStyle(e,"opacity"))&&(t=parseFloat(t))||t===0?t:1},setOpacity:function(e,t){return e?(t=Math.max(0,Math.min(1,t)),t>.9999||isNaN(t)?this.removeOpacity(e):(e.anim$opacity=t,e.style.opacity=t,t)):-1},removeOpacity:function(e){return e?(e.anim$opacity=1,e.style.opacity="",1):-1},encodeColor:function(e,t,n){if(typeof e=="object"&&typeof e.r=="number"&&typeof e.g=="number"&&typeof e.b=="number")t=e.g,n=e.b,e=e.r;else if(typeof e=="object")t=e[1],n=e[2],e=e[0];else if(typeof e=="string"){if(e.charAt(0)=="#"&&e.length===7)return e;e=Anim.decodeColor(e),t=e[1],n=e[2],e=e[0]}return e=Math.round(Math.max(0,Math.min(255,e))).toString(16),e.length==1&&(e="0"+e),t=Math.round(Math.max(0,Math.min(255,t))).toString(16),t.length==1&&(t="0"+t),n=Math.round(Math.max(0,Math.min(255,n))).toString(16),n.length==1&&(n="0"+n),("#"+e+t+n).toUpperCase()},decodeColor:function(e){Anim.colors&&Anim.colors[e]&&(e=Anim.colors[e]);var t,n,r,i;if((t=typeof e)=="number"||t=="object")return undefined;e=e.replace(/\s+/g,"");if(e.charAt(0)=="#")e.length==4&&(e="#"+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)+e.charAt(3)+e.charAt(3)),n=parseInt(e.substring(1,3),16),r=parseInt(e.substring(3,5),16),i=parseInt(e.substring(5,7),16);else{var s;if(e.indexOf("rgba(")!=-1)s=5;else{if(e.indexOf("rgb(")==-1)return undefined;s=4}e=e.substring(s,e.length-1).split(","),n=parseInt(e[0],10),r=parseInt(e[1],10),i=parseInt(e[2],10
)}return[n,r,i]},colors:{red:"#ff0000","orange red":"#ff4500",orange:"#ff7f00",yellow:"#ffff00",green:"#00ff00","forest green":"#228b22",cyan:"#00ffff","light sea green":"#20b2aa",blue:"#0000ff","cornflower blue":"#6495ed","medium blue":"#3232cd",purple:"#a020f0","hot pink":"#ff69b4",magenta:"#ff00ff",white:"#ffffff","light gray":"#d3d3d3",gray:"#bebebe","dark gray":"#a9a9a9","dim gray":"#696969",black:"#000000"},perf:function(e){var t;Anim.perfPop=t=window.open("","Animator","height="+(window.screen.availHeight-19)+",width=500,top=0,left=0");if(!t){window.console&&console.log&&console.log("No popup available for performance monitor.");return}t.document.body.innerHTML='<div style="position:absolute; left:0px; top:0px; width:100%; height:100%; overflow:auto"><div style="position:absolute; left:10px; top:10px; right:10px;"></div></div>',t.document.body.style.background="black",Anim.perfPop.updater||(Anim.perfPop.updater=Anim.perfPop.setInterval(function(){(function(){try{this.document.body.firstChild.firstChild.innerHTML='<span style="font-family:helvetica,arial,sans-serif; font-size:12px; color:#CCCCCC;"><big>Performance Monitor</big><br>'+Core.strToHtml(this.opener.Anim.status())+"</span>"}catch(e){(!this.opener||this.opener==this.window)&&this.close()}}).call(Anim.perfPop)},e||250)),window.focus()},bogDown:function(){Anim.listen("frame",function(){var e=5;for(var t=0;t<1e6;t++)e=Math.sin(e)})},status:function(){var e="";return e+="\nActive: "+Anim.isActive,e+="\n",e+="\nTarget FPS: "+Anim.fps,e+="\nActual FPS: "+Anim.frameRate,e+="\n",e+="\nFrame Time: "+Anim.frameTime+" ms"
,e+="\nCompute Time: "+Anim.computeTime+" ms",e+="\nTimeout Wait Time: "+Anim.timeoutWaitTime+" ms",e+="\n",e+="\nSpeed Multiplier: "+Anim.speedMultiplier,e+="\n",e+="\nExtra Status: ",e+="\n"+window.enumerate?window.enumerate(Anim.extraStatus):Anim.extraStatus,e+="\n",e+="\n"+Anim.tasks.length+" Task"+(Anim.tasks.length==1?"":"s")+":",e+="\n"+Anim.tasks.join("\n"),e}}),Anim.Task=Core.Object.extend({className:"Anim.Task",running:!1,paused:!1,speedMultiplier:1,frameCount:0,elapsedTime:0,ticked:!1,tickCount:0,start:function(){return this.running?this:(this.running=!0,this.elapsedTime=this.frameCount=this.tickCount=0,this.trigger("start"),Anim.handleTask(this),this)},stop:function(){return this.running?(this.running=!1,this.trigger("stop"),this):this},elapse:function(t,n){if(this.isDestroyed)return this.running=!1,this;if(!n&&this.shouldSkipFrame&&this.shouldSkipFrame())return this;this._forcedZeroes&&(t=0,this._forcedZeroes--),t*=this.speedMultiplier,this.trigger("preframe"),this.elapsedTime+=t;if(!this.ticked)this.trigger("pretick"),this.run instanceof Function&&this.run(t),this.tickCount++,this.trigger("tick");else for(var r=this.ticked===!0?1e3/Anim.fps:this.ticked,i=1+Math.floor(this.elapsedTime/r),s=i-this.tickCount,o=0;o<s;o++)this.trigger("pretick"),this.run instanceof Function&&this.run(r,o<s-1),this.running&&this.trigger("tick"),this.tickCount++;return this.running&&(this.trigger("frame"),this.trigger("frame"+this.frameCount)),this.trigger("postFrame"),this.clearTrigger("postFrame"),this.frameCount++,this},destroy:function(){return arguments.callee.base&&arguments.callee
.base.apply(this,arguments),this.isDestroyed=!0,this}}),Anim.Task.go=function(){var e=this.create.apply(this,arguments);return e.start(),e},Anim.tweens={make:function(e){var t=[];for(var n=1,r=arguments.length;n<r;n++)t.push(arguments[n]);return function(){var n=t;n.l=n.length;var r=Anim.tweens[e]||Anim.tweens.LINEAR;return function(e){return n[n.l]=e,r.apply(this,n)}}()},compound:function(){var e=arguments.length,t=arguments[e-1];for(var n=0,r;n<e-1&&(r=arguments[n]);n++)typeof r=="string"?t=Anim.tweens[r].call(this,t):t=r.call(this,t);return t},concat:function(e){var t=arguments.length,n=Math.floor((t-2)/2),r=arguments[t-1],i,s=0,o=0,u=0,a,f,l;for(i=0;i<n;i++)s+=arguments[2*i+2];for(i=0;i<n;i++){o+=arguments[2*i+2]/s;if(r<o)return a=(r-u)/(o-u),l=arguments[2*i+1],typeof l=="string"&&(l=Anim.tweens[l]),f=l.call(this,a),e!==!1?u+f*(o-u):f;u=o}},LINEAR:function(e){return e},BOUNCE:function(e){var t;e=1-e;for(var n=0,r=1;1;n+=r,r/=2)if(e>=(7-4*n)/11){t=r*r-Math.pow((11-6*n-11*e)/4,2);break}return 1-t},SINE_IN_OUT:function(e){return.5-.5*Math.cos(Math.PI*e)},multiSineInOut:function(e,t){var n=e%1;e=Math.floor(e);for(var r=0;r<e;r++)t=.5-.5*Math.cos(Math.PI*t);return n&&(t=(1-n)*t+n*(.5-.5*Math.cos(Math.PI*t))),t},QUADRATIC_IN:function(e){return e*e},QUADRATIC_OUT:function(e){return 1-(e=1-e)*e},WEBKIT_EASE:function(e){return Anim.tweens.cubicBezier(.25,.1,.25,1,e)},WEBKIT_LINEAR:function(e){return e},WEBKIT_EASE_IN:function(e){return Anim.tweens.cubicBezier(.42,0,1,1,e)},WEBKIT_EASE_OUT:function(e){return Anim.tweens.cubicBezier(0,0,.58,1,e)},WEBKIT_EASE_IN_OUT:function(e){return Anim
.tweens.cubicBezier(.42,0,.58,1,e)},cubicBezier:function(e,t,n,r,i){var s=5,o=3*e,u=3*(n-e)-o,a=1-o-u,f=3*t,l=3*(r-t)-f,c=1-f-l,h=1/(200*s),p,d,v,m,g,y;for(v=i,y=0;y<8;y++){m=((a*v+u)*v+o)*v-i;if(Math.abs(m)<h)return((c*v+l)*v+f)*v;g=(3*a*v+2*u)*v+o;if(Math.abs(g)<1e-6)break;v-=m/g}p=0,d=1,v=i;if(v<p)return((c*p+l)*p+f)*p;if(v>d)return((c*d+l)*d+f)*d;while(p<d){m=((a*v+u)*v+o)*v;if(Math.abs(m-i)<h)return((c*v+l)*v+f)*v;i>m?p=v:d=v,v=(d-p)*.5+p}return((c*v+l)*v+f)*v},linearInterpolation:function(e,t){var n=e._length_||(e._length=e.length),r=t*n/n*(n-1),i=Math.floor(r),s=e[i],o=r-i;if(o===0)return s;var u=e[Math.ceil(r)];return s*(1-o)+u*o}},Anim.Animation=Core.Animation=Anim.Task.extend({className:"Anim.Animation",isAnimation:!0,init:function(){arguments.callee.base.call(this),this.hasOwnProperty("animateOldIE")||(this.animateOldIE=Anim.enableOldIE),Anim.IS_OLD_IE&&!this.animateOldIE&&(this.disabled=!0);var e,t,n,r,i,s=this._type.prototype.freevars;typeof this.freevars=="string"&&(this.freevars=this.freevars.split(/\s+/)),this.freevars&&!this.freevars.length&&(this.freevars=[this.freevars]);if(this.freevars&&s&&this.freevars===s){i=[];for(t=0;t<(r||(r=this.freevars.length));t++)i.push(this.freevars[t]);this.freevars=i}this.freevars&&this.speed===undefined&&this.duration===undefined&&!this.signal&&(this.duration=0);for(t=-1,r=!!this.freevars&&this.freevars.length;t<r;t++)e=t===-1?this:this.freevars[t],typeof e=="string"&&(this[e].key=e,this.freevars[t]=e=this[e]),e=this.makeFreevarFromHash(e),e!==this&&(this.freevars[t]=e,e.key&&(this[e.key]=e))},makeFreevarFromHash:function(e
){if(e._isFreevar)return e;var t=Anim.Animation.defaultFreevar,n,r,i,s,o,u,a,f=e===this?this:{};for(i in e){if(!e.hasOwnProperty(i))continue;f!==e&&(f[i]=e[i])}if(f===this)for(i in t)f[i]===undefined&&(f[i]=t[i]);else for(i in t)f.hasOwnProperty(i)||(f[i]=t[i]);if(f.signal)f.tween=undefined,n=this._returnExtendedFreevar(f,Anim.Animation._signalFreevar),n._unsignaledCurrent=n.from;else if(f.inertia){f.tween=undefined,n=this._returnExtendedFreevar(f,Anim.Animation._inertiaFreevar),n._undampedCurrent=n.from,n.inertia!==!0||(n.inertia=Anim.Animation._inertiaFreevar.prototype.inertia),r=[];for(i=0;i<f.inertia-1;i++)r[i]=n._undampedCurrent;n.inertiaChain=r}else n=this._returnExtendedFreevar(f,Anim.Animation._tweenFreevar),n._untweenedCurrent=f.from,typeof n.speed=="number"&&(n.duration=undefined);return n._isFreevar=!0,n.freevarRun(0),n},_returnExtendedFreevar:function(e,t){if(e===this){for(var n in t.prototype)this[n]===undefined&&(this[n]=t.prototype[n]);return this}return new t(e)},addFreevar:function(e){if(!e)return;return e.key&&this[e.key]?!1:(e=this.makeFreevarFromHash(e),e.key&&(this[e.key]=e),(this.freevars||(this.freevars=[])).push(e),this)},removeFreevar:function(e){typeof e=="string"&&(e=this[e]);if(!e||!e._isFreevar)return null;if(!this.freevars||!this.freevars.length)return null;e.key&&(this[e.key]=undefined);for(var t=0;t<this.freevars.length;t++)this.freevars[t]===e&&this.freevars.splice(t--,1);return e},allFreevarsDo:function(e,t){var n,r,i=arguments.callee.args||(arguments.callee.args=[]);i.length=0;for(var s=1,o=arguments.length;s<o;s++)i.push(arguments[s]);this
[e].apply(this,i);if(!(n=this.freevars))return this;for(s=0;r=n[s];s++)r[e].apply(r,i);return this},forceAll:function(e){return this.allFreevarsDo("force",e),this},resetAll:function(){return this.allFreevarsDo("reset"),this},reverseAll:function(e){return this.allFreevarsDo("reverse"),this},run:function(t,n){var r=!0,i=1,s=Infinity,o;for(var u=-1,a=!!this.freevars&&this.freevars.length||0;u<a;u++)o=this.freevars&&this.freevars[u]||this,o.freevarRun(t)||(r=!1),o.progress<i&&(i=o.progress),o.tweenedProgress<s&&(s=o.tweenedProgress);this.freevars&&(this.progress=i,this.tweenedProgress=s),n||this.update(),r&&this.listen("postFrame",this._finishNaturally)},start:function(){if(this.running)return this;this.disabled&&this.allFreevarsDo("zeroOutDuration");if(Anim._hasSC){var e=SC.RunLoop.isRunLoopInProgress();e||SC.RunLoop.begin()}var t=arguments.callee.base.apply(this,arguments);return Anim.isActive&&(this.update(),this.trigger("tick"),this.trigger("frame")),!e&&Anim._hasSC&&SC.RunLoop.end(),t},finish:function(e,t){if(!this.running)return this;e||(this.allFreevarsDo("force"),t||(this.update(),this.trigger("tick"),this.trigger("frame")));var n=this.stop();return this.trigger("finish"),this.repeat>0&&(this.repeat--,this.reverseOnRepeat?this.reverse():this.reset(),this.start()),n},_finishNaturally:function(){this.finish(!0)},update:function(){},toString:function(){var e=arguments.callee.base.apply(this,arguments);return e=e.substring(0,e.length-1)+(this.name?" "+this.name:"")+(this.running?" running":"")+(this.freevars||this.inertia?"":" "+this.from+"-to-"+this.to+" "+this.duration+"ms "+
Math.round(this.progress*100)+"%")+"]",e},destroy:function(){var e=arguments.callee.base.apply(this,arguments);return this.update=this.run=this.finish=Core.noOp,e},recycle:function(){this.allFreevarsDo("reset"),this.tickCount=this.frameCount=this.elapsedTime=this._forcedZeroes=0}}),Anim.Animation.defaultFreevar={tween:Anim.tweens.WEBKIT_EASE,discreteness:0},Anim.Animation._tweenFreevar=function(){var e=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};return e.prototype={from:0,to:1,duration:1e3,importants:undefined,isAlmostFinished:function(e){return Math.abs(this.to-this.current)<e},reverse:function(){var e=this.to;return this.to=this.from,this.from=e,this.freevarRun(0),this},reset:function(){return this._untweenedCurrent=this.from,this.freevarRun(0),this},redirectTo:function(e){return e===this.to?this:(this.from=this.current,this.to=e,this._untweenedCurrent=this.from,this.freevarRun(0),this)},redirectFrom:function(e){return this.from=this._untweenedCurrent=e,this.freevarRun(0),this},zeroOutDuration:function(){return!this.duration||(this.duration=0),!this.speed||(this.speed=Infinity),this},force:function(e){return typeof e=="number"&&(this.to=e),this._untweenedCurrent=this.to,this.freevarRun(0),this},freevarRun:function(t){if(this.duration===0||this.speed===Infinity)this._untweenedCurrent=this.to;var n=this,r=n._untweenedCurrent<n.to,i=n.isFinished=n._untweenedCurrent===n.to,s=n.importants?n.importants[n._impSpot||0]||undefined:undefined,o=s!==undefined?n._untweenedCurrent<s:undefined,u,a;if(n.to===n.from)return n.current=n._untweenedCurrent=n.to,n.isFinished=!0
;if(!i){a=n.speed||1e3/n.duration*Math.abs(n.to-n.from),u=Math.abs(a*t/1e3),r?n._untweenedCurrent+=u:n._untweenedCurrent-=u;if(o===!0&&n._untweenedCurrent>s||o===!1&&n._untweenedCurrent<s)n._untweenedCurrent=s,n._impSpot=(n._impSpot||0)+1;if(n.isFinished=r&&n._untweenedCurrent>=n.to||!r&&n._untweenedCurrent<=n.to)n._untweenedCurrent=n.to}return n.from!==undefined&&n.to!==undefined?(n.progress=(n._untweenedCurrent-n.from)/(n.to-n.from),n.tween instanceof Function&&n.from!=n.to&&(n.from===0&&n.to===1?n.current=n.tweenedProgress=n.tween.call(this,n._untweenedCurrent):n.current=(n.tweenedProgress=n.tween.call(this,n.progress))*(n.to-n.from)+n.from)):n.current=n._untweenedCurrent,n.discreteness&&Math.abs(n.to/n.discreteness)%1<1e-8&&(n.current=Math.round(n.current/n.discreteness)*n.discreteness),n.isFinished}},e._freevarPrototype=e,e}(),Anim.Animation._inertiaFreevar=function(){var e=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};return e.prototype={from:0,to:1,speed:1,inertia:3,headStart:.01,isAlmostFinished:function(e){return Math.abs(this.to-this.current)<e},reverse:function(){var e=this.to;return this.to=this.from,this.from=e,this},reset:function(){var e=this.to;return this.force(this.from),this.to=e,this},redirectTo:function(e){return this.from=this.current,this.to=e,this},redirectFrom:function(e){var t=e-this.current;this.from=e,this._undampedCurrent+=t;for(var n=0,r=this.inertiaChain.length;n<r;n++)this.inertiaChain[n]+=t;return this.freevarRun(0),this},zeroOutDuration:function(){return this.speed=Infinity,this},force:function(e){typeof e=="number"&&(this.
to=e),this._undampedCurrent=this.current=this.to;for(var t=0,n=this.inertiaChain.length;t<n;t++)this.inertiaChain[t]=this.to;return this},freevarRun:function(t){this.speed===Infinity&&this.force();var n,r=this,i,s,o=r.speed,u=r.inertiaChain,a,f,l;for(n=0;n<r.inertia;n++){n===0?(i=r._undampedCurrent,s=r.to):n===1?(i=u[0],s=r._undampedCurrent):(i=u[n-1],s=u[n-2]);if(i===s)continue;a=i<s,f=t/1e3*o*Math.abs(s+r.headStart*(2*a-1)-i),a?i+=f:i-=f;if(l=a&&i>=s||!a&&i<=s)i=s;n===0?r._undampedCurrent=i:u[n-1]=i}return r.current=i,r.discreteness&&Math.abs(r.to/r.discreteness)%1<1e-8&&(r.current=Math.round(r.current/r.discreteness)*r.discreteness),r.isFinished=r.to===r.current,r.progress=NaN,r.isFinished}},e._freevarPrototype=e,e}(),Anim.Animation._signalFreevar=function(){var e=function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t])};return e.prototype={speed:1,from:0,signal:function(e){return.5+.5*Math.sin(e*Math.PI*2)},persistent:!0,isAlmostFinished:function(e){return!this.persistent},reverse:function(){return this.speed=-this.speed,this},reset:function(){return this._unsignaledCurrent=this.from,this},redirectTo:function(){return this},force:function(){return this},advance:function(e){this._unsignaledCurrent+=e},zeroOutDuration:function(){return this},freevarRun:function(t){return this._unsignaledCurrent+=t/1e3*this.speed,this.current=this.signal(this._unsignaledCurrent),this.discreteness&&(this.current=Math.round(this.current/this.discreteness)*this.discreteness),this.isFinished=!this.persistent,this.progress=NaN,this.isFinished}},e._freevarPrototype=e,e}(),Anim.Fader=Anim.Animation
.extend({className:"Anim.Fader",update:function(){Anim.setOpacity(this.element,this.current)},init:function(){this.from===undefined&&(this._untweenedCurrent=this.from=Anim.getOpacity(this.element)),arguments.callee.base.apply(this,arguments)},_removeOnFinish:function(){if(!this.REMOVE_ON_FINISH)return;this.element.parentNode&&this.element.parentNode.removeChild(this.element)}.observes("finish"),saveSelf:function(){var e=this.element._animFader;e&&e.stop(),this.element._animFader=this}.observes("start"),killSelf:function(){this.element._animFader=undefined}.observes("stop")}),Anim.DisplayNoneAtZero={isMixin:!0,setDisplayNone:function(){this.to===0&&(this.element.style.display="none")}.observes("finish"),removeDisplayNone:function(){this.element.style.display=""}.observes("start")},Core.ErrorCatcherDelegate={isErrorCatcherDelegate:YES,isMixin:YES,errorCatchShouldReportError:function(e,t){return!0},errorCatcherGetDetailedInformationForError:function(e,t){return null},errorCatcherReportErrorFeedback:function(e,t,n){}},function(){var e=window.location.toString(),t=window.location.toString().indexOf("nogpu")!==-1,n=!t&&window.location.toString().indexOf("gpu")!==-1;Core.maxGPUTextureSize=B.android?2048:B.iOS>=9?1536:B.iOS?1024:1950,Core.useGPU=!!B.iOS,Core.useGPUForBigs=B.safari||B.chrome||B.iOS,Core.useGPU=(Core.useGPU||n)&&!t,Core.useGPUForBigs=(Core.useGPUForBigs||n)&&!t}(),require("utilities/gpu_prefs"),Core.GPUFriendliness={isMixin:YES,maxLayerSize:{width:Core.maxGPUTextureSize,height:Core.maxGPUTextureSize},rootHTML:'<div><div class="container"></div></div>',containerElement
:"layer.firstChild",isGPUFriendly:NO,layout:{originX:.5,originY:.5,translateX:0,translateY:0,scale:1,top:0,left:0,width:0,height:0},_ensureLayout:function(){this.ensureOwn("layout")}.observes("init"),updateToGPUFriendliness:function(){var e=this.isGPUFriendly;if(!this.layer||this._igf_===(this._igf_=e))return;e?this.becomeGPUFriendly():this.returnToFullRes()}.observes("isGPUFriendly"),becomeGPUFriendlyIfNeeded:function(){this.isGPUFriendly&&!this._hasBecomeGPUFriendly&&this.becomeGPUFriendly()}.observes("layout"),becomeGPUFriendly:function(){if(!this.layout||!this.layout.width||!this.layout.height)return NO;this._hasBecomeGPUFriendly=YES;var e=this.layer,t=this.container,n=this.layout,r=Core.innerSizeInOuter(n,this.maxLayerSize),i=Math.min(1,r.width/n.width);e.style.overflow=t.style.overflow="hidden",e.style.width=Math.round(Math.min(r.width,n.width))+"px",e.style.height=Math.round(Math.min(r.height,n.height))+"px",e.style.webkitTransformOrigin=t.style.webkitTransformOrigin="0 0",t.style.webkitTransform="scale("+i+")";var s=n.translateX-n.originX*(n.scale-1)*n.width,o=n.translateY-n.originY*(n.scale-1)*n.height;return e.style.webkitTransform="translateX("+s+"px) translateY("+o+"px) scale3d("+n.scale/i+","+n.scale/i+",1)",YES},returnToFullRes:function(){var e=this.layer,t=this.container;e.style.overflow=t.style.overflow="",e.style.width=Math.round(this.layout.width)+"px",e.style.height=Math.round(this.layout.height)+"px",e.style.webkitTransform=t.style.webkitTransform="",e.style.webkitTransformOrigin=t.style.webkitTransformOrigin=""},updateToLayout:function(){var e=this.layer
,t=this.container,n=this.layout,r=Math.round;if(!e||!t)return;e=e.style,t=t.style;if(!n.width||!n.height)return;var i,s;if(this.isGPUFriendly){i=Core.innerSizeInOuter(n,this.maxLayerSize),s=Math.min(1,i.width/this.layout.width),e.width=r(Math.min(i.width,n.width))+"px",e.height=r(Math.min(i.height,n.height))+"px",t.webkitTransform="scale("+s+")";var o=n.translateX-n.originX*(n.scale-1)*n.width,u=n.translateY-n.originY*(n.scale-1)*n.height;e.webkitTransform="translateX("+o+"px) translateY("+u+"px) scale3d("+n.scale/s+","+n.scale/s+",1)"}else e.width=r(n.width)+"px",e.height=r(n.height)+"px";t.width=r(n.width)+"px",t.height=r(n.height)+"px",e.left=r(n.left)+"px",e.top=r(n.top)+"px",t.left==="0px"||(t.left="0px"),t.top==="0px"||(t.top="0px")}.observes("layout")},Core.PinchZoomability={isMixin:YES,hasPinchZoomability:YES,allowZoom:YES,enableOwnerSwipability:NO,zoomState:null,defendAgainstAbnormallyFastFlicks:NO,defaultZoomState:{zoom:1,y:0,x:0},neverLockXAxis:NO,neverLockYAxis:NO,maximumZoom:6,speedFractionPerTick:.989,speedAsymptoteBoost:.01,shouldSnapToTop:NO,shouldSnapToLeft:NO,touchIgnoreTest:function(){return NO},resetZoom:function(e){this.computeBoundedZoomHash(this.defaultZoomState,this.zoomState||(this.zoomState={})),e||this.trigger("zoomState")},_initZoom:function(){this.resetZoom(YES)}.observes("init"),touchStart:function(e){if(!e||!this.allowZoom||this.touchIgnoreTest(e))return;if(e.touches.length>2)return;var t=this._getScaleGestureInfo(e);if(!t)return;this.enableOwnerSwipability&&this.owner.isCommittingSwipe&&this.owner.forceFinishCurrentSwipeCommittal(),this.determineAxisLock
(e),Core.cloneHash(t,this._initialGestureInfo||(this._initialGestureInfo={})),Core.cloneHash(this._candidateZoom||this.zoomState,this._initialZoomInfo||(this._initialZoomInfo={})),Anim.tellStop(this._pinchZoomAnimation),this._isZoomReadyForMove=YES},touchEnd:function(e){if(e&&e.touches.length>2||!this.allowZoom)return;if(!e||!e.touches||!e.touches.length)this._candidateZoom=null;var t=this._initialGestureInfo;if(!t)return;e.touches.length?this.touchStart(e):(this._isZoomReadyForMove=NO,this.setIfChanged("isZoomTouching",NO),t.separation=t.centerX=t.centerY=NaN,this.animateAfterTouch(),this.cleanUpAfterTouch(),this.enableOwnerSwipability&&(this.owner.swipeTouchDidEnd(),this._isSwiping=NO,this._hasForfeitedRightSwipe=NO,this._hasForfeitedLeftSwipe=NO,this._wasSwipeRejected=NO)),this._previousTouchDate=NaN},touchMove:function(e){if(!this._isZoomReadyForMove||!this.allowZoom)return;e.preventDefault();var t=this._getScaleGestureInfo(e);if(!t)return;var n=this.zoomContainerSize,r=this.zoomContentSize,i=this._initialGestureInfo,s=this._initialZoomInfo,o=i.separation===0?1:t.separation/i.separation||1,u=Math.min(this.maximumZoom,Math.max(.025,s.zoom*o)),a=u/s.zoom,f=t.centerX-i.centerX+(a-1)*(s.x+n.width/2-i.centerX),l=t.centerY-i.centerY+(a-1)*(s.y+n.height/2-i.centerY),c=this._candidateZoom||(this._candidateZoom={}),h,p,d,v,m;this.enableOwnerSwipability&&(e.touches.length===1?(d=this.computeBoundedZoomHash(this.zoomState,this._boundedTestHashRecycler||(this._boundedTestHashRecycler={})),v=this.zoomState.zoom*r.width<=n.width,m=this.zoomState.zoom===1,h=this.getRightBoundaryX(),!this
._isSwiping&&(h===this.zoomState.x||v&&d.x===this.zoomState.x||m)&&!this._hasForfeitedLeftSwipe&&t.centerX<i.centerX&&(this._isSwiping="left",this._isXAxisLocked=YES,this.shouldLockVerticalDragOnSwipe&&(this._isYAxisLocked=YES)),v&&h<this.zoomState.x-2&&(this._hasForfeitedLeftSwipe=YES),this._isSwiping==="left"&&(!d&&(t.centerX>i.centerX||this._wasSwipeRejected)&&(this._isSwiping=NO,this._hasForfeitedLeftSwipe=YES,this._isXAxisLocked=NO,this.shouldLockVerticalDragOnSwipe&&(this._isYAxisLocked=NO)),this._hasForfeitedLeftSwipe||this.owner.swipeToOffset(t.centerX-i.centerX)&&(this._wasSwipeRejected=YES)),p=this.getLeftBoundaryX(),!this._isSwiping&&(p===this.zoomState.x||v&&d.x===this.zoomState.x||m)&&!this._hasForfeitedRightSwipe&&t.centerX>i.centerX&&(this._isSwiping="right",this._isXAxisLocked=YES,this.shouldLockVerticalDragOnSwipe&&(this._isYAxisLocked=YES)),v&&p>this.zoomState.x+2&&(this._hasForfeitedRightSwipe=YES),this._isSwiping==="right"&&(!d&&(t.centerX<i.centerX||this._wasSwipeRejected)&&(this._isSwiping=NO,this._hasForfeitedRightSwipe=YES,this._isXAxisLocked=NO,this.shouldLockVerticalDragOnSwipe&&(this._isYAxisLocked=NO)),this._hasForfeitedRightSwipe||this.owner.swipeToOffset(t.centerX-i.centerX)&&(this._wasSwipeRejected=YES))):this.owner.cancelSwipe()),c.zoom=u,c.x=s.x+!this._isXAxisLocked*f,c.y=s.y+!this._isYAxisLocked*l,this.computeCompromiseZoomHash(c,this.zoomState),e.touches.length===1?(this._ppTouchDate=this._previousTouchDate,this._previousTouchDate=new Date*1,this._isXAxisLocked||(this._ppTouchX=this._previousTouchX,this._previousTouchX=t.centerX),this._isYAxisLocked||
(this._ppTouchY=this._previousTouchY,this._previousTouchY=t.centerY)):this._previousTouchDate=NaN,this.setIfChanged("isZoomTouching",YES),this.trigger("zoomState")},touchCancel:function(e){return this.touchEnd.apply(this,arguments)},determineAxisLock:function(e){var t=this.zoomContainerSize,n=this.zoomContentSize,r=this.zoomState,i=this.computeBoundedZoomHash(r,this._axisLockBoundTester||(this._axisLockBoundTester={}));this._isXAxisLocked=NO,this._isYAxisLocked=NO;if(!t||!n||!i||!e||!e.touches||e.touches.length>1)return;i.x===r.x&&n.width*r.zoom<=t.width&&(this._isXAxisLocked=!this.neverLockXAxis),i.y===r.y&&n.height*r.zoom<=t.height&&(this._isYAxisLocked=!this.neverLockYAxis)},cleanUpAfterTouch:function(){this._isYAxisLocked=this._isXAxisLocked=NO,this._ppTouchY=this._ppTouchX=this._ppTouchDate=this._previousTouchY=this._previousTouchX=this._previousTouchDate=NaN},_getScaleGestureInfo:function(e){if(!e.touches.length)return null;var t=this._gsgiVessel||(this._gsgiVessel={}),n,r,i,s,o,u,a,f,l;return n=e.touches[0],r=e.touches[1]||n,i=n.clientX,s=n.clientY,o=r.clientX,u=r.clientY,a=o-i,f=u-s,l=Math.sqrt(f*f+a*a),t.separation=l,t.centerX=(o+i)/2,t.centerY=(u+s)/2,t},animateAfterTouch:function(){var e=this.zoomState;if(!e||!this.allowZoom)return;Anim.tellStop(this._pinchZoomAnimation),e.zoom>=1&&this._ppTouchDate&&this._previousTouchDate?this._pinchZoomAnimation=this.InertiaAnimation.go({owner:this}):this._pinchZoomAnimation=this.SnapBackAnimation.go({owner:this})},computeBoundedZoomHash:function(e,t){Core.cloneHash(e,t||(t={}));var n=this.zoomContentSize,r=this.zoomContainerSize
,i;if(!n||!r)return;return e.zoom<1&&(t.zoom=1),i=n.width/2*t.zoom-r.width/2,n.width*t.zoom<r.width?t.x=this.shouldSnapToLeft?i:0:t.x<-i?t.x=-i:t.x>i&&(t.x=i),i=n.height/2*t.zoom-r.height/2,n.height*t.zoom<r.height?t.y=this.shouldSnapToTop?i:0:t.y<-i?t.y=-i:t.y>i&&(t.y=i),t},getLeftBoundaryX:function(){return this.zoomContentSize.width/2*this.zoomState.zoom-this.zoomContainerSize.width/2},getRightBoundaryX:function(){return-(this.zoomContentSize.width/2*this.zoomState.zoom-this.zoomContainerSize.width/2)},computeCompromiseZoomHash:function(e,t,n){return this.computeBoundedZoomHash(e,t||(t={})),n&&Core.cloneHash(t,n),t.zoom=(e.zoom+t.zoom)/2,t.x=(e.x+t.x)/2,t.y=(e.y+t.y)/2,t},areZoomHashesEqual:function(e,t){return e.zoom===t.zoom&&e.x===t.x&&e.y===t.y},SnapBackAnimation:Anim.Animation.extend({duration:350,saveStartState:function(){this.owner.computeBoundedZoomHash(this.owner.zoomState,this.toZoom={}),Core.cloneHash(this.owner.zoomState,this.fromZoom||(this.fromZoom={}))}.observes("start"),update:function(){var e=this.current,t=1-e,n=this.fromZoom,r=this.owner.zoomState,i=this.toZoom;r.zoom=i.zoom*e+t*n.zoom,r.x=i.x*e+t*n.x,r.y=i.y*e+t*n.y,this.owner.trigger("zoomState")},killSelfAndIsZoomHappening:function(){this.owner._pinchZoomAnimation=null,this.owner.setIfChanged("isZoomHappening",NO)}.observes("finish")}),InertiaAnimation:Anim.Task.extend({ticked:2,computeInitialSpeed:function(){var e=this.owner,t=(e._previousTouchDate-e._ppTouchDate)/(this.ticked||16)||Infinity,n,r;this.x={name:"x",speed:(e._previousTouchX-e._ppTouchX||0)/t,current:e.zoomState.x},this.y={name:"y",speed
:(e._previousTouchY-e._ppTouchY||0)/t,current:e.zoomState.y},this.owner.defendAgainstAbnormallyFastFlicks&&this.owner._zoomHappeningStartTime>=new Date*1-500&&(r=5*(this.owner.zoomContainerSize.width/2+this.owner.zoomContainerSize.height/2)/896,n=Math.sqrt(this.x.speed*this.x.speed+this.y.speed*this.y.speed),n>r&&(this.x.speed*=r/n,this.y.speed*=r/n))}.observes("start"),killSelfAndIsZoomHappening:function(){this.owner._pinchZoomAnimation=null,this.owner.setIfChanged("isZoomHappening",NO)}.observes("finish"),run:function(e,t){var n=this.owner.computeBoundedZoomHash(this.owner.zoomState,this._closestBound||(this._closestBound={}));this.runComponent(this.x,e,n.x),this.runComponent(this.y,e,n.y),isNaN(this.x.current)||(this.owner.zoomState.x=this.x.current),isNaN(this.y.current)||(this.owner.zoomState.y=this.y.current),Math.abs(this.x.speed||0)<.001&&Math.abs(this.y.speed||0)<.001&&(this.trigger("finish"),this.stop()),t||this.owner.trigger("zoomState")},runComponent:function(e,t,n){if(e.turnedAround)return;var r=!isNaN(e.bound);r||e.current!==n&&(e.bound=n,e.behindBound=e.current<n,e.aheadOfBound=!e.behindBound,r=YES),r&&(e.speed+=(e.behindBound?1:-1)*Math.abs(e.bound-e.current)/50*t/16,!e.turnedAround&&(e.behindBound&&e.speed>0||!e.behindBound&&e.speed<0)&&(e.turnedAround=YES),e.turnedAround&&(e.speed=Infinity,e.snapBackAnim=Anim.Animation.go({owner:this,stopper:function(){if(!e.snapBackAnim)return;e.snapBackAnim=null,e.speed=0,this.stop()}.observes(".owner.stop","stop"),inertia:4,speed:20,headStart:1,from:e.current,to:e.bound,update:function(){e.current=this.current}})));var i=
e.speed>0,s=i?1:-1;if(e.speed){e.speed+=s*this.owner.speedAsymptoteBoost,e.speed*=this.owner.speedFractionPerTick,e.speed-=s*this.owner.speedAsymptoteBoost;if(i&&e.speed<=0||!i&&e.speed>=0)e.speed=0}e.snapBackAnim||(e.current+=e.speed)}}),bumpIsZoomHappening:function(){if(!this.isZoomTouching)return;this.setIfChanged("isZoomHappening",YES)}.observes("isZoomTouching"),prepareForFastFlickDefense:function(){if(!this.defendAgainstAbnormallyFastFlicks)return;this._zoomHappeningStartTime=new Date*1}.observes("isZoomHappening")},Core.RequestDelegate={isRequestDelegate:YES,isMixin:YES,requestWillSend:function(e){},requestDelayForResponse:function(e,t){return null},requestDidRecieveResponse:function(e,t){},requestShouldPauseHandlingOfReceivedResponse:function(e,t){return!1},requestShouldPauseSendingOfRequest:function(e){return!1},requestDidPauseExecution:function(e){},requestCancelled:function(e){}},Core.FadeShowHide={isMixin:YES,disableFade:NO,duration:350,shouldShow:YES,showHideAnimationExample:Anim.Fader,_watchShouldShow:function(){if(!this.layer||this._lastShouldShow===(this._lastShouldShow=this.shouldShow))return;this.isRenderingLayer&&(this.initiallyAppended=this.shouldShow),this[this.shouldShow?"show":"hide"](this.isRenderingLayer),!this.shouldShow&&this.isRenderingLayer&&(this.layer.style.opacity=0)}.observes("shouldShow","render"),show:function(e){if(this.isShowing===YES)return;this.set("isShowing",YES),Anim.tellStop(this._showHider);var t=this.showDuration||this.duration;if(isNaN(t)||this.disableFade)e=YES;if(e)return this.append();this._showHider=this.showHideAnimationExample
.go({owner:this,element:this.layer,to:1,duration:t,append:function(){this.owner.append()}.observes("start")})},hide:function(e){if(this.isShowing===NO)return;this.set("isShowing",NO),Anim.tellStop(this._showHider);var t=this.hideDuration||this.duration;if(isNaN(t)||this.disableFade)e=YES;if(e)return this.remove();this._showHider=this.showHideAnimationExample.go({owner:this,element:this.layer,to:0,duration:t,remove:function(){this.owner.remove()}.observes("finish")})},finishTransition:function(){Anim.tellFinish(this._showHider)}},Core.WaitSupport={isMixin:YES,hasWaitSupport:YES,shouldFireWithoutReqs:NO,numReqs:0,_waitSupport_reqsCompleted:0,_waitSupport_initWarning:function(){},forceWaitCompletion:function(){this._waitSupport_allReqsDidComplete()},preinit:function(){},init:function(){this.preinit();var e=this.shouldFireWithoutReqs;e&&this.openReq(),arguments.callee.base.apply(this,arguments);var t=this._waitSupport_subclass_init;t&&t.apply(this),e&&this.closeReq()},initOverride:function(e,t,n){return e.base=this._waitSupport_subclass_init||this._waitSupport_initWarning,this._waitSupport_subclass_init=e,t},openReq:function(){this.numReqs++},closeReq:function(){var e=this._waitSupport_reqsCompleted,t=this.numReqs;if(e===t)return;this._waitSupport_reqsCompleted=e+=1,e===t&&this._waitSupport_allReqsDidComplete()},_waitSupport_allReqsDidComplete:function(){if(this._didComplete===(this._didComplete=YES))return;this.trigger("waitDidComplete")}},Core.KeyCodes={ARROW_LEFT:37,ARROW_RIGHT:39,ESCAPE:27,SPACE:32},Core.KeyActions={},function(){var e=Core.KeyCodes,t=Core.KeyActions;t[e.ARROW_LEFT
]="ArrowLeft",t[e.ARROW_RIGHT]="ArrowRight",t[e.ESCAPE]="Escape",t[e.SPACE]="Space"}(),Core.KeyEventRootResponder=Core.Object.extend({eventKeys:"keydown keyup keypress".w(),responder:null,registerKeyEventHandlers:function(){var e=this,t=this.eventKeys,n=function(t){e.handleKeyEvent.call(e,t)};for(var r=0,i;i=t[r];r+=1)Core.addEvent(document,i,n)}.observes("init"),handleKeyEvent:function(e){var t=this.get("responder"),n,r=e.type.toLowerCase(),i=e.keyCode,s=Core.KeyActions[i];if(!t)return;n=t[r+"For"+s];if(n instanceof Function){n.call(t,e);return}n=t[r],n instanceof Function&&n.call(t,e)}}),Core.KeyEventRootResponder.responder=Core.KeyEventRootResponder,Core.mixin({setupKeyEventRootResponder:function(){var e=Core.KeyEventRootResponder.responder;Core.set("keyEventRootResponder",e.create())}.observes("finalizeCore")}),Core.define("Locale",Core.Object.extend({strings:{},locString:function(e){var t=this.strings[e];return t||e},static_locales:{},static_localeClassFor:function(e){var t,n=this.locales[e];return n||(this.locales[e]=n=Core.Locale.extend()),n},static_createCurrentLocale:function(){var e=String.preferredLanguage||navigator.language,t=this.localeClassFor(e);return e!==this.currentLanguage&&(this.currentLanguage=e,this.currentLocale=t.create()),this.currentLocale},static_addStrings:function(e){return this.prototype.strings=e,this}})),Core.stringsFor=function(e,t){var n=Core.Locale.localeClassFor(e);return n.addStrings(t),this},(window.SC||(SC={})).stringsFor=function(){return Core.stringsFor.apply(Core,arguments)},Core.Array={forEach:function(e,t,n){if(!e)return;n=n||e;for(
var r=0,i=e.length;r<i;r+=1)t.call(n,e[r],r)}},Core.mixin({_b64:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",enbase64:function(e){if(window.btoa)try{return btoa(e)}finally{}if(!e)return e;var t=Core._b64,n=0,r=0,i="",s=Core._tmpArr||(Core._tmpArr=[]),o="",u=e.length,a=String.fromCharCode,f,l,c,h,p,d,v,m,g,y;s.length=0,e=e.toString().replace(/\r\n/g,"\n");for(g=0;g<u;g++)(y=e.charCodeAt(g))<128?o+=a(y):y>127&&y<2048?(o+=a(y>>6|192),o+=a(y&63|128)):(o+=a(y>>12|224),o+=a(y>>6&63|128),o+=a(y&63|128));e=o;do f=e.charCodeAt(n++),l=e.charCodeAt(n++),c=e.charCodeAt(n++),m=f<<16|l<<8|c,h=m>>18&63,p=m>>12&63,d=m>>6&63,v=m&63,s[r++]=t.charAt(h)+t.charAt(p)+t.charAt(d)+t.charAt(v);while(n<e.length);i=s.join("");switch(e.length%3){case 1:i=i.slice(0,-2)+"==";break;case 2:i=i.slice(0,-1)+"="}return i},debase64:function(e){if(window.atob)try{return atob(e)}finally{}var t=Core._b64,n="",r=0,i,s,o,u,a,f,l;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(r<e.length)u=t.indexOf(e.charAt(r++)),a=t.indexOf(e.charAt(r++)),f=t.indexOf(e.charAt(r++)),l=t.indexOf(e.charAt(r++)),i=u<<2|a>>4,s=(a&15)<<4|f>>2,o=(f&3)<<6|l,n+=String.fromCharCode(i),f!==64&&(n+=String.fromCharCode(s)),l!==64&&(n+=String.fromCharCode(o));var c=0,h="",p,d,v;while(c<n.length)p=n.charCodeAt(c),p<128?(h+=String.fromCharCode(p),c++):p>191&&p<224?(d=n.charCodeAt(c+1),h+=String.fromCharCode((p&31)<<6|d&63),c+=2):(d=n.charCodeAt(c+1),v=n.charCodeAt(c+2),h+=String.fromCharCode((p&15)<<12|(d&63)<<6|v&63),c+=3);return h}}),Core.define("bodyOverflowArbitrator",Core.Object.create({requestHidden:function(e,t){this._makeRequest
(e,-1-9*!!t)},requestVisible:function(e,t){this._makeRequest(e,1+9*!!t)},withdrawRequest:function(e){if(!e)return;var t=Core.guidFor(e);this._requests[t]&&(delete this._requests[t],this.setOverflow())},setOverflow:function(){var e=this._decideOverflow();e!==undefined&&(document.body.style.overflow=e?"auto":"hidden")},_makeRequest:function(e,t){if(!e)return;var n=Core.guidFor(e);if(this._requests[n]===(this._requests[n]=t))return;this.setOverflow()},_requests:{},_decideOverflow:function(){var e,t,n,r,i=this._requests,s;for(var o in i)(s=i[o])<0&&(e=YES),s<-1&&(n=YES),s>0&&(t=YES),s>1&&(r=YES);return r?YES:t&&n?NO:t?YES:e?NO:YES}})),Core.mixin({strToHtml:function(e){return e.split("\n").join("<BR>").split("  ").join(" &nbsp;")},toCamel:function(e,t){e||(e="");for(var n=0,r=e.length;n<r;n++){if(e.charAt(n)!=="-"||n==r-1)continue;e=e.substring(0,n)+e.charAt(n+1).toUpperCase()+e.substring(n+2),r--}return t?e.charAt(0).toUpperCase()+e.substring(1):e},toDashed:function(e,t){e||(e="");for(var n=0,r=e.length;n<r;n++){var i=e.charAt(n);if(i.toLowerCase()===i||n==r-1)continue;e=e.substring(0,n)+"-"+e.charAt(n).toLowerCase()+e.substring(n+1),r++}return t&&e.charAt(0)==="-"?e.substring(1):e},getStyle:function(e,t){if(e.currentStyle)return e.currentStyle[Core.toCamel(t)];if(e.initialStyle)return e.initialStyle.getPropertyValue(t);var n;if((n=document.defaultView)&&(n=n.getComputedStyle))return(e.initialStyle=n(e,null)).getPropertyValue(t)},addEvent:function(el,name,func,capture){if(el.addEventListener)return el.addEventListener(name,func,!!capture);if(el.attachEvent)return el.attachEvent("on"+
name,function(){return func.apply(el,arguments)});var old=el["on"+name],listener=old?function(){typeof old=="string"?eval(old):old.apply(this,arguments),func.apply(this,arguments)}:func;return el["on"+name]=listener},stopPropagatingEvent:function(e){if(!e)return;e.cancelBubble=!0,e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()},positionOfElement:function(e){var t=0,n=0,r=e;do t+=r.offsetTop||0,n+=r.offsetLeft||0,r=r.offsetParent;while(r);var i=e._posHash||(e._posHash={});return i.left=n,i.top=t,i},hideIOSAddressBar:function(e){clearTimeout(Core._hideIOSABTimeout);if(!B.iOS)return;if(Core.scrollTop()>=10)return;e?Core._hideIOSABTimeout=setTimeout(Core._hideIOSAddressBar,e):Core._hideIOSAddressBar()},_hideIOSAddressBar:function(){Core.scrollTop(0)},scrollTop:function(e){var t=document.body,n=document.documentElement;if(!t||!n)return;return isNaN(e)?window.scrollY||t.scrollTop||n.scrollTop:(window.scrollTo(window.scrollX||t.scrollLeft||n.scrollLeft||0,e),e)},scrollHeight:function(){if(!document.body||!document.documentElement)return;return Math.max(document.body.scrollHeight||0,document.documentElement.scrollHeight||0)},lastScrollTop:0,_saveScrollTop:function(){Core.setIfChanged("lastScrollTop",Core.scrollTop())}.observes("Core.windowScroll")}),Core.addEventToElement=Core.addEvent,Core.mixin({emptyObject:{},emptyArray:[],emptyFunction:function(){},emptyImageSrc:"data:image/gif;base64,R0lGODlhAQABAJAAAP///wAAACH5BAUQAAAALAAAAAABAAEAAAICBAEAOw=="}),Core.ErrorCatcher=Core.Object.extend({_isAttached:NO,attach:function(){if(this._isAttached===(this._isAttached=
YES))return;this._attachToFunctionPrototype()},detach:function(){if(this._isAttached===(this._isAttached=NO))return;this._detachFromFunctionPrototype()},_attachToFunctionPrototype:function(){var e=this,t=this._nativeCall=Function.prototype.call,n=this._nativeApply=Function.prototype.apply,r=t,i=n,s,o;t.call=t,t.apply=n,n.call=t,n.apply=n,t.displayName="call",n.displayName="apply";var u=function(t){var n=Function.prototype,u=r,a=i,f=e;return function(){var e=n,r;e.call=u,e.apply=a;try{r=t.apply(this,arguments)}catch(i){throw f._isAttached&&!f._isHandlingException&&(f.shouldIgnoreException(i)||f._handleException(i),e.call=s,e.apply=o),i}return f._isAttached&&(e.call=s,e.apply=o),r}};Function.prototype.call=s=u(t),Function.prototype.apply=o=u(n)},_detachFromFunctionPrototype:function(){Function.prototype.call=this._nativeCall,Function.prototype.apply=this._nativeApply},handleException:function(e){},_handleException:function(e){var t;this._isHandlingException=YES;try{this.handleException(e)}catch(n){t=n}this._isHandlingException=NO;if(t)throw t},shouldIgnoreException:function(e){}}),require("utilities/error_catcher/error_catcher"),Core.ErrorCatcher.reopen({NO_USER_DIALOG:YES,MAX_RECENT_LOG_MESSAGES_SIZE:4800,delegate:null,shouldIgnoreException:function(e){var t=e.toString();return t.indexOf("GM.")!==-1?YES:NO},handleException:function(e){var t=this.buildHashForException(e);this.sendHashToFeedbackWS(t)},buildHashForException:function(e){var t=undefined,n={},r=window.BUILD_INFO;return n.error=e?e.message?e.message:e.toString():"Unknown",e||(e=Core.emptyObject),n.file=e.fileName||e
.sourceURL||"Unknown",n.line=e.lineNumber||e.line||"Unknown",n.time=(new Date).toString()+" ("+Math.floor(new Date)+")",n.userAgent=navigator.userAgent+"",r&&(n.buildInfo=window.enumerate(r)),t&&(n.symbolicationFailed=t.toString()),e.stack&&(n.stack=e.stack.toString()),window.RELATIVE_URLS&&this.NO_USER_DIALOG&&(delete n.file,delete n.line,delete n.stack,delete n.buildInfo),this.NO_USER_DIALOG&&(delete n.windowLocation,delete n.exceptionInfo,delete n.recentLogMessages),this.computeLogTextForHash(n),n},computeLogTextForHash:function(e){var t="";for(var n in e)t+=this._upperCasifyCamel(n)+"\n"+e[n]+"\n\n";return e.text=t,t},_upperCasifyCamel:function(e){var t="";for(var n=0,r=e.length,i,s,o=YES;n<r;n++)s=(i=e[n]).toUpperCase(),i===s&&(n===0&&(o=NO),o&&(t+=" ")),t+=s;return t},sendHashToFeedbackWS:function(e){var t={appName:window.APP_NAME,errorTitle:e.error,errorType:"exception",origin:"client"};Core.cloneHash(e,t),delete t.text;var n=this.delegate;if(n&&n.errorCatchShouldReportError(this,e)){var r=n.errorCatcherGetDetailedInformationForError(this,e);r&&Core.cloneHash(r,t),n.errorCatcherReportErrorFeedback(this,e,t)}}}),function(){var e=/[&<>\"\'\/]/g,t=function(e){switch(e){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&#39;";case"/":return"&#47;"}};Core.escapeHTML=function(n){return n?n.replace(e,t):n}}(),Core.define("JSONProcessor",Core.Object.extend({processJSONObject:function(e,t,n,r,i,s){n||(n=""),s||(s=[]),r=(r||0)+1,i||(i=e);if(!e||!t)return;s.push(e);var o,u,a,f,l,c,h=arguments.callee._scratchArrays||(arguments.callee
._scratchArrays=[]),p=h[r]||(h[r]=[]),d,v,m,g,y,b,w,E,S,x,T,N=" > ",C=N.length,k,L,A,O;for(v in t)v.indexOf("_ensureExists_")!=-1&&(e.hasOwnProperty(v.substring(14))||(e[v.substring(14)]=t[v]));for(v in t){if(!t.hasOwnProperty(v))continue;p.length=0,m=undefined;if(v==="*")for(m in e)p.push(m);else e.hasOwnProperty(v)&&p.push(v),v.slice(-1-"_jsontransform".length,-1)==="_jsontransform"&&(T=v.slice(0,-1-"_jsontransform".length),e.hasOwnProperty(T)&&p.push(T));u=t[v];for(d=0;m=p[d];d++){o=e[m],x=u instanceof Function;if(typeof u=="string"||x){x?(A=u,O=m):(k=u.indexOf(N),k!==-1?(L=u.substring(0,k),O=u.substring(k+C),v==="*"&&(O=m+O),A=this[L]):(L=u,O=v,A=this[L])),e[O]=A.call(this,e[m],e,i,s,m,O);continue}a=o instanceof Array,f=u instanceof Array,l=o instanceof Object,c=u instanceof Object;if(!l||!c||a!==f)continue;if(!a)this.processJSONObject(o,u,n+"."+m,r,i,s);else{b=u[0],w=n+"."+m+".";for(g=0;y=o[g];g++)this.processJSONObject(y,b,w+g,r,i,s)}}}s.length--;return},copy:function(e){return e},remove:function(){return undefined},toLowerCase:function(e){return(e||"").toString().toLowerCase()},parseInt:parseInt,parseFloat:parseFloat})),Core.mixin({innerSizeInOuter:function(e,t,n,r,i){var s=this._innerSizeOuterRet||(this._innerSizeOuterRet={}),o,u,a;return isNaN(e)&&(i=n,r=t.height,n=t.width,t=e.height,e=e.width),o=e/t,u=n/r,a=i?o<u:o>u,s.width=a?n:r*o,s.height=a?n/o:r,s}}),Core.mixin({LogLevel:{NONE:1e3,ERROR:2,WARN:1,DEBUG:0},LogPrefixes:{debug:"",warn:"Warning: ",error:"Error: "},logLevel:0,_debugs:[],_warns:[],_errors:[],_logs:[],debug:function(){Core._log(Core.LogLevel.DEBUG,"debug"
,arguments)},warn:function(){Core._log(Core.LogLevel.WARN,"warn",arguments)},error:function(){Core._log(Core.LogLevel.ERROR,"error",arguments)},maybeDebug:function(e){if(!e)return;var t=Core._argPasser;t.length=0;for(var n=1;n<arguments.length;n++)t.push(arguments[n]);Core.debug.apply(this,t)},_log:function(e,t,n){for(var r=0,i="",s=n.length,o;(o=n[r])||r<s;r++)i+=(r===0?"":" ")+o;this["_"+t+"s"].push(i),this._logs.push((Core.LogPrefixes[t]||"")+i);if(this.logLevel>e)return;var u=window.console;u&&(u=u[t])&&u.apply?u.apply(console,n):u&&u(i)},stringifyRecordedLogMessages:function(e){e||(e=Infinity);var t=this._logs,n=t.length-1,r=0,i=[];while(r<=e&&n>=0)r+=t[n].length,i.push(t[n]),n--;return i.join("\n")}}),Core.mixin({mousePosition:{},setUpMouseEvents:function(){Core.addEvent(document,"mousemove",function(e){if(!e)return;var t=NO,n=Core.mousePosition;!isNaN(e.clientX)&&n.x!==(n.x=e.clientX)&&(t=YES),!isNaN(e.clientY)&&n.y!==(n.y=e.clientY)&&(t=YES),t&&Core.trigger("mousePosition")})}.observes("finalizeCore")}),Core._relativeUrl_cachedCurrentUrl=function(){var e=BUILD_INFO.currentUrl.split("/"),t,n=e.length;for(t=0;t<e.length;t++)e[t]==".."&&(e.splice(t,1),e.splice(t-1,1),t--,t--);return e.join("/")}(),Core.relativeUrl=function(e){var t=Core._relativeUrl_cachedCurrentUrl.split("/"),n=e.split("/");while(n.length>=1&&t.length>=1&&t[0]===n[0])t.shift(),n.shift();var r="";t.pop();for(var i=0,s=t.length;i<s;i++)r+="../";return r+=n.join("/"),r},require("mixins/request_delegate"),Core.define("Request",Core.Object.extend(Core.RequestDelegate,{className:"Request",forceAjaxSender:NO,
debugDelay:0,url:"",type:"GET",body:null,contentType:"text/plain",isAsync:YES,withCredentials:YES,requestId:null,headers:{},autoJSONParse:YES,ajaxSenderFrames:{},delegate:null,static_trace:!1,static_responseQueue:[],static_requestDelegate:null,static__PauseToken:Core.Object.extend({request:null,resumeAction:null,resume:function(){this.resumeAction.call(this)}}),delegateValue:function(){return this.delegate||Core.Request.requestDelegate||this}.property(),isCancelled:function(){return!!this._isCancelled}.property(),enforceAPI:function(){this.url||Core.error("Core.Requests require URLs.")}.observes("init"),send:function(){if(this.get("isCancelled"))return;var e=this,t=arguments;if(!this.debugDelay)return this._send.apply(this,t);setTimeout(function(){e._send.apply(e,t)},this.debugDelay)},cancel:function(){this._isCancelled=!0;var e=this.get("delegateValue");e.requestCancelled(this)},_send:function(){if(this.get("isCancelled"))return;var e=this.get("delegateValue");if(e.requestShouldPauseSendingOfRequest(this)){this._pauseExecution(Core.Request._PauseToken.create({request:this,resumeAction:function(){this.request._completeSend()}})),Core.warn("%@: Sending %@ request to %@ has been paused.".fmt(this,this.type,this.url));return}this._completeSend()},_completeSend:function(){var e=this.get("delegateValue");e.requestWillSend(this),this.trigger("willSend");var t=Core.Request.responseQueue.shift();if(t){var n=t.responseObject;n&&(t.responseObject=JSON.parse(JSON.stringify(n))),this.didReceiveResponse(t);return}if(this.forceAjaxSender||this.isCrossDomain&&B.msie<=9)return this.sendWithAjaxSender
.apply(this,arguments);var r=new XMLHttpRequest,i=this.headers,s=this.body?this.body instanceof Object&&JSON.stringify(this.body)||this.body:null,o;r.open(this.type,this.url,this.isAsync),r.owner=this,r.onreadystatechange=this._readyStateChangeFunction,r.withCredentials=this.withCredentials&&!!this.isAsync;for(o in i)i.hasOwnProperty(o)&&r.setRequestHeader(o,i[o]);return r.send(s),this._transport=r,this},sendWithAjaxSender:function(){var e=this.ajaxSenderFrames,t=e[this.origin]||(e[this.origin]=Core.AjaxSenderFrame.create({origin:this.origin}));t.sendRequest(this)},_readyStateChangeFunction:function(){if(this.readyState!==4)return;this.owner.didReceiveResponse(this)},hasPausedExecution:function(){return!!this._pauseToken}.property(),resumeExecution:function(){if(!this.get("hasPausedExecution"))return;var e=this._pauseToken;this._pauseToken=null,Core.warn("%@: Resuming execution.".fmt(this)),e.resume()},_pauseExecution:function(e){this._pauseToken=e,this.get("delegateValue").requestDidPauseExecution(this)},didReceiveResponse:function(e){this._xhr=e;var t=this.get("delegateValue"),n=t.requestDelayForResponse(this,e);if(!n)return this._handleReceivedResponse(e);var r=this;setTimeout(function(){r._handleReceivedResponse(e)},n)},_handleReceivedResponse:function(e){if(this.get("isCancelled")){Core.Request.trace&&Core.warn("%@: Request has been cancelled. Unable to handle received response".fmt(this));return}if(this.autoJSONParse&&!e.responseObject)try{var t=e.responseText;t&&(e.responseObject=JSON.parse(t))}catch(n){Core.debug("Could not parse the responseText as JSON for "+this+": "
,n)}var r=this.get("delegateValue");r.requestDidRecieveResponse(this,e);if(r.requestShouldPauseHandlingOfReceivedResponse(this,e)){this._pauseExecution(Core.Request._PauseToken.create({request:this,response:e,resumeAction:function(){this.request._finalizeHandlingOfReceivedResponse(this.response)}})),Core.warn("%@: Handling of received response has been paused.".fmt(this));return}this._finalizeHandlingOfReceivedResponse(e)},_finalizeHandlingOfReceivedResponse:function(e){e.status!==200?(this.set("resolution","error"),this.trigger("error"+e.status,e),this._stoppedError||this.trigger("error",e)):(this.set("resolution","success"),this.trigger("success",e))},_computeOriginAndDecideCrossDomain:function(){var e=location,t=e.protocol+"//"+e.host,n=this.url,r=n.indexOf("://"),i=r!==-1?n.substring(0,n.indexOf("/",r+3)):t;this.set("origin",i),this.set("isCrossDomain",t!==i),!this.isAsync&&this.isCrossDomain&&B.msie<=9&&Core.warn("Warning: A cross-domain, synchronous request was just created.","Though possible with browsers that support CORS, the request will","be asynchronous in MSIE <= 9 due to reliance on the postmessage API","to communicate with the ajax_sender iframe.")}.observes("init"),stopError:function(){this._stoppedError=YES},_decideRequestId:function(){this.requestId||this.set("requestId",this.toString().slice(1,-1))}.observes("init"),_writeContentTypeHeader:function(){if(!this.contentType)return;var e=this.ensureOwn("headers");if(e["Content-Type"])return;e["Content-Type"]=this.contentType}.observes("init"),toString:function(){return"[Core.Request: %@]".fmt(this.coreGuid)}})
),Core.Request.send=function(){var e=this.create.apply(this,arguments);return e.send(),e},Core.define("AjaxSenderFrame",Core.Object.extend({isReady:NO,path:"/ajax_sender.html",origin:null,prepareScaffolding:function(){this._inflightRequests={};var e=document.createElement("iframe"),t=this;e.setAttribute("frameBorder",0),e.setAttribute("width",0),e.setAttribute("height",0),e.style.cssText="position:absolute; left:-10000px; top:-10000px; visibility:hidden; z-index:-1;",e.id="AjaxSenderFrame"+this.coreGuid,e.onload=e.onreadystatechange=function(){if(this.readyState&&this.readyState!=="loaded"&&this.readyState!=="complete")return;this.onreadystatechange=null,t.setIfChanged("isReady",YES)},e.setAttribute("src",this.origin+this.path),document.body.appendChild(e),this.set("frame",e),Core.addEvent(window,"message",function(e){t._didReceiveResponseMessage(e)})}.observes("init"),_didReceiveResponseMessage:function(e){if(e.origin!==this.origin)return;var t=JSON.parse(e.data),n=t.requestId,r=this._inflightRequests[n];if(!r){Core.debug("AjaxSenderFrame ("+this.origin+"): Received a response from iframe, but can't find a request to which to pass it.");return}r.didReceiveResponse(t)},sendRequest:function(e){if(!e)return;if(e.origin!==this.origin)return Core.warn("Can't use AjaxSenderFrame for "+this.origin+" to send request to "+e.origin+".");this.isReady?this._sendRequest(e):(this._pendingReqs||(this._pendingReqs=[])).push(e)},flushPendingReqs:function(){if(!this.isReady)return;for(var e=0,t=this._pendingReqs,n;n=t&&t[e];e++)this._sendRequest(n);t.length=0}.observes("isReady"),_sendRequest
:function(e){try{this.frame.contentWindow.postMessage(JSON.stringify({requestId:e.requestId,url:e.url,type:e.type,headers:e.headers,body:e.body,isAsynchronous:YES}),this.origin),this._inflightRequests[e.requestId]=e}catch(t){Core.warn("AjaxSenderFrame ("+this.origin+"): Error while attempting to postMessage into the iframe. ",t)}},logMe:function(){Core.debug("Setting up cross-domain AjaxSenderFrame for origin "+this.origin)}.observes("init")})),Core.Request.reopen({_json2CodeStatus:window.JSON2CodeStatus={isRequired:!(window.JSON&&JSON.stringify&&JSON.parse),isReceived:NO,isRequested:NO,queue:null,ensureRequested:function(){if(this.isRequested===(this.isRequested=YES))return;Core.debug("Appending script tag for the JSON2 code.");var e=this.script=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src","/applications/sharedalbum/1819Project40/quark/1819Project40/en-us/resources/json2"),document.body.appendChild(e)},didReceive:function(){Core.debug("JSON2 code is obtained. Launching any queued requests.");var e,t,n=this.queue;this.isReceived=YES;for(e=0;t=n[e];e++)t.send()}},send:function(){var e=this._json2CodeStatus;if(e.isRequired&&!e.isReceived){(e.queue||(e.queue=[])).push(this),e.ensureRequested();return}arguments.callee.base.apply(this,arguments)}}),Core.define("View",Core.Object.extend({className:"View",isView:YES,tagName:"div",ariaRole:undefined,ariaLabel:undefined,tabIndex:undefined,classNames:"view".w(),classNamesOverride:"concatenate",initiallyAppended:YES,isAppended:NO,isAppendedInWindow:NO,CACHE_LAYER_EXAMPLE_IMMEDIATELY:!!B
.mobile,DO_NOT_CACHE_LAYER_EXAMPLES:NO,static__htmlSpawner:function(){var e=document.createElement("div");return e.elementFromHTML=B.msie?function(e){return this.innerHTML=e,this.firstChild.cloneNode(!0)}:function(e){return this.innerHTML=e,this.firstChild},e}(),init:function(){arguments.callee.base.apply(this,arguments);var e,t,n,r,i,s,o=this.CACHE_LAYER_EXAMPLE_IMMEDIATELY;(r=this.rootHTML)?(s=this._rootHTMLUniqueAncestor||this,o&&!s._rootHTMLExample&&(s._rootHTMLExample=Core.View._htmlSpawner.elementFromHTML(r)),(i=s._rootHTMLExample)&&i!==!0&&(t=this.layer=i.cloneNode(!0)),t||(t=this.layer=Core.View._htmlSpawner.elementFromHTML(r)),s&&i===!0&&(i=s._rootHTMLExample=t.cloneNode(!0)),s&&!i&&(i=s._rootHTMLExample=!0)):t=this.layer=document.createElement(this.tagName),this.set("isRenderingLayer",YES),this.layer.id="View"+this.coreGuid;if(e=this.classNames&&this.classNames.join(" "))t.className+=(t.className?" ":"")+e;this._resolveInitialElements(),this.ariaRole&&this.layer.setAttribute("role",this.ariaRole),this.render(t),this._initializeChildViews(),this._initializeEventListeners(),this.trigger("render"),this.set("isRenderingLayer",NO)},updateToTabIndex:function(){if(!this.layer)return;var e=this.tabIndex;e||e===0?this.layer.setAttribute("tabindex",this.tabIndex):this.layer.removeAttribute("tabindex")}.observes("tabIndex","render"),updateToAriaLabel:function(){if(!this.layer)return;var e=Core.escapeHTML(this.ariaLabel);e&&this.layer.setAttribute("aria-label",e)}.observes("ariaLabel","render"),applyBackgroundColor:function(){if(!this.layer)return;var e=this.backgroundColor;e&&
(this.layer.style.backgroundColor=e||"")}.observes("backgroundColor","render"),"*ViewOverride":function(e,t,n){if(!e||!e.isClass)return e;var r=this.ensureOwn("initialChildViews")||(this.initialChildViews=[]);return r.push(n),e},"*ElementOverride":function(e,t,n){e===null&&this.initialElements&&this.initialElements.remove(t);if(typeof e!="string")return e;var r=this.ensureOwn("initialElements")||(this.initialElements=[]),i=n.slice(0,-7);return r.remove(i),r.push(i),e},rootHTMLOverride:function(e,t,n){return this._isCreating?this._rootHTMLUniqueAncestor=undefined:(this._rootHTMLUniqueAncestor=this._type,this._type._rootHTMLExample=undefined),e},_resolveInitialElements:function(){for(var e=0,t=this.initialElements,n;n=t&&t[e];e++)this[n]=this.getPath(this[n+"Element"])},_initializeChildViews:function(){for(var e=0,t,n=this.initialChildViews,r;n&&(r=n[e]);e++)(t=this[r])&&t.isClass&&(t=this[r]=t.create({owner:this}))&&t.initiallyAppended&&t.appendTo(this)},stopPropagatingEvent:function(e){Core.stopPropagatingEvent(e)},_initializeEventListeners:function(){var e=this,t=this.layer,n=Core.View,r=null,i=Core.addEvent;!this.layerFocused||i(t,"focus",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.layerFocused(t)}),B.msie>=11&&navigator.pointerEnabled?(!this.pointerEntered||i(t,"pointerenter",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.pointerEntered(t||window.event)}),!this.pointerExited||i(t,"pointerout",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.mouseExited(t||window.event)}),!this.pointerClick||i(t,"pointerdown",function(t){var r;if(!(r=n._mouseDownOn
)||r===e)return e.pointerClick(t||window.event)}),!this.pointerMove||i(t,"pointermove",function(t){var r;if(!n._mouseDownOn)return e.pointerMove(t||window.event)}),!this.mouseDown||i(t,"mousedown",function(t){if(n._mouseDownOn)return;n._mouseDownOn=e,$(document.body).addClass("mouse-down");var i,s=Core.getStyle(e.layer,"cursor");s&&$(document.body).addClass(n._forcedCursor="cursor-"+s),document.onmouseup=r,e.pointerMove&&(document.onpointermove=e._boundMove||(e._boundMove=function(t){return e.pointerMove(t)}));if(e.mouseDown)return e.mouseDown(t)}),r=function(t){n.allowFutureMouseDown();if(e.mouseUp)return e.mouseUp(t||window.event)}):B.msie===10&&navigator.msPointerEnabled?(!this.pointerEntered||i(t,"MSPointerOver",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.pointerEntered(t||window.event)}),!this.pointerExited||i(t,"MSPointerOut",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.mouseExited(t||window.event)}),!this.pointerClick||i(t,"MSPointerDown",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.pointerClick(t||window.event)}),!this.pointerMove||i(t,"MSPointerMove",function(t){var r;if(!n._mouseDownOn)return e.pointerMove(t||window.event)}),!this.mouseDown||i(t,"mousedown",function(t){if(n._mouseDownOn)return;n._mouseDownOn=e,$(document.body).addClass("mouse-down");var i,s=Core.getStyle(e.layer,"cursor");s&&$(document.body).addClass(n._forcedCursor="cursor-"+s),document.onmouseup=r,e.pointerMove&&(document.onpointermove=e._boundMove||(e._boundMove=function(t){return e.pointerMove(t)}));if(e.mouseDown)return e.mouseDown(t)}),r=function(t){n.allowFutureMouseDown
();if(e.mouseUp)return e.mouseUp(t||window.event)}):B.mobile?(!this.touchStart||i(t,"touchstart",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.touchStart(t||window.event)},!1),!this.touchEnd||i(t,"touchend",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.touchEnd(t||window.event)},!1),!this.touchMove||i(t,"touchmove",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.touchMove(t||window.event)},!1),!this.touchCancel||i(t,"touchcancel",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.touchCancel(t||window.event)},!1)):(!this.mouseEntered||i(t,"mouseover",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.mouseEntered(t||window.event)}),!this.mouseExited||i(t,"mouseout",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.mouseExited(t||window.event)}),!this.mouseClick||i(t,"click",function(t){var r;if(!(r=n._mouseDownOn)||r===e)return e.mouseClick(t||window.event)}),!this.mouseMove||i(t,"mousemove",function(t){var r;if(!n._mouseDownOn)return e.mouseMove(t||window.event)}),!this.mouseDown||i(t,"mousedown",function(t){if(n._mouseDownOn)return;n._mouseDownOn=e,$(document.body).addClass("mouse-down");var i,s=Core.getStyle(e.layer,"cursor");s&&$(document.body).addClass(n._forcedCursor="cursor-"+s),document.onmouseup=r,e.mouseMove&&(document.onmousemove=e._boundMove||(e._boundMove=function(t){return e.mouseMove(t)}));if(e.mouseDown)return e.mouseDown(t)}),r=function(t){n.allowFutureMouseDown();if(e.mouseUp)return e.mouseUp(t||window.event)})},static_allowFutureMouseDown:function(){$(document.body).removeClass("mouse-down").removeClass(this
._forcedCursor),this._mouseDownOn=null,this._forcedCursor=null,document.onmouseup=null,document.onmousemove=null,document.onpointermove=null},render:function(e){},append:function(e){return this.appendTo(e||this._previousParent||this.owner||document.body)},appendTo:function(e){if(!e)return this;!e.isView||(e=e[this.appendInto]||e.container||e.layer);var t=this._parent;return t&&t!==e&&(this.remove(),t=null),t||e.appendChild(this.layer),this._previousParent=this._parent=e,this.setIfChanged("isAppended",YES),this},remove:function(){if(!this.layer)return this;this.layer.parentNode&&this.layer.parentNode.removeChild(this.layer);var e=this._parent;return this._parent=null,e&&this.setIfChanged("isAppended",NO),this},killSelectionAndDragInIE:B.msie?function(){this.layer.onselectstart=this.layer.ondragstart=this._NO_RETURNER}.observes("render"):undefined,_updateToIsAppended:function(){if(this._appendRemove_lastIsAppended===(this._appendRemove_lastIsAppended=this.isAppended))return;this.isAppended?this.append():this.remove()}.observes("isAppended"),computeAppendednessInWindow:function(){var e=this.owner;window.appendedness=(window.appendedness||0)+1,this.setIfChanged("isAppendedInWindow",e?e.isAppendedInWindow&&this.isAppended:this._parent===document.body)}.observes(".owner.isAppendedInWindow","isAppended"),_view_finalCleanup:function(){this.remove()}.observes("destroy"),_NO_RETURNER:function(){return NO}})),require("views/_view"),Core.mixin({announce:function(e){if(!this._screenreaderAnnouncerView)return;this._screenreaderAnnouncerView.announce(e)},ScreenreaderAnnouncerView:Core.View
.extend({classNames:"screenreader-announcer".w(),_IGNORE_OBSERVATION_WARNINGS_FOR_PATHS:{"#owner":YES},makeMeAnAnnouncer:function(){this.layer.setAttribute("aria-live","polite")}.observes("render"),announce:function(e){if(!this.layer)return;this._lastAnnouncedText===(this._lastAnnouncedText=e)&&(this.layer.innerText=""),this.layer.innerText=e||""}}),_createAnnouncer:function(){this._screenreaderAnnouncerView=Core.ScreenreaderAnnouncerView.create().appendTo(document.body)}.observes("finalizeCore")}),Core.textMeasurer=Core.View.create({rootHTML:'<div class="text-measurer"></div>',_IGNORE_OBSERVATION_WARNINGS_FOR_PATHS:{"#owner":YES},canUseCanvas:NO,_vessel:{},contextCache:{},init:function(){var e=this._canvas=document.createElement("canvas"),t=this._context=e.getContext&&e.getContext("2d");e.width=e.height=1,this.canUseCanvas=!!(e&&t&&t.fillText&&t.measureText),arguments.callee.base.apply(this,arguments)},attachOnLoad:function(){this.appendTo(document.body)}.observes("Core.finalizeCore"),metricsForString:function(e,t,n){if(!this.layer)return;var r=this.layer,i=this._vessel;return r.innerHTML=e,r.style.cssText=t?"font:"+t+";":"",n?r.style.maxWidth=n+"px":r.style.maxWidth="",i.width=r.offsetWidth,i.height=r.offsetHeight,i},widthForString:function(e,t,n){if(n||!this.canUseCanvas||e.indexOf("<")!==-1)return this.metricsForString(e,t,0).width;var r=this.contextCache[t]||(this.contextCache[t]=this._contextForFontString(t));return r.measureText(e).width},_contextForFontString:function(e){var t=document.createElement("canvas"),n=t.getContext("2d");return t.width=t.height=1,n.font=e,n}
}),Core.metricsForString=function(){return Core.textMeasurer.metricsForString.apply(Core.textMeasurer,arguments)},Core.widthForString=function(){return Core.textMeasurer.widthForString.apply(Core.textMeasurer,arguments)},Core.compareVersions=function(e,t){e=Core.parseVersion(e),t=Core.parseVersion(t);var n,r,i,s=Math.max(e.length,t.length);for(n=0;n<s;n++){r=e[n]||0,i=t[n]||0,r<0&&i<0&&(r=-r,i=-i);if(r<i)return-1;if(r>i)return 1}return 0},Core.parseVersion=function(e){e||(e="0"),e=e.split("b");var t=e[1];e=e[0].split(".");for(var n=0,r,i;r=e[n];n++)r==(i=parseInt(r,10))&&(e[n]=i);return t&&(e=e.concat([-t])),e},Core.mixin({setUpWindowScrollTracking:function(){var e=this;Core.addEvent(window,"scroll",function(){e._windowDidScroll()})},_windowDidScroll:function(){this.trigger("windowScroll")}}),Core.setUpWindowScrollTracking(),Core.mixin({minWindowWidth:0,windowZoom:1,_lastWindowZoom:1,setUpWindowSizeTracking:function(){this.windowSize={},this.actualWindowSize={},window.windowResizeTimes=[];var e=this,t=this._windowDidResize,n=this._windowDidResize=function(){var r=new Date*1,i=t.apply(e,arguments);return window.windowResizeTimes.push(new Date*1-r),i};Core.addEvent(window,"resize",n,!0),B.iOS&&Core.addEvent(window,"orientationchange",n,!0),B.iOS>=7&&setInterval(n,500),(this._windowDidResize(!0)===1||B.mobile)&&Core.listen("windowDidLoad",n)},_windowDidResize:function(e){var t=this.windowSize,n=window,r=document,i,s,o;if(!r.body||!r.documentElement)return 1;var u=window.orientation,a=n.innerWidth||r.documentElement.clientWidth||r.body.clientWidth,f=n.innerHeight||r.documentElement
.clientHeight||r.body.clientHeight,l=B.standalone;if(s=Core.windowSizeOverride)!isNaN(s.width)&&(a=s.width),!isNaN(s.height)&&(f=s.height),!isNaN(s.orientation)&&(u=s.orientation),s.hasOwnProperty("standalone")&&(l=s.standalone);B.desktop&&(Core.minWindowWidth&&a<Core.minWindowWidth?(o=a,a=Core.minWindowWidth,Core.bodyOverflowArbitrator.requestVisible(this,!0)):Core.bodyOverflowArbitrator.withdrawRequest(this)),B.onlyiOS?(B.iPad&&u%180===0&&window.innerWidth>window.innerHeight&&(u=90),B.iOS<7?u%180?B.iPad?(t.width=1024,t.height=Math.max(f,644),B.iOS<7&&f<=768&&(this._tallestLandscape>t.height||(this._tallestLandscape=t.height),t.height=this._tallestLandscape)):B.iPhone&&(t.width=Math.max(a,480),t.height=Math.max(f,268),B.iOS<7&&(this._widestLandscape>t.width||(this._widestLandscape=t.width),t.width=this._widestLandscape),B.iOS<7&&f<=(l?320:268)&&(this._tallestLandscape>t.height||(this._tallestLandscape=t.height),t.height=this._tallestLandscape)):(B.iPad?(t.height=Math.max(f,900),t.width=768):B.iPhone&&(t.height=Math.max(f,B.iPhone5?504:416),t.width=320),B.iOS<7&&(this._tallestPortrait>t.height||(this._tallestPortrait=t.height),t.height=this._tallestPortrait)):(t.width=a,t.height=f),this._lastOrientation!==(this._lastOrientation=u)&&e!==!0&&(p=YES),this.windowOrientation=u,this.windowZoom=t.width/a,this._originalMaxGPUTextureSize||(this._originalMaxGPUTextureSize=this.maxGPUTextureSize),this.maxGPUTextureSize=this._originalMaxGPUTextureSize/this.windowZoom):(t.width=a,t.height=f);var c=NO,h,p;c=c||!!o,c=c||this._lastWindowWidth!==(this._lastWindowWidth=t.width),c=c||this._lastWindowHeight!==
(this._lastWindowHeight=t.height),c=c||(h=this._lastWindowZoom!==(this._lastWindowZoom=this.windowZoom));if(!c||e===!0)return;Core.hideIOSAddressBar(100),this.actualWindowSize.width=o||this.windowSize.width,this.actualWindowSize.height=this.windowSize.height;if(B.msie<=8){if((i=Core._ie8WSFreebies)>=3)return clearTimeout(this._ie8WindowSizeTimeout),this._ie8WindowSizeTimeout=setTimeout(function(){Core.trigger("windowSize")},10);Core._ie8WSFreebies=(i||0)+1}h&&this.trigger("windowZoom"),this.trigger("windowSize")}.observes("minWindowWidth"),maintainOrientationClassesOnBody:function(){if(!B.mobile)return;var e=Core.windowOrientation%180,t=e?"landscape":"portrait",n=e?"portrait":"landscape";$(document.body).addClass(t),$(document.body).removeClass(n)}.observes("windowSize")}),Core.setUpWindowSizeTracking(),function(){var e=3;Core.define("ButtonView",Core.View.extend(Core.ButtonnessMixin={isMixin:YES,className:"ButtonView",ariaRole:"button",classNames:"button".w(),useHoverOnMobile:NO,actionDelay:10,isPurelyDecorative:NO,isEnabled:YES,isActive:NO,isOver:NO,isDown:NO,allowEventPropogation:!0,action:function(){},init:function(){if(!this.isPurelyDecorative)return arguments.callee.base.apply(this,arguments);for(var e=0,t=this._buttonnessKeys,n;n=t[e];e++)this[n]=undefined;return this.ariaRole==="button"&&(this.ariaRole=undefined),arguments.callee.base.apply(this,arguments)},touchStart:function(e){var t=e.touches[0].clientX,n=e.touches[0].clientY;return this._touchStartX=t,this._touchStartY=n,this.mouseDown(e)},touchEnd:function(e){var t=this.mouseUp(e);return this.mouseExited(),t},touchMove
:function(t){var n=t.touches[0].clientX,r=t.touches[0].clientY;if(Math.abs(n-this._touchStartX)>e||Math.abs(r-this._touchStartY)>e)return this.touchCancel()},touchCancel:function(e){return this.mouseExited(),this.mouseUp(e)},pointerEntered:function(){this.mouseEntered()},mouseEntered:function(){if(!this.isEnabled)return;this.setIfChanged("isOver",YES)},mouseExited:function(){this.setIfChanged("isOver",NO)},pointerDown:function(e){this.mouseDown(e)},mouseDown:function(e){this.allowEventPropogation||this.stopPropagatingEvent(e);if(!this.isEnabled)return;this.mouseEntered(),this.setIfChanged("isDown",YES)},mouseUp:function(e){this.allowEventPropogation||this.stopPropagatingEvent(e);var t=this,n=t.actionDelay;t.isEnabled&&t.isActive&&(n?setTimeout(function(){t.performActions(e)},n):this.performActions(e)),t.setIfChanged("isDown",NO),this._touchStartX=this._touchStartY=NaN},pointerClick:function(e){this.mouseClick()},mouseClick:function(e){this.allowEventPropogation||this.stopPropagatingEvent(e)},_buttonnessKeys:"touchStart touchEnd touchMove touchCancel pointerEntered pointerExited mouseEntered mouseExited mouseDown mouseUp".w(),performActions:function(e){this.action(e),this.trigger("action",e)},chooseTabIndex:function(){if(this.isPurelyDecorative)return;isNaN(this.tabIndex)&&this.setIfChanged("tabIndex",!this.isPurelyDecorative&&this.isEnabled?0:-1)}.observes("render","isPurelyDecorative","isEnabled"),setActive:function(){this.setIfChanged("isActive",this.isDown&&this.isOver)}.observes("isDown","isOver"),classActive:function(){if(!this.layer||this._lIA===(this._lIA=!!this.isActive
))return;$(this.layer)[this.isActive?"addClass":"removeClass"]("active")}.observes("isActive","render"),classOver:function(){if(!this.layer||this._lIO===(this._lIO=!!this.isOver)||B.mobile&&!this.useHoverOnMobile)return;$(this.layer)[this.isOver?"addClass":"removeClass"]("hover")}.observes("isOver","render"),classSelected:function(){if(!this.layer||this._lIS===(this._lIS=!!this.isSelected))return;$(this.layer)[this.isSelected?"addClass":"removeClass"]("sel")}.observes("isSelected","render"),classDisabled:function(){if(!this.layer||this._lIE===(this._lIE=!!this.isEnabled))return;$(this.layer)[this.isEnabled?"removeClass":"addClass"]("disabled")}.observes("isEnabled","render")}))}(),Core.define("TransitionerView",Core.View.extend({transitioners:null,allowInterruption:NO,transitioningOverflow:"hidden",steadyStateOverflow:"visible",_immediateTransition:Core.Object.extend({start:function(){var e=this.frView,t=this.toView;e&&e.remove(),t&&t.append(this.owner),this.owner.didFinishTransition()}}),finishTransitioning:function(){var e;(e=this.transitioner)&&e.finish(),(e=this.transitioner)&&e.finish()},transitionToCurrentView:function(){if(this._isRestoringPreviousViewAfterCancel)return;var e=this.transitioner;if(e){if(!this.allowInterruption){this._pendingTransitionView=this.currentView,this.currentView=this.previousView,e.__speedFactor__=3,e.duration/=e.__speedFactor__,e._restoreDuration||(e._restoreDuration=function(){this.duration*=this.__speedFactor__,this.__speedFactor__=1},e.listen("finish",e._restoreDuration));return}e.finish()}this._pendingTransitionView=null;var t=this.currentView
,n=this.previousView,r=t&&t.typeInteger||0,i=n&&n.typeInteger||0,s=this.transitioners,o=s&&s[r],u=o&&o[i]||this.defaultTransition||this._immediateTransition,a=this._transitionerInstances;e=a[Core.guidFor(u)]||(a[u.coreGuid]=u.create({owner:this})),this.setIfChanged("previousView",t),this.trigger("willRunTransition",n,t,e),n&&n.trigger("willEnterTransition",n,t,e),t&&t.trigger("willEnterTransition",n,t,e),t&&t.setIfChanged("isShowing",YES),n&&n.trigger("didEnterTransition",n,t,e),t&&t.trigger("didEnterTransition",n,t,e),this.trigger("didRunTransition",n,t,e),e.frView=n,e.toView=t,this.set("transitioner",e),this.shouldAutomaticallyStartTransitionFromViewToView(n,t)?e.start():this.didNotAutomaticallyStartTransitionFromViewToView(e,n,t)}.observes("currentView"),shouldAutomaticallyStartTransitionFromViewToView:function(e,t){return!0},didNotAutomaticallyStartTransitionFromViewToView:function(e,t,n){},didFinishTransition:function(){var e=this.transitioner;this.set("transitioner",null);if(!e)return;var t=e.frView,n=e.toView;this.trigger("willFinishRunningTransition",t,n,e),t&&t.trigger("willFinishTransition",t,n,e),n&&n.trigger("willFinishTransition",t,n,e),t&&t.setIfChanged("isShowing",NO),t&&t.trigger("didFinishTransition",t,n,e),n&&n.trigger("didFinishTransition",t,n,e),this.trigger("didFinishRunningTransition",t,n,e);var r=this._pendingTransitionView,i=this;r&&setTimeout(function(){i.setIfChanged("currentView",r)},0)},didCancelTransition:function(){var e=this.transitioner;this.set("transitioner",null);var t=e.frView,n=e.toView;t&&t.trigger("didCancelTransition",t,n,e),n&&(n.setIfChanged
("isShowing",NO),n.trigger("didCancelTransition",t,n,e)),this.trigger("didCancelRunningTransition",t,n,e),this._isRestoringPreviousViewAfterCancel=YES,this.setIfChanged("currentView",t),this.setIfChanged("previousView",t),this._isRestoringPreviousViewAfterCancel=NO;var r=this._pendingTransitionView,i=this;r&&setTimeout(function(){i.setIfChanged("currentView",r)},0)},hideScrollbars:function(){this.layer.style.overflow=this.transitioningOverflow}.observes("willRunTransition"),unhideScrollbars:function(){this.layer.style.overflow=this.steadyStateOverflow}.observes("didFinishRunningTransition","render"),_transitionerInstances:function(){this._transitionerInstances={}}.observes("init")})),function(){var e,t,n,r,i,s,o=Anim.Animation.extend({duration:700,tween:Anim.tweens.make("compound","WEBKIT_EASE","SINE_IN_OUT"),shadowHeight:300,shouldUseShadow:YES,provideDelayAfterFinish:function(){var e=this;setTimeout(function(){e.trigger("delayAfterFinish")},0)}.observes("finish"),_dropHeight:function(){return Core.windowSize.height+this.shadowHeight},start:function(){return this._forcedZeroes=3,arguments.callee.base.apply(this,arguments)},update:function(){var e=this.slideView.layer.style,t=this._shadow&&this._shadow.style,n;!this.disableGPU&&Core.useGPUForBigs&&Core.windowSize.width<=Core.maxGPUTextureSize?(n="0px",e.top===n||(e.top=n),t&&(t.top===n||(t.top=n)),e.webkitTransform="translate3d(0,"+this.current+"px,0)",t&&(t.webkitTransform="translate3d(0,"+(this.current-this.shadowHeight)+"px,0)")):(e.top=Math.round(this.current)+"px",t&&(t.top=Math.round(this.current-this.shadowHeight)+"px"
)),e.position==="fixed"||(e.position="fixed"),t.position==="fixed"||(t.position="fixed")},tellWorkspaceDone:function(){this.owner.didFinishTransition()}.observes("delayAfterFinish"),addShadow:function(){if(!this.shouldUseShadow)return;var e;(e=this._shadow)||(this._shadow=e=document.createElement("div"),e.className="top-shadow",e.style.cssText="z-index:500; position:absolute; left:0px; top:0px; width:100%; height:"+this.shadowHeight+"px;"),this.owner.layer.appendChild(e)}.observes("start"),removeShadow:function(){if(!this.shouldUseShadow)return;var e=this._shadow;e&&e.parentNode&&e.parentNode.removeChild(e)}.observes("finish"),ensureCorrectZOrdering:function(){var e=this._runningZ||(this._runningZ=10);this.sitView&&(this.sitView.layer.style.zIndex=e),this.slideView&&(this.slideView.layer.style.zIndex=e+1),this._runningZ+=2}.observes("start")}),u=o.extend({to:0,start:function(){return this.slideView=this.toView,this.sitView=this.frView,this.redirectFrom(this._dropHeight()),this.redirectTo(0),this.reset(),arguments.callee.base.apply(this,arguments)}}),a=o.extend({from:0,start:function(){return this.slideView=this.frView,this.sitView=this.toView,this.redirectFrom(0),this.redirectTo(this._dropHeight()),this.reset(),arguments.callee.base.apply(this,arguments)}});Core.transitionBank={liftTo:u,dropFrom:a,xFadeTo:u.extend({duration:350,shouldUseShadow:NO,update:function(){if(!this.slideView)return;var e=this.slideView.layer.style;e.opacity=this.progress}}),xFadeFrom:a.extend({duration:350,shouldUseShadow:NO,update:function(){if(!this.slideView)return;var e=this.slideView.layer.style
;e.opacity=1-this.progress}}),slideRight:n=(t=Anim.Animation.extend({duration:350,disableGPU:NO,start:function(){return this._originalDuration||(this._originalDuration=this.duration),this.duration=this._originalDuration,this.useGPU=!this.disableGPU&&Core.useGPUForBigs&&Core.windowSize.width<=Core.maxGPUTextureSize,!(B.s.chrome>=19)&&!(B.s.mozilla>=14)&&!(B.msie>=9)&&Core.useGPUForBigs&&Core.windowSize.width>Core.maxGPUTextureSize&&(this.duration=0),B.msie===8&&(this.duration=0),this.recycle(),this._forcedZeroes=3+5*(!!B.safari&&!!B.windows),this._lastElapsedTime&&this.duration&&(this.duration=(this.duration*.75+this._lastElapsedTime*.25)*.8+.2*this._originalDuration),this.redirectFrom(0),this.redirectTo(1),arguments.callee.base.apply(this,arguments)},updateDurationForNextTime:function(){this._lastElapsedTime=this.elapsedTime,this._lastElapsedTime<100&&(this._lastElapsedTime=this._originalDuration)}.observes("finish"),appendToWhenBegin:function(){this.toView&&this.toView.append(this.owner)}.observes("start"),removeFrWhenDone:function(){this.to===1&&this.frView&&this.frView.remove()}.observes("finish"),tellWorkspaceDone:function(){this.to===1&&this.owner.didFinishTransition()}.observes("finish"),removeToWhenCanceled:function(){this.to===0&&this.toView&&this.toView.remove()}.observes("finish"),tellWorkspaceCanceled:function(){this.to===0&&this.owner.didCancelTransition()}.observes("finish"),update:function(){var e=Core.windowSize.width,t=this.direction,n=this.current,r=this.frView,i=this.toView;this.useGPU?(r&&(r.layer.style.webkitTransform="translate3d("+n*e*t+"px,0,0)"),i&&(i
.layer.style.webkitTransform="translate3d("+(n*e*t-t*e)+"px,0,0)")):(r&&(r.layer.style.marginLeft=Math.round(n*e*t)+"px"),i&&(i.layer.style.marginLeft=Math.round(n*e*t-t*e)+"px"))},cleanUp:function(){var e=this.frView,t=this.toView;e&&(e.layer.style.marginLeft=""),t&&(t.layer.style.marginLeft=""),e&&(e.layer.style.webkitTransform=""),t&&!this.owner.preserveUpSlideGPULayers&&(t.layer.style.webkitTransform="")}.observes("finish")})).extend({direction:1.05}),slideLeft:r=t.extend({direction:-1.05}),xFadeSlideRight:B.msie===8?n:(i=t.extend({update:function(){arguments.callee.base.apply(this,arguments);var e=this.frView,t=this.toView,n=this.current;e&&(e.layer.style.opacity=1-n),t&&(t.layer.style.opacity=n)},fixOpacities:function(){var e=this.frView,t=this.toView;e&&(e.layer.style.opacity=""),t&&(t.layer.style.opacity="")}.observes("finish")})).extend({direction:.2}),xFadeSlideLeft:B.msie===8?r:i.extend({direction:-0.2})}}(),Core.define("WorkspaceView",Core.TransitionerView.extend({classNames:"workspace full-width full-height".w(),_IGNORE_OBSERVATION_WARNINGS_FOR_PATHS:{"#owner":YES},makeViewsArray:function(){var e=this._nowShowingMap;if(!e)return;for(var t=0,n=e.length;t<n;t++)e[t]=this[e[t]];this.set("isNSMapReady",YES)}.observes("render"),"*ViewOverride":function(e,t,n){return(this.ensureOwn("_nowShowingMap")||(this._nowShowingMap=[])).push(n),arguments.callee.base.apply(this,arguments)},setCurrentViewFromNowShowing:function(){if(!this.isNSMapReady)return;this.setIfChanged("currentView",this._nowShowingMap[this.nowShowing])}.observes("nowShowing"),setClassName:function(){var e=
this._lastClassNS,t=this.nowShowing;if(this._lastClassNS===(this._lastClassNS=t))return;window._removeRHTMLSpinner&&window._removeRHTMLSpinner();if(!this.tabNames)return;$(this.layer).removeClass(this.tabNames[e]),$(this.layer).addClass(this.tabNames[t])}.observes("currentView"),setExplicitIOSLayerSize:B.iOS?function(){this.layer.style.width=Core.windowSize.width+"px",this.layer.style.height=Core.windowSize.height+"px"}.observes("Core.windowSize","render"):null,nowShowingZeroPlaceholderView:null})),Core.addEvent(window,"load",function(){if(window.shouldAbortCore)return;Core.trigger("finalizeCore"),Core.trigger("windowDidLoad"),window.main instanceof Function&&window.main()}),require("utilities/error_catcher/error_handling"),function(){Core.errorCatcher=Core.ErrorCatcher.create(),Core.errorCatcher.attach()}(),CoreImage=Core.Namespace.create({}),CoreImage.InitialStateController=Core.Object.extend({params:null,paramKeys:[],baseUrl:null,semicolonDelimitedKeys:Core.emptyArray,paramsBase64Encoded:NO,discoverInitiallyKnownWindowLocation:function(){var e=window.location.toString();e.indexOf("%")!==-1&&window.decodeURIComponent&&(e=window.decodeURIComponent(e)),this.initiallyKnownWindowLocation=e,this.trigger("didDiscoverInitiallyKnownWindowLocation")}.observes("init"),generateParams:function(){try{var e=this.initiallyKnownWindowLocation,t=e.indexOf("#")+1,n=e.indexOf("?")+1;if(!t&&n){window.location=e.substring(0,n-1)+"#"+e.substring(n),Core.debug("About to redirect. Replacing '?' with '#'.");return}var r=t?e.substring(t):"",i=r.match(/\=(|\=)$/),s=r.indexOf("=")+1;r&&(!s||i)&&r.indexOf
(";")===-1?(r=Core.debase64(r),this.paramsBase64Encoded=YES):this.paramsBase64Encoded=NO;var o={},u={},a=[],f=this.semicolonDelimitedKeys,l,c,h,p,d,v,m,g=function(e,t){u[e]=t,!isNaN(p=parseFloat(t))&&p==t&&(t=p);if(m=this["paramTransform_"+e])t=m.call(this,t,o);o[e]=t,a.push(e)};if(r.indexOf("&")===-1&&r.indexOf(";")!==-1){l=r.split(";");for(v=0;(h=l[v])!==undefined&&(c=f[v]);v++)g.call(this,c,h)}else{l=r.split("&");for(v=0;d=l[v];v++){s=d.indexOf("=")+1;if(!s)continue;h=d.substring(s),c=d.substring(0,s-1),g.call(this,c,h)}}this._unmodifiedParams=u,this.set("params",o),this.set("paramKeys",a)}catch(y){this.trigger("paramsParseDidErr"),this.set("params",{}),this.set("paramKeys",[])}}.observes("init"),retrieveBaseUrl:function(){var e=window.location.toString();this.set("baseUrl",e.substring(0,(e.indexOf("#")+1||Infinity)-1)+"#")}.observes("init")}),CoreImage.SlideshowController=Core.Object.extend({isPlaying:NO,delay:3e3,itemSet:null,currentItem:null,getItemAfterItem:function(e){var t=this.itemSet,n=t.length,r=t.indexOf(e);return r>=0?t[(r+1)%n]:null},getItemBeforeItem:function(e){var t=this.itemSet,n=t.length,r=t.indexOf(e);return r>=0?t[(r-1+n)%n]:null},getItemAfterCurrentItem:function(){var e=this.currentItem;return e?this.getItemAfterItem(e):this.itemSet[0]},getItemBeforeCurrentItem:function(){var e=this.currentItem,t=this.itemSet;return e?this.getItemBeforeItem(e):t[t.length-1]},selectNext:function(){if(!this.itemSet)return;var e=this.getItemAfterCurrentItem();this.willSelectNextItem(e),this.set("currentItem",e),this.didSelectNextItem(e)},willSelectNextItem:function(e){},didSelectNextItem
:function(e){this.get("isPlaying")&&this.scheduleNext()},selectPrevious:function(){if(!this.itemSet)return;var e=this.getItemBeforeCurrentItem();this.willSelectPreviousItem(e),this.set("currentItem",e),this.didSelectPreviousItem(e)},willSelectPreviousItem:function(e){},didSelectPreviousItem:function(e){this.get("isPlaying")&&this.scheduleNext()},toggleShow:function(){this.isPlaying?this.stopShow():this.startShow()},stopShow:function(){this.setIfChanged("isPlaying",NO),clearTimeout(this._timeout),this._timeout=undefined,this.didStopShow()},didStopShow:function(){},startShow:function(){this.setIfChanged("isPlaying",YES),this.didStartShow()},didStartShow:function(){this.scheduleNext(.15)},announcePlaying:function(){var e="_Accessibility.SlideshowStarted",t="_Accessibility.SlideshowPaused",n=e.loc(),r=t.loc();if(e===n||t===r)return;Core.announce(this.isPlaying?n:r)}.observes("isPlaying"),scheduleNext:function(e){var t=this,n=e?e*this.delay:this.delay;clearTimeout(this._timeout),this._timeout=setTimeout(function(){t.selectNext()},n)},cancelNextScheduledItem:function(){var e=this._timeout;e&&clearTimeout(e)}}),CoreImage.ImageViewDelegate={isMixin:YES,isImageViewDelegate:YES,imageViewShouldEstablishCurrentAndPreferredReps:function(e){return YES},imageViewShouldAutomaticallyEstablishCurrentAndPreferredReps:function(e){return YES},imageViewGetEstablishedCurrentRep:function(e){return null},imageViewGetEstablishedPreferredRep:function(e){return null},imageViewShouldLoadImageForRep:function(e,t){return YES},imageViewShouldImmediatelyStartLoadingImageForRep:function(e,t){return YES},imageViewWillPrepareImageLoadForRep
:function(e,t){},imageViewDidPrepareImageLoadForRep:function(e,t){},imageViewImageValidToLoadForRep:function(e,t){return YES},imageViewSuccessfullyLoadedImageForRep:function(e,t){},imageViewFailedToLoadImageForRep:function(e,t){},imageViewImageLoadAbortedForRep:function(e,t){},imageViewDidUnloadImageForRep:function(e,t){}},require("mixins/image_view_delegate"),CoreImage.define("AbstractImageView",Core.View.extend(Core.WaitSupport,CoreImage.ImageViewDelegate,{classNames:"image-view".w(),reps:undefined,downerGroup:undefined,importance:0,importanceAdjust:0,shouldHoldOff:NO,isOff:NO,progressivityThreshold:1536,shouldEnforceThreshold:YES,sizePreferenceBias:window.devicePixelRatio||1,zIndex:NaN,height:NaN,width:NaN,left:0,top:0,preferredRep:null,currentRep:null,currentSrc:null,isLoading:NO,aspectRatio:NaN,loadednesses:null,numReqs:1,isInitting:YES,maximumRepSize:Infinity,delegate:null,delegateValue:function(){var e=this.delegate;return e&&e.isImageViewDelegate?e:this}.property(),init:function(){arguments.callee.base.apply(this,arguments),this.isInitting=NO},fixMaximumRepSize:function(){var e=Infinity,t=this.maximumRepSize||Infinity,n,r;for(n in this.reps)r=parseInt(n,10),r<e&&(e=r);e>t&&(t=e),this.maximumRepSize=t}.observes("maximumRepSize","reps"),_processReps:function(){if(this._lastReps===this.reps)return;this._lastReps=this.reps;var e=this.reps,t=this.sizes||(this.sizes=[]),n=NO,r=NO,i=NO,s=this.progressivityThreshold/2+10,o=this.progressivityThreshold/3,u=NaN,a=Infinity,f=this.maximumRepSize,l,c,h,p,d,v,m,g,y=-Infinity;t.length=0;if(!e){this.loadednesses=null;return}v=this.loadednesses=
{},g=this.loadees={},this.unloadObservers={};for(l in e){if(isNaN(p=parseInt(l,10)))continue;y<p&&(y=p);if(p>f)continue;t.push(p),typeof (h=e[l])=="string"&&(h=e[l]={url:h}),h._key=l;if(d=CoreImage.imageLoader.imageForSRC(h.url))v[l]=d;(m=CoreImage.imageLoader.loadeeForSRC(h.url))&&this.takeLoadeeForRepKey(m,l),p<=s&&(n=YES),p>=this.progressivityThreshold&&(r=YES)}i=r&&n,t.sort();if(this.shouldEnforceThreshold=this.shouldEnforceThreshold&&i)for(l=0;p=t[l];l++){if(p>s)continue;(u=Math.abs(p-o))<a&&(this._preferredSubThresholdSize=p,a=u)}this.biggestRepSizeInRepSet=y,this.trigger("sizes")}.observes("init","reps"),takeLoadeeForRepKey:function(e,t){this.loadees[t]=e;var n=this,r=this.unloadObservers[t];if(r)return;r=this.unloadObservers[t]=function(){n.handleRepUnload(t)},e.listen("didUnload",r)},_initialLayout:function(){this.setLayout(this.left,this.top,this.width,this.height,this.zIndex,YES)}.observes("render"),setLayout:function(e,t,n,r,i,s){var o=!1,u=this.aspectRatio;u&&(isNaN(n)&&(n=r*u),isNaN(r)&&(r=n/u)),!isNaN(t)&&(!s||!(this.top=NaN))&&this.setIfChanged("top",Math.round(t)),!isNaN(e)&&(!s||!(this.left=NaN))&&this.setIfChanged("left",Math.round(e)),!isNaN(n)&&(!s||!(this.width=NaN))&&(o=this.setIfChanged("width",Math.round(n))||o),!isNaN(r)&&(!s||!(this.height=NaN))&&(o=this.setIfChanged("height",Math.round(r))||o),!isNaN(i)&&(!s||!(this.zIndex=NaN))&&this.setIfChanged("zIndex",Math.round(i)),o&&this.trigger("sizeDidChange")},setSize:function(e,t,n){this.setLayout(NaN,NaN,e,t,NaN,n)},discoverBiggestRepSize:function(){var e=this.sizes,t,n,r=-Infinity;for(t=0;n=e[t];t++)
r<n&&(r=n);this.setIfChanged("biggestRepSize",r)}.observes("sizes"),provideBiggestRepBit:function(){parseInt(this.getPath("currentRep._key"),10)===this.biggestRepSize&&this.setIfChanged("hasSuccessfullyLoadedBiggestRep",YES)}.observes("currentRep"),provideBiggestRepSizeInRepSetBit:function(){parseInt(this.getPath("currentRep._key"),10)===this.biggestRepSizeInRepSet&&this.setIfChanged("hasSuccessfullyLoadedBiggestRepInRepSet",YES)}.observes("currentRep"),sizeBiasForCurrentAndPreferredReps:function(){return(this.ignoreHeightInRepDecision?this.width:Math.max(this.width,this.height))*this.sizePreferenceBias},_establishCurrentAndPreferredReps:function(){if(!this.layer||this.shouldHoldOff||this.isOff)return;if(!this.reps){this._setCurrentAndPreferredRep(null,null);return}var e=this.get("delegateValue");if(!e.imageViewShouldEstablishCurrentAndPreferredReps(this))return;if(!e.imageViewShouldAutomaticallyEstablishCurrentAndPreferredReps(this)){var t=e.imageViewGetEstablishedCurrentRep(this),n=e.imageViewGetEstablishedPreferredRep(this);this._setCurrentAndPreferredRep(t,n);return}var r=this.sizeBiasForCurrentAndPreferredReps();if(!r)return;var i=this.sizes,s=this.reps,o=this.loadednesses,u=this.loadees,a=Infinity,f=0,l=Infinity,c=0,h=this.maximumRepSize,p,d,v,m,g,y,b,w;for(v=0;(g=i[v])&&(m=s[g]);v++){if(g>h)continue;g<=r&&g>f&&(f=g),g>=r&&g<a&&(a=g);if(!(y=o[g]||(o[g]=CoreImage.imageLoader.imageForSRC(m.url)))||y.isRequest&&y.loaded===!1)continue;g<=r&&g>c&&(c=g),g>=r&&g<l&&(l=g),g<this.progressivityThreshold&&(this._isThresholdSatisfied=YES)}a===Infinity&&(a=0),l===Infinity&&(l=0),d=
a||f||0,p=l||c||0,!this.shouldEnforceThreshold||d<this.progressivityThreshold||this._isThresholdSatisfied||!this._preferredSubThresholdSize||(d=this._preferredSubThresholdSize),this._setCurrentAndPreferredRep(s[p],s[d])}.observes("sizes","sizeDidChange","assetRequestDidComplete","shouldHoldOff","maximumRepSize"),_setCurrentAndPreferredRep:function(e,t){this.setIfChanged("currentRep",e),this.setIfChanged("preferredRep",t)},_requestPreferredRepIfNeeded:function(){if(!this.preferredRep)return;var e=this.preferredRep,t=parseInt(e._key,10),n=this,r=this.loadednesses[t],i=this.get("delegateValue");if(r&&(!r.isRequest||r.loaded)){this.set("loaded",!0),this.set("done",!0),i.imageViewSuccessfullyLoadedImageForRep(this,e),this.trigger("assetRequestDidComplete");return}if(!i.imageViewShouldLoadImageForRep(this,e))return;var s=i.imageViewShouldImmediatelyStartLoadingImageForRep(this,e);i.imageViewWillPrepareImageLoadForRep(this,e),this._imageRequest=(this.CustomImageRequestClass||CoreImage.ImageRequest).create(this.getCustomOptionsForRequests(e),CoreImage.ImageRequestDelegate,{owner:this,saveTo:this.loadednesses,saveKey:t,group:this.downerGroup,importanceBinding:".owner.importance",importanceAdjustBinding:".owner.importanceAdjust",loadedBinding:"to:.owner.loaded",erredBinding:"to:.owner.erred",doneBinding:"to:.owner.done",rep:e,url:e.url,urls:e.urls,additionalUrls:e.additionalUrls,size:t,shouldIgnoreForLoading:!s,delegateValue:this,saveLoadeeToOwner:function(){if(!this.loadee)return;this.owner.takeLoadeeForRepKey(this.loadee,this.saveKey)}.observes("loadee"),onabort:function(){var e=this
;setTimeout(function(){e.owner._imageRequest=null,e.owner.set("preferredRep",null),i.imageViewImageLoadAbortedForRep(e.owner,e.rep),e.owner.trigger("assetRequestDidAbort")},0)},onload:function(){var e=this;setTimeout(function(){e.owner._imageRequest=null,e.rep.url=e.url,i.imageViewSuccessfullyLoadedImageForRep(e.owner,e.rep),e.owner.trigger("assetRequestDidComplete")},0)},onerror:function(){var e=this;setTimeout(function(){e.owner._imageRequest=null,e.owner.sizes.remove(e.size),delete e.owner.reps[e.size],i.imageViewFailedToLoadImageForRep(e.owner,e.rep),e.owner.trigger("sizes"),e.owner.trigger("assetRequestDidComplete")},0)}}),i.imageViewDidPrepareImageLoadForRep(this,e),this.trigger("isLoadingImage")}.observes("preferredRep"),imageRequestValid:function(e){var t=this.get("delegateValue");return t.imageViewImageValidToLoadForRep(this,e.rep)},pauseLoadingImageIfNeeded:function(){var e=this._imageRequest;e&&e.setIfChanged("shouldIgnoreForLoading",YES)},resumeLoadingImageIfNeeded:function(){var e=this._imageRequest;e&&e.set("shouldIgnoreForLoading",NO)},abortImageLoad:function(){var e=this._imageRequest;e&&e.abort()},isLoadingImage:function(){return!!this._imageRequest}.property(),isLoadingImagePaused:function(){var e=this._imageRequest;return!!e&&e.get("shouldIgnoreForLoading")}.property(),reestablishingRepsIfNeeded:function(e){if(!e&&this.get("isLoadingImage"))return;this._establishCurrentAndPreferredReps()},hasImageForRep:function(e){return!!this._loadeeForRep(e)},unloadImageForRep:function(e){var t=this._loadeeForRep(e);if(!t)return;t.unload&&t.unload()},_loadeeForRep:function(
e){if(!e)return!1;var t=parseInt(e._key,10);return t?this.loadednesses[t]:null},handleRepUnload:function(e){var t=this.reps[e];this.loadednesses[e]=null,this.loadees[e]=null,this.unloadObservers[e]=null;var n=this.get("delegateValue");t&&n.imageViewDidUnloadImageForRep(this,t),this.trigger("assetRequestDidComplete")},closeReqOnImageReceipt:function(){this.closeReq()}.observes("assetRequestDidComplete","currentSrc"),getCustomOptionsForRequests:function(e){return null},_establishIsLoading:function(){if(!this.preferredRep)return this.setIfChanged("isLoading",NO);var e=this.loadednesses[this.preferredRep._key];this.setIfChanged("isLoading",!e||e.loaded===!1)}.observes("preferredRep","assetRequestDidComplete"),_establishCurrentSrcAndExampleImage:function(){this.suspendTriggers();if(!this.currentRep)this.setIfChanged("currentSrc",null),this.setIfChanged("currentImageExample",null),this.setIfChanged("currentAdditionalImages",null);else{var e=this.loadednesses[this.currentRep._key];this.setIfChanged("currentSrc",this.currentRep.url||this.currentRep.urls&&this.currentRep.urls[0]||null),this.setIfChanged("currentImageExample",e&&e.isRequest?e.image:e),this.setIfChanged("currentAdditionalImages",e&&e.additionalImages||null)}this.resumeTriggers()}.observes("currentRep"),applyZIndex:YES,applyTop:YES,applyLeft:YES,applyWidth:YES,applyHeight:YES,_doApplyZIndex:function(){if(!this.applyZIndex)return;this.layer.style.zIndex=Math.round(this.zIndex)}.observes("zIndex"),_doApplyTop:function(){if(!this.applyTop)return;this.layer.style.top=Math.round(this.top)+"px"}.observes("top"),_doApplyLeft:function(
){if(!this.applyLeft)return;this.layer.style.left=Math.round(this.left)+"px"}.observes("left"),_doApplyWidth:function(){if(!this.applyWidth)return;this.layer.style.width=Math.round(this.width)+"px"}.observes("width"),_doApplyHeight:function(){if(!this.applyHeight)return;this.layer.style.height=Math.round(this.height)+"px"}.observes("height")})),CoreImage.define("EasyDomImageView",CoreImage.AbstractImageView.extend({shouldFade:YES&&!B.mobile&&!B.msie<=8,useGPU:NO,isImageOpaque:NO,imageAccessoryElement:null,MINIMUM_FADE_DELAY:100,_renderImageAccessoryElement:function(){if(!this.layer)return;var e=this.get("imageAccessoryElement");if(e){e.style.display="none";var t=this.layer;this.appendInto&&(t=this.owner[this.appendInto]),t.appendChild(e)}}.observes("imageAccessoryElement","render"),Anim:Anim.Fader.extend({elementBinding:".owner.image",accessoryBinding:".owner.imageAccessoryElement",hide:function(){if(this.to===0){this.element.style.display="none";var e=this.accessory;e&&(e.style.display="none")}this.to===1&&this.owner.setIfChanged("isImageOpaque",YES)}.observes("finish"),update:function(){arguments.callee.base.apply(this,arguments);var e=this.accessory;e&&Anim.setOpacity(e,this.current)},show:function(){if(this.to===1){this.element.style.display="";var e=this.accessory;e&&(e.style.display="")}this.to===0&&this.owner.setIfChanged("isImageOpaque",NO)}.observes("start")}),generateImage:function(){var e=this.image=new Image;e.style.position="relative",e.style.width="100%",e.style.height="100%",e.style.top=e.style.left="0px",e.style.zIndex=2,this.layer.appendChild(e)},hideImage:function(
){if(this._isImageShowing===(this._isImageShowing=NO))return;if(this.shouldFade&&!this.isInitting)return(this.anim||(this.anim=this.Anim.create({owner:this}))).redirectTo(0).redirectFrom(1).start();Anim.tellStop(this.anim),this.image.style.display="none",this.setIfChanged("isImageOpaque",NO)},showImage:function(){if(this._isImageShowing===(this._isImageShowing=YES))return;var e=this._firstShowImageDate?Infinity:this._firstShowImageDate=new Date*1;if(e>this._initDate+this.MINIMUM_FADE_DELAY&&this.shouldFade&&!this.isInitting)return(this.anim||(this.anim=this.Anim.create({owner:this}))).redirectTo(1).redirectFrom(0).start();Anim.tellStop(this.anim),this.image.style.display="";var t=this.get("imageAccessoryElement");t&&(t.style.display=""),this.setIfChanged("isImageOpaque",YES)},updateToCurrentSrc:function(){var e=this.currentSrc;if(!e)return this.image?this.hideImage():undefined;this.image||this.generateImage(),this.showImage(),this.image.src=this.currentSrc}.observes("currentSrc"),markFadeGuardDate:function(){this._initDate=new Date*1}.observes("reps")})),CoreImage.define("ConstructedImageView",CoreImage.AbstractImageView.extend({layoutWidth:1,layoutHeight:1,reps:null,useCanvasBackgrounds:B.safari||B.chrome||B.iOS||B.android,ignoreHeightInRepDecision:YES,spriteReps:null,constructRepsFromSpriteReps:function(){if(!this.spriteReps)return;var e={},t=this.spriteReps,n,r,i;for(var s in t){if(s==="_savedRepClones")continue;if(!t[s])continue;i=parseInt(s,10),r=t[s],r.pixelsPerLayoutUnit=i/r.layoutWidth,n=r.pixelsPerLayoutUnit*this.get("layoutWidth"),n+=r.extraPixelWidth||0,n+=r._hackKeyBump||0
,n=Math.floor(n);var o=t._savedRepClones||(t._savedRepClones={}),u=r.pixelsPerLayoutUnit+"_for_"+n,a=o[u]||(o[u]=Core.cloneHash(r,YES));e[n]=a}this.set("reps",e)}.observes("init","spriteReps")})),CoreImage.define("CanvasConstructedImageView",CoreImage.ConstructedImageView.extend({bitmapCacheKey:function(){return this.get("layoutWidth")+"by"+this.get("layoutHeight")}.property(),paint:function(e,t,n){var r=this.currentRep,i=this.currentImageExample;e.drawImage(i,0,0,r.left,r.top,0,0,r.left,r.top),e.drawImage(i,r.width-r.right,0,r.right,r.top,t-r.right,0,r.right,r.top),e.drawImage(i,0,r.height-r.bottom,r.left,r.bottom,0,n-r.bottom,r.left,r.bottom),e.drawImage(i,r.width-r.right,r.height-r.bottom,r.right,r.bottom,t-r.right,n-r.bottom,r.right,r.bottom),e.drawImage(i,r.left,0,r.width-r.left-r.right,r.top,r.left,0,t-r.left-r.right,r.top),e.drawImage(i,r.left,r.height-r.bottom,r.width-r.left-r.right,r.bottom,r.left,n-r.bottom,t-r.left-r.right,r.bottom),e.drawImage(i,0,r.top,r.left,r.height-r.top-r.bottom,0,r.top,r.left,n-r.top-r.bottom),e.drawImage(i,r.width-r.right,r.top,r.right,r.height-r.top-r.bottom,t-r.right,r.top,r.right,n-r.top-r.bottom),e.drawImage(i,r.left,r.top,r.width-r.left-r.right,r.height-r.top-r.bottom,r.left,r.top,t-r.left-r.right,n-r.top-r.bottom)},maintainElement:function(){if(!this.isAppendedInWindow||!this.currentRep)return;var e=this.useCanvasBackgrounds,t=this.get("bitmapCacheKey"),n=this.get("layoutWidth"),r=this.get("layoutHeight"),i=this.currentRep,s="spriteRep"+Core.guidFor(i)+"at"+t,o=i.knownBitmaps||(i.knownBitmaps={}),u=o[t],a,f,l,c,h,p=this.currentBitmap
;u||(f=Math.ceil(i.pixelsPerLayoutUnit*n+(i.extraPixelWidth||0)),l=Math.ceil(i.pixelsPerLayoutUnit*r+(i.extraPixelHeight||0)),e?u=o[t]={width:f,height:l,context:a=document.getCSSCanvasContext("2d",s,f,l),getContext:function(){return this.context}}:(u=o[t]=document.createElement("canvas"),u.width=f,u.height=l,u.context=a=u.getContext("2d")),this.paint(a,f,l)),e?(c=this.carrierElement,c||(c=this.carrierElement=document.createElement("div"),c.style.cssText="position:absolute; left:0px; top:0px; width:100%; height:100%; z-index:2; background-size:100% 100%; -webkit-background-size:100% 100%;",this.layer.appendChild(c)),c.setAttribute("bitmap_width",u.width),c.setAttribute("bitmap_height",u.height),c.style.background="-webkit-canvas("+s+")"):(c=(this._bitmaps||(this._bitmaps={}))[i._key],c||(c=this._bitmaps[i._key]=document.createElement("canvas"),c.width=u.width,c.height=u.height,c.context=h=c.getContext("2d"),h.drawImage(u,0,0),c.style.cssText="position:absolute; left:0px; top:0px; width:100%; height:100%; z-index:2;"),p!==c&&(p&&p.parentNode&&p.parentNode.removeChild(p),this.layer.appendChild(c),p=this.currentBitmap=c))}.observes("isAppendedInWindow","currentRep")})),CoreImage.define("ClassicDOMConstructedImageView",CoreImage.ConstructedImageView.extend({rendererViewClass:Core.View.extend({rep:null,classNames:"full-width full-height".w(),rootHTML:"<div><div></div><img><div></div><img><img><img><div></div><img><div></div></div>",tlElement:"layer.firstChild",tElement:"tl.nextSibling",trElement:"t.nextSibling",lElement:"tr.nextSibling",cElement:"l.nextSibling",rElement:"c.nextSibling"
,blElement:"r.nextSibling",bElement:"bl.nextSibling",brElement:"b.nextSibling",initialRender:function(){if(!this.rep)return;var e=this.rep,t=e.url,n=e.additionalUrls,r=e.top,i=e.bottom,s=e.right,o=e.left;if(!n)return;this.tl.style.cssText="background: url("+t+") top left; left:0px; top:0px; width:"+o+"px; height:"+r+"px;",this.t.src=n[0],this.t.style.cssText="left:"+o+"px; top:0px; height:"+r+"px;",this.tr.style.cssText="background: url("+t+") top right; right:0px; top:0px; width:"+s+"px; height:"+r+"px;",this.l.src=n[1],this.l.style.cssText="left:0px; top:"+r+"px; width:"+o+"px;",this.c.src=n[2],this.c.style.cssText="left:"+o+"px; top:"+r+"px;",this.r.src=n[3],this.r.style.cssText="right:0px; top:"+r+"px; width:"+s+"px;",this.bl.style.cssText="background: url("+t+") bottom left; bottom:0px; left:0px; width:"+o+"px; height:"+i+"px;",this.b.src=n[4],this.b.style.cssText="bottom:0px; left:"+o+"px; height:"+i+"px;",this.br.style.cssText="background: url("+t+") bottom right; bottom:0px; right:0px; width:"+s+"px; height:"+i+"px;";for(var u=0;u<this.initialElements.length;u++)this[this.initialElements[u]].style.position="absolute"}.observes("render"),update:function(){if(!this.isAppendedInWindow||!this.rep)return;var e=this.owner,t=this.rep,n,r,i,s;if(isNaN(t.left)||isNaN(t.right)||isNaN(t.top)||isNaN(t.bottom))return;this.t.style.width=this.b.style.width=this.c.style.width=Math.max(0,e.width-t.left-t.right)+"px",this.l.style.height=this.r.style.height=this.c.style.height=Math.max(0,e.height-t.top-t.bottom)+"px",this.tl.style.width=this.bl.style.width=Math.max(0,n=Math.min(t.left,
Math.ceil(e.width/2)))+"px",this.tr.style.width=this.br.style.width=Math.max(0,i=Math.min(t.right,e.width-n))+"px",this.tl.style.height=this.tr.style.height=Math.max(0,s=Math.min(t.top,Math.ceil(e.height/2)))+"px",this.bl.style.height=this.br.style.height=Math.max(0,r=Math.min(t.bottom,e.height-s))+"px",this.t.style.left=this.b.style.left=this.c.style.left=n+"px",this.t.style.display=this.b.style.display=n+i===e.width?"none":"block",this.l.style.top=this.r.style.top=this.c.style.top=s+"px",this.l.style.display=this.r.style.display=s+r===e.height?"none":"block",this.c.style.display=s+r===e.height&&n+i===e.width?"none":"block"}.observes("isAppendedInWindow",".owner.sizeDidChange")}),maintainChild:function(){if(!this.isAppendedInWindow||!this.currentRep)return;var e=this.currentRep,t=this._repChildren||(this._repChildren={}),n=t[Core.guidFor(e)]||(t[e.coreGuid]=this.rendererViewClass.create({owner:this,rep:e})),r=this._currentChild;n!==r&&r&&r.remove(),n&&n.append(),this._currentChild=n}.observes("isAppendedInWindow","currentRep")})),require("views/image"),CoreImage.GridItemMixin={isMixin:YES,cellSizeBinding:"from:.owner.cellSize",displayWidthBinding:"from:cellSize",cellSize:undefined,top:undefined,left:undefined,width:undefined,height:undefined,performLayout:function(){if(!this.cellSize||!this.layer)return;var e=this.cellSize,t=this.layer.style,n=this.layout||(this.layout={});t.top=(n.top=Math.round(this.top*e))+"px",t.left=(n.left=Math.round(this.left*e))+"px",t.width=(n.width=Math.round(this.width*e))+"px",t.height=(n.height=Math.round(this.height*e))+"px",isNaN(this.zIndex)||
(t.zIndex=this.zIndex),this.trigger("layout")}.observes("cellSize","render")},CoreImage.define("PhotoGridItemMixin",{isMixin:YES,cropMetricsEl:"imageContainer",imageMetricsEl:"imageView.layer",imageView:CoreImage.EasyDomImageView.extend({appendInto:"imageContainer",downerGroupBinding:"from:.owner.downerGroup",currentSrcBinding:"to:.owner.currentSrc",isImageOpaqueBinding:"to:.owner.isImageOpaque"}),cropLeft:.5,cropTop:.5,zoom:1,fallBackOnMissingImage:function(){if(!this.isAppendedInWindow)return;if(this.imageView&&this.imageView.currentSrc)return;this.set("isShowingMissingImage",YES)}.observes("isAppendedInWindow"),removeMissingImage:function(){if(!this.isImageOpaque)return;this.set("isShowingMissingImage",NO)}.observes("isImageOpaque"),doImageLayout:function(){if(this.imageView.isClass||!this.value)return;var e=this.value;if(!e.width||!e.height)e.width=e.height=1;var t=this.cellSize,n=this.getInset(),r=this.get("cropLeft"),i=this.get("cropTop"),s=this.zoom,o=t*this.width-2*n,u=t*this.height-2*n,a=o/u,f=e.width,l=e.height,c=f/l,h=c>a,p=s*(h?u*c:o),d=s*(h?u:o/c),v=o-p,m=u-d,g=r*v,y=i*m;this.imageView.setLayout(g,y,p,d)}.observes("cellSize","render","value"),saveZoomImageInfoToPageView:function(){if(!this.currentSrc){this.pageView&&this.pageView.set("zoomImageInfo",null);return}var e=this.getPath(this.cropMetricsEl),t=this.getPath(this.imageMetricsEl),n=Core.positionOfElement(e),r=Core.positionOfElement(t);this.pageView&&this.pageView.set("zoomImageInfo",{src:this.currentSrc,cropL:n.left,cropT:n.top-Core.lastScrollTop,cropW:e.offsetWidth,cropH:e.offsetHeight,imageL:r.left,imageT
:r.top-Core.lastScrollTop,imageW:t.offsetWidth,imageH:t.offsetHeight})}.observes("action")}),function(){CoreImage.define("MissingImageSupport",{isMixin:YES,isShowingMissingImage:NO,ICON_ASPECT:512/464,missingImageIconScale:.75,maximumImageIconSize:512,missingImageParent:"",missingImageLayout:null,_missing_image_iconReps:null,_missing_image_backgroundSrc:"",fadeInMissingImage:NO,computeMissingImageLayout:function(){Core.cloneHash(this.layout,this.missingImageLayout||(this.missingImageLayout={})),this.missingImageLayout.top=this.missingImageLayout.left=0,this.trigger("missingImageLayout")}.observes("layout"),_missing_image_showHide:function(){var t,n,r,i,s,o=this;if(this.isShowingMissingImage){if(!(t=this.missingImageLayout)||!t.width||!t.height)return;(n=this._missingImage)||((n=this._missingImage=document.createElement("div")).className="missing-image-container",r=this._missingImageBg=new Image,e?(r.src=this._missing_image_backgroundSrc,this._handleBgImageLoaded()):(r.style.display="none",r.onload=function(){o._handleBgImageLoaded()},r.src=this._missing_image_backgroundSrc,B.msie===8&&setTimeout(r.onload,500)),n.appendChild(r),this._missingImageIconView=i=CoreImage.EasyDomImageView.create({reps:this._missing_image_iconReps,owner:this,downerGroup:CoreImage.imageLoader.essentialGroup,shouldFade:NO,doneBinding:"to:.owner._iconImageDoneLoading"}),i.appendTo(n)),this._missing_image_doLayout(),this._showMissingImageElement()}else(n=this._missingImage)&&(s=n.parentNode)&&(this._missingImageVisible=!1,s.removeChild(n))}.observes("render","isShowingMissingImage","missingImageLayout")
,_showMissingImageElement:function(){if(this._missingImageVisible||!this.hasDownloadedBg||!this._iconImageDoneLoading)return;this._missingImageVisible=!0,(this[this.missingImageParent]||this.layer).appendChild(this._missingImage);if(!this.fadeInMissingImage||B.mobile||B.msie<=8)return;Anim.Fader.go({from:0,to:1,element:this._missingImage})}.observes("hasDownloadedBg","_iconImageDoneLoading"),_missing_image_doLayout:function(){var e=this.missingImageLayout,t=this._missingImage,n=this._missingImageIconView,r,i;if(!n||!e||!(r=e.width)||!(i=e.height))return;var s=YES;s=this._mis_w_!==(this._mis_w_=r)&&s,s=this._mis_h_!==(this._mis_h_=i)&&s;if(!s)return;t.style.left=e.left+"px",t.style.top=e.top+"px",t.style.width=e.width+"px",t.style.height=e.height+"px";var o=this.missingImageIconScale,u=this.maximumImageIconSize,a=this.ICON_ASPECT,f=r/i,l=a>f,c=o*(l?r:i*a),h=o*(l?r/a:i);c>u&&(c=u,h=c/a),h>u&&(h=u,c=h*a),n.setLayout((r-c)/2,(i-h)/2,c,h)}.observes("missingImageLayout"),_handleBgImageLoaded:function(){this._missingImageBg.style.display="",e=YES,this.setIfChanged("hasDownloadedBg",YES)}});var e=NO}(),require("views/image"),CoreImage.define("SlideshowItemMixin",{isMixin:YES,allowsHudToHide:YES,resetState:function(){},sizeHashConvenience:function(){this.size={}}.observes("init"),setAvailableSize:function(){var e=this.availableSize||(this.availableSize={}),t=this.owner.availableRect;if(!t)return;e.width=t.width,e.height=t.height;var n=this._lastsw_!==(this._lastsw_=e.width);n=n||this._lastsh_!==(this._lastsh_=e.height);if(!n)return;this.trigger("availableSize")}.observes(".owner.availableRect"
,"render"),doLayoutFromSize:function(){if(!this.size)return;var e=this.owner.availableRect,t=Math.round(this.size.width),n=Math.round(this.size.height),r=this.layer.style,i=this.layout||(this.layout={});if(!t||!n)return;r.width=(i.width=t)+"px",r.height=(i.height=n)+"px",r.left=(i.left=Math.round((e.width-t)/2+e.left))+"px",r.top=(i.top=Math.round((e.height-n)/2+e.top)+(this.size.offsetTop||0))+"px",this.trigger("layout")}.observes("size")}),CoreImage.SlideshowPhotoMixin={isMixin:YES,shouldAttemptToFillScreen:NO,shouldAvoidUpscaling:YES,canAllowZoom:!!B.mobile,allowZoom:NO,enableOwnerSwipability:YES,maxTextureSize:{width:Core.maxGPUTextureSize,height:Core.maxGPUTextureSize},imageView:CoreImage.EasyDomImageView.extend({shouldFade:NO,currentSrcBinding:"to:.owner.currentSrc",downerGroupBinding:"from:.owner.downerGroup",isImageOpaqueBinding:"to:.owner.isImageOpaque",biggestSizeBinding:"to:.owner.biggestSize",discoverBiggestSize:function(){for(var e=0,t=0;e<this.sizes.length;e++)t<this.sizes[e]&&(t=this.sizes[e]);this.setIfChanged("biggestSize",t)}.observes("sizes")}),enableZoomOnLoad:function(){if(!this.canAllowZoom)return;!this.currentSrc||this.setIfChanged("allowZoom",YES)}.observes("currentSrc"),fallBackOnMissingImage:function(){if(!this.isAppendedInWindow)return;if(this.currentSrc)return;this.set("isShowingMissingImage",YES)}.observes("isAppendedInWindow"),removeMissingImage:function(){if(!this.isImageOpaque)return;this.set("isShowingMissingImage",NO)}.observes("isImageOpaque"),shouldAutomaticallySize:function(){return YES},getSizeForFrame:function(e){return null},shouldAllowZoom
:function(){return this.canAllowZoom},doLayout:function(){if(!this.value||!this.layer)return;var e=this.delegate,t=this.value;if(!t.width||!t.height)t.width=t.height=1;var n=this.availableSize,r=this.size||(this.size={}),i=this.zoomContentSize||(this.zoomContentSize={}),s=t.width,o=t.height,u=s/o,a=n.width,f=n.height,l=a/f,c=this.shouldAttemptToFillScreen&&Math.max(u/l,l/u)<1.15,h=c?u<l:u>l,p=Math.round(h?a:f*u),d=Math.round(h?a/u:f),v=this.biggestSize/Math.max(p,d);this.shouldAvoidUpscaling&&v<1&&(p*=v,d*=v);if(!this.shouldAutomaticallySize()){var m=this.getSizeForFrame(n);r.width=p=m.width,r.height=d=m.height}r.width=a,r.height=f,i.width=p,i.height=d,this.zoomContainerSize=this.size,this.zoomState||this.resetState(YES),this.trigger("size"),this.trigger("imageLayout")}.observes("availableSize","value"),resetState:function(e){Anim.tellStop(this._pinchZoomAnimation);var t=this.size,n=this.zoomContentSize;if(!t||!n)return;this.resetZoom(YES),this._hasRenderedZoomSinceReset=NO,e||this.trigger("imageLayout")},getBigZoomInfo:function(){var e=this.layout,t=this.imageView;return!e||!t?null:this._bigZoomInfo||(this._bigZoomInfo={src:this.currentSrc,left:t.left+e.left,top:t.top+e.top,width:t.width,height:t.height})},computeMissingImageLayout:function(){var e=this.missingImageLayout||(this.missingImageLayout={}),t=this.size,n=this.zoomContentSize;if(!t||!n)return;e.left=t.width/2-n.width/2,e.top=t.height/2-n.height/2,e.width=n.width,e.height=n.height,this.trigger("missingImageLayout")}.observes("imageLayout"),_updateBigZoomInfoSrc:function(){this._bigZoomInfo&&(this._bigZoomInfo.src=this
.currentSrc)}.observes("currentSrc"),clearBigZoomInfo:function(){this._bigZoomInfo=null}.observes("layout"),doImageLayout:function(){if(!this.value||!this.imageView||!this.zoomContentSize||!this.zoomState)return;var e=this.value,t=this.size,n=this.zoomContentSize,r=this.maxTextureSize,i=this.zoomState;allowZoom=this.shouldAllowZoom();if(!allowZoom||i.zoom===1&&i.y===0&&i.x===0&&!this._hasRenderedZoomSinceReset)return this.imageView.layer.style.webkitTransform="",this.imageView.setLayout(t.width/2-n.width/2,t.height/2-n.height/2,n.width,n.height);this._hasRenderedZoomSinceReset=YES;var s=Core.innerSizeInOuter(e,r);this.imageView.setLayout(t.width/2-s.width/2,t.height/2-s.height/2,s.width,s.height);var o=n.width*i.zoom,u=n.height*i.zoom,a=Math.max(o,u)/r.width;this.imageView.layer.style.webkitTransform="translate3d("+i.x+"px,"+i.y+"px,0) scale("+a+")"}.observes("imageLayout","zoomState"),touchStart:function(){if(!this.isImageOpaque)return;return arguments.callee.base.apply(this,arguments)}},CoreImage.define("ThemeSupport",{isMixin:YES,themeOverride:function(e,t,n){return e?e.isTheme?e:CoreImage.Theme.create(e):e},_themeSupport_updateToDisplayWidth:function(){if(!this.layer||!this.theme||!this.displayWidth)return;this.theme.applyToView(this)}.observes("displayWidth","render","theme"),_themeSupport_getThemeFromOwner:function(){var e;if(!(e=this.owner)||!(e=e.theme)||!(e=e[this.className+".theme"]))return;this.setIfChanged("theme",e)}.observes(".owner.theme","init")}),CoreImage.ImageRequestDelegate={imageRequestValid:function(e){return!0}},CoreImage.define("ImageRequest",Core.Object
.extend({imageLoader:null,done:!1,loaded:!1,erred:!1,group:null,importance:0,importanceAdjust:0,isRequest:!0,served:!1,onload:null,onerror:null,onloading:null,onabort:null,loadee:null,shouldIgnoreForLoading:NO,pending:NO,loading:NO,aborted:NO,delegateValue:null,customLoadeeMixin:{},getAdditionalCustomLoadeeProperties:function(){return null},init:function(){this.saveTo&&(this.saveTo[this.saveKey]=this),arguments.callee.base.apply(this,arguments),this._isInitting=!0,this.group||(this.group=this.imageLoader.group),this.passive&&(this.group=this.imageLoader.passiveGroup),(this.urls&&this.urls.length||this.url)&&this.joinLoadee(),(!this.loadee||!this.loadee.started)&&this.enter(this.group),this.loadee&&!this.loadee.started&&this.imageLoader.startThreads(),this._isInitting=!1},ensureCorrectLoadeeMembership:function(){!this.url&&!this.urls?this.leaveLoadee():this.joinLoadee()}.observes("urls","url"),joinLoadee:function(){if(this.loadee||!this.group)return;var e=this.url||this.urls;if(!e)return;e=e.toString();var t=this.imageLoader.loadees[e],n=this;t||(t=CoreImage.Loadee.create(this.customLoadeeMixin,this.getAdditionalCustomLoadeeProperties(),{urls:this.urls,url:this.url,debug:this.debug,globalKey:e}),this.imageLoader.loadees[e]=t),t.listen("willUnload",this._willUnloadHandler||(this._willUnloadHandler=function(){n.trigger("loadeeWillUnload")})),t.listen("didUnload",this._didUnloadHandler||(this._didUnloadHandler=function(){n.trigger("loadeeDidUnload")})),this.requestNumber=t.requests.length+1,this.setIfChanged("loadee",t),t.accommodate(this),!this._isInitting&&!this.loadee.started&&
this.imageLoader.startThreads()},leaveLoadee:function(){if(!this.loadee)return;var e=this.loadee;e.unaccommodate(this),e.unlisten("willUnload",this._willUnloadHandler),e.unlisten("didUnload",this._didUnloadHandler),this.loadee=null},didSatisfyAnyAdditionalUrls:function(){this.set("loaded",!0),this.trigger("success"),this.set("done",!0)},didStartLoading:function(){this.set("loading",!0),this.onloading instanceof Function&&this.onloading()},didLoad:function(e){this.set("loading",!1),this.leaveGroup();if(this.done)return;this.setIfChanged("url",e),this.image=this.loadee.image;var t=this.additionalUrls,n,r;if(!t)this.didSatisfyAnyAdditionalUrls();else{this.additionalImages=this.image.additionalImages=[],this.image.additionalUrls=this.additionalUrls,this.additionalImageLoadedCount=0,n=function(){this.owner.additionalImageLoadedCount++,this.owner.additionalImageLoadedCount===this.owner.additionalUrls.length&&this.owner.didSatisfyAnyAdditionalUrls()},r=function(){this.owner.didErr()};for(var i=0,s,o;o=t[i];i++)this.additionalImages.push(s=new Image),s.onload=n,s.onerror=r,s.owner=this,s.src=o}},didErr:function(){this.set("loading",!1),this.leaveGroup();if(this.done||this.erred)return;this.setIfChanged("erred",!0),this.loadee&&(this.image=this.loadee.image),this.trigger("error"),this.setIfChanged("done",!0)},_runOnLoadAPIGlue:function(){this.onload instanceof Function&&this.onload()}.observes("success"),_runOnErrorAPIGlue:function(){this.onerror instanceof Function&&this.onerror()}.observes("error"),needsAttention:function(){return!!this.loadee&&!this.done},enter:function(e){if(!e)return;
if(this.served)return;return this.group=e,e.accept(this),this},calmDown:function(){return this.setIfChanged("served",!0),this.leaveGroup(),this},leaveGroup:function(){return this.group&&this.group.reject(this),this.group=null,this},abort:function(){if(this.done)return;this.set("done",!0),this.set("aborted",!0),this.leaveGroup(),this.loadee&&this.loadee.unaccommodate(this),this.saveTo&&delete this.saveTo[this.saveKey],this.onabort instanceof Function&&this.onabort()},toString:function(e){e=e||this.parent&&this.parent._string_indent||this.group&&this.group._string_indent||0;var t="";for(var n=0;n<e;n++)t+=" ";return this._string_indent=e+2,t+"[ImageRequest:"+this.coreGuid+"; importance="+this.importance+"; served="+this.served+"; done="+this.done+"]"},unload:function(){this.loadee&&this.loadee.unload&&this.loadee.unload()},valid:function(){var e=this.delegateValue;return e?e.imageRequestValid(this):!0},_shouldIgnoreForLoadingDidChange:function(){if(this.done)return;var e=this.get("shouldIgnoreForLoading");e||this.imageLoader.startThreads()}.observes("shouldIgnoreForLoading")})),CoreImage.define("Loadee",Core.Object.extend({imageLoader:null,done:!1,loaded:!1,erred:!1,loading:!1,started:!1,url:null,requests:null,image:null,thread:null,init:function(){arguments.callee.base.call(this),this.requests=[]},unload:function(){this._isUnloading=!0,this.trigger("willUnload");var e=this.requests.concat([]),t,n;for(t=0;n=e[t];t++)n.abort(),n.leaveGroup();this.image&&(this.image.src=Core.emptyImageSrc,this.image.onload=this.image.onerror=null),this.image=null;var r=this.imageLoader.loadees;if(
r){r[this.url]=null;try{delete r[this.url]}catch(i){}if(this.globalKey){r[this.globalKey]=null;try{delete r[this.globalKey]}catch(i){}}}this.stopLoading(),this.trigger("didUnload"),this._isUnloaded=!0,this._isUnloading=!1},didLoad:function(){this.image&&(this.image.onload=null,this.image.onerror=null);if(this.done)return;var e=(new Date).getTime(),t=e-this._loadStartTime,n=CoreImage.Loadee.tracer,r=this.image;n&&n.imageLoadeeLoadedImageForURL&&n.imageLoadeeLoadedImageForURL(this,r,r.src,t),this.thread&&this.thread.loadeeDidFinish(),this.thread=null,this._downloadTime=new Date*1-this._lastUrlSetTime||NaN,this.set("loaded",!0),this.set("loading",!1),this.imageLoader.loadees[this.url]=this;for(var i=0;i<this.requests.length;i++)this.requests[i].didLoad(this.url);this.set("done",!0)},didErr:function(){if(this.done)return;this.thread&&this.thread.loadeeDidFinish(),this.thread=null,this.set("erred",!0),this.set("loading",!1);for(var e=0;e<this.requests.length;e++)this.requests[e].didErr();this.set("done",!0)},didHalfLoad:function(){delete this.image.onload,delete this.image.onerror;var e=this;this.image=new Image,this.image.onload=function(){e.didLoad()},this.image.onerror=function(){e.didErr()},this.image.src=this.url,this._lastUrlSetTime=new Date*1},didHalfErr:function(){if(!this.urls)return this.didErr();this.url=this.urls[++this._currentlyAttemptingUrlIndex];if(!this.url)return this.didErr();this._loadStartTime=(new Date).getTime(),this.image.src=this.url,this._lastUrlSetTime=new Date*1},load:function(e,t){if(this.done||this.loading&&!t)return;var n=this,r=this.imageLoader.simulatedLatency
;if(!r||r&&!t)this.calmRequests(),this.thread=e,this.setIfChanged("loading",!0),this.setIfChanged("started",!0),this._currentlyAttemptingUrlIndex=-1,!this.url&&this.urls&&(this._currentlyAttemptingUrlIndex=0,this.url=this.urls[0]);if(r&&!t){clearTimeout(this._latencyTimeout),this._latencyTimeout=setTimeout(function(){n.load(e,!0)},r);return}for(var i=0;i<this.requests.length;i++)this.requests[i].didStartLoading();this._kickOffLoadingProcess()},_kickOffLoadingProcess:function(){var e=this;this._loadStartTime=(new Date).getTime();if(!this.url)return this.didErr();this.image=new Image,this.image.onload=B.s.safari<5?function(){e.didHalfLoad()}:function(){e.didLoad()},this.image.onerror=function(){e.didHalfErr()},this.image.src=this.url,this._lastUrlSetTime=new Date*1},calmRequests:function(){if(this.done||this.loading)return;if(!this.requests||!this.requests.length)return;for(var e=0;e<this.requests.length;e++)this.requests[e].calmDown();return this},accommodate:function(e){if(!e)return;return this.loaded?e.didLoad(this.url):this.erred&&e.didErr(),this.requests.push(e),this},unaccommodate:function(e){if(!e)return;if(this.done)return;this.requests.remove(e),this.requests.length||this.stopLoading()},stopLoading:function(){if(!this.loading)return;clearTimeout(this._latencyTimeout),this.thread&&this.thread.loadeeDidFinish(),this.setIfChanged("started",!1),this.setIfChanged("loading",!1);if(!this.image)return;this.image.onload=this.image.onerror=null,this.image.src=Core.emptyImageSrc,this.image=null},updateToUrls:function(e){this.urls!==e&&(this.url=null),this.setIfChanged("urls",e)}
,updateToUrl:function(e){this.url!==e&&(this.urls=null),this.setIfChanged("url",e)},updateToUrlOrUrls:function(){this.globalKey=this.url||this.urls||"",this.globalKey&&(this.imageLoader.loadees[this.globalKey]=this);for(var e,t=0;e=this.requests[t];t++)e.url=this.url,e.urls=this.urls}.observes("url","urls"),tearDown:function(){delete this.tearDown,delete this.image;for(var e=0;e<this.requests.length;e++)this.requests[e]&&this.requests[e].tearDown&&this.requests[e].tearDown(),delete this.requests[e];delete this.requests,delete this.group,delete this.thread}})),CoreImage.Loadee.tracer=null,CoreImage.define("ImageGroup",Core.Object.extend({isGroup:YES,parent:null,importance:0,importanceAdjust:0,pending:null,target:Math.pow(2,32)-1,needsAttention:function(){for(var e=0;e<this.pending.length;e++)if(this.pending[e].needsAttention())return!0;return!1},accept:function(e){if(e==this)return;return e.isRequest&&e.set("pending",!0),this.pending.push(e),this},reject:function(e){return e.set("pending",!1),this.pending.remove(e),this},enter:function(e){if(!e)return;return e.accept(this),this.parent=e,this},getNext:function(e){if(!this.pending.length)return null;var t=Infinity,n=null,r=-1,i=!1;for(var s=0,o;(o=this.pending[s])&&!i;s++){if(e&&e(o)||o.get("shouldIgnoreForLoading"))continue;o.importance||(o.importance=0);var u=Math.abs(o.importance-this.target)-o.importanceAdjust;o.needsAttention()&&(o.isEssential&&(n=o,i=!0),u<t&&(n=o,t=u,r=s))}return n?n&&n.isRequest?n.valid()?n:(n.abort(),this.getNext(e)):n?n.getNext(e):null:null},manyNextAnswerArray:[],getManyNext:function(e,t,n){var r=this
.manyNextAnswerArray,i=this._tempUseArray;n||(r.length=0),i.length=0;if(!this.pending.length)return r;var s=r.length,o,u,a;this.pending.sort(this._importanceVsTargetSorter);for(o=0;(u=this.pending[o])&&s<e;o++){if(u.isGroup)continue;if(t&&t(u))continue;i.push(u),s++}for(o=0;u=i[o];o++)r.push(u);if(s<e)for(o=0;(a=this.pending[o])&&r.length<=e;o++)a.isGroup&&a.getManyNext(e,t,!0);return r},init:function(){arguments.callee.base.call(this),this.pending=[],this._tempUseArray=[];var e=this;this._importanceVsTargetSorter=function(t,n){return t.isEssential?-1:n.isEssential?1:Math.abs(t.importance-e.target)-t.importanceAdjust-(Math.abs(n.importance-e.target)-n.importanceAdjust)}},becomeMostImportant:function(){if(!this.parent)return;for(var e=0,t=-Infinity,n,r=this.parent.pending;n=r[e];e++)n.isEssential||(t=Math.max(t,n.importance));this.importance=t+1},tearDown:function(){delete this.tearDown;for(var e=0;e<this.pending.length;e++)this.pending[e]&&this.pending[e].tearDown&&this.pending[e].tearDown(),delete this.pending[e]},toString:function(e){e=e||this.parent&&this.parent._string_indent||this.group&&this.group._string_indent||0;var t="";for(var n=0;n<e;n++)t+=" ";return this._string_indent=e+2,t+"[ImageGroup:"+this.coreGuid+"; "+(this.isEssential?"essential":"importance="+this.importance)+"; pending=[\n"+this.pending.join(t+"\n")+"\n"+t+"]]"}})),CoreImage.define("ImageLoader",Core.Object.extend({numThreads:4,delay:0,threads:null,group:null,loadees:null,init:function(){arguments.callee.base.call(this),this.group=CoreImage.ImageGroup.create({parent:this}),this.essentialGroup=CoreImage
.ImageGroup.create({isEssential:!0}).enter(this.group),this.passiveGroup=CoreImage.ImageGroup.create({parent:this}),this.threads=[];for(var e=0;e<this.numThreads;e++)this.threads[e]=CoreImage.ImageThread.create({loader:this});this.loadees={}},getNext:function(){return this.group.getNext.apply(this.group,arguments)},getManyNext:function(){return this.group.getManyNext.apply(this.group,arguments)},startThreads:function(){var e=this;this._startTimeout||(this._startTimeout=setTimeout(this._starter||(this._starter=function(){e._startThreads(),e._startTimeout=undefined}),0))},_startThreads:function(){for(var e=0;e<this.threads.length;e++)this.threads[e].startIfNecessary();return this},stopThreads:function(){for(var e=0,t;t=this.threads[e];e+=1)t.stop()},requestsForSRC:function(e){var t=this.loadees[e];return t?t.requests:[]},isSRCLoaded:function(e){return!!this.imageForSRC(e)},imageForSRC:function(e){var t=this.loadees[e];return t?t.loaded?t.image:!1:!1},loadeeForSRC:function(e){var t=this.loadees[e];return t?t:!1},loadedLoadeeForSRC:function(e){var t=this.loadees[e];return t?t.loaded?t:!1:!1},isSRCRequested:function(e){var t=this.loadees[e];if(!t)return!1;if(t.started)return!0;for(var n=0;n<t.requests;n++)if(t.requests[n].group)return!0;return!1},isSRCErred:function(e){var t=this.loadees[e];return t?t.erred:!1},tearDown:function(){delete this.tearDown;var e,t;for(e=0;e<this.threads.length;e++)this.threads[e]&&this.threads[e].tearDown&&this.threads[e].tearDown();for(e in this.loadees)t=this.loadees[e],t&&t.tearDown&&t.tearDown();this.group&&this.group.tearDown&&this.group.tearDown
(),this.passiveGroup&&this.passiveGroup.tearDown&&this.passiveGroup.tearDown(),delete this.group,delete this.passiveGroup},toString:function(){return this._string_indent=2,"[ImageLoader:"+this.coreGuid+";\nthreads=[\n"+this.threads.join("\n")+"\n]\ngroup=\n"+this.group+"\n]"}})),CoreImage.define("ImageThread",Core.Object.extend({loader:null,loading:!1,delayed:!1,idle:!0,loadee:null,ignoreTester:null,executing:!1,startIfNecessary:function(){return this.set("executing",!0),this.idle&&this.startNextLoad(),this},stop:function(){this.set("executing",!1),this.set("idle",!0),this._delayTimeoutHandle&&clearTimeout(this._delayTimeoutHandle)},startNextLoad:function(){if(this.loading)return;var e=this.loader.getNext(this.ignoreTester);if(!e){this.set("idle",!0),this.set("loading",!1),this.loadee=null;return}if(!e.loadee)return;return this.set("delayed",!1),this.set("loading",!0),this.set("idle",!1),this.loadee=e.loadee,this.loadee.load(this),this},loadeeDidFinish:function(){var e=this;this.loadee=null,this.set("loading",!1);if(!this.executing)return;!this.loader.delay&&B.msie!==8?this.startNextLoad():(this.set("delayed",!0),this._delayTimeoutHandle=setTimeout(function(){e.startNextLoad()},this.loader.delay||5))},toString:function(){return"[ImageThread:"+this.coreGuid+"; loadee="+this.loadee+"]"}})),CoreImage.imageLoader=Anim.extraStatus["CoreImage.imageLoader"]=CoreImage.ImageLoader.create({numThreads:6,simulatedLatency:0,delay:0}),CoreImage.ImageRequest.reopen({imageLoader:CoreImage.imageLoader}),CoreImage.Loadee.reopen({imageLoader:CoreImage.imageLoader}),CoreImage.FileDownloader=Core
.Object.extend({queue:[],QUEUE_DRAIN_INTERVAL:500,shouldPostponeRecentDownloads:B.msie===8,downloadMultiple:function(e){for(var t=0,n;n=e&&e[t];t++)this.downloadFile(n)},downloadFile:function(e,t){if(!e)return;this.ensureFrameExistence(),this.queue.push(e),this._timeout?this.ensureScheduled():this.dequeueAndDownload(),!t&&this.shouldPostponeRecentDownloads&&this.postponeDownloadForNextLoad(e)},ensureScheduled:function(){if(this._timeout)return;var e=this;this._timeout=setTimeout(function(){e._timeout=undefined,e.dequeueAndDownload()},this.QUEUE_DRAIN_INTERVAL)},dequeueAndDownload:function(){var e=this.queue[0];this.queue.remove(e),Core.debug("Downloading a file."),this.frame.src=e,this.queue.length&&this.ensureScheduled()},ensureFrameExistence:function(){if(this.frame)return;var e=this.frame=document.createElement("iframe");e.style.cssText="position:absolute; left:-1000px; top:-1000px; width:0px; height:0px; z-index:-1000;",document.body.appendChild(e)},postponeDownloadForNextLoad:function(e){if(!window.sessionStorage)return;try{window.sessionStorage.setItem("_iPhotoJournalPostponedDownload",new Date*1+":"+e)}catch(t){Core.debug("Failed to use session storage to postpone download. Download will not be triggered upon reload.")}},triggerPostponedDownloadIfNeeded:function(){if(!this.shouldPostponeRecentDownloads)return;if(!window.sessionStorage)return;try{var e=window.sessionStorage.getItem("_iPhotoJournalPostponedDownload")+"",t=parseInt(e.substring(0,e.indexOf(":")),10),n=e.substring(e.indexOf(":")+1),r=this;t+1e4>=(window.pageLoadTime||new Date*1)&&this.setIfChanged("autoDownloadURL"
,n);try{window.sessionStorage.removeItem("_iPhotoJournalPostponedDownload")}catch(i){}}catch(s){Core.debug("Failed to use session storage to auto-trigger postponed download.")}}.observes("init"),handleAutoDownloadURL:function(){if(!document.body||!this.autoDownloadURL)return;var e=this,t=e.autoDownloadURL;setTimeout(function(){e.downloadFile(t,YES)},150),this.set("autoDownloadURL",undefined)}.observes("Core.windowDidLoad")}),CoreImage.mixin({isFullScreen:NO,fullScreenSupported:function(){var e=document.documentElement;return(!!e.webkitRequestFullScreen||!!e.mozRequestFullScreen)&&!(B.s.safari<5.17)}.property(),requestFullScreen:function(){if(this.isFullScreen)return;var e=document.documentElement,t=e.webkitRequestFullScreen||e.mozRequestFullScreen;if(!t)return;this.trigger("requestingFullScreenMode"),t.call(e),this.setIfChanged("isFullScreen",YES),this.trigger("requestedFullScreenMode")},cancelFullScreen:function(){if(!this.isFullScreen)return;var e=document,t=e.webkitCancelFullScreen||e.mozCancelFullScreen;if(!t)return;this.trigger("cancellingFullScreenMode"),t.call(e),this.setIfChanged("isFullScreen",NO),this.trigger("cancelledFullScreenMode")},setupFullscreenEventHandling:function(){if(!this.fullScreenSupported())return;var e=document.documentElement,t=this;e.webkitRequestFullScreen?Core.addEvent(e,"webkitfullscreenchange",function(){t.setIfChanged("isFullScreen",document.webkitIsFullScreen)}):e.mozRequestFullScreen&&Core.addEvent(document,"mozfullscreenchange",function(){t.setIfChanged("isFullScreen",document.mozFullScreen)})}.observes("Core.windowDidLoad"),isFullScreenDidChange
:function(){this.trigger(this.isFullScreen?"enteredFullScreenMode":"exitedFullScreenMode")}.observes("isFullScreen")}),CoreImage.Theme=Core.Object.extend({isTheme:YES,"*.themeOverride":function(e,t,n){for(var r in e)e[r]=this.parseIfNeeded(e[r]);return t&&t.prototype&&t.prototype.isTheme?t.extend(e):(e=CoreImage.Theme.extend(e),(this.ensureOwn("_themeList")||(this._themeList=[])).push(n),e)},"*.stylesOverride":function(e,t,n){if(!e)return e;(this.ensureOwn("_stylesList")||(this._stylesList=[])).push(n);var r=[],i=[];for(var s in e)r.push(s),i.push(e[s]=this.parseIfNeeded(e[s]));return e._keys=r,e._values=i,e},applyToView:function(e){if(!e)return;for(var t=0,n,r,i=this._stylesList,s;i&&(n=i[t])&&(r=this[n]);t++)if((s=e[n.slice(0,-7)])&&s instanceof Element)for(var o=0,u=r._keys,a=r._values,f,l;f=u[o];o++)s.style[f]!==(l=this.evaluate(a[o],e))&&(s.style[f]=l+"px")},buildChildThemes:function(){for(var e=0,t,n=this._themeList;t=n&&n[e];e++)this[t]=this[t].create();delete this._themeList}.observes("init"),valueFor:function(e,t){var n=e.indexOf(".");return n!==-1?this.evaluate(this[e.substring(0,n)+".styles"][e.substring(n+1)],t):this.evaluate(this[e],t)},evaluate:function(e,t,n){var r,i,s,o,u,a,f;if(!e)return e;t instanceof Object&&(n=t,t=t.displayWidth);if(e instanceof Function)return Math.round(e.apply(n||this));t||(t=this.displayWidth);if(!e.input)return e>-1&&e<1?Math.round(e*t):e;r=e,u=r.input,o=CoreImage.Theme._cache||(CoreImage.Theme._cache={}),a=o[u]||(o[u]={});if(f=a[t])return f;e=r.fraction*t+r.constant,((i=r.min)||i===0)&&e<i&&(e=i),((s=r.max)||s===0)&&e>s&&(e=s);var l=
a[t]=Math.round(e);return l},parseIfNeeded:function(e){if(typeof e!="string"||e.indexOf("+")===-1)return e;var t=e;e=e.split(" ").join("");var n={},r;return(r=e.lastIndexOf("<",e.indexOf("+")))!==-1&&(n.min=parseFloat(e.substring(0,r))),e=e.substring(r+1),r=e.indexOf("+"),n.fraction=parseFloat(e.substring(0,r)),e=e.substring(r+1),r=e.indexOf("<"),r===-1?n.constant=parseFloat(e):(n.constant=parseFloat(e.substring(0,r)),n.max=parseFloat(e.substring(r+1))),n.input=t,n}}),CoreImage.URLResolver=Core.JSONProcessor.extend({computeUrlSetHash:function(e,t){var n=t.items,r=t.locations,i={},s,o,u,a,f=new Date*1;if(e.url_location){o=r[e.url_location],u=o.scheme?o.scheme+"://":"",a=o.hosts.length,i.urls=[];for(s=0;s<a;s++)i.urls.push(u+o.hosts[s]+e.url_path);i.expiry=this.parseUrlExpiry(e.url_expiry,f),i.birth=f}else i.error=e.error_code;return i},parseUrlExpiry:function(e,t){var n=isNaN(e)?this.parseJSONDate(e):e;return n<t&&(n=t+12e5),n||Infinity},parseJSONDate:function(e){e=e.split("T");var t=e[0],n=e[1];if(!t||!n)return;t=t.split("-"),n=n.slice(0,-1),n=n.split(":");if(t.length!==3)return Infinity;if(n.length!==3)return Infinity;var r=new Date;return r.setMilliseconds(0),r.setUTCFullYear(parseInt(t[0],10)),r.setUTCMonth(parseInt(t[1],10)-1),r.setUTCDate(parseInt(t[2],10)),r.setUTCHours(parseInt(n[0],10)),r.setUTCMinutes(parseInt(n[1],10)),r.setUTCSeconds(parseInt(n[2],10)),r*1||Infinity}}),CoreImage.VideoDetector=Core.Object.extend({makeDecisions:function(){var e=this.hasQT=this.isValidQTAvailable(),t=this.canHazQT=this.doesQTExistForPlatform(),n=this.hasHTML5MOV=this.canUseHTML5("mov"
),r=this.hasHTML5MP4=this.canUseHTML5("mp4"),i=this.abilities={},s=this.choices={};i.mp4=!!r||!!e,i.mov=!(!n&&!e||!!B.android),s.mp4=r?"html5":NO,s.mp4||(s.mp4=e?"quicktime":NO),s.mov=n?"html5":NO,s.mov||(s.mov=e?"quicktime":NO)}.observes("Core.windowDidLoad"),canUseHTML5:function(e){if(B.winXP)return NO;if(B.windows&&B.safari&&!B.chrome&&!this.isValidQTAvailable())return NO;try{if((B.silk||B.android)&&e==="mov")return NO;if(this["__dCUH5"+e+"__"]===(this["__dCUH5"+e+"__"]=YES))return this._canUseHTML5;var t=document.createElement("video"),n=this._canUseHTML5=t.canPlayType instanceof Function&&t.canPlayType(e==="mov"?"video/x-m4v":"video/mp4");if(n==="no"||!n)n=NO;return n}catch(r){return NO}},_isQTInstalled:undefined,isQTInstalled:function(){if(B.msie>=9)return NO;if(this._isQTInstalled===undefined){var e=!1;if(navigator.plugins&&navigator.plugins.length)for(var t=0;t<navigator.plugins.length;t++){var n=navigator.plugins[t];n.name.indexOf("QuickTime")>-1&&(e=!0)}else typeof execScript!="undefined"&&(qtObj=!1,execScript('on error resume next: qtObj = IsObject(CreateObject("QuickTimeCheckObject.QuickTimeCheck.1"))',"VBScript"),e=qtObj);this._isQTInstalled=e}return this._isQTInstalled},getQTVersion:function(){if(this._qtVersion)return this._qtVersion;var e="0";if(navigator.plugins&&navigator.plugins.length)for(var t=0;t<navigator.plugins.length;t++){var n=navigator.plugins[t],r=n.name.match(/quicktime\D*([\.\d]*)/i);r&&r[1]&&(e=r[1])}else typeof execScript!="undefined"&&(ieQTVersion=null,execScript('on error resume next: ieQTVersion = CreateObject("QuickTimeCheckObject.QuickTimeCheck.1").QuickTimeVersion'
,"VBScript"),ieQTVersion&&(e=ieQTVersion.toString(16),e=[e.charAt(0),e.charAt(1),e.charAt(2)].join(".")));return this._qtVersion=e},isQT772:function(){return this.getQTVersion()==="7.7.2"},isQTCompatible:function(e,t){var n=this._compatTest||(this._compatTest=function(e,t){var r=parseInt(e[0],10);isNaN(r)&&(r=0);var i=parseInt(t[0],10);return isNaN(i)&&(i=0),r===i?e.length>1?n(e.slice(1),t.slice(1)):!0:r<i?!0:!1}),r=e.split(/\./),i=t?t.split(/\./):this.getQTVersion().split(/\./);return n(r,i)},isValidQTAvailable:function(e){return this.isQTInstalled()&&this.isQTCompatible(e||CoreImage.MIN_QUICKTIME_VERSION)&&(!B.windows||!this.isQT772())&&!(B.msie>8)},doesQTExistForPlatform:function(){return B.winXP?NO:!B.mobile&&!(B.msie>8)}}),CoreImage.MIN_QUICKTIME_VERSION="7.6",function(){var e="__NONE__",t="html5",n="quicktime";CoreImage.VideoPlayerView=Core.View.extend({classNames:"video-player",shouldAutoPlay:YES,format:"mp4",isPrepared:function(){return this._isPrepared&&!this._isPreparing}.property(),mimes:{mov:"video/x-m4v",mp4:"video/mp4"},init:function(){var e=this;this._videoPlayEventHandler=function(t){e._videoDidPlay()},this._videoEndedEventHandler=function(t){e._videoDidEnd()},this._videoErrorEventHandler=function(t){e._videoDidError()},this._videoCloseFullscreenEventHandler=function(t){e._videoDidCloseFullscreen()},this._videoPauseEventHandler=function(t){e._videoDidPause()},this._sourceElementErrorEventHandler=function(t){e._sourceElementDidError(t)},arguments.callee.base.apply(this,arguments),this.mimeType=this.mimes[this.format],this._isPreparing=!1,this._isPrepared=!1},getVideoImplementationTypeForVideoFormat
:function(t){return e},hasSupportForPlayback:function(){return this.getVideoImplementationTypeForVideoFormat(this.format)!==e}.property(),processUrlsForValue:function(e,t,n){throw new Error("[CoreImage.VideoPlayerView: "+this.toString()+"] Must override processUrlsForValue method")},getPreferredVideoRepForValue:function(e){throw new Error("[CoreImage.VideoPlayerView: "+this.toString()+"] Must override getPreferredVideoRepForReps method")},play:function(){if(!this.get("isPrepared"))return;var e=this._video,t=this._implementation;t==="quicktime"?setTimeout(function(){e.Play()}):t==="html5"&&(B.silk?setTimeout(function(){e.play()}):e.play())},pause:function(){if(!this.get("isPrepared"))return;var e=this._video,t=this._implementation;t==="quicktime"?this._stopQTVideo(e):t==="html5"&&e.pause()},prepare:function(){if(this._isPreparing)return;this._isPreparing=!0,this._isPrepared=!1;var t=this.format,n=this.value,r=this.delegate,i=this.getVideoImplementationTypeForVideoFormat(t),s=this;this._implementation=i,i===e?(r.videoPlayerViewCannotSupportVideoForValue(this,n),this._isPreparing=!1):this._prepareRepsForValue(n)},append:function(e){arguments.callee.base.apply(this,arguments);if(!this.get("isPrepared"))return;this._setupVideoElementForValueIfNeeded(this.value),this.shouldAutoPlay&&this.play()},remove:function(){arguments.callee.base.apply(this,arguments),this._teardownVideoElementIfNeeded()},_getURLsFromRep:function(e){var t=null;return e.urls?t=e.urls:e.url&&(t=[e.url]),t},_prepareRepsForValue:function(e,t,n){var r=this.getPreferredVideoRepForValue(e);if(!r){this._prepareRepsForValueDidFail
(e);return}var i=this._getURLsFromRep(r),s=this,o=this.delegate;o&&o.videoPlayerViewWillPrepareForValue&&o.videoPlayerViewWillPrepareForValue(e);if(!i||this._repIsExpired(r)){var t=function(){s._prepareRepsForValueDidSucceed(e)},n=function(){s._prepareRepsForValueDidFail(e)};this.processUrlsForValue(e,t,n)}else this._prepareRepsForValueDidSucceed(e)},_prepareRepsForValueDidFail:function(e){var t=this.delegate;t&&t.videoPlayerViewDidFailToPrepareForValue&&t.videoPlayerViewDidFailToPrepareForValue(this,e),this._isPrepared=!1,this._isPreparing=!1},_prepareRepsForValueDidSucceed:function(e){var t=this.delegate;t&&t.videoPlayerViewDidSuccessfullyPrepareForValue&&t.videoPlayerViewDidSuccessfullyPrepareForValue(this,e),this._isPrepared=!0,this._isPreparing=!1},_repIsExpired:function(e){var t=e.urlSet,n=t?t.expiry:null,r=new Date*1;return!n||r>=n},_enhanceURLForSource:function(e){var t=e,n;return B.chrome&&(n=e.indexOf("?")!==-1?"&":"?",t=e+n+"chrome_unique="+Math.round(Math.random()*1e9)),t},_setupVideoElementForValueIfNeeded:function(e){if(this._video)return;var t=this.getPreferredVideoRepForValue(e),n=this._getURLsFromRep(t),r=this._implementation,i;return r==="quicktime"?i=this._setupQuickTimeVideoElementForURLs(n):r==="html5"&&(i=this._setupHTML5VideoElementForURLs(n)),this._video=i,i},_teardownVideoElementIfNeeded:function(){var e=this._video;if(!e)return;var t=this._implementation;t==="quicktime"?this._teardownQuickTimeVideoElement(e):t==="html5"&&this._teardownHTML5VideoElement(e),this._video=null},_setupQuickTimeVideoElementForURLs:function(e){var t=null;return B.msie?(this
.layer.innerHTML='<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="https://www.apple.com/qtactivex/qtplugin.cab#version=7,3,0,0" playerType="quicktime" width="100%" height="100%" > <param name="src" value="'+this._enhanceURLForSource(e[0])+'" />'+'<param name="controller" value="true" />'+'<param name="wmode" value="window" />'+'<param name="showlogo" value="false" />'+'<param name="scale" value="tofit" />'+'<param name="bgcolor" value="black" />'+'<param name="kioskmode" value="true" />'+'<param name="enablejavascript" value="true" />'+'<param name="postdomevents" value="true" />'+'<param name="cache" value="true" />'+'<param name="width" value="100%" />'+'<param name="height" value="100%" />'+"</object>",t=this.layer.firstChild,t.isQT=YES,t._urls=e,t._currentUrl=0):(this.layer.innerHTML='<EMBED SRC="'+this._enhanceURLForSource(e[0])+'"'+'CONTROLLER="true" '+'TYPE="video/quicktime" '+'PLUGINSPAGE="www.apple.com/quicktime/download" '+'EnableJavaScript="true" '+'postdomevents="true" '+'SHOWLOGO="false" '+'SCALE="aspect" '+'autoplay="true" '+'width="100%" '+'height="100%" '+"/>",t=this.layer.firstChild,t.isQT=YES,t.isQTEmbed=YES,t._urls=e,t._currentUrl=0),this._addEventHandlersForQuicktimeVideo(t),t},_setupHTML5VideoElementForURLs:function(e){var t=document.createElement("video");t.setAttribute("controls","controls"),this.shouldAutoPlay&&t.setAttribute("autoplay","autoplay"),t.style.width="100%",t.style.height="100%",t.isHTML5=YES,this._addEventHandlersForHTML5Video(t),this.layer.appendChild(t);var n=e.length,r;this._sourceErrorCounter=0;var i=this._sourceElements=new 
Array(e.length);for(var s=0;s<n;s++)r=this._createSourceElementForUrl(this._enhanceURLForSource(e[s])),i[s]=r,t.appendChild(r);return t},_createSourceElementForUrl:function(e){var t=document.createElement("source"),n=this;return t.setAttribute("type",this.mimeType),t.setAttribute("src",e),t.addEventListener("error",this._sourceElementErrorEventHandler),t},_sourceElementDidError:function(e){this._sourceErrorCounter+=1;var t=this._sourceErrorCounter;t===this._sourceElements.length&&this._videoDidError()},_teardownQuickTimeVideoElement:function(e){this._removeEventHandlersForQuicktimeVideo(e),this._stopQTVideo(e),this.layer.removeChild(e)},_stopQTVideo:function(e){setTimeout(function(){e&&e.Stop&&e.Stop()})},_teardownHTML5VideoElement:function(e){this._removeEventHandlersForHTML5Video(e),e.pause(),this.layer.removeChild(e);var t=this._sourceElements,n=t.length,r;for(var i=0;i<n;i++)r=t[i],r.src="",r.removeEventListener("error",this._sourceElementErrorEventHandler)},_addEventHandlersForQuicktimeVideo:function(e){this._addEventListenerToVideo(e,"qt_play",this._videoPlayEventHandler),this._addEventListenerToVideo(e,"qt_pause",this._videoPauseEventHandler),this._addEventListenerToVideo(e,"qt_ended",this._videoEndedEventHandler),this._addEventListenerToVideo(e,"qt_error",this._videoErrorEventHandler)},_addEventHandlersForHTML5Video:function(e){this._addEventListenerToVideo(e,"play",this._videoPlayEventHandler),this._addEventListenerToVideo(e,"ended",this._videoEndedEventHandler),this._addEventListenerToVideo(e,"pause",this._videoPauseEventHandler),this._addEventListenerToVideo(e,"webkitendfullscreen"
,this._videoCloseFullscreenEventHandler),this._addEventListenerToVideo(e,"error",this._videoErrorEventHandler)},_removeEventHandlersForQuicktimeVideo:function(e){this._removeEventListenerFromVideo(e,"qt_play",this._videoPlayEventHandler),this._removeEventListenerFromVideo(e,"qt_pause",this._videoPauseEventHandler),this._removeEventListenerFromVideo(e,"qt_ended",this._videoEndedEventHandler),this._removeEventListenerFromVideo(e,"qt_error",this._videoErrorEventHandler)},_removeEventHandlersForHTML5Video:function(e){this._removeEventListenerFromVideo(e,"play",this._videoReadyEventHandler),this._removeEventListenerFromVideo(e,"ended",this._videoEndedEventHandler),this._removeEventListenerFromVideo(e,"pause",this._videoPauseEventHandler),this._removeEventListenerFromVideo(e,"webkitendfullscreen",this._videoCloseFullscreenEventHandler),this._removeEventListenerFromVideo(e,"error",this._videoErrorEventHandler)},_addEventListenerToVideo:function(e,t,n){e.addEventListener?e.addEventListener(t,n):e.attachEvent?e.attachEvent("on"+t,n):e["on"+t]=n},_removeEventListenerFromVideo:function(e,t,n){e.removeEventListener?e.removeEventListener(t,n):e.detachEvent?e.detachEvent("on"+t,n):e["on"+t]=null},_videoDidCloseFullscreen:function(){var e=this.delegate;e&&e.videoPlayerViewDidCloseFullscreen&&e.videoPlayerViewDidCloseFullscreen(this)},_videoDidPlay:function(){var e=this.delegate;e&&e.videoPlayerViewDidPlayVideo&&e.videoPlayerViewDidPlayVideo(this),this.trigger("playbackDidPlay")},_videoDidEnd:function(){var e=this.delegate;e&&e.videoPlayerViewDidEndPlayingVideo&&e.videoPlayerViewDidEndPlayingVideo
(this),this.trigger("playbackDidEnd")},_videoDidPause:function(){var e=this.delegate;e&&e.videoPlayerViewDidPauseVideo&&e.videoPlayerViewDidPauseVideo(this),this.trigger("playbackDidPause")},_videoDidError:function(){var e=this.delegate;e&&e.videoPlayerViewDidError&&e.videoPlayerViewDidError(this),this.trigger("playbackDidErr")}}),CoreImage.VideoPlayerView.VIDEO_IMPL_NONE=e,CoreImage.VideoPlayerView.VIDEO_IMPL_HTML5=t,CoreImage.VideoPlayerView.VIDEO_IMPL_QUICKTIME=n}(),require("views/video_player_view"),CoreImage.SlideshowViewDelegate={isMixin:YES,isSlideshowViewDelegate:YES,slideshowViewWillChangeCurrentItemView:function(e){},slideshowViewDidChangeCurrentItemView:function(e){},slideshowViewWillUpdateItemViewsInScope:function(e){},slideshowViewDidUpdateItemViewsInScope:function(e){},slideshowViewDidAddItemViewToScopeForItem:function(e,t,n){},slideshowViewDidRemoveItemViewFromScopeForItem:function(e,t,n){},slideshowViewCreateItemViewForItem:function(e,t){return Core.error("When using SlideshowView, you must implement slideshowViewCreateItemViewForItem. Otherwise, the slideshow is unable to render any item records."),null},slideshowViewItemIsVideo:function(e,t){return!1},slideshowViewDidStartPlayingVideoForItem:function(e,t){},slideshowViewDidEndPlayingVideoForItem:function(e,t){},slideshowViewDidFailToPlayVideoForItem:function(e,t){},slideshowViewShouldAutoPlayVideoForItem:function(e,t){return!1},slideshowViewVideoDidCloseFullscreenForItem:function(e,t){},slideshowViewCannotSupportVideoForItem:function(e,t){},slideshowViewCannotProcessVideoURLsForItem:function(e,t){},slideshowViewAbleToPlayVideoForItem
:function(e,t){}},CoreImage.define("SlideshowView",Core.TransitionerView.extend(CoreImage.SlideshowViewDelegate,{itemSet:null,currentItem:null,currentView:null,leftTransitioners:null,rightTransitioners:null,isHudShowing:NO,hudLifespan:4e3,canHudHide:YES,steadyStateOverflow:"hidden",shouldMaintainPreviousAndNextItemViews:Core.useGPUForBigs,delegate:null,itemViewsScopeLookAheadCount:0,itemViewsScopeLookBehindCount:0,videoViewExample:CoreImage.VideoPlayerView,isShowingVideo:function(){return!!this._currentVideoView}.property(),itemViewsScopeSize:function(){var e=this.itemViewsScopeLookAheadCount,t=this.itemViewsScopeLookBehindCount;return e+t+1}.property(),delegateValue:function(){return this.delegate||this}.property(),init:function(){this._scopedItemViews={},this._preparedVideosViews={},arguments.callee.base.apply(this,arguments)},viewForItem:function(e){var t=this.get("delegateValue");return t.slideshowViewCreateItemViewForItem(this,e)},setCurrentViewFromCurrentItem:function(){this.stopShowingVideoViewIfNeeded();var e=this.currentItem,t=this.itemSet.indexOf(e),n=this.currentView,r=this.itemSet.indexOf(n&&n.originalItem),i=t>r,s=this.itemSet.length,o,u,a,f=this.get("delegateValue");Math.abs(t-r)===s-1&&(i=!i),this.set("transitionDirection",i?"left":"right"),Core.guidFor(this.currentItem),this._updateItemViewsScopeRelativeToCurrentItem();var l=this._itemViewForCurrentItem();f.slideshowViewWillChangeCurrentItemView(this),this.setIfChanged("currentView",l),f.slideshowViewDidChangeCurrentItemView(this,l),l&&l.trigger("didBecomeCurrent")}.observes("currentItem"),decideTransitioners
:function(){this._currentlySwiping?this.transitioners=this[this.transitionDirection+"SwipeTransitioners"]||this[this.transitionDirection+"Transitioners"]:this.transitioners=this[this.transitionDirection+"Transitioners"]}.observes("transitionDirection"),_updateItemViewsScopeRelativeToCurrentItem:function(){var e=this.currentItem;e&&this._updateItemViewsScopeRelativeToItem(e)},_updateItemViewsScopeRelativeToItem:function(e){if(!e)return;var t=this.get("delegateValue"),n=this.get("itemSet"),r=this.itemViewsScopeLookAheadCount,i=this.itemViewsScopeLookBehindCount,s=n.indexOf(e),o=n.length;t.slideshowViewWillUpdateItemViewsInScope(this);var u={},a,f,l;u[e.coreGuid]=e;for(a=1;a<=r;a+=1)f=(s+a)%o,l=n[f%o],u[l.coreGuid]||(u[l.coreGuid]=l);for(a=1;a<=i;a+=1)f=s+a*-1,f<0&&(f=o+f),l=f<0?null:n[f],l&&!u[l.coreGuid]&&(u[l.coreGuid]=l);var c=this._scopedItemViews,h=[],p,d;for(p in c)u[p]||this._removeItemViewFromScopeForItemKey(p);for(p in u)l=u[p],this.hasItemViewInScopeForItem(l)||this._addItemViewToScopeForItem(l);t.slideshowViewDidUpdateItemViewsInScope(this)},_itemViewForCurrentItem:function(){var e=this.currentItem;return e?this.scopedItemViewForItem(e):null},_itemViewForNextItem:function(){var e=this.itemSet.indexOf(this.currentItem);if(e===-1)return null;var t=this.itemSet[(e+1)%this.itemSet.length];return t===this.currentItem?null:t?this.scopedItemViewForItem(t):null},_itemViewForPreviousItem:function(){var e=this.itemSet.indexOf(this.currentItem);if(e===-1)return null;var t=this.itemSet[(e-1+this.itemSet.length)%this.itemSet.length];return t===this.currentItem?null:t?this.scopedItemViewForItem
(t):null},scopedItemViewForItem:function(e){var t=this._scopedItemViews[e.coreGuid];return t?t.view:null},hasItemViewInScopeForItem:function(e){return!!this.scopedItemViewForItem(e)},hasItemViewInScope:function(e){var t=this._scopedItemViews;for(var n in t)if(t[n].view===e)return!0;return!1},positionOfItemRelativeToCurrentItem:function(e){var t=this.itemSet,n=this.currentItem;if(!t||!n)return null;var r=t.indexOf(n),i=t.indexOf(e);return i<0?null:i-r},positionOfItemViewInScope:function(e){var t=this._scopedItemViews,n;for(var r in t){n=t[r];if(n.view===e)return this.positionOfItemRelativeToCurrentItem(n.item)}return null},itemViewsInScope:function(){var e=[],t=this._scopedItemViews;for(var n in t)e.push(t[n].view);return e}.property(),_addItemViewToScopeForItem:function(e){var t=this._scopedItemViews,n=this.get("delegateValue"),r=this.viewForItem(e),i=this;return r?(t[e.coreGuid]={view:r,item:e},n.slideshowViewDidAddItemViewToScopeForItem(this,r,e),r):null},_removeItemViewFromScopeForItemKey:function(e){var t=this.get("delegateValue"),n=this._scopedItemViews,r,i,s;return s=n[e],s?(r=n[e].view,i=n[e].item,delete n[e],t.slideshowViewDidRemoveItemViewFromScopeForItem(this,r,i),r):null},chainObserveIsLoading:function(){var e=this._isLoadingWatcher;if(!e){var t=this;e=this._isLoadingWatcher=function(){t._watchIsLoading()}}this._lastIsLoadingWatcherView&&this._lastIsLoadingWatcherView.unlisten("isLoading",e),this.currentView&&this.currentView.listen("isLoading",e),this._lastIsLoadingWatcherView=this.currentView,e()}.observes("currentView"),allowOrDisallowHudHide:function(){this.setIfChanged
("canHudHide",this.currentView&&this.currentView.allowsHudToHide)}.observes("currentView"),_watchIsLoading:function(){this.setIfChanged("isLoading",this.currentView&&this.currentView.isLoading)},resetOldViewOnFinish:function(e,t,n){e&&e.resetState()}.observes("didFinishRunningTransition"),computeAvailableRectFromWindow:function(){var e=this.availableRect||(this.availableRect={});e.top=0,e.left=0,e.width=Core.windowSize.width,e.height=Core.windowSize.height,this.trigger("availableRect")}.observes("Core.windowSize","init"),setSelfLayout:function(){if(!this.shouldLayoutSelf)return;var e=Core.windowSize,t=this.layer.style;t.width=e.width+"px",t.height=e.height+"px"}.observes("Core.windowSize","render"),prepareVideoForItem:function(e){if(!this.delegate.slideshowViewItemIsVideo(this,e))return;var t=this._preparedVideosViews[e.coreGuid];t||(t=this._createVideoViewForItem(e),this._preparedVideosViews[e.coreGuid]=t),t.prepare()},playVideoForItem:function(e){if(!this.delegate.slideshowViewItemIsVideo(this,e))return!1;var t=this._scopedItemViews[e.coreGuid];if(!t)return!1;var n=t.view,r=this._preparedVideosViews[e.coreGuid];return!r||!r.get("hasSupportForPlayback")?!1:(this._currentVideoView=r,n.remove(),this._updateVideoViewLayout(r),r.append(this),this.didStartShowingVideo(),!0)},didStartShowingVideo:function(){},stopShowingVideoViewIfNeeded:function(){var e=this._currentVideoView;if(!e)return;e.pause();var t=e.value,n=this.scopedItemViewForItem(t);e.remove(),this._currentVideoView=null,n.append(this),this.didStopShowingVideo()},didStopShowingVideo:function(){},_updateVideoViewLayout
:function(e){var t=this._scopedItemViews,n=this.availableRect,r=e.value,i=t[r.coreGuid],s=i.view,o=s.getSizeForFrame(n);if(!o)return;var u=Math.floor(n.height/2-o.height/2+n.top),a=Math.floor(n.width/2-o.width/2),f=e.layer.style;f.width=o.width+"px",f.height=o.height+"px",f.top=u+"px",f.left=a+"px"},_availableRectDidChange:function(){var e=this._currentVideoView;e&&this._updateVideoViewLayout(e)}.observes("availableRect"),_willRunTransitionDidTrigger:function(){this.stopShowingVideoViewIfNeeded(),this._transitionHandle&&clearTimeout(this._transitionHandle)}.observes("willRunTransition"),_didFinishRunningTransitionDidTrigger:function(){var e=this.get("delegateValue"),t=this.currentItem,n=this;if(!t)return;var r=this._preparedVideosViews[t.coreGuid];this._preparedVideosViews[t.coreGuid]&&e.slideshowViewShouldAutoPlayVideoForItem(this,t)&&(this._transitionHandle=setTimeout(function(){var e=n.currentItem;if(!e)return;n.playVideoForItem(e)},500))}.observes("didFinishRunningTransition"),_createVideoViewForItem:function(e){var t=this.videoViewExample,n=this.videoViewExample.create({owner:this,delegate:this,value:e,shouldAutoPlay:!0});return n},videoPlayerViewCannotSupportVideoForValue:function(e,t){var n=this.get("delegateValue");n.slideshowViewCannotSupportVideoForItem(this,t)},videoPlayerViewDidSuccessfullyPrepareForValue:function(e,t){var n=this.get("delegateValue");n.slideshowViewDidSuccessfullyPrepareVideoForItem(this,t)},videoPlayerViewDidFailToPrepareForValue:function(e,t){var n=this.get("delegateValue");n.slideshowViewDidFailToPrepareVideoForItem(this,t)},videoPlayerViewDidPlayVideo
:function(e){var t=this.get("delegateValue"),n=e.value;t.slideshowViewDidStartPlayingVideoForItem(this,n)},videoPlayerViewDidEndPlayingVideo:function(e){this.stopShowingVideoViewIfNeeded();var t=this.get("delegateValue"),n=e.value;t.slideshowViewDidEndPlayingVideoForItem(this,n)},videoPlayerViewDidError:function(e){var t=this.get("delegateValue"),n=e.value,r=this;this.stopShowingVideoViewIfNeeded(),t.slideshowViewDidFailToPlayVideoForItem(r,n)},videoPlayerViewDidCloseFullscreen:function(e){var t=this.get("delegateValue"),n=e.value;t.slideshowViewVideoDidCloseFullscreenForItem(this,n)}})),require("views/slideshow"),CoreImage.SlideshowView.reopen({_MAKE_TMP_POINTER:function(){window.sv=this}.observes("init"),swipeToOffset:function(e){if(this.isCommittingSwipe)return 1;if(!this.itemSet||this.itemSet.length<=1)return 1;if(!e)return this.cancelSwipe(YES),0;if(this.currentSwipeOffset===e)return 0;var t=e<0,n=t?"left":"right";n!==this._currentlySwiping&&this._currentlySwiping&&this.cancelSwipe(YES),this._currentlySwiping||this._initiateSwipe(t);var r=this.victimTransitioner;return r.current=e/Core.windowSize.width/r.direction,r.update(),this._previousSwipeOffset=this.currentSwipeOffset,this._previousSwipeTime=this._currentSwipeTime,this.setIfChanged("currentSwipeOffset",e),this._currentSwipeTime=new Date*1,0},swipeTouchDidEnd:function(){var e=this.currentSwipeOffset-this._previousSwipeOffset,t=(this._currentSwipeTime-this._previousSwipeTime)/1e3,n=e/t||0,r=Math.abs(this.currentSwipeOffset+n);r>=Core.windowSize.width/2?this.finishSwipe():this.cancelSwipe()},_initiateSwipe:function(e
){if(this._currentlySwiping)return;this._currentlySwiping=e?"left":"right",e?this.controller.selectNext():this.controller.selectPrevious();var t=this.transitioner;this.setIfChanged("victimTransitioner",t),t.paused=YES},cancelSwipe:function(e){var t=this.victimTransitioner;if(!t)return;t.redirectTo(0),t.redirectFrom(t.current),t.reset(),t.listen("finish",function(){this.unlisten("finish",arguments.callee),this.owner.swipeDidFinishCanceling()}),t.paused=NO,this.setIfChanged("isCommittingSwipe",YES),e&&t.finish()},finishSwipe:function(e){var t=this.victimTransitioner;if(!t)return;t.redirectTo(1),t.redirectFrom(t.current),t.reset(),t.listen("finish",function(){this.unlisten("finish",arguments.callee),this.owner.swipeDidFinishFinishing()}),t.paused=NO,this.setIfChanged("isCommittingSwipe",YES),e&&t.finish()},forceFinishCurrentSwipeCommittal:function(){if(!this.isCommittingSwipe)return;this.victimTransitioner.finish()},swipeDidFinishCanceling:function(){var e=this._currentlySwiping;if(!e)return;e==="right"&&this.controller.selectNext(),e==="left"&&this.controller.selectPrevious(),this.swipeDidFinish()},swipeDidFinishFinishing:function(){this.swipeDidFinish()},swipeDidFinish:function(){this._currentlySwiping=NO,this.setIfChanged("victimTransitioner",null),this.setIfChanged("isCommittingSwipe",NO),this._previousSwipeOffset=NaN,this._previousSwipeTime=NaN,this._currentSwipeTime=NaN},getNextView:function(){return this.viewForItem(this.itemSet[(this.itemSet.indexOf(this.currentView.originalItem)+1)%this.itemSet.length])},getPreviousView:function(){return this.viewForItem(this.itemSet[(
this.itemSet.indexOf(this.currentView.originalItem)+this.itemSet.length-1)%this.itemSet.length])}}),CoreImage.SlideshowView.reopen({touchStart:function(e){if(this.get("isShowingVideo"))return;if(this.currentView&&this.currentView.hasPinchZoomability&&this.currentView.allowZoom)return arguments.callee.base.apply(this,arguments);e.preventDefault();var t=this.currentView,n=t?t.zoomState:null,r=n?n.zoom===1:!0;if(e.touches.length>1||!r)return arguments.callee.base.apply(this,arguments);var i=e.touches[0].clientX;return i?(this._initialSwipeTouchX=i,this._isTouchReadyToSwipe=YES,arguments.callee.base.apply(this,arguments)):arguments.callee.base.apply(this,arguments)},touchMove:function(e){if(this.get("isShowingVideo"))return;e.preventDefault();var t=this.currentView,n=t?t.zoomState:null,r=n?n.zoom===1:!0;if(e.touches.length>1||!r)return arguments.callee.base.apply(this,arguments);var i=e&&e.touches&&e.touches[0]&&e.touches[0].clientX;return i?this._isTouchReadyToSwipe?(this.swipeToOffset(i-this._initialSwipeTouchX),this._isTouchSwiping||(this._initialSwipeTime=Date.now()),this._isTouchSwiping=YES,arguments.callee.base.apply(this,arguments)):arguments.callee.base.apply(this,arguments):arguments.callee.base.apply(this,arguments)},touchEnd:function(e){if(this.get("isShowingVideo"))return;return e.preventDefault(),this._isTouchSwiping?(this.swipeTouchDidEnd(),this._isTouchSwiping=this._isTouchReadyToSwipe=NO,this._initialSwipeTouchX=undefined,arguments.callee.base.apply(this,arguments)):arguments.callee.base.apply(this,arguments)}}),CoreImage.BasicDialogView=Core.View.extend({className
:"Journal.BasicDialogView",rootHTML:'<div class="basic-dialog"><div class="background"><div class="middle"></div><div class="right"></div><div class="left"></div></div><div class="caption"></div></div>',captionElement:"layer.lastChild",title:null,widthPadding:0,leftPadding:0,titleDidChange:function(){this.caption.innerHTML=this.title||"&nbsp;",this.doLayerAdjustments()}.observes("title","render"),doLayerAdjustments:function(){if(!this.isAppendedInWindow)return;this.adjustLayerWidth(),this.centerLayerHorizontally(),this.centerLayerVertically()}.observes("isAppendedInWindow",".owner.size"),adjustLayerWidth:function(){if(this._adjustedLayerWidth)return;this.caption.style.marginLeft=this.leftPadding-1+"px";var e=this.caption.offsetWidth+this.widthPadding;if(isNaN(e))return;this.layer.style.width=Math.round(e)+"px",this._adjustedLayerWidth=!0},centerLayerHorizontally:function(){var e=this.layer,t=Math.round(this.owner.size.height/2),n=t-Math.round(e.clientHeight/2);if(isNaN(n))return;this.layer.style.top=Math.round(n)+"px"},centerLayerVertically:function(){var e=this.layer,t=Math.round(this.owner.size.width/2),n=t-Math.round(e.clientWidth/2);if(isNaN(n))return;this.layer.style.left=Math.round(n)+"px"}}),CoreImage.QuickTimeErrorView=CoreImage.BasicDialogView.extend({widthPadding:B.rightToLeft?70:75,leftPadding:B.rightToLeft?25:0,dlButtonView:Core.ButtonView.extend({rootHTML:'<div><div class="crazy-extender eye-transparent-mouse-opaque"></div><div>',crazyExtenderElement:"layer.firstChild",action:function(){window.location.href="_URL.DownloadQuicktime".loc()},getLinkAndSizeExtender:
function(){if(!this.isAppended)return;this.link=this.getPath(B.leftToRight?"layer.previousSibling.lastChild":"layer.previousSibling.firstChild");if(!this.link)return;(this.link.tagName||"").toLowerCase()!=="a"&&(this.link=null);if(!this.link)return;this.crazyExtender.style[B.leftToRight?"left":"right"]=-this.link.offsetWidth-12+"px"}.observes("isAppendedInWindow"),brightenLinkText:function(){if(!this.link)return;this.isOver?$(this.link).addClass("hover"):$(this.link).removeClass("hover")}.observes("isOver"),brightenLinkTextMore:function(){if(!this.link)return;this.isActive?$(this.link).addClass("active"):$(this.link).removeClass("active")}.observes("isActive")})}),CoreImage.define("FadingTextSwapperView",Core.TransitionerView.extend({allowInterruption:YES,defaultTransition:Core.transitionBank.xFade||Core.TransitionerView.prototype.defaultTransition,minLeft:0,minLeftPadding:10,align:"center",textLeft:null,textWidth:null,showText:YES,currentView:CoreImage.define("MeasuredTextLabelView",Core.View.extend({classNames:"measured-label".w(),value:"",rootHTML:'<div><div class="text"></div></div>',escapeHTMLBinding:"from:.owner.escapeHTML",textElement:"layer.firstChild",alignBinding:"from:.owner.align",minLeftBinding:"from:.owner.minLeft",minLeftPaddingBinding:"from:.owner.minLeftPadding",leftBinding:"to:.owner.textLeft",widthBinding:"to:.owner.textWidth",showTextBinding:"from:.owner.showText",showTextDidChange:function(){this.showText||!this.isAppendedInWindow?this.owner.transitioner||$(this.text).addClass("show").removeClass("hide"):$(this.text).addClass("hide").removeClass("show")}
,__runShowTextDidChange__:function(){var e=this;setTimeout(function(){e.showTextDidChange()},0)}.observes("showText",".owner.transitioner","isAppendedInWindow"),writeValue:function(){if(!this.isAppendedInWindow)return;this.text.style.left="",this.text.style.right="";var e=this.value+"";this.escapeHTML&&(e=Core.escapeHTML(e)),this.text.innerHTML=e,this.set("width",this.text.offsetWidth)}.observes("value","isAppendedInWindow"),positionLayer:function(){var e=this.align;e!=="right"?this.layer.style.left=e==="center"?"50%":"0px":this.layer.style.right=this.width+"px",this.trigger("layerPositioned")}.observes("width"),positionText:function(){if(!this.width||!this.isAppended||!this.isAppendedInWindow)return;this.align==="center"?this.centerText():(this.text.style.left="0px",this.set("left",this.owner.layer.offsetLeft+this.layer.offsetLeft))}.observes("layerPositioned","minLeft","Core.windowSize"),centerText:function(){var e=Math.round(this.width/2),t=e*-1,n=this.layer.offsetLeft;this.text.style.left=t+"px";var r=t+n-(this.minLeft+this.minLeftPadding);r<0&&(t-=r,this.text.style.left=t+"px"),e+(r<0?r*-1:0)>n?this.text.style.right=n*-1+"px":this.text.style.right="",this.set("left",n+t)}})).extend({initiallyAppended:NO}),_previousView:CoreImage.MeasuredTextLabelView.extend({initiallyAppended:NO}),updateToValue:function(){this._previousView.set("value",this.value);var e=this.currentView;this.set("currentView",this._previousView),this._previousView=e}.observes("value","render")})),function(){var e,t,n;CoreImage.transitionBank=B.android?{}:{zoomImageIn:Core.transitionBank.liftTo.superclass
.extend(e={isMixin:YES,zoomMaskContainerLayout:{left:0,top:0,right:0,bottom:0},removeZoomImage:function(){if(!this.isUsingZoomImage)return;var e=this.zoomMask,t=this.zoomMaskContainer;this.bigView.unhideZoomImageItem&&this.bigView.unhideZoomImageItem(),e&&(this._zoomImageFader=Anim.Fader.go({element:e,to:0,duration:B.chrome?0:1e3*(!(B.msie<=8)&&!B.mozilla),finalize:function(){!B.iOS&&t&&t.parentNode&&t.parentNode.removeChild(t),B.iOS&&(t.style.webkitTransform="translate3d(-10000px,-10000px,0)"),Anim.setOpacity(e,1),B.mozilla&&(e.firstChild.src=Core.emptyImageSrc)}.observes("finish")}))}.observes("finish"),initializeZoomImage:function(){Anim.tellFinish(this._zoomImageFader);var e=this.bigView,t=this.smallView;if(!e||!e.getBigZoomInfo||!t||!t.getSmallZoomInfo)return;var n=t.getSmallZoomInfo(),r=e.getBigZoomInfo();if(!n||!r)return;this.isUsingZoomImage=YES;var i=this.zoomMaskContainer,s,o;if(!i){i=this.zoomMaskContainer=document.createElement("div"),i.style.cssText="position:fixed; overflow:hidden; z-index:1701; pointer-events:none;";for(var u in this.zoomMaskContainerLayout)i.style[u]=this.zoomMaskContainerLayout[u]+"px";o=this.zoomMask=document.createElement("div"),o.style.cssText="position:absolute; z-index:1701; overflow:hidden; pointer-events:none; opacity:0;",o.appendChild(s=new Image),s.style.cssText="position:absolute; z-index:1; pointer-events:none;",i.appendChild(o)}o=this.zoomMask=i.firstChild,s=this.zoomImage=o.firstChild,s.src=r.src||n.src,o.style.opacity=0,B.iOS&&(i.style.webkitTransform="translate3d(0,0,0)"),document.body.appendChild(i),this.bigView.hideZoomImageItem&&
this.bigView.hideZoomImageItem()}.observes("start"),renderZoomImage:function(){if(!this.isUsingZoomImage)return;var e=this.smallView.getSmallZoomInfo&&this.smallView.getSmallZoomInfo(),t=this.bigView.getBigZoomInfo&&this.bigView.getBigZoomInfo(),n=this.getProgress(),r=1-n,i=Math.round;if(!e||!t)return;var s=e.cropT,o=e.cropL,u=e.cropW,a=e.cropH,f=e.imageT,l=e.imageL,c=e.imageW,h=e.imageH,p=t.top,d=t.left,v=t.width,m=t.height,g=n*p+r*s,y=n*d+r*o,b=n*v+r*u,w=n*m+r*a,E=n*p+r*f-g,S=n*d+r*l-y,x=n*v+r*c,T=n*m+r*h,N=this.zoomMask.style,C=this.zoomImage.style;if(!B.chrome&&Core.useGPUForBigs&&Core.windowSize.width<=Core.maxGPUTextureSize){C.top="0px",C.left="0px",N.top=p+"px",N.left=d+"px",N.width=C.width=v+"px",N.height=C.height=m+"px";var k=(o-l)/(c-u||Infinity),L=(s-f)/(h-a||Infinity);N.webkitTransform="translateX("+(y+b/2-(d+v/2))+"px) "+"translateY("+(g+w/2-(p+m/2))+"px) "+"scaleX("+b/v+") scaleY("+w/m+") "+"translateZ(0px)",C.webkitTransform="translateX("+(l-o+c/2-(r*u/2+n*((u+u-c)*k+(1-k)*c)/2))*(v/b)+"px) "+"translateY("+(f-s+h/2-(r*a/2+n*((a+a-h)*L+(1-L)*h)/2))*(m/w)+"px) "+"scaleX("+x/b+") "+"scaleY("+T/w+") "+"translateZ(0px)"}else N.top=i(g)+"px",N.left=i(y)+"px",N.width=i(b)+"px",N.height=i(w)+"px",C.top=i(E)+"px",C.left=i(S)+"px",C.width=i(x)+"px",C.height=i(T)+"px",C.webkitTransform=N.webkitTransform="";N.opacity=""}.observes("frame")},t={isMixin:YES,getProgress:function(){return(this.current-this.from)/(this.to-this.from)},start:function(){return this.smallView=this.frView,this.bigView=this.toView,arguments.callee.base.apply(this,arguments)}}),zoomImageOut:Core.transitionBank
.dropFrom.superclass.extend(e,n),xFadeToZoomImageIn:Core.transitionBank.xFadeTo.extend(e,t,{duration:500})}}(),SC.stringsFor("en-us",{_iCloud:"iCloud",_Today:"Today",_Yesterday:"Yesterday",_AM:"AM",_PM:"PM",_January:"January",_February:"February",_March:"March",_April:"April",_May:"May",_June:"June",_July:"July",_August:"August",_September:"September",_October:"October",_November:"November",_December:"December","_Day.X1":"%@st","_Day.X2":"%@nd","_Day.X3":"%@rd","_Day.X4":"%@th","_Day.X5":"%@th","_Day.X6":"%@th","_Day.X7":"%@th","_Day.X8":"%@th","_Day.X9":"%@th","_Day.X0":"%@th","_Day.11":"11th","_Day.12":"12th","_Day.13":"13th","_App.Title.Default":"iCloud Photo Sharing","_App.Title.Given":"%@ - iCloud Photo Sharing",_DateTime:"%{date} %{time}",_FullName:"%{fname} %{lname}","_Stream.BatchSummary.Count.Contributor.Single.Photos":"%@1 posted %@2 photos","_Stream.BatchSummary.Count.Contributor.Single.OnePhoto":"%@1 posted a photo","_Stream.BatchSummary.Count.Contributor.Single.Panoramas":"%@1 posted %@2 panoramas","_Stream.BatchSummary.Count.Contributor.Single.OnePanorama":"%@ posted a panorama","_Stream.BatchSummary.Count.Contributor.Single.Videos":"%@1 posted %@2 videos","_Stream.BatchSummary.Count.Contributor.Single.OneVideo":"%@ posted a video","_Stream.BatchSummary.Count.Contributor.Single.PhotosAndVideos":"%@1 posted %@2 photos and %@3 videos","_Stream.BatchSummary.Count.Contributor.Single.PhotosAndOneVideo":"%@1 posted %@2 photos and a video","_Stream.BatchSummary.Count.Contributor.Single.OnePhotoAndVideos":"%@1 posted a photo and %@2 videos","_Stream.BatchSummary.Count.Contributor.Single.OnePhotoAndOneVideo"
:"%@ posted a photo and a video","_Stream.BatchSummary.Count.Contributor.Multi.Photos":'<span class="multi">%@1</span> posted %@2 photos',"_Stream.BatchSummary.Count.Contributor.Multi.OnePhoto":'<span class="multi">%@</span> posted a photo',"_Stream.BatchSummary.Count.Contributor.Multi.Panoramas":'<span class="multi">%@1</span> posted %@2 panoramas',"_Stream.BatchSummary.Count.Contributor.Multi.OnePanorama":'<span class="multi">%@</span> posted a panorama',"_Stream.BatchSummary.Count.Contributor.Multi.Videos":'<span class="multi">%@1</span> posted %@2 videos',"_Stream.BatchSummary.Count.Contributor.Multi.OneVideo":'<span class="multi">%@</span> posted a video',"_Stream.BatchSummary.Count.Contributor.Multi.PhotosAndVideos":'<span class="multi">%@1</span> posted %@2 photos and %@3 videos',"_Stream.BatchSummary.Count.Contributor.Multi.PhotosAndOneVideo":'<span class="multi">%@1</span> posted %@2 photos and a video',"_Stream.BatchSummary.Count.Contributor.Multi.OnePhotoAndVideos":'<span class="multi">%@1</span> posted a photo and %@2 videos',"_Stream.BatchSummary.Count.Contributor.Multi.OnePhotoAndOneVideo":'<span class="multi">%@1</span> posted a photo and a video',"_Stream.BatchSummary.Count.Contributor.Multi.Items":'<span class="multi">%@1</span> posted %@2 items',"_Stream.BatchSummary.Count.Plain.Photos":"%@ photos","_Stream.BatchSummary.Count.Plain.OnePhoto":"1 photo","_Stream.BatchSummary.Count.Plain.OnePanorama":"1 panorama","_Stream.BatchSummary.Count.Plain.OneVideo":"1 video","_Stream.BatchSummary.Count.Plain.Items":"%@ items","_Stream.BatchSummary.DateFormatShort":"mm dd"
,"_Stream.BatchSummary.DateFormatLong":"mm dd, yyyy","_Stream.BatchSummary.TimeFormat":"hh:mm p","_Stream.Header.ByTitle.Desktop":"<span class='title'>%@1</span> by %@2 %@3","_Stream.Header.ByTitle.Mobile":"by %@1 %@2","_Stream.Footer.PrivacyPolicy":"Privacy Policy","_Stream.Footer.TermsOfService":"Terms & Conditions","_Stream.MissingPhotos":"No Shared Photos","_Slideshow.CannotLoadPhoto":"Cannot Load Photo","_Slideshow.Desktop.Button.PlaySlideshow":"Slideshow","_Slideshow.Desktop.Button.PauseSlideshow":"Stop Slideshow","_Slideshow.Desktop.Button.Download":"Download","_Slideshow.Desktop.Button.EnterFullscreen":"Fullscreen","_Slideshow.Desktop.Button.ExitFullscreen":"Exit Fullscreen","_Slideshow.Mobile.Button.PlaySlideshow":"Play","_Slideshow.Mobile.Button.PauseSlideshow":"Pause","_Slideshow.Mobile.Counter":"%@1 of %@2","_ErrorPage.Message.NotFound.Title":"iCloud can’t find that page.","_ErrorPage.Message.NotFound.Caption":"Please double check and try again.","_ErrorPage.Message.Unexpected.Title":"An unexpected error occurred","_ErrorPage.Message.Unexpected.Caption":"We’re sorry, please try again later.","_ErrorPage.Message.Unavailable.Title":"Try again later.","_ErrorPage.Message.Unavailable.Caption":"The shared album you are trying to view is currently unavailable.","_ErrorPage.Message.HighDemand.Title":"This shared album is unavailable.","_ErrorPage.Message.HighDemand.Caption":"Due to high demand, this shared album cannot be loaded. Please try again later.","_ErrorPage.Message.JavaScriptRequired.Title":"JavaScript is required.","_ErrorPage.Message.JavaScriptRequired.Caption"
:"To use iCloud, enable JavaScript in your browser and try again.","_ErrorPage.Footer.Legal":"Copyright &copy %@ Apple Inc. All rights reserved.","_URL.PrivacyPolicy":"http://www.apple.com/privacy/","_URL.TermsOfService":"http://www.apple.com/legal/icloud/ww/","_URL.ApplePhotoStream":"http://www.apple.com/icloud/icloud-photo-sharing.html","_URL.DownloadQuicktime":"http://www.apple.com/quicktime/download/","_Error.MissingQuicktime":"Your browser cannot play this video without QuickTime.","_Error.DownloadQuicktime":"Download QuickTime","_Error.CanNotPlayVideo":"Your browser cannot play this video.","_Error.FailureTryingToPlayVideo":"An error occurred while playing this video. Please try again later.","_Error.VideoStillBeingPublished":"This video is still being published. Please try again later.","_Error.Short.FailureTryingToPlayVideo":"An error occurred while playing this video.","_Error.Short.VideoStillBeingPublished":"This video is still being published.","_Accessibility.CaptionedGridPhotoButtonSummary":"%{caption}, %{index} of %{setSize}, taken %{date} %{time}","_Accessibility.CaptionlessGridPhotoButtonSummary":"%{index} of %{setSize}, taken %{date} %{time}","_Accessibility.Pause":"Pause","_Accessibility.Play":"Play","_Accessibility.Next":"Next","_Accessibility.Previous":"Previous","_Accessibility.Download":"Download","_Accessibility.EnterFullscreen":"Enter Fullscreen","_Accessibility.ExitFullscreen":"Exit Fullscreen","_Accessibility.AppleLogo":"Apple","_Accessibility.SlideshowStarted":"Slideshow Started","_Accessibility.SlideshowPaused":"Slideshow Paused","_Accessibility.PlayVideo"
:"Play Video"});var Config={defaultSetting:null,_settings:{},register:function(e,t){this._settings[e]=t},get:function(e){var t=this._settings[this.defaultSetting],n=t[e],r=n.split("."),i=window;for(var s=0,o;o=r[s];s+=1)i=i[o];return i}};Config.register("remote",{photoStreamDataSource:"Photos.RemotePhotoStreamDataSource",photoUrlsDataSource:"Photos.RemotePhotoUrlsDataSource",videoUrlsDataSource:"Photos.RemoteVideoUrlsDataSource"}),Config.register("fixtures",{photoStreamDataSource:"Photos.FixturePhotoStreamDataSource",photoUrlsDataSource:"Photos.FixturePhotoUrlsDataSource",videoUrlsDataSource:"Photos.FixtureVideoUrlsDataSource"}),require("config"),Config.defaultSetting="remote",Photos=Core.Object.create({NOWHERE:0,STREAM:1,SLIDESHOW:2,ERROR:3,tabNames:"nowhere stream slideshow".w(),DeviceMode:{Desktop:"desktop",Mobile:"mobile"},mobileDeviceModeWidthThreshold:660,deviceMode:function(){return B.desktop?this.DeviceMode.Desktop:Core.windowSize.width<=this.mobileDeviceModeWidthThreshold?this.DeviceMode.Mobile:this.DeviceMode.Desktop}.property(),dataSource:null,trace:NO}),Photos.EnvironmentControllerDelegate={createHandlerForEnvController:function(e){var t=null;Photos.V2EnvironmentHandler.detect()?t=Photos.V2EnvironmentHandler:Photos.V3EnvironmentHandler.detect()&&(t=Photos.V3EnvironmentHandler);if(!t)return null;var n=t.create({controller:e,urlTokenManager:this._urlTokenManagerForEnvironmentHandler()});return n.setup(),n},_urlTokenManagerForEnvironmentHandler:function(){var e=Photos.UrlTokenManager;return B.windows&&B.version===8&&(e=Photos.SessionUrlTokenManager),e.create()}},require
("utils/environment/controller_delegate"),Photos.environmentController=Core.Object.create(Photos.EnvironmentControllerDelegate,{delegate:null,delegateValue:function(){return this.delegate||this}.property(),handler:function(){return this._handler||(this._handler=this.get("delegateValue").createHandlerForEnvController(this)),this._handler}.property(),hasValidEnvironment:function(){return!!this.get("handler")}.property(),sharedStreamURLGenerator:function(){var e=this.get("handler"),t=this._urlGenerator;return t||(t=this._urlGenerator=e.createSharedStreamURLGenerator()),t}.property(),sharedStreamJSONGenerator:function(){var e=this.get("handler"),t=this._jsonGenerator;return t||(t=this._jsonGenerator=e.createSharedStreamJSONGenerator()),t}.property(),photoGuid:function(e,t){return t!==undefined&&this.get("handler").set("photoGuid",t),this.get("handler").get("photoGuid")}.property(),version:function(){return this.get("handler").get("version")}.property(),startDetectingExternalEnvironmentChanges:function(){this.get("handler").startDetectingExternalEnvironmentChanges()},stopDetectingExternalEnvironmentChanges:function(){this.get("handler").stopDetectingExternalEnvironmentChanges()},notifyEnvironmentChanges:function(e){this._urlGenerator=null,this._jsonGenerator=null,this.trigger("externalEnvironmentChangesDetected",e)}}),Photos.ErrorType={NotFound:"not-found",Unexpected:"unexpected",Unavailable:"unexpected",HighDemand:"unexpected"},Photos.errorController=Core.Object.create({errorType:null,title:null,caption:null}),Photos.errorCatcherController=Core.Object.create({errorCatchShouldReportError
:function(e,t){return BUILD_INFO.buildMode!=="debug"},errorCatcherGetDetailedInformationForError:function(e,t){var n=Photos.photosController.photos;return{appCurrentState:Photos.stateManager.currentState.get("fullPathName"),streamToken:Photos.environmentController.getPath("handler.token"),streamPhotosCount:n?n.length:"---"}},errorCatcherReportErrorFeedback:function(e,t,n){Core.Request.send({type:"POST",url:"https://feedbackws.icloud.com/reportError",body:body})}}),Photos.PhotoDerivativesUpdaterDelegate={isPhotoDerivativesUpdaterDelegate:YES,isMixin:YES,photoDerivativesUpdaterWillStartUpdateForPhotos:function(e,t){this._photosToUpdate=t,this._exhaustedAllPhotos=NO},photoDerivativesUpdaterDidFinishUpdate:function(e){this._exhaustedAllPhotos=YES},photoDerivativesUpdaterDidErrorOnUpdate:function(e){this._exhaustedAllPhotos=YES},photoDerivativesUpdaterWillUpdatePhotos:function(e,t){},photoDerivativesUpdaterDidUpdatePhotos:function(e,t){},photoDerivativesUpdaterNextBatchOfPhotosToUpdate:function(e){return this._exhaustedAllPhotos?null:(this._exhaustedAllPhotos=YES,this._photosToUpdate)},photoDerivativesUpdaterDidCancelUpdate:function(e){}},Random={make:function(e){return e<0&&(e=-e),e<1&&(e=1/e),function(t,n,r,i){var s=Math.sin(Math.PI*e/2.362)*1e4,o;return e=s-Math.floor(s),i=i||r===!0,t||(t=0),!isNaN(r)||(r=1),!isNaN(n)||(n=1),o=(e*(n-t)+t)*r,i?Math.round(o):o}}},function(){var e=3.15,t=2,n=0,r=1;Photos.PhotoRecord=Core.Object.extend({className:"PhotoRecord",timestamp:NaN,width:NaN,height:NaN,derivatives:null,caption:"",importance:null,largestDerivative:null,smallestDerivative:null
,_derivativesDidChange:function(){this.suspendTriggers(),this.trigger("hasExpiredDerivatives"),this.trigger("hasDerivatives"),this.trigger("missingDerivativeUrls"),this._checkForLargestDerivative(),this._checkForSmallestDerivative(),this.resumeTriggers()}.observes("derivatives","init"),id:function(){return this.photoGuid}.property(),isPanoramic:function(){var t=this.width,n=this.height,r=t/n;return t>n&&r>e}.property(),isWideLandscape:function(){var e=this.width,n=this.height,r=e/n;return e>n&&r>t}.property(),isPortrait:function(){return this.get("orientation")===r}.property(),isLandscape:function(){return this.get("orientation")===n}.property(),isVideo:function(){return this.mediaAssetType==="video"}.property(),orientation:function(){return this.width>=this.height?n:r}.property(),hasContributor:function(){return this.contributorFirstName&&this.contributorLastName}.property(),contributor:function(){var e=this._contributor||null;if(!e&&this.get("hasContributor")){var t=this.contributorFirstName,n=this.contributorLastName;e=this._contributor=new Photos.User(t,n)}return e}.property(),hasExpiredDerivatives:function(){var e=this.derivatives,t=(new Date).getTime(),n;for(var r in e){n=e[r];if(n&&n.expiry&&n.expiry<=t)return!0}return!1}.property(),hasDerivatives:function(){var e=this.derivatives;for(var t in e)if(!!e[t])return!0;return!1}.property(),missingDerivativeUrls:function(){if(!this.get("hasDerivatives"))return!1;var e=this.derivatives;for(var t in e)if(!e[t].urlSet)return!0;return!1}.property(),_checkForLargestDerivative:function(){var e=this.derivatives,t=-Infinity,n,r,i,s
;for(i in e)n=parseInt(i,10),i==="original"&&(n=Infinity),t<n&&(t=n,r=i);this.set("largestDerivative",r?e[r]:null)},_checkForSmallestDerivative:function(){var e=this.derivatives,t=Infinity,n,r,i,s;for(i in e)n=parseInt(i,10),i==="original"&&(n=Infinity),t>n&&(t=n,r=i);this.set("smallestDerivative",r?e[r]:null)},expireAllDerivatives:function(){var e=this.derivatives,t;for(var n in e)t=e[n].expiry,e[n].expiry=t-Photos.PhotoRecord.DERIVATIVE_EXPIRY_THRESHOLD},updateIfNeeded:function(e){if(!this.get("missingDerivativeUrls")&&!this.get("hasExpiredDerivatives")){this._photoUpdatedSuccessfully(e);return}var t=Photos.createPhotoDerivativesUpdater();t.updateIfNeeded({target:this,success:function(){this._photoUpdatedSuccessfully(e)},error:function(){this._photoErroredOnUpdated(e)}})},_photoUpdatedSuccessfully:function(e){e&&e.success&&e.success.call(e.successTarget||e.target,this)},_photoErroredOnUpdated:function(e){e&&e.error&&e.error.call(e.errorTarget||e.target,this)}}),Photos.PhotoRecord.DERIVATIVE_EXPIRY_THRESHOLD=36e5,Photos.PhotoRecord.LANDSCAPE=n,Photos.PhotoRecord.PORTRAIT=r}(),Photos.PhotoStreamDataSourceDelegate={dataSourceDidFetchPhotoStream:function(e,t,n){},dataSourceErrorFetchingPhotoStream:function(e,t,n){}},require("random"),require("model/photo_record"),require("mixins/photo_stream_data_source_delegate"),function(){function e(e,t){var n=0,r=0,i=0,s=0,o=t.length,u;for(var a=0;a<o;a++)u=t[a],u.get("isVideo")?r+=1:(n+=1,u.get("isPanoramic")?s+=1:u.get("isWideLandscape")&&(i+=1));Photos.feedbackStatsService.report("fetchedPhotoStreamDataInfo",{totalItemsCount:o,videoCount
:r,photoCount:n,panoramaPhotoCount:s,widePhotoCount:i,multicontributor:e.hasMultiContributor})}Photos.photosController=Core.Object.create(Photos.PhotoStreamDataSourceDelegate,{photos:null,hasMultipleContributors:!1,detectedBetaFeatures:!1,CHANGESET_TRANSFORMATIONS:{photos:[{derivatives_jsontransform2:function(e,t){if(t.width&&t.height)return e;var n;for(var r in e){n=e[r];if(!n)continue;if(!n.width||!n.height)continue;if(parseInt(t.width,10)>parseInt(n.width,10))continue;if(parseInt(t.height,10)>parseInt(n.height,10))continue;t.width=n.width,t.height=n.height}return e},height:"parseInt",width:"parseInt",dateCreated:"parseJSONDate",batchDateCreated:"parseJSONDate",contributorFullName:function(e,t,n,r){n._hasAtLeastOneContributorNamed?n._hasAtLeastOneContributorNamed!==e&&(n.hasMultiContributor=YES):(n._hasAtLeastOneContributorNamed=e,n.hasMultiContributor||(n.hasMultiContributor=NO));if(n.userFirstName&&t.contributorFirstName&&t.contributorFirstName!==n.userFirstName||n.userFirstName&&t.contributorFirstName&&t.contributorFirstName!==n.userFirstName)n.hasMultiContributor=YES;return e},derivatives_jsontransform1:function(e,t,n,r){if(t.mediaAssetType!=="video")return e;n.hasVideos=YES;var i=e.PosterFrame;return delete e.PosterFrame,t.videoDerivatives=e,{1280:i}},derivatives:{"*":{width:"parseInt",height:"parseInt",fileSize:"parseInt",checksum:"obtainUrlSetForChecksum > urlSet"}},videoDerivatives:{"*":{width:"parseInt",height:"parseInt",fileSize:"parseInt"}}}],hasMultiContributor:function(e,t,n,r){if(e)return e;for(var i=0,s=n.photos,o=s.length,u;i<o;i++)if(u=s[i])u.contributorFullName=
u.contributorFirstName=u.contributorLastName=undefined,delete u.contributorFullName,delete u.contributorFirstName,delete u.contributorLastName;return e}},dataSourceDidFetchPhotoStream:function(t,n,r){r&&(this._photosByGuid={},this.photos=[]),Photos.URLResolver.processJSONObject(n,this.CHANGESET_TRANSFORMATIONS),this.set("lastReceivedFeed",n);var i=n.photos,s=this._photosByGuid,o=this.photos,u=0,a=0,f=0,l,c,h,p,d,v;for(l=0;h=i[l];l++){p=s[h.photoGuid];if(p)if(h.deleted)o.remove(s[h.photoGuid]),s[h.photoGuid]=null,a++;else{for(v in h)h.hasOwnProperty(v)&&p.setIfChanged(v,h[v]);f++}else if(!h.deleted){var m=h.derivatives;if(!m)continue;var g=!1;for(v in m){g=!0;break}if(!g)continue;s[h.photoGuid]=p=Photos.PhotoRecord.create(h);if(!(d=o[o.length-1])||d.timestamp>p.timestamp)o.push(p);else{for(c=0;(d=o[c])&&d.timestamp>p.timestamp;c++);o.insertAtIndex(p,c)}u++}}e(n,o);if(u||a||r)this.trigger("photos"),this.set("hasMultipleContributors",n.hasMultiContributor)},findPhotoWithId:function(e){var t=this.photos;for(var n=0,r;r=t[n];n+=1)if(r.get("id")===e)return r}})}(),require("mixins/photo_derivatives_updater_delegate"),require("controllers/photos"),Photos.PhotoDerivativesUpdateController=Core.Object.extend(Photos.PhotoDerivativesUpdaterDelegate,{maxBatchSize:25,photoDerivativesUpdaterWillStartUpdateForPhotos:function(e,t){var n=[];for(var r=0,i;i=t[r];r+=1)(i.get("missingDerivativeUrls")||i.get("hasExpiredDerivatives"))&&n.push(i);this._photosToUpdate=n},photoDerivativesUpdaterNextBatchOfPhotosToUpdate:function(e){var t=this._photosToUpdate;return t.length===0?null:(t.sort(function(e
,t){var n=e.get("importance"),r=t.get("importance");return n>r?-1:r>n?1:0}),t.splice(0,t.length<this.maxBatchSize?t.length:this.maxBatchSize))}}),Photos.windowController=Core.Object.create({minDistanceToBodyBottom:60,minDistanceToBodyTop:300,bodyScrollHeight:0,bodyScrollHeight:0,windowInnerHeight:0,bodyTopVisible:NO,bodyBottomVisible:NO,nearTopOfBody:NO,nearBottomOfBody:NO,distanceToBodyTop:null,distanceToBodyBottom:null,init:function(){this._body=B.mozilla||B.msie?document.documentElement:document.body,arguments.callee.base.apply(this,arguments)},refresh:function(){var e=this._body,t=B.msie===8?document.documentElement.clientHeight:window.innerHeight,n=Core.scrollTop(),r=Core.scrollHeight(),i=r-n,s=Math.abs(i-t);this.suspendTriggers(),this.set("bodyScrollHeight",r),this.set("bodyScrollTop",n),this.set("windowInnerHeight",t),this.set("distanceToBodyTop",n),this.set("distanceToBodyBottom",s),this.set("bodyTopVisible",n===0),this.set("bodyBottomVisible",s===0),this.set("nearTopOfBody",n<=this.minDistanceToBodyTop),this.set("nearBottomOfBody",s<=this.minDistanceToBodyBottom),this.trigger("windowChanged"),this.resumeTriggers()}.observes("init","window.Core.windowScroll","window.Core.windowSize")}),require("controllers/window"),Photos.streamPhotoGroupBlockViewsController=Core.Object.create({views:[],addView:function(e){this.views.push(e)}}),Photos.scrollTracker=Core.Object.create({active:NO,scrollSpeed:0,init:function(){this._body=B.mozilla||B.msie?document.documentElement:document.body,this._sampleSet=new Array(10),this.reset(),arguments.callee.base.apply(this,arguments)},reset:
function(){var e=this._lastScrollMetric,t=this._currentScrollMetric;e||(e=this._lastScrollMetric={}),t||(t=this._currentScrollMetric={}),e.time=0,e.distance=0,t.time=0,t.distance=0;var n=this._sampleSet,r=n.length;for(var i=0;i<r;i+=1)n[i]=null;this._sampleSetMarker=0,this._ticks=0,this._timerHandle&&clearTimeout(this._timerHandle),this._timerHandle=null},refresh:function(){if(!this.active)return;this._ticks+=1;var e=Core.scrollTop(),t=this._lastScrollMetric,n=this._currentScrollMetric;t.time=n.time,t.distance=n.distance,n.time=Browser.msie===8?(new Date).getTime():Date.now(),n.distance=e;var r=n.time-t.time,i=Math.abs(n.distance-t.distance),s=r>0?Math.floor(i/(r/1e3)):0,o=this._sampleSet,u=o.length,a=this._sampleSetMarker;s>0&&(o[a]=s,this._sampleSetMarker=(a+1)%u);var f=0,l=0;for(var c=0;c<u;c+=1){if(!o[c])break;l+=1,f+=o[c]}var h=l>0?Math.floor(f/l):0;this.set("scrollSpeed",h),h>0&&this._tryTrackingScrollSpeed()}.observes("window.Core.windowScroll"),_tryTrackingScrollSpeed:function(){this._timerHandle||(this._markedTicks=this._ticks,this._timerHandle=setTimeout(this._trackScrollSpeed,250))},_trackScrollSpeed:function(){var e=Photos.scrollTracker;e._timerHandle=null;var t=e._markedTicks,n=e._ticks;t===n?(e.reset(),e.set("scrollSpeed",0)):e.refresh()}}),require("utils/scroll_tracker"),Photos.photoGridItemImageViewControllers=Core.Object.create({controllers:[],photoDerivativesUpdater:function(){return this._updater||(this._updater=Photos.createPhotoDerivativesUpdater({delegate:Photos.PhotoDerivativesUpdateController.create()})),this._updater}.property(),addController:function(
e){this.controllers.push(e)},removeController:function(e){var t=this.controllers,n=t.indexOf(e);n>=0&&t.splice(n,1)},resumeLoadingImagesIfNeeded:function(){var e=this.controllers,t=this.get("photoDerivativesUpdater");for(var n=0,r;r=e[n];n+=1){if(r.get("hasAllRequiredImagesLoaded"))continue;r.refresh(),r.get("requiresPhotoDerivativesUpdated")?t.addPhoto(r.get("photo")):r.resumeImageLoadingIfNeeded()}t.updateIfNeeded()}}),Photos.photoGridItemViewsController=Core.Object.create({items:[],addPhotoGridItemView:function(e){this.items.push(e)},removePhotoGridItemView:function(e){this.items.remove(e)}}),function(){var e=Photos.Workspace={},t=e.DisplayWidthStrategy={isMixin:YES,isDisplayWidthStrategy:YES};t.mobile=Core.Object.create(t,{widthForWindowSize:function(e){return e.width-2}}),t.desktop=Core.Object.create(t,{usingHighResDevice:function(){return window.devicePixelRatio===2}.property(),widthForWindowSize:function(e){return e.width-20}}),Photos.WorkspaceControllerDelegate={getDisplayStrategyForWorkspaceController:function(e){var t=Photos.Workspace.DisplayWidthStrategy;switch(this.get("deviceMode")){case Photos.DeviceMode.Desktop:return t.desktop;case Photos.DeviceMode.Mobile:return t.mobile}}},Photos.workspaceController=Core.Object.create(Photos.WorkspaceControllerDelegate,{deviceModeBinding:"from:window.Photos.deviceMode",delegate:null,delegateValue:function(){return this.delegate||this}.property(),displayWidthStrategyValue:function(){if(!this._displayWidthStrategy){var e=this.get("delegateValue");this._displayWidthStrategy=e.getDisplayStrategyForWorkspaceController(this)}return this
._displayWidthStrategy}.property(),computeDisplayWidth:function(){var e=this.get("displayWidthStrategyValue").widthForWindowSize(Core.windowSize);return this.setIfChanged("displayWidth",Math.floor(e))}.observes("init","window.Core.windowSize")})}(),function(){var e=function(){this.brt=null,this.depth=0,this.range=new Photos.Range,this.parentNode=null,this.childNodes=[],this.items=[]};e.prototype={adjustRange:function(e,t){this.range.start=e,this.range.end=t;var n=t-e,r=this.childNodes,i=r.length,s=Math.floor(n/i);for(var o=0,u;u=r[o];o+=1)u.adjustRange(e,o<i-1?e+s-1:t),e=u.range.end+1},addItem:function(e){if(!this.range.containsRange(e[this.brt.itemRangeKey]))return!1;var t=this.childNodes;for(var n=0,r;r=t[n];n+=1)if(r.addItem(e))return!0;return this.items.push(e),!0},removeAllItems:function(){this.items.length=0;var e=this.childNodes;for(var t=0,n;n=e[t];t+=1)n.removeAllItems()},findItemsIntersectingRange:function(e){var t=[],n=this.items,r=this.childNodes,i,s,o,u=this.brt.itemRangeKey;if(!e.intersectsRange(this.range))return t;for(i=0;s=n[i];i+=1)e.intersectsRange(s[u])&&t.push(s);for(i=0;o=r[i];i+=1)n=o.findItemsIntersectingRange(e),t=t.concat(n);return t},_createChildNodes:function(){if(this.depth===this.brt.depth)return;var t=this.childNodes;for(var n=0;n<2;n+=1){var r=new e;r.brt=this.brt,r.depth=this.depth+1,r.parentNode=this,t.push(r)}}},Photos.BinaryRangeTree=Core.Object.extend({depth:0,rangeStart:0,rangeEnd:0,itemRangeKey:"range",init:function(){arguments.callee.base.apply(this,arguments),this._rootNode=new e,this._rootNode.brt=this,this.adjustRange(this.rangeStart
,this.rangeEnd)},adjustRange:function(e,t){this.rangeStart=e,this.rangeEnd=t;var n=this._rootNode;n.adjustRange(e,t)},addItem:function(e){this._rootNode.addItem(e)},removeAllItems:function(){this._rootNode.removeAllItems()},findItemsIntersectingRange:function(e){return this._rootNode.findItemsIntersectingRange(e)}})}(),Photos.Range=function(e,t){this.start=e||0,this.end=t||0},Photos.Range.prototype={adjust:function(e,t){this.start=e,this.end=t},containsValue:function(e){return e>=this.start&&e<=this.end},intersectsRange:function(e){return this.containsValue(e.start)||this.containsValue(e.end)||e.containsValue(this.start)||e.containsValue(this.end)},containsRange:function(e){return this.containsValue(e.start)&&this.containsValue(e.end)},toString:function(){return"[Range: start = %@, end = %@]".fmt(this.start,this.end)}},require("controllers/photo_grid_item_views"),require("controllers/workspace"),require("utils/binary_range_tree"),require("utils/range"),function(){var e=function(e,t){this.value=e,this.range=t},t=25,n=window.screen.height,r=B.mozilla||B.msie?document.documentElement:document.body;Photos.StreamItemsVisibilityControllerDelegate={visibilityControllerGetItems:function(e){return this.items},visibilityControllerResetItem:function(e,t){t.setIfChanged("showContent",!1)},visibilityControllerRangeForItem:function(e,t){var n=t.getAbsoluteTop(),r=n+t.height;return new Photos.Range(n,r)},visibilityControllerShouldUpdateVisibleItemsForViewportRange:function(e,t){return!0},visibilityControllerBeginUpdatingVisibleItems:function(e){},visibilityControllerEndUpdatingVisibleItems
:function(e){},visibilityControllerGetVisibleRangeForViewPortRange:function(e,t){var n=t.start,r=t.end;return new Photos.Range(n,r)},visibilityControllerGetStartToleranceForVisibleRange:function(e,t){return 0},visibilityControllerGetEndToleranceForVisibleRange:function(e,t){return 0},visibilityControllerUpdateItemInsideVisibleRegion:function(e,t){t.setIfChanged("showContent",!0)},visibilityControllerUpdateItemOutsideVisibleRegion:function(e,t){t.setIfChanged("showContent",!1)}},Photos.photoGridItemsVisibilityController=Core.Object.create(Photos.StreamItemsVisibilityControllerDelegate,{itemsBinding:"hard:from:Photos.streamPhotoGroupBlockViewsController.views",delegate:null,visibleItems:function(){var e=this._currentlyVisibleItems,t=[];if(e)for(var n in e)t.push(e[n]);return t}.property(),delegateValue:function(){return this.delegate||this}.property(),init:function(){arguments.callee.base.apply(this,arguments),this._brt=null,this._visibleRange=new Photos.Range,this._visibleScrollRange=new Photos.Range,this._viewPortRange=new Photos.Range,this._currentlyVisibleItems=null},reset:function(e){var t=this;setTimeout(function(){t._doReset(),e&&e()})},_doReset:function(){this._visibleRange.adjust(0,0),this._visibleScrollRange.adjust(0,0),this._viewPortRange.adjust(0,0),this._currentlyVisibleItems=null;var e=this.get("delegateValue"),t=e.visibilityControllerGetItems(this);for(var n=0,r;r=t[n];n+=1)e.visibilityControllerResetItem(this,r);this._setupBinaryRangeTree(),this.update()},update:function(){if(!this._brt)return;var e=this.get("delegateValue"),t=B.msie===8?r.clientHeight:window.innerHeight
,n=Core.scrollTop(),i=Core.scrollHeight(),s=this._viewPortRange,o=this._visibleScrollRange,u=this._visibleRange,a=n,f=n+t;s.start=a>=0?a:0,s.end=f<=i?f:i;if(o.containsRange(s))return;if(!e.visibilityControllerShouldUpdateVisibleItemsForViewportRange(this,s))return;e.visibilityControllerBeginUpdatingVisibleItems(this),u=u=e.visibilityControllerGetVisibleRangeForViewPortRange(this,s),u.start<0&&(u.start=0),u.end>i&&(u.end=i);var l=e.visibilityControllerGetStartToleranceForVisibleRange(this,u),c=e.visibilityControllerGetEndToleranceForVisibleRange(this,u);a=u.start+l,f=u.end-c,f<a&&(a=u.start,f=u.end),o.start=a>s.start?s.start:a,o.end=f<s.end?s.end:f;var h=this._brt.findItemsIntersectingRange(u),p={},d=this._currentlyVisibleItems;for(var v=0,m;m=h[v];v+=1){var g=m.value;e.visibilityControllerUpdateItemInsideVisibleRegion(this,g),p[g.coreGuid]=g}if(d)for(var y in d)p[y]||e.visibilityControllerUpdateItemOutsideVisibleRegion(this,d[y]);this._currentlyVisibleItems=p,e.visibilityControllerEndUpdatingVisibleItems(this)},_setupBinaryRangeTree:function(){var n=this.get("delegateValue");s=n.visibilityControllerGetItems(this);var i=r,s=this.items||[],o=s.length,u=this._brt;u?(u.adjustRange(0,Core.scrollHeight()),u.removeAllItems()):this._brt=u=Photos.BinaryRangeTree.create({rangeStart:0,rangeEnd:Core.scrollHeight(),depth:o>t?Math.ceil(Math.log(o/t)/Math.log(2)):0});for(var a=0,f;f=s[a];a+=1){var l=n.visibilityControllerRangeForItem(this,f);u.addItem(new e(f,l))}}})}(),require("controllers/photos"),function(){function e(e){var t=e.get("groups"),n=t.length;if(n===0)return;Photos.feedbackStatsService
.report("photoGroupsInfo",{count:n})}Photos.photoGroupsController=Core.Object.create({photosBinding:"hard:from:Photos.photosController.photos",groups:null,computeGroupsFromPhotos:function(){var t={},n=[],r=this.photos;if(!r)return this.set("groups",[]);var i=r.length,s,o,u,a;for(a=0;a<i;a++)s=r[a],o=s.batchGuid,u=t[o],u||(u=Photos.PhotoGroup.create({dateCreated:s.batchDateCreated}),t[o]=u,n.push(u)),u.addPhoto(s);var f=n.length;for(a=0;a<f;a++)u=n[a],u.sortPhotos();this.set("groups",n.sort(this._compareGroupDateCreated).reverse()),e(this)}.observes("photos"),_compareGroupDateCreated:function(e,t){return e.dateCreated<t.dateCreated?-1:e.dateCreated>t.dateCreated?1:0}})}(),require("controllers/photos"),Photos.sessionInfoController=Core.Object.create({streamTitle:"",userPhotoUrl:null,user:null,updateValuesFromFeed:function(){var e=Photos.photosController.lastReceivedFeed,t=e.userFirstName,n=e.userLastName,r=new Photos.User(t,n);this.setIfChanged("streamTitle",e.streamName),this.setIfChanged("user",r)}.observes("Photos.photosController.lastReceivedFeed"),updateBrowserTitle:function(){var e=this.get("streamTitle"),t;e?t="_App.Title.Given".loc(e):t="_App.Title.Default",document.title=t}.observes("streamTitle")}),Photos.sortedPhotosController=Core.Object.create({groupsBinding:"hard:from:Photos.photoGroupsController.groups",photos:[],sortPhotos:function(){var e=this.groups,t=e.length,n=[],r,i,s,o,u;for(o=0;o<t;o++){r=e[o],i=r.photos,s=i.length;for(u=0;u<s;u++)n.push(i[u])}this.set("photos",n)}.observes("groups")}),require("controllers/sorted_photos"),require("controllers/workspace")
,Photos.SlideshowControllerDelegate={getPhotosUpdaterForSlideshowController:function(e){return Photos.createPhotoDerivativesUpdater({delegate:Photos.PhotoDerivativesUpdateController.create()})}},function(){function n(){Photos.feedbackStatsService.report("appEventInfo",{event:"playSlideshow"})}function r(){Photos.feedbackStatsService.report("appEventInfo",{event:"playVideo"})}function i(){Photos.feedbackStatsService.report("appEventInfo",{event:"errorPlayingVideo"})}Photos.slideshowController=CoreImage.SlideshowController.create(CoreImage.SlideshowViewDelegate,Photos.SlideshowControllerDelegate,{itemSetBinding:"from:Photos.sortedPhotosController.photos",itemViewsScopeLookAheadCount:1,itemViewsScopeLookBehindCount:1,delegate:null,init:function(){this._itemViews={},this._itemToViewsMap={},this._imageViewControllers=[],this._itemViewToImageViewController={},this._unsupportedVideoItems={},arguments.callee.base.apply(this,arguments)},_adjustItemViewsScope:function(){Photos.get("deviceMode")===Photos.DeviceMode.Mobile?(this.set("itemViewsScopeLookAheadCount",5),this.set("itemViewsScopeLookBehindCount",3)):(this.set("itemViewsScopeLookAheadCount",15),this.set("itemViewsScopeLookBehindCount",5))}.observes("init"),delegateValue:function(){return this.delegate||this}.property(),photosUpdaterValue:function(){if(!this._photosUpdater){var e=this.get("delegateValue");this._photosUpdater=e.getPhotosUpdaterForSlideshowController(this)}return this._photosUpdater}.property(),itemSetCount:function(){var e=this.get("itemSet");return e?e.length:0}.property(),canPlay:function(){return this.get("itemSetCount"
)>1}.property(),canShowNextItem:function(){return this.get("itemSetCount")>1}.property(),canShowPrevItem:function(){return this.get("itemSetCount")>1}.property(),canDownloadCurrentItem:function(){var e=this.get("currentItem");return e&&!e.get("missingDerivativeUrls")}.property(),stopShowOnEnterExit:function(){this.stopShow()}.observes("Photos.workspaceController.nowShowing"),_pssc_itemSetDidChange:function(){this.trigger("canPlay"),this.trigger("canShowNextItem"),this.trigger("canShowPrevItem")}.observes("itemSet"),_pssc_currentItemChanged:function(){this.trigger("canDownloadCurrentItem");var e=this.get("currentItem"),t=this;this._pssc_currentItemDerivativesChanged||(this._pssc_currentItemDerivativesChanged=function(){t.trigger("canDownloadCurrentItem")});var n=this._pssc_currentItemDerivativesChanged;this._prevCurrentItem&&this._prevCurrentItem.unlisten("derivatives",n),e&&e.listen("derivatives",n),this._prevCurrentItem=e}.observes("currentItem","itemSet"),addImageViewController:function(e){var t=e.slideshowItemView;this._imageViewControllers.push(e),this._itemViewToImageViewController[t.coreGuid]=e},removeImageViewController:function(e){var t=this._imageViewControllers,n=t.indexOf(e),r=e.slideshowItemView;n>=0&&t.splice(n,1),delete this._itemViewToImageViewController[r.coreGuid]},imageViewControllerForSlideshowItemView:function(e){return this._itemViewToImageViewController[e.coreGuid]},slideshowViewItemIsVideo:function(e,t){return t.get("isVideo")},slideshowViewCreateItemViewForItem:function(e,t){if(!t)return null;var n=this._itemToViewsMap,r=n[t.coreGuid];return r?r:(r=Photos
.SlideshowItemView.create({value:t,owner:e,originalItem:t,slideshowController:this}),n[t.coreGuid]=r,r)},slideshowViewDidChangeCurrentItemView:function(e,t){var n=e.get("itemViewsInScope"),r=this.get("photosUpdaterValue");for(var i=0,s,o;s=n[i];i+=1)o=this.imageViewControllerForSlideshowItemView(s),o.get("requiresPhotoDerivativesUpdated")?r.addPhoto(o.photo):o.updateImageViewIfNeeded();r.updateIfNeeded();var u=e.currentItem;this.get("isPlaying")&&(u.get("isVideo")&&!this._unsupportedVideoItems[u.coreGuid]?B.mobile?this.scheduleNext(1.5):this.cancelNextScheduledItem():this.scheduleNext()),u&&u.get("isVideo")&&e.prepareVideoForItem(u)},slideshowViewDidRemoveItemViewFromScopeForItem:function(e,t,n){var r=this.imageViewControllerForSlideshowItemView(t);r.updateImageViewIfNeeded()},slideshowViewCannotSupportVideoForItem:function(e,t){var n=this._itemToViewsMap[t.coreGuid],r;this._unsupportedVideoItems[t.coreGuid]=t,Photos.get("deviceMode")===Photos.DeviceMode.Mobile?this._applyStandardErrorViewToItemView(n,"_Error.CanNotPlayVideo".loc()):B.winXP||B.msie<=8?this._applyStandardErrorViewToItemView(n,"_Error.CanNotPlayVideo".loc()):this._applyQuickTimeErrorViewToItemView(n)},slideshowViewDidSuccessfullyPrepareVideoForItem:function(e,t){var n=this._itemToViewsMap[t.coreGuid];if(!n||n.errorView)return;var i=n.playButton;i||(i=n.playButton=this._createPlayButtonViewForItemView(e),i.action=function(){r(),e.playVideoForItem(t)}),i.append(n)},slideshowViewDidFailToPrepareVideoForItem:function(e,t){this._unsupportedVideoItems[t.coreGuid]=t,this.get("isPlaying")&&this.scheduleNext();var n=this
._itemToViewsMap[t.coreGuid];this._applyStandardErrorViewToItemView(n,"_Error.CanNotPlayVideo".loc())},slideshowViewShouldAutoPlayVideoForItem:function(e,t){var n=!0;return this._unsupportedVideoItems[t.coreGuid]&&(n=!1),this.get("isPlaying")&&!B.mobile&&n},slideshowViewDidStartPlayingVideoForItem:function(e,t){this.get("isPlaying")&&B.mobile&&this.cancelNextScheduledItem()},slideshowViewDidEndPlayingVideoForItem:function(e,t){this.get("isPlaying")&&this.scheduleNext(.15)},slideshowViewDidFailToPlayVideoForItem:function(e,t){i();var n=this._itemToViewsMap[t.coreGuid],r;Photos.get("deviceMode")===Photos.DeviceMode.Mobile?r="_Error.Short.FailureTryingToPlayVideo".loc():r="_Error.FailureTryingToPlayVideo".loc(),this._applyStandardErrorViewToItemView(n,r),this.get("isPlaying")&&this.scheduleNext()},slideshowViewVideoDidCloseFullscreenForItem:function(e,t){Photos.get("deviceMode")===Photos.DeviceMode.Mobile&&(e.stopShowingVideoViewIfNeeded(),this.get("isPlaying")&&this.scheduleNext())},slideshowItemViewDidSuccessfullyLoadImageForRep:function(e,t){Photos.page.slideshowView.prepareVideoForItem(e.value)},slideshowItemViewDidFailToLoadImageForRep:function(e,t){},didStartShow:function(){n();var e=this.currentItem;e&&e.get("isVideo")?B.mobile?this.scheduleNext(1.5):Photos.page.slideshowView.playVideoForItem(e)||this.scheduleNext(.15):this.scheduleNext(.15)},didStopShow:function(){var e=this.currentItem;e&&e.get("isVideo")&&Photos.page.slideshowView.stopShowingVideoViewIfNeeded()},didSelectNextItem:function(e){},didSelectPreviousItem:function(e){},_applyStandardErrorViewToItemView:function(
e,t){var n=this;this._applyErrorViewToItemView(e,function(){return n._createStandardErrorViewForItemView(e,t)})},_applyQuickTimeErrorViewToItemView:function(e){var t=this;this._applyErrorViewToItemView(e,function(){return t._createQuicktimeErrorViewForItemView(e)})},_applyErrorViewToItemView:function(e,t){if(!e||e.errorView)return;var n=t();n.append(e),e.errorView=n,e.layer.className+=" disabled",e.playButton&&e.playButton.remove()},_createPlayButtonViewForItemView:function(e){return Core.ButtonView.create({owner:e,actionDelay:0,classNames:"play-button".w(),ariaRole:"button",ariaLabel:"_Accessibility.PlayVideo".loc(),allowEventPropogation:!1})},_createStandardErrorViewForItemView:function(t,n){return e.create({owner:t,value:n})},_createQuicktimeErrorViewForItemView:function(e){return t.create({owner:e})}});var e=Core.View.extend({rootHTML:'<div class="slideshow-item-message basic"><p class="text"></p></div>',textElemElement:"layer.firstChild",value:null,_renderDidTrigger:function(){var e=this.layer,t=Photos.get("deviceMode");e.className+=t===Photos.DeviceMode.Mobile?" mobile":" desktop"}.observes("render"),_valueDidChange:function(){var e=this.textElem,t=this.value;e&&(e.innerHTML=t)}.observes("render","value")}),t=Core.View.extend({rootHTML:'<div class="slideshow-item-message quicktime"><p class="header">'+"_Error.MissingQuicktime".loc()+"</p>"+'<p class="link">'+'<a href="%@" target="_blank">'.fmt("_URL.DownloadQuicktime".loc())+"_Error.DownloadQuicktime".loc()+"</a>"+"</p>"+"</div>",_renderDidTrigger:function(){$(this.layer).find("a").click(function(e){Core.stopPropagatingEvent
(e),window.open("_URL.DownloadQuicktime".loc(),"_blank")})}.observes("render")})}(),Photos.StreamViewDelegate={isMixin:YES,isStreamViewDelegate:YES,deviceMode:null,photoBatchViewExampleForStreamView:function(e){return Photos.PhotoBatchView},streamViewDidCreatePhotoBatchView:function(e,t){},interGroupSpacingForStreamView:function(e){switch(this.get("deviceMode")){case Photos.DeviceMode.Desktop:return 10;case Photos.DeviceMode.Mobile:return 0}},topForStreamView:function(e){switch(this.get("deviceMode")){case Photos.DeviceMode.Desktop:return 57;case Photos.DeviceMode.Mobile:return 42}},bottomForStreamView:function(e){var t=e.get("photoGroups");return!t||t.length===0?70:null}},require("mixins/stream_view_delegate"),Photos.streamViewController=Core.Object.create(Photos.StreamViewDelegate,{className:"StreamViewController",view:null,deviceModeBinding:"from:window.Photos.deviceMode",addPhotoGridBlocksToStreamView:function(e){this.view.addPhotoGridBlocks(e)}}),require("controllers/window"),require("controllers/stream_view"),Photos.streamPageLoadingFooterViewController=Core.Object.create({view:null,active:NO,viewDidLoad:function(e){this.set("view",e)},_updateViewIfNeeded:function(){var e=this.view,t=this.active,n=Photos.windowController.distanceToBodyBottom;e&&e.setIfChanged("active",t&&n<200)}.observes("active","window.Photos.windowController.distanceToBodyBottom")}),require("controllers/stream_view"),Photos.streamPageViewController=Core.Object.create({view:null,showFooter:YES,showEmptyStreamMessage:NO,lastPhotoGridBlockLoadedBinding:"from:Photos.streamViewController.lastBlockLoaded"
,_updateLoadingState:function(){this.setIfChanged("loading",!this.lastPhotoGridBlockLoaded)}.observes("lastPhotoGridBlockLoaded","loading")}),Photos.mixin({createPhotoStreamDataSource:function(e){var t=Config.get("photoStreamDataSource"),n=Photos.environmentController;return t.create(e||{},{urlGenerator:n.get("sharedStreamURLGenerator"),jsonGenerator:n.get("sharedStreamJSONGenerator")})},createPhotoUrlsDataSource:function(e){var t=Config.get("photoUrlsDataSource"),n=Photos.environmentController;return t.create(e||{},{urlGenerator:n.get("sharedStreamURLGenerator"),jsonGenerator:n.get("sharedStreamJSONGenerator")})},createVideoUrlsDataSource:function(e){var t=Config.get("videoUrlsDataSource");return t.create(e||{})},createPhotoDerivativesUpdater:function(e){return Photos.PhotoDerivativesUpdater.create(e||{},{dataSource:Photos.createPhotoUrlsDataSource()})},getUrlsForSingleAssetRecord:function(e,t,n,r){var i=Photos.createPhotoUrlsDataSource();this._getUrlsForSingleAssetRecordUsingDataSource(e,t,n,r,i)},_getUrlsForSingleAssetRecordUsingDataSource:function(e,t,n,r,i){var s=e.photoGuid,o=this;Core.Request.send({type:"POST",url:i.urlGenerator.generateURLForPath("webasseturls"),body:this._photoRecordToJSONForWebAssetUrls(e,i.jsonGenerator,r),onSuccess:function(r){var i=o.processJSONWebAssetURLsForPhotoRecord(r.responseObject,e);i?t&&t():n&&n()}.observes("success"),onError:function(e){n&&n()}.observes("error"),onError330:function(s){var u=JSON.parse(s.responseText);i.urlGenerator.set("host",u["X-Apple-MMe-Host"]),o._getUrlsForSingleAssetRecordUsingDataSource(e,t,n,r,i),this.stopError
()}.observes("error330")})},_photoRecordToJSONForWebAssetUrls:function(e,t,n){var r=e.photoGuid,i=t.generateJSON(),s,o;i.photoGuids=[r];if(n){i.derivatives={},i.derivatives[r]=[];if(n==="video"&&e.videoDerivatives)for(o in e.videoDerivatives){s=e.videoDerivatives[o];if(!s)continue;i.derivatives[r].push(s.checksum)}}return i},processJSONWebAssetURLsForPhotoRecord:function(e,t){Photos.URLResolver.processJSONObject(e,{items:{"*":function(e,t,n,r,i,s){return e.urlSet=Photos.URLResolver.computeUrlSetHash(e,n),e}}});var n=0,r;for(r in t.derivatives)n+=this._saveUrlSetToDerivative(t.derivatives[r],e);for(r in t.videoDerivatives)n+=this._saveUrlSetToDerivative(t.videoDerivatives[r],e);return n===0?!1:!0},_saveUrlSetToDerivative:function(e,t){return!e||!t||!t.items||!t.items[e.checksum]?0:(e.urlSet=t.items[e.checksum].urlSet,e.urls=e.urlSet.urls,e.url=null,1)}}),require("mixins/photo_stream_data_source_delegate"),Photos.PhotoStreamDataSource=Core.Object.extend(Photos.PhotoStreamDataSourceDelegate,{delegate:null,delegateValue:function(){return this.delegate||this}.property(),reset:function(){},fetchPhotoStream:function(e){throw"fetchPhotoStream not implemented. Must override."},handleSuccessFetchingPhotoStream:function(e,t,n){var r=this.get("delegateValue");r&&r.dataSourceDidFetchPhotoStream(this,e,t),n&&n.success&&n.success.call(n.successTarget||n.target,e,t,n.params),t?this.trigger("successFetchingInitialPhotoStream",e):this.trigger("successFetchingPhotoStream",e)},handleFailureFetchingPhotoStream:function(e,t,n){var r=this.get("delegateValue");r&&r.dataSourceErrorFetchingPhotoStream
(this,e,t),n&&n.error&&n.error.call(n.errorTarget||n.target,e,t,n.params),t?this.trigger("errorFetchingInitialPhotoStream",e):this.trigger("errorFetchingPhotoStream",e)}}),Photos.PhotoUrlsDataSource=Core.Object.extend({fetchUrlsForPhotoGuids:function(e,t){throw"fetchUrlsForPhotoGuids not implemented. Must override."},cancelFetch:function(){},handleSuccessFetchingPhotoUrls:function(e,t){t&&t.success&&t.success.call(t.successTarget||t.target,e,t.params),this.trigger("successFetchingPhotoUrls",e)},handleErrorFetchingPhotoUrls:function(e,t){t&&t.error&&t.error.call(t.errorTarget||t.target,e,t.params),this.trigger("errorFetchingPhotoUrls",e)}}),Photos.RemoteDataSourceSupport={urlGenerator:null,jsonGenerator:null,handleRedirect:function(e,t){var n=JSON.parse(e.responseText);this.urlGenerator.set("host",n["X-Apple-MMe-Host"]);var r=Array.prototype.slice.call(arguments,2);t.apply(this,r)}},require("data_sources/photo_stream_data_source"),require("mixins/remote_data_source_support"),function(){function e(e,t,n){Photos.feedbackStatsService.report("xhrEventInfo",{event:"webstream",host:e.urlGenerator.get("hostValue"),duration:(new Date).getTime()-t.getTime(),responseStatusCode:n.status,initialStream:e.get("handlingInitialStream")})}Photos.RemotePhotoStreamDataSource=Photos.PhotoStreamDataSource.extend(Photos.RemoteDataSourceSupport,{STREAM_CTAG_KEY:"streamCtag",URL_PATH:"webstream",streamCTag:null,handlingInitialStream:function(){return!this.streamCTag}.property(),reset:function(){this.set("streamCTag",null),this.urlGenerator.reset()},fetchPhotoStream:function(t){var n=this,r=new Date;
Core.Request.send({type:"POST",url:this.urlGenerator.generateURLForPath(this.URL_PATH),body:this._createPhotoStreamJSON(),onSuccess:function(i){e(n,r,i);var s=n.get("handlingInitialStream"),o=i.responseObject;n.handleSuccessFetchingPhotoStream(o,s,t),n.streamCTag=n._extractCtagFromData(o)}.observes("success"),onError330:function(e){n.handleRedirect(e,n.fetchPhotoStream,t),this.stopError()}.observes("error330"),onError:function(i){e(n,r,i);var s=n.get("handlingInitialStream");n.handleFailureFetchingPhotoStream(i,s,t)}.observes("error")})},_createPhotoStreamJSON:function(){var e=this.jsonGenerator.generateJSON();return e[this.STREAM_CTAG_KEY]=this.streamCTag,e},_extractCtagFromData:function(e){return e?e[this.STREAM_CTAG_KEY]:null}})}(),require("data_sources/photo_urls_data_source"),require("mixins/remote_data_source_support"),function(){function e(e,t,n,r){Photos.feedbackStatsService.report("xhrEventInfo",{event:"webasseturls",host:e.urlGenerator.get("hostValue"),duration:(new Date).getTime()-t.getTime(),photoGUIDCount:n.length,responseStatusCode:r.status})}Photos.RemotePhotoUrlsDataSource=Photos.PhotoUrlsDataSource.extend(Photos.RemoteDataSourceSupport,{URL_PATH:"webasseturls",fetchUrlsForPhotoGuids:function(t,n){var r=this,i=new Date;this._request=Core.Request.send({type:"POST",url:this.urlGenerator.generateURLForPath(this.URL_PATH),body:this._createPhotoAssetUrlsJSON(t),onSuccess:function(s){e(r,i,t,s),r.handleSuccessFetchingPhotoUrls(s.responseObject,n)}.observes("success"),onError330:function(e){r.handleRedirect(e,r.fetchUrlsForPhotoGuids,t,n),this.stopError()}.observes("error330"
),onError:function(s){e(r,i,t,s),r.handleErrorFetchingPhotoUrls(s,n)}.observes("error")})},cancelFetch:function(){var e=this._request;e&&e.cancel()},_createPhotoAssetUrlsJSON:function(e){var t=this.jsonGenerator.generateJSON();return t.photoGuids=e,t}})}(),Photos.RemoteVideoUrlsDataSource=Core.Object.extend({processUrlsForValue:function(e,t,n){Photos.getUrlsForSingleAssetRecord(e,t,n,"video")}}),Photos.ActionDispatcher={defaultActionDispatcherTargetKey:"target",dispatchActionForTarget:function(e,t){if(!e)return;e instanceof String&&(e=t[e]||e),t||(t=this.get(this.defaultActionDispatcherTargetKey));var n=Array.prototype.slice.call(arguments,2);n.unshift(this),e.apply(t,n)}},Photos.Handler=Core.Object.extend({isHandler:YES,owner:null,handles:null,action:null,invoke:function(e,t,n){return this.action.apply(this.owner,arguments)}}),require("system/handler"),Photos.HandlerSupport={isMixin:YES,handlerExample:Photos.Handler,_hs_registerHandlers:function(){var e=this._hs_registerHandlerKeys||[];for(var t=0,n,r;n=e[t];t+=1){r=this[n];if(!r.isClass||!r.prototype.isHandler)r=this.handlerExample.extend({handles:[n.replace(/Handler$/,"")],action:r});this.registerHandler(r)}}.observes("init"),"*HandlerOverride":function(e,t,n){if(!e||n==="registerHandler")return e;var r=this.ensureOwn("_hs_registerHandlerKeys")||(this._hs_registerHandlerKeys=[]);return r.push(n),e},getHandlerFor:function(e){var t=this._hs_registeredHandlers;return t&&t[e]},hasHandlerFor:function(e){return!!this.getHandlerFor(e)},tryInvokingHandlerFor:function(e,t,n){var r=this.getHandlerFor(e);return r?r.invoke(e,t,n)!==NO
:NO},registerHandler:function(e){if(!e.isClass||!e.prototype.isHandler)throw"Unable to register an invalid handler for %@".fmt(this);var t=this._hs_registeredHandlers||(this._hs_registeredHandlers={});e=e.create({owner:this});var n=e.handles;for(var r=0,i;i=n[r];r+=1)t[i]=e}},CoreImage.MissingImageSupport._missing_image_iconReps={64:{url:""},128:{url:""},256:{url:""},512:{url:""}},CoreImage.MissingImageSupport._missing_image_backgroundSrc="",Photos.PhotoGridItemImageViewSupport={isMixin:YES,applyTop:NO,applyLeft:NO,applyWidth:NO,applyHeight:NO,photo:null,establishRepsAndRepsWatcher:function(){var e=this.photo;if(!e)return;e.get("missingDerivativeUrls")||this.set("reps",e.get("derivatives"));var t=this.photo,n=t.__watchingDerivativesFor__;n?(n.remove(this),n.push(this)):(n=t.__watchingDerivativesFor__=[this],t.listen("derivatives",function(){for(var e=0,t;t=this.__watchingDerivativesFor__[e];e++)t.set("reps",this.derivatives)}))}.observes("photo","init"),isSmallestSquare:function(){return this.getPath("gridItem.columnWidth")<=2&&this.getPath("gridItem.rowHeight")<=2}.property()},Photos.StateManagerMonitor={isMixin:YES,isStateManagerMonitor:YES,stateManagerStartedStateTransition:function(e){},stateManagerEndedStateTransition:function(e){},stateManagerTransitionInfo:function(e,t){},stateManagerWillEnterState:function(e,t){},stateManagerDidEnterState:function(e,t){},stateManagerWillExitState:function(e,t){},stateManagerDidExitState:function(e,t){},stateManagerWillReenterState:function(e,t){},stateManagerDidReenterState:function(e,t){},stateManagerSentActionHandled:function(e,t,n
){},stateManagerSentActionNotHandled:function(e,t){}},Photos.StreamViewSupport={refresh:function(){this._absoluteTop=null},getAbsoluteTop:function(){var e=this._absoluteTop;return e||(e=this.top+this.owner.getAbsoluteTop()),e}},Photos.User=function(e,t){this.firstName=e,this.lastName=t,this.fullName=e+" "+t},Photos.User.prototype={localizeFullName:function(){return"_FullName".loc({fname:this.firstName,lname:this.lastName})}},Photos.PhotoGroup=Core.Object.extend({photos:null,dateCreated:0,init:function(){arguments.callee.base.apply(this,arguments),this.photos=[]},addPhoto:function(e){e.ownerGroup=this,e.indexInGroup=this.photos.length,this.photos.push(e),this.trigger("photos")},removePhoto:function(e){this.photos.remove(e),this.trigger("photos")},expireAllPhotoDerivatives:function(){for(var e=0,t;t=this.photos[e];e+=1)t.expireAllDerivatives()},sortPhotos:function(){var e=this.photos;if(!e)return;e.sort(this._compareDateCreated),this.trigger("photos")},_compareDateCreated:function(e,t){var n=e.dateCreated,r=t.dateCreated,i=!!e.dateCreated,s=!!t.dateCreated,o=function(e,t){return e.get("id")>t.get("id")?1:e.get("id")<t.get("id")?-1:0};return i&&s?n<r?-1:n>r?1:o(e,t):!i&&!s?o(e,t):i?1:s?1:0},contributor:function(){var e=this.photos;return e.length>0?e[0].get("contributor"):null}.property(),stillPhotoCount:function(){for(var e=0,t=0,n=this.photos,r;r=n[e];e++)(!r.mediaAssetType||r.mediaAssetType==="photo")&&t++;return t}.property("photos"),videoCount:function(){for(var e=0,t=0,n=this.photos,r;r=n[e];e++)r.mediaAssetType==="video"&&t++;return t}.property("photos"),containsOnlyPanoramicPhotos
:function(){var e=!0,t=this.photos,n=t.length,r;for(var i=0;i<n;i++){r=t[i];if(r.get("isVideo")||!r.get("isPanoramic"))e=!1}return e}.property("photos"),itemCount:function(){return this.photos.length}.property("photos")}),Photos.State=Core.Object.extend(Photos.HandlerSupport,{isState:YES,initialSubstate:null,isEnteredState:NO,stateManager:null,parentState:null,substates:null,localName:null,enterCounter:0,exitCounter:0,initialEntry:function(){return this.enterCounter===1}.property(),initialExit:function(){return this.exitCounter===1}.property(),entering:function(){},exiting:function(){},reentering:function(){},doEnter:function(e){this.set("isEnteredState",YES),this.set("enterCounter",this.enterCounter+1),this.entering(e),this.trigger("entering")},doExit:function(e){this.set("isEnteredState",NO),this.set("exitCounter",this.exitCounter+1),this.exiting(e),this.trigger("exiting")},doReentry:function(e){this.reentering(e),this.trigger("reentering")},isCurrentState:function(){return this.stateManager.get("currentState")===this}.property(),"*StateOverride":function(e,t,n){if(!e||!e.isClass)return e;var r=this.ensureOwn("substates")||(this.substates=[]);return r.push(n),e},init:function(){this._registeredSubstates=[],this._registeredSubstatePaths={},arguments.callee.base.apply(this,arguments),this._registerWithParentStates(),this._initializeSubstates()},_initializeSubstates:function(){var e=this.substates,t=this.initialSubstate;if(!e)return;for(var n=0,r,i;i=e[n];n+=1){r=this[i],r=r.create({stateManager:this.stateManager,parentState:this,localName:i.replace("State","")}),e[n]=r,this[
i]=r;if(t===i||t+"State"===i)this.initialSubstate=r}},_registerWithParentStates:function(){var e=this.parentState;while(e)e.registerSubstate(this),e=e.parentState},registerSubstate:function(e){this._registeredSubstates.push(e),this._registeredSubstatePaths[e.pathRelativeTo(this)]=e},pathRelativeTo:function(e){var t=this.localName,n=this.parentState;if(e===this)return t;while(n!==e)t="%@.%@".fmt(n.localName,t),n=n.parentState;return n!==e&&Core.error("invalid relative path from this %@ to %@".fmt(this,e)),t},gotoState:function(e,t){var n=this.getState(e);if(!n){Core.error("%@: Cannot go to state %@. Unable to find state for key".fmt(this,e));return}this.stateManager.gotoState(n,t)},fullPathName:function(){return this._fullPathName||(this._fullPathName=this.pathRelativeTo(this.stateManager.rootState)),this._fullPathName}.property(),ancestorStates:function(){if(!this._ancestorStates){var e=[],t=this.parentState;while(t)e.push(t),t=t.parentState;this._ancestorStates=e}return this._ancestorStates.slice()}.property(),getSubstate:function(e){if(typeof e=="object"&&e.isState)return this._registeredSubstates.indexOf(e)>=0?e:null;var t=this._registeredSubstatePaths,n,r=[];for(n in t){var i=new RegExp("(\\.%@$|^%@$)".fmt(e,e));n.match(i)&&r.push(n)}return r.length===0?null:r.length>1?null:this._registeredSubstatePaths[r[0]]},getState:function(e){if(e===this)return this;if(e instanceof Object&&e.isState)return e;var t=this.getSubstate(e);if(t)return t;var n=this.parentState;return n?n.getState(e):null},toString:function(){return"[State: %@]".fmt(this.get("fullPathName"))}}),Photos.State
.gotoState=function(e){return function(){this.gotoState.apply(this,[e,arguments[1]])}},require("mixins/state_manager_monitor"),Photos.ConsoleStateManagerMonitor=Core.Object.extend(Photos.StateManagerMonitor,{stateManagerStartedStateTransition:function(e){Core.debug("%@: Begin state transition".fmt(e.toString()))},stateManagerEndedStateTransition:function(e){Core.debug("%@: End state transition".fmt(e.toString()))},stateManagerTransitionInfo:function(e,t){t.fromState&&Core.debug("%@: ... from state %@".fmt(e.toString(),t.fromState.toString())),Core.debug("%@: ... to state %@".fmt(e.toString(),t.toState.toString())),t.pivotState&&Core.debug("%@: ... pivot state = %@".fmt(e.toString(),t.pivotState.toString()))},stateManagerWillEnterState:function(e,t){Core.debug("%@: ... entering state %@".fmt(e.toString(),t.toString()))},stateManagerWillExitState:function(e,t){Core.debug("%@: ... exiting state %@".fmt(e.toString(),t.toString()))},stateManagerWillReenterState:function(e,t){Core.debug("%@: ... reentering state %@".fmt(e.toString(),t.toString()))},stateManagerSentActionHandled:function(e,t,n){Core.debug("%@: %@ handled action '%@'".fmt(e.toString(),n.toString(),t))},stateManagerSentActionNotHandled:function(e,t){Core.debug("%@: action '%@' was not handled by any state or the state manager".fmt(e.toString(),t))}}),require("system/state"),require("system/console_state_manager_monitor"),require("mixins/handler_support"),Photos.StateManager=Core.Object.extend(Photos.HandlerSupport,{initialState:null,currentState:null,rootState:null,trace:NO,name:null,monitorExample:Photos.ConsoleStateManagerMonitor
,monitor:function(){return this._monitor||(this._monitor=this.get("monitorExample").create()),this._monitor}.property(),init:function(){arguments.callee.base.apply(this,arguments),this._pendingTasksQueue=[],this.rootState=this._createRootState()},start:function(){if(this._isStarted)return;this._isStarted=YES,this.gotoState(this.rootState)},getState:function(e){return this.rootState.getState(e)},_createRootState:function(){var e={},t=this._rootSubstates;for(var n=0,r,i;i=t[n];n+=1)e[i]=this[i];return Photos.State.create(e,{stateManager:this,isRootState:YES,localName:"__root__",initialSubstate:this.initialState})},"*StateOverride":function(e,t,n){if(!e||!e.isClass)return e;var r=this.ensureOwn("_rootSubstates")||(this._rootSubstates=[]);return r.push(n),e},gotoState:function(e,t){if(!this._isStarted)throw"Cannot go to state %@. Must start state manager".fmt(e);var n=this.getState(e);if(!n)throw"%@ is not a valid state to go to".fmt(e);if(this.get("_isExecutingTask")){this._pendingTasksQueue.push({type:Photos.StateManager.TaskType.GotoState,state:e,context:t});return}this._gotoStateLocked=YES;var r=Photos.StateTransitioner.create({stateManager:this,fromState:this.currentState,toState:n,context:t});r.go(),this._gotoStateLocked=NO,this._executeNextPendingTask()},_executeNextPendingTask:function(){var e=this._pendingTasksQueue.shift();if(!e)return;switch(e.type){case Photos.StateManager.TaskType.GotoState:this.gotoState(e.state,e.context);return;case Photos.StateManager.TaskType.SendAction:this.sendAction(e.key,e.arg1,e.arg2);return;default:throw"Unable to execute next pending task. Unexpected task type"
}},_setupTriggers:function(){var e=this._actionTriggers||{},t=this,n;for(var r=0,i;i=e[r];r+=1)n=function(){var e=arguments.callee._trigger;t.sendAction.call(t,e,arguments[0],arguments[1])},n._trigger=i.replace("Trigger",""),this.listen(this[i],n)}.observes("init"),"*TriggerOverride":function(e,t,n){if(!e)return e;var r=this.ensureOwn("_actionTriggers")||(this._actionTriggers=[]);return r.push(n),e},sendAction:function(e,t,n){if(!this._isStarted)throw"Cannot send action to entered state. Must start state manager";if(this.get("_isExecutingTask")){this._pendingTasksQueue.push({type:Photos.StateManager.TaskType.SendAction,key:e,arg1:t,arg2:n});return}this._sendActionLocked=YES;var r=this.trace,i=this.get("monitor"),s=this.get("currentState"),o;while(s){if(s.tryInvokingHandlerFor(e,t,n)!==NO){o=s;break}s=s.get("parentState")}!o&&this.tryInvokingHandlerFor(e,t,n)!==NO&&(o=this),r&&(o?i.stateManagerSentActionHandled(this,e,o):i.stateManagerSentActionNotHandled(this,e)),this._sendActionLocked=NO,this._executeNextPendingTask()},_isExecutingTask:function(){return!!this._sendActionLocked||!!this._gotoStateLocked}.property(),toString:function(){var e=this.name;return"[StateManager:%@]".fmt(e?e:this.coreGuid)}}),Photos.StateManager.TaskType={GotoState:0,SendAction:1},require("system/state"),Photos.SetupState=Photos.State.extend({initialSubstate:"fetchPhotoStream",fetchPhotoStreamState:Photos.State.extend({entering:function(){var e=Photos.dataSource;e.reset(),e.fetchPhotoStream({target:this,success:this._successFetchingStream,error:this._errorFetchingStream})},_successFetchingStream:function(
){this.gotoState("fetchInitialWebAssetUrls")},_errorFetchingStream:function(e){this.gotoState("error",e)}}),fetchInitialWebAssetUrlsState:Photos.State.extend({entering:function(){var e=Photos.sortedPhotosController.photos.slice(0,25);if(e.length===0){this.gotoState("workspace");return}var t=Photos.createPhotoDerivativesUpdater({delegate:Photos.PhotoDerivativesUpdateController.create()});t.addPhotos(e),t.updateIfNeeded({target:this,success:this._successFetchingUrls,error:this._errorFetchingUrls})},_successFetchingUrls:function(){this.gotoState("workspace")},_errorFetchingUrls:function(e){this.gotoState("error",e)}})}),require("system/state"),function(){var e=Photos.State.extend({errorType:null,title:null,caption:null,entering:function(){var e=Photos.errorController;e.set("errorType",this.errorType),e.set("title",this.title),e.set("caption",this.caption)}});Photos.ErrorState=Photos.State.extend({entering:function(e){window._removeRHTMLSpinner&&window._removeRHTMLSpinner(),Photos.errorPage.set("isAppended",YES);switch(e.status){case 403:case 404:this.gotoState("notFoundError");break;case 503:this.gotoState("unavailableError");break;case 509:this.gotoState("highDemandError");break;case 0:Core.error("Error: Status 0"),Photos.errorPage.set("isAppended",NO);break;default:this.gotoState("unexpectedError")}},exiting:function(){Photos.errorPage.set("isAppended",NO)},unexpectedErrorState:e.extend({errorType:Photos.ErrorType.Unexpected,title:"_ErrorPage.Message.Unexpected.Title".loc(),caption:"_ErrorPage.Message.Unexpected.Caption".loc()}),notFoundErrorState:e.extend({errorType:Photos.ErrorType
.NotFound,title:"_ErrorPage.Message.NotFound.Title".loc(),caption:"_ErrorPage.Message.NotFound.Caption".loc()}),unavailableErrorState:e.extend({errorType:Photos.ErrorType.Unavailable,title:"_ErrorPage.Message.Unavailable.Title".loc(),caption:"_ErrorPage.Message.Unavailable.Caption".loc()}),highDemandErrorState:e.extend({errorType:Photos.ErrorType.HighDemand,title:"_ErrorPage.Message.HighDemand.Title".loc(),caption:"_ErrorPage.Message.HighDemand.Caption".loc()})})}(),require("system/state"),function(){function e(e){Photos.feedbackStatsService.report("appEventInfo",{event:"appModeChanged",mode:"stream"})}function n(){var e=t,n=Photos.photoGridItemsVisibilityController,r=n.get("items"),i=n.get("visibleItems"),s=i.length,o=0,u;for(var a=0;a<s;a++)u=i[a],u._reportedStats||(o=r.indexOf(u),o>t&&(t=o),u._reportedStats=!0);t>e&&t>-1&&Photos.feedbackStatsService.report("streamVisibilityInfo",{blocksCount:Photos.streamPhotoGroupBlockViewsController.views.length,greatestVBI:t})}Photos.StreamState=Photos.State.extend({init:function(){var e=this;this._windowSizeListener=function(){e._windowSizeDidChange()},this._scrollSpeedListener=function(t,n){e._scrollSpeedDidChange()},arguments.callee.base.apply(this,arguments)},entering:function(){e(this);var t=Photos.photoGroupsController.groups;this.get("initialEntry")&&Photos.page.streamView.addPhotoGroups(t),Photos.workspaceController.setIfChanged("nowShowing",Photos.STREAM),Photos.scrollTracker.set("active",YES),Core.listen("windowSize",this._windowSizeListener),Photos.scrollTracker.listen("scrollSpeed",this._scrollSpeedListener),this._windowSizeDidChange
()},exiting:function(){Core.unlisten("windowSize",this._windowSizeListener),Photos.scrollTracker.set("active",NO),Photos.scrollTracker.unlisten("scrollSpeed",this._scrollSpeedListener)},_windowSizeDidChange:function(){var e=Core.windowSize.width,t=Core.windowSize.height;Photos.page.streamView.adjustFrameSize(e,t),Photos.photoGridItemsVisibilityController.reset(function(){n()}),Photos.photoGridItemImageViewControllers.resumeLoadingImagesIfNeeded()},_scrollSpeedDidChange:function(){Photos.photoGridItemImageViewControllers.resumeLoadingImagesIfNeeded(),Photos.photoGridItemsVisibilityController.update(),Photos.scrollTracker.scrollSpeed===0&&n()}});var t=-1}(),require("system/state"),function(){function e(e){Photos.feedbackStatsService.report("appEventInfo",{event:"appModeChanged",mode:"slideshow"})}function t(e){Photos.feedbackStatsService.report("appEventInfo",{event:"requestFullScreen"})}Photos.SlideshowState=Photos.State.extend({init:function(){var e=this;this._windowSizeListener=function(){e._windowSizeDidChange()},arguments.callee.base.apply(this,arguments)},currentItemBinding:"window.Photos.slideshowController.currentItem",entering:function(t){e(this),t&&this.set("currentItem",t),Core.listen("windowSize",this._windowSizeListener),Photos.workspaceController.set("nowShowing",Photos.SLIDESHOW),Core.keyEventRootResponder.set("responder",this),this._windowSizeDidChange()},exiting:function(){Photos.slideshowController.stopShow(),CoreImage.get("isFullScreen")&&(CoreImage.cancelFullScreen(),Photos.page.__forceStreamViewRedraw__=!0),Core.unlisten("windowSize",this._windowSizeListener
),Photos.environmentController.set("photoGuid",null),Core.keyEventRootResponder.set("responder",null)},_windowSizeDidChange:function(){var e=Core.windowSize.width,t=Core.windowSize.height;Photos.page.slideshowView.adjustFrameSize(e,t)},reentering:function(e){e&&this.set("currentItem",e)},exitSlideshowHandler:Photos.State.gotoState("stream"),currentItemDidChange:function(){if(!this.isEnteredState)return;var e=this.currentItem;if(!e||!e.get)return;Photos.environmentController.set("photoGuid",e.get("id"))}.observes("currentItem"),downloadItemHandler:function(e,t){Photos.fileDownloader.downloadItem(t)},toggleFullscreenModeHandler:function(e){CoreImage.get("isFullScreen")?CoreImage.cancelFullScreen():(t(this),CoreImage.requestFullScreen())},showPreviousPhotoHandler:function(){Photos.slideshowController.selectPrevious()},showNextPhotoHandler:function(){Photos.slideshowController.selectNext()},toggleShowHandler:function(){Photos.slideshowController.toggleShow()},keydownForArrowLeft:function(){Photos.slideshowController.selectPrevious()},keydownForArrowRight:function(){Photos.slideshowController.selectNext()},keydownForEscape:function(){Photos.stateManager.sendAction("exitSlideshow")},keydownForSpace:function(){var e=Photos.slideshowController;e.isPlaying?e.stopShow():e.startShow()}})}(),require("system/state"),require("states/workspace/stream"),require("states/workspace/slideshow"),Photos.WorkspaceState=Photos.State.extend({streamState:Photos.StreamState,slideshowState:Photos.SlideshowState,entering:function(){Photos.page.set("isAppended",!0);if(this.get("initialEntry")){var e=Photos
.environmentController.get("photoGuid"),t=Photos.photosController.findPhotoWithId(e);if(t){this.gotoState("slideshow",t);return}}this.gotoState("stream")},exiting:function(){Photos.page.set("isAppended",!1)},showPhotoHandler:Photos.State.gotoState("slideshow"),externalEnvironmentChangesDetectedHandler:function(e,t){if(!t.changeOnlyToParam("photoGuid"))return NO;var n=Photos.photosController.findPhotoWithId(t.valueForParam("photoGuid"));if(!n)return NO;this.gotoState("slideshow",n)}}),require("system/state_manager"),require("states/setup"),require("states/error"),require("states/workspace"),Photos.stateManager=Photos.StateManager.extend({name:"main",externalEnvironmentChangesDetectedTrigger:"window.Photos.environmentController.externalEnvironmentChangesDetected",photoCollectionUpdatedTrigger:"window.Photos.photosController.photos",loadingBlocksIntoStreamTrigger:"window.Photos.streamViewController.loadingBlocksIntoStream",loadedBlocksIntoStreamTrigger:"window.Photos.streamViewController.loadedBlocksIntoStream",errorLoadingBlocksIntoStreamTrigger:"window.Photos.streamViewController.errorLoadingBlocksIntoStream",externalEnvironmentChangesDetectedHandler:function(e,t){window.location.reload()},initialState:"setup",setupState:Photos.SetupState,workspaceState:Photos.WorkspaceState,errorState:Photos.ErrorState}),Photos.StateTransitioner=Core.Object.extend({stateManager:null,fromState:null,toState:null,context:null,trace:function(){return this.stateManager.get("trace")}.property(),monitor:function(){return this.stateManager.get("monitor")}.property(),_reset:function(){this._lastStateEntered=
null,this._enterChain=null,this._enterChain=null,this._pivotState=null},go:function(){this._reset();var e=this.get("trace"),t=this.get("monitor"),n=this.stateManager,r=this.toState;e&&t.stateManagerStartedStateTransition(n),r.get("isEnteredState")?(e&&t.stateManagerWillReenterState(n,r),this.toState.doReentry(this.context),e&&t.stateManagerDidReenterState(n,r)):(this._setup(),this._exitStates(),this._enterStates(),n.set("currentState",this._lastStateEntered)),e&&t.stateManagerEndedStateTransition(n)},_setup:function(){var e=this.stateManager,t=this.fromState,n=this.toState,r,i;t&&(r=t.get("ancestorStates"),r.unshift(t)),i=n.get("ancestorStates"),i.unshift(n);var s=this._findPivot(r,i);i.reverse();var o=n.initialSubstate;while(o)i.push(o),o=o.initialSubstate;this._enterChain=i,this._exitChain=r,this._pivotState=s,this._lastStateEntered=null,this.get("trace")&&this.get("monitor").stateManagerTransitionInfo(e,{fromState:this._exitChain?this._exitChain[0]:null,toState:this._enterChain[this._enterChain.length-1],pivotState:s})},_exitStates:function(){var e=this._exitChain,t=this._pivotState,n=this.context;if(!e)return;var r=this.get("trace"),i=this.get("monitor");for(var s=0,o;o=e[s];s+=1){if(o===t)return;r&&i.stateManagerWillExitState(this.stateManager,o),o.doExit(n),r&&i.stateManagerDidExitState(this.stateManager,o)}},_enterStates:function(){var e=this._enterChain,t=this._pivotState,n=this.context;if(!e)return;var r=this.get("trace"),i=this.get("monitor"),s=e.indexOf(t);s=s<0?0:s+1;for(var o=s,u;u=e[o];o+=1)r&&i.stateManagerWillEnterState(this.stateManager,u),u.doEnter(n),r&&i.
stateManagerDidEnterState(this.stateManager,u),this._lastStateEntered=u},_findPivot:function(e,t){if(!e||!t)return null;e=e.slice().reverse(),t=t.slice().reverse();var n=Math.min(e.length,t.length),r=null;for(var i=0,s,o;i<n;i+=1)s=e[i],o=t[i],s===o&&(r=s);return r}}),CoreImage.Theme=CoreImage.Theme.extend({displayWidthBinding:"from:Photos.workspaceController.displayWidth"}),Photos.URLResolver=CoreImage.URLResolver.create({allDerivativesByChecksum:{},obtainUrlSetForChecksum:function(e,t,n){var r=n.items[e],i=r?this.computeUrlSetHash(r,n):null;return i&&(t.urls=i.urls,t.expiry=i.expiry,this.allDerivativesByChecksum[e]=t),i},parseBatchDateCreated:function(e){var t=e.match(/^(\d\d\d\d)-(\d\d)-(\d\d)\s+(\d\d):(\d\d):(\d\d) UTC/);if(!t)return Infinity;var n=new Date;return n.setUTCFullYear(parseInt(t[1],10)),n.setUTCMonth(parseInt(t[2],10)-1),n.setUTCDate(parseInt(t[3],10)),n.setUTCHours(parseInt(t[4],10)),n.setUTCMinutes(parseInt(t[5],10)),n.setUTCSeconds(parseInt(t[6],10)),n*1}}),Photos.dateLocalizer=Core.Object.create({months:["_January".loc(),"_February".loc(),"_March".loc(),"_April".loc(),"_May".loc(),"_June".loc(),"_July".loc(),"_August".loc(),"_September".loc(),"_October".loc(),"_November".loc(),"_December".loc()],localize:function(e){var t=new Date,n=new Date(t-864e5),r=t.toLocaleDateString(),i=n.toLocaleDateString(),s=e.toLocaleDateString();if(s===r)return"_Today".loc();if(s===i)return"_Yesterday".loc();var o=e.getFullYear(),u=this.months[e.getUTCMonth()],a=e.getUTCDate(),f;o===t.getFullYear()?f="_Stream.BatchSummary.DateFormatShort".loc():f="_Stream.BatchSummary.DateFormatLong"
.loc();var l="_Day.%@".fmt(a),c=l.loc();return c===l&&(c="_Day.X%@".fmt(a%10).loc(a)),f.replace("mm",u).replace("dd",c).replace("yyyy",o)}}),Photos.EnvironmentChanges=Core.Object.extend({init:function(){arguments.callee.base.apply(this,arguments),this._changedParams={},this._paramCounter=0},paramsCount:function(){return this._paramCounter},hasParam:function(e){return this._changedParams.hasOwnProperty(e)},changeOnlyToParam:function(e){return this.hasParam(e)&&this.paramsCount()===1},addParam:function(e,t){this._changedParams[e]=t,this._paramCounter+=1},valueForParam:function(e){return this._changedParams[e]}}),Photos.EnvironmentHandler={isEnvironementControllerDelegate:YES,isMixin:YES,monitorParams:null,controller:null,photoGuid:null,version:null,urlTokenManager:null,urlToken:function(e,t){var n=this.get("urlTokenManager");return t!==undefined&&n.set("token",t),n.get("token")}.property(),setup:function(){this.setupParameters()},startDetectingExternalEnvironmentChanges:function(){this.lastEnvironmentSnapshot=this.snapshotEnvironment();var e=this;this._intervalHandle=setInterval(function(){e.detectExternalEnvironmentChanges()},250)},stopDetectingExternalEnvironmentChanges:function(){clearInterval(this._intervalHandle)},detectExternalEnvironmentChanges:function(){var e=this.get("urlToken");if(e===this.lastEnvironmentSnapshot.urlToken)return;this.setupParameters();var t=this.snapshotEnvironment(),n=Photos.EnvironmentChanges.create();for(var r=0,i;i=this.monitorParams[r];r+=1)t[i]!==this.lastEnvironmentSnapshot[i]&&(this.trigger(i),n.addParam(i,t[i]));this.lastEnvironmentSnapshot=
t,this.controller.notifyEnvironmentChanges(n)},snapshotEnvironment:function(){var e={};e.urlToken=this.get("urlToken");var t=this.monitorParams;for(var n=0,r;r=this.monitorParams[n];n+=1)e[r]=this.get(r);return e},setupParameters:function(){},generateNewUrlToken:function(){return null},_updateLocationHash:function(){var e=this.generateNewUrlToken(),t=this.snapshotEnvironment();t.urlToken=e,this.lastEnvironmentSnapshot=t,this.set("urlToken",e)}.observes("photoGuid"),createSharedStreamURLGenerator:function(){return null},createSharedStreamJSONGenerator:function(){return null}},Photos.UrlTokenManager=Core.Object.extend({className:"Photos.UrlTokenManager",token:function(e,t){return t!==undefined&&(window.location.hash="#"+t),window.location.hash.slice(1)}.property()}),Photos.SessionUrlTokenManager=Photos.UrlTokenManager.extend({className:"Photos.SessionUrlTokenManager",sessionTimeStamp:function(e,t){var n=this._sessionProperty("%@.timeStamp".fmt(this.className),t);return n?parseInt(n,10):null}.property(),sessionUrlToken:function(e,t){return this._sessionProperty("%@.urlToken".fmt(this.className),t)}.property(),_sessionProperty:function(e,t){if(t!==undefined)if(t===null){var n=sessionStorage[e];n&&delete sessionStorage[e]}else sessionStorage[e]=t;return sessionStorage[e]},isTimeStampExpired:function(){var e=this.get("sessionTimeStamp");return!(e&&new Date*1-e<12e4)}.property(),_setupTokenOnInit:function(){var e=this.get("sessionUrlToken");!this.get("token")&&!this.get("isTimeStampExpired")&&e&&this.set("token",e),this.set("sessionTimeStamp",null),this.set("sessionUrlToken",null)}
.observes("init"),_updateSessionPropertiesOnTokenChange:function(){this.set("sessionTimeStamp",new Date*1),this.set("sessionUrlToken",this.get("token"))}.observes("token")}),require("utils/environment/handler"),Photos.V2EnvironmentHandler=Core.Object.extend(Photos.EnvironmentHandler,{monitorParams:"version serverPartition streamGuid dsid photoGuid".w(),params:null,version:2,streamGuid:function(){return this.params.streamGuid}.property(),serverPartition:function(){return this.params.serverPartition}.property(),dsid:function(){return this.params.dsid}.property(),photoGuid:function(e,t){return t!==undefined&&(this.params.photoGuid=t),this.params.photoGuid}.property(),setupParameters:function(){var e=this.get("urlToken"),t=e.split(";"),n={};for(var r=0,i;i=this.monitorParams[r];r+=1)n[i]=this["_parse_"+i].call(this,t[r]);this.params=n},_parse_version:function(e){return e},_parse_serverPartition:function(e){return e=parseInt(e,10),isNaN(e)?null:e},_parse_streamGuid:function(e){return e},_parse_dsid:function(e){return e},_parse_photoGuid:function(e){return e?e:null},generateNewUrlToken:function(){var e=this.monitorParams,t="",n=0,r;for(var i=0,s;s=e[i];i+=1)r=this.params[s],r!==null&&r!==undefined&&(n>0&&(t+=";"),t+=this.params[s],n+=1);return t},createSharedStreamURLGenerator:function(){return Photos.SharedStreamsURLGenerator.create({serverPartition:this.get("serverPartition"),token:this.get("dsid")})},createSharedStreamJSONGenerator:function(){return Photos.SharedStreamJSONGenerator.create({streamGuid:this.get("streamGuid")})}}),Photos.V2EnvironmentHandler.detect=function(){var e=
window.location.hash;return!!e.match(/^#v2;/)},require("utils/environment/handler"),Photos.V3EnvironmentHandler=Core.Object.extend(Photos.EnvironmentHandler,{monitorParams:"version serverPartition photoGuid token".w(),version:null,token:null,serverPartition:null,photoGuid:null,BASE_62_CHAR_SET:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",setupParameters:function(){var e=this.get("urlToken"),t=e[0],n=t==="A"?this._base62ToInt(e[1]):this._base62ToInt(e.substring(1,3)),r=e,i=e.indexOf(";"),s=null;i>=0&&(s=e.slice(i+1),r=r.replace(";"+s,"")),this.set("version",t),this.set("serverPartition",n),this.set("token",r),this.set("photoGuid",s)},generateNewUrlToken:function(){var e=this.token,t=this.photoGuid;return t&&(e+=";"+t),e},_base62ToInt:function(e){var t=0;for(var n=0;n<e.length;n++)t=t*62+this.BASE_62_CHAR_SET.indexOf(e[n]);return t},createSharedStreamURLGenerator:function(){return Photos.SharedStreamsURLGenerator.create({serverPartition:this.get("serverPartition"),token:this.get("token")})},createSharedStreamJSONGenerator:function(){return Photos.SharedStreamJSONGenerator.create()}}),Photos.V3EnvironmentHandler.detect=function(){var e=window.location.hash;return e?!!e.match(/^#A/)||!!e.match(/^#B/):!1},function(){var e="statName",t="sessionID",n="appName",r=5e3;Photos.FeedbackStatsService=Core.Object.extend({appName:"",flushInterval:r,appendedStats:{},queuedEntries:function(){return this._queuedEntries}.property(),sessionID:function(){return this._sessionID}.property(),isRunning:function(){return this._running}.property(),init:function(){this._queuedEntries=
[],this._flushTimeoutHandle=null,this._running=!1,this._streams=[];var e=this;this._sessionID=this._generateGUID(),arguments.callee.base.apply(this,arguments);var t=this.appendedStats;t||(this.appendedStats={})},start:function(){if(this._running)return;this._running=!0,this._scheduleNextFlush()},stop:function(){if(!this._running)return;this._running=!1,this._clearNextScheduledFlush()},addStream:function(e){var t=this._streams;e&&t.indexOf(e)<0&&t.push(e)},removeStream:function(e){this._streams.remove(e)},clearQueuedEntries:function(){this._queuedEntries=[]},report:function(r,i){if(!this._running)return;var s=this.appendedStats,o=this._mergeHashes(i,s);o[e]=r,o[t]=this._sessionID,o[n]=this.appName,this._queuedEntries.push(o)},flush:function(){if(!this._running)return;var e=this._queuedEntries.slice(),t=this._streams;if(e.length>0){this.clearQueuedEntries();var n=t.length;for(var r=0;r<n;r++)t[r].next(e)}this._scheduleNextFlush()},_scheduleNextFlush:function(){this._clearNextScheduledFlush();var e=this.flushInterval;if(e===0)return;var t=this;this._flushTimeoutHandle=setTimeout(function(){t.flush()},e)},_clearNextScheduledFlush:function(){var e=this._flushTimeoutHandle;e&&clearTimeout(e),this._flushTimeoutHandle=null},_generateGUID:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)});return e},_mergeHashes:function(e,t){var n=this._cloneHash(e);for(var r in t)n[r]=t[r];return n},_cloneHash:function(e){var t={};for(var n in e)t[n]=e[n];return t}}),Photos.FeedbackStatsStream=Core.Object
.extend({next:function(e){}}),Photos.ConsoleFeedbackStatsStream=Photos.FeedbackStatsStream.extend({init:function(){this._counter=1,arguments.callee.base.apply(this,arguments)},next:function(e){e.forEach(function(e){var t=this._counter;console.log("\nfeedback stat entry ",t);for(var n in e)console.log("...",n,e[n]);this._counter+=1}.bind(this))}}),Photos.RemoteFeedbackStatsStream=Photos.FeedbackStatsStream.extend({next:function(e){this._request=Core.Request.send({type:"POST",url:"https://feedbackws.icloud.com/reportStats",withCredentials:NO,body:{stats:e}})}})}(),function(){function e(e){var t="photo";e.get("isVideo")&&(t="video"),Photos.feedbackStatsService.report("appEventInfo",{event:"downloadItem",itemType:t})}Photos.fileDownloader=CoreImage.FileDownloader.create({downloadItem:function(e){e.mediaAssetType==="video"?this.downloadVideo(e):this.downloadPhoto(e)},downloadVideo:function(t){e(t);if(!t)return;var n=t.videoDerivatives;if(!n){Core.debug("Video had no valid derivatives to attempt to download.");return}var r=[],i;for(var s in n)i=parseInt(s,10),i>0&&s.slice(-1)==="p"&&!!n[s]&&r.push(i);if(!r.length){Core.debug("Video had no valid derivatives to attempt to download.");return}var o=Math.max.apply(null,r),u=n[o+"p"];if(u.urls&&u.urls.length)Core.debug("URLs for video were already known. Initiating download."),this.downloadFile(u.urls[0]);else{var a=function(){if(!u.urls||!u.urls.length)return;Photos.fileDownloader.downloadFile(u.urls[0])},f=function(){};Photos.getUrlsForSingleAssetRecord(t,a,f,"video")}},downloadPhoto:function(t){e(t);var n=this;t.updateIfNeeded({success
:function(){Photos.DerivativeImageUrlProbe.create({urls:t.get("largestDerivative").urls,rep:t.get("largestDerivative"),photo:t})},failure:function(){}})}}),Photos.DerivativeImageUrlProbe=CoreImage.ImageRequest.extend({fileDownloader:Photos.fileDownloader,group:CoreImage.imageLoader.essentialGroup,importance:2e9,requestGuessDelay:2e3,mixinNotifiersToLoadee:function(){if(!this.loadee)return;this.loadee.mixin({load:function(e,t){return t||this.rescheduleURLProbeGuesses("our loadee was told to begin loading"),arguments.callee.base.apply(this,arguments)},didHalfErr:function(){return this.rescheduleURLProbeGuesses("we discovered an invalid URL"),arguments.callee.base.apply(this,arguments)},rescheduleURLProbeGuesses:function(e){for(var t=0,n=this.__urlProbes__,r;r=n[t];t++)r.rescheduleGuess(e)}}),(this.loadee.__urlProbes__||(this.loadee.__urlProbes__=[])).push(this)}.observes("loadee"),joinLoadee:function(){var e=arguments.callee.base.apply(this,arguments);return this.loadee.loading&&this.rescheduleGuess("we just joined a loadee"),e}.observes("urls","url"),rescheduleGuess:function(e){var t=new Date*1;if(this._lastRescheduleTime>=t-20)return;this._lastRescheduleTime=t,clearTimeout(this._guessTimeout);if(this._guessedAlready)return;Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": Because "+e+", we now schedule to guess the URL "+this.requestGuessDelay/1e3+" seconds from now. Time is "+new Date%1e5+".");var n=this;this._guessTimeout=setTimeout(function(){n.guess()},this.requestGuessDelay)},guess:function(){this._guessedAlready=YES,Core.debug("Downloading Photo rep:"+Core.
guidFor(this.rep)+": Currently attempted URL is taking a long time: it is likely to be correct. Downloading it. Time is now "+new Date%1e5+".");var e=this._alreadyAttemptedUrl=this.getPath("loadee.url");this.fileDownloader.downloadFile(e)},onload:function(){var e;clearTimeout(this._guessTimeout);if(e=this._alreadyAttemptedUrl){e===this.url?Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": The URL Probe successfully fully loaded the image, and the URL was as predicted. Time is now "+new Date%1e5+"."):(Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": The URL Probe successfully fully loaded the image, and the final URL was different than the one predicted. Downloading the new, known-successful URL. Time is now "+new Date%1e5+"."),this.fileDownloader.downloadFile(this.url));return}Core.debug("Downloading Photo rep:"+Core.guidFor(this.rep)+": The URL Probe successfully fully loaded the image, and is now downloading the known-successful URL. Time is now "+new Date%1e5+"."),this.fileDownloader.downloadFile(this.url)},onerror:function(){}})}(),Photos.gridItemBoundaryTransformer=Core.Object.create({transformByFrame:function(e,t,n,r){var i=Core.innerSizeInOuter(e,t,n,r,YES);return{translateX:Math.round(n/2-i.width/2),translateY:0,width:i.width,height:i.height}}}),function(){var e=window.screen.height,t=480,n=800,r=1.3,i=1.5;Photos.gridItemPhotoHeightScalerStrategy={calculateForPhoto:function(s){var o=s.width,u=s.height,a=u/o,f=u;return a>r&&(e<=t?f*=a<i?.8:.6:e<=n?f*=a<i?1:.7:f*=a<i?1:.9),f/o}}}(),require("mixins/photo_derivatives_updater_delegate"),Photos.PhotoDerivativesUpdater=
Core.Object.extend(Photos.PhotoDerivativesUpdaterDelegate,{CHANGESET_TRANSFORMATIONS:{photos:[{derivatives:{"*":{checksum:"obtainUrlSetForChecksum > urlSet"}}}]},delegate:null,dataSource:null,isUpdating:NO,trace:NO,delegateValue:function(){return this.delegate||this}.property(),hasPhotosToUpdate:function(){return this._photosToUpdate.length>0}.property(),init:function(){this._photosToUpdate=[],arguments.callee.base.apply(this,arguments)},addPhoto:function(e){var t=this._photosToUpdate;if(t.indexOf(e)>=0)return;t.push(e)},addPhotos:function(e){for(var t=0,n;n=e[t];t+=1)this.addPhoto(n)},updateIfNeeded:function(e){if(this.isUpdating||!this.get("hasPhotosToUpdate"))return;this._update(e)},_update:function(e){var t=this.get("delegateValue"),n=this.get("trace");if(!this.isUpdating){var r=this._photosToUpdate;t.photoDerivativesUpdaterWillStartUpdateForPhotos(this,r),r.length=0,this.set("isUpdating",YES),n&&Core.debug("%{self}: started update process".fmt({self:this}))}var i=t.photoDerivativesUpdaterNextBatchOfPhotosToUpdate(this),s=[],o,u;if(!i||i.length===0){n&&Core.debug("%{self}: finished update process successfully".fmt({self:this})),this.set("isUpdating",NO),t.photoDerivativesUpdaterDidFinishUpdate(this),this._notifySuccessfulPhotoUpdate(e);return}if(n){Core.debug("%{self}: ... will update next %{len} photos".fmt({self:this,len:i.length}));for(o=0;u=i[o];o+=1)Core.debug("%{self}: ...".fmt({self:this}),u)}t.photoDerivativesUpdaterWillUpdatePhotos(this,i);for(o=0;u=i[o];o+=1)s.push(u.get("id"));e=e||{},e._photosBatch=i,this._params=e,this.dataSource.fetchUrlsForPhotoGuids(s,{success
:this._dataSourceDidFetchPhotoUrls,error:this._dataSourceErrorFetchingPhotoUrls,target:this,params:e})},cancel:function(){if(!this.isUpdating)return;var e=this.get("delegateValue"),t=this.get("trace"),n=this;t&&Core.debug("%@: cancelled current update process"),this.dataSource.cancelFetch(),this.set("isUpdating",NO),e.photoDerivativesUpdaterDidCancelUpdate(this);var r=this._params;r&&r.cancel&&r.cancel.call(r.cancelTarget||r.target),this.trigger("cancelledPhotoDerivativesUpdate")},_dataSourceDidFetchPhotoUrls:function(e,t){if(!t)throw"PhotoDerivativesUpdater#_dataSourceDidFetchPhotoUrls: Missing params.";var n=t._photosBatch;if(!n)throw"PhotoDerivativesUpdater#_dataSourceDidFetchPhotoUrls: Missing photos batch.";e.photos=n,Photos.URLResolver.processJSONObject(e,this.CHANGESET_TRANSFORMATIONS),delete t._photosBatch,this.trace&&Core.debug("%{self}: ... did update photos".fmt({self:this}));for(var r=0,i;i=n[r];r+=1)i.trigger("derivatives");this.get("delegateValue").photoDerivativesUpdaterDidUpdatePhotos(this,n),this._update(t)},_dataSourceErrorFetchingPhotoUrls:function(e,t){this.trace&&Core.debug("%@: finished update process with error".fmt(this)),this.set("isUpdating",NO),this.get("delegateValue").photoDerivativesUpdaterDidErrorOnUpdate(this),t&&t.error&&t.error.call(t.errorTarget||t.target,e),this.trigger("errorUpdatingPhotoDerivatives",e)},_notifySuccessfulPhotoUpdate:function(e){e&&e.success&&e.success.call(e.successTarget||e.target),this.trigger("successUpdatingPhotoDerivatives")},toString:function(){return"[BatchPhotoDerivativesUpdater: %@]".fmt(this.coreGuid)}}),Photos.
PhotoGridBlockLoadFeeder=Core.Object.extend({controller:null,streamDisplayWidth:null,minNextBlocksToLoad:4,nextBlocksToLoad:function(){var e=[];return this._addInitialSetOfBlocksToLoad(e),this._addAdditionalBlocksToFillScreenIfNeeded(e),e},_addInitialSetOfBlocksToLoad:function(e){var t=this.controller;for(var n=0,r;n<this.minNextBlocksToLoad;n+=1)r=t.dequeueNextBlockToLoad(),r&&e.push(r)},_addAdditionalBlocksToFillScreenIfNeeded:function(e){var t=this.controller;if(t.get("numBlocksLoaded")>0||!t.get("hasBlocksToLoad")||e.length===0)return;var n=Math.ceil(this.get("streamDisplayWidth")/Photos.PhotoGrid.MAX_COLUMNS),r=window.innerHeight,i=0,s,o;Core.Array.forEach(e,function(e){i+=e.get("rowHeight")*n},this);if(i<r){o=Math.ceil((r-i)/(n*6))+1;for(var u=0;u<o;u+=1)s=t.dequeueNextBlockToLoad(),s&&e.push(s)}}}),require("system/state_manager"),require("system/state"),function(){Photos.PollingStrategy={isMixin:YES,isPollingStrategy:YES,poller:null,setup:function(){},pollerDidStart:function(){},pollerDidStop:function(){},nextStreamPollInterval:function(){return null}};var e=Photos.PollingStrategies={};e.UpdateModeStrategy=Core.Object.extend(Photos.PollingStrategy,{className:"PollingStrategy:UpdateModeStrategy",POLL_INTERVAL:6e4,nextStreamPollInterval:function(){return this.POLL_INTERVAL}});var t=e.ActiveMode={};t._PollingState=Photos.State.extend({entering:function(){this._forceNextPoll()},reentering:function(){this._forceNextPoll()},_forceNextPoll:function(){this.stateManager.owner._forceNextStreamPollInterval()},nextInterval:function(){}}),t._ExponentialPollingState=t._PollingState
.extend({maxPollInterval:108e5,initialPollInterval:6e4,intervalGrowthFactor:1,maxIntervalCount:20,entering:function(){this.reset(),arguments.callee.base.apply(this,arguments)},reentering:function(){this.reset(),arguments.callee.base.apply(this,arguments)},reset:function(){this._intervalCounter=0},nextInterval:function(){if(this._intervalCounter>=this.maxIntervalCount)return null;var e=Math.floor(Math.pow(this.initialPollInterval,Math.pow(this.intervalGrowthFactor,this._intervalCounter)));return this._intervalCounter+=1,e>this.maxPollInterval?this.maxPollInterval:e}}),t._ActiveWindowPollingState=t._ExponentialPollingState.extend({intervalGrowthFactor:1.02}),t._InactiveWindowPollingState=t._ExponentialPollingState.extend({intervalGrowthFactor:1.05}),t.PollingStrategy=Core.Object.extend(Photos.PollingStrategy,{className:"PollingStrategy:ActiveModeStrategy",trace:NO,_stateManager:Photos.StateManager.extend({name:"polling",traceBinding:".owner.trace",initialState:"inactive",inactiveState:Photos.State.extend({activateHandler:Photos.State.gotoState("active")}),activeState:Photos.State.extend({initialSubstate:"windowFocused",deactivateHandler:Photos.State.gotoState("inactive"),detectedWindowFocusHandler:Photos.State.gotoState("windowFocused"),detectedWindowBlurHandler:Photos.State.gotoState("windowBlurred"),windowFocusedState:Photos.State.extend({initialSubstate:"shortPoll",longPollState:t._ActiveWindowPollingState.extend({detectedUserEventHandler:Photos.State.gotoState("shortPoll")}),shortPollState:t._PollingState.extend({entering:function(){this._forceNextPoll(),this._lastUserEventDate=
(new Date).getTime()},exiting:function(){clearTimeout(this._intervalHandle)},nextInterval:function(){return this._checkForUserActivity(),1e4},detectedUserEventHandler:function(){this._lastUserEventDate=(new Date).getTime()},_checkForUserActivity:function(){var e=this;this._intervalHandle=setTimeout(function(){if(!e.get("isEnteredState"))return;var t=(new Date).getTime();t-e._lastUserEventDate>=1e4&&e.gotoState("longPoll")},1e4)}})}),windowBlurredState:t._InactiveWindowPollingState})}),setup:function(){var e=this._stateManager.create({owner:this});e.start(),this._stateManager=e,this.setupEventHooks()},setupEventHooks:function(){var e=this;Core.addEvent(window,"focus",function(){e._sendAction("detectedWindowFocus")}),Core.addEvent(window,"blur",function(){e._sendAction("detectedWindowBlur")}),Core.addEvent(document,"mousedown",function(){e._sendAction("detectedUserEvent")}),Core.addEvent(document,"touchstart",function(){e._sendAction("detectedUserEvent")}),Core.addEvent(document,"pointerdown",function(){e._sendAction("detectedUserEvent")}),Core.addEvent(document,"MSPointerDown",function(){e._sendAction("detectedUserEvent")})},pollerDidStart:function(){this._stateManager.sendAction("activate")},pollerDidStop:function(){this._stateManager.sendAction("deactivate")},nextStreamPollInterval:function(){var e=this._stateManager.get("currentState"),t=e.nextInterval();return t},_sendAction:function(e){this._stateManager.sendAction(e)},_forceNextStreamPollInterval:function(){var e=this;setTimeout(function(){e.poller.refresh()})}}),Photos.PhotoStreamPollerDelegate={isMixin:YES,isPhotoStreamerPollerDelegate
:YES,dataSource:null,createPollingStrategyForPhotoStreamPoller:function(e){var t=Photos.PollingStrategies.ActiveMode.PollingStrategy;window.location.search.match(/\bupdatemode(=|&|#|$)/)&&(t=Photos.PollingStrategies.UpdateModeStrategy);var n=t.create({poller:e,traceBinding:".poller.trace"});return n.setup(),n},dataSourceForPhotoStreamPoller:function(e){return this.dataSource}},Photos.PhotoStreamPoller=Core.Object.extend(Photos.PhotoStreamPollerDelegate,{started:NO,trace:NO,delegate:null,delegateValue:function(){return this.delegate||this}.property(),pollingStrategyValue:function(){if(!this._pollingStrategy){var e=this.get("delegateValue");this._pollingStrategy=e.createPollingStrategyForPhotoStreamPoller(this)}return this._pollingStrategy}.property(),dataSourceValue:function(){if(!this._dataSource){var e=this.get("delegateValue");this._dataSource=e.dataSourceForPhotoStreamPoller(this)}return this._dataSource}.property(),start:function(){this.started=!0,this.trace&&Core.debug("%@: started".fmt(this)),this.get("pollingStrategyValue").pollerDidStart(this),this._pollStream()},stop:function(){var e=this._streamPollTimeoutHandle;e&&clearTimeout(e),this._currentPollInterval=null,this.started=!1,this.get("pollingStrategyValue").pollerDidStop(this),this.trace&&Core.debug("%@: stopped".fmt(this))},refresh:function(){if(!this.started||this._fetching)return;clearTimeout(this._streamPollTimeoutHandle),this._pollStream()},_pollStream:function(){if(!this.started||this._fetching)return;var e=this.get("pollingStrategyValue"),t=e.nextStreamPollInterval(),n=this;if(t===null){this.trace&&Core.debug
("%@: no next interval for polling. Stopping...".fmt(this)),this.stop();return}this.trace&&Core.debug("%@: next poll in %@ ms".fmt(this,t)),this._streamPollTimeoutHandle=setTimeout(function(){n.trace&&Core.debug("%@: polling".fmt(n)),n._fetching=YES,n.get("dataSourceValue").fetchPhotoStream({success:function(){n._dataSourceDoneFetching()},error:function(){n._dataSourceErroredOnFetch()}})},t)},_dataSourceDoneFetching:function(){this._fetching=NO,this._pollStream()},_dataSourceErroredOnFetch:function(){this.trace&&Core.debug("%@: error fetching from data source. Stopping".fmt(this)),this._fetching=NO,this.stop()},toString:function(){return"[PhotoStreamPoller]"}})}(),Photos.SharedStreamJSONGenerator=Core.Object.extend({JSON_STREAM_GUID_KEY:"streamGuid",streamGuid:null,generateJSON:function(){var e={},t=this.get("streamGuid");return t&&(e[this.JSON_STREAM_GUID_KEY]=t),e}}),Photos.SharedStreamsURLGenerator=Core.Object.extend({protocol:"https://",defaultHost:"p%@-sharedstreams.icloud.com",token:null,serverPartition:null,host:null,hostValue:function(){var e=this.get("serverPartition");return e<10&&(e="0"+e),this.host||this.defaultHost.fmt(e)}.property(),origin:function(){return"%@%@".fmt(this.get("protocol"),this.get("hostValue"))}.property(),baseUrl:function(){var e="%@/%@/sharedstreams";return e.fmt(this.get("origin"),this.get("token"))}.property(),reset:function(){this.set("host",null)},generateURLForPath:function(e){return"%@/%@".fmt(this.get("baseUrl"),e)}}),function(){var e=300,t=2e3,n=5e3;Photos.SlideshowChromeManager=Core.Object.extend({delegate:null,hudIsVisible:function()
{return this._hudVisible}.property(),captionIsVisible:function(){return this._captionVisible}.property(),allChromeVisible:function(){return this._hudVisible&&this._captionVisible}.property(),init:function(){this._hudViews=[],this._captionViews=[],this._hudVisible=!0,this._captionVisible=!0,this._hideHUDTaskHandle=null,this._hideCaptionTaskHandle=null,this._performingFadeIn=!1,this._performingFadeOut=!1,arguments.callee.base.apply(this,arguments)},addHUDView:function(e){this._hudViews.push(e),this._jqueryHUDElements=null,this._allJQueryElements=null;var t=$(e.layer);this._hudVisible?t.show():t.hide(),this.stop()},addCaptionView:function(e){this._captionViews.push(e),this._jqueryCaptionElements=null,this._allJQueryElements=null;var t=$(e.layer);this._captionVisible?t.show():t.hide(),this.stop()},removeHUDView:function(e){var t=this._hudViews,n=t.indexOf(e);n>=0&&t.splice(n,1),this._jqueryHUDElements=null,this._allJQueryElements=null,this.stop()},removeCaptionView:function(e){var t=this._captionViews,n=t.indexOf(e);n>=0&&t.splice(n,1),this._jqueryCaptionElements=null,this._allJQueryElements=null,this.stop()},showAllChrome:function(){this._hudVisible=!0,this._captionVisible=!0,this.stop();var e=this._getAllJQueryElements();e.show()},hideAllChrome:function(){this._hudVisible=!1,this._captionVisible=!1,this.stop();var e=this._getAllJQueryElements();e.hide()},showCaption:function(){this._captionVisible=!0,this.stop();var e=this._getAllJQueryCaptionElements();e.show()},hideCaption:function(){this._captionVisible=!1,this.stop();var e=this._getAllJQueryCaptionElements();e.hide()},fadeInAllChrome
:function(t){if(this._performingFadeIn||this.get("allChromeVisible"))return;this.stop(),this._performingFadeIn=!0;var n=this,r=this._getAllJQueryElements(),i=t?t.step:null,s=t?t.finish:null;r.fadeIn({duration:e,step:i,complete:function(){n._completedFadeInAllChrome(),s&&s()}})},_completedFadeInAllChrome:function(){this._performingFadeIn=!1,this._hudVisible=!0,this._captionVisible=!0},fadeOutAllChrome:function(){if(this._performingFadeOut)return;this.stop(),this._performingFadeOut=!0;var t=this,n=this._getAllJQueryElements();n.fadeOut(e,function(){t._completedFadeOutAllChrome()})},_completedFadeOutAllChrome:function(){this._performingFadeOut=!1,this._hudVisible=!1,this._captionVisible=!1},stop:function(){this._fadingInAllChrome=!1,this._fadingOutAllChrome=!1,this._clearAllScheduledTasks(),this._getAllJQueryElements().finish()},scheduleFadeOutSequence:function(){this._clearAllScheduledTasks(),this._scheduleHUDForFadeOut()},_scheduleHUDForFadeOut:function(){var e=this;this._hideHUDTaskHandle=setTimeout(function(){e._fadeOutHUD(function(){e._scheduleCaptionForFadeOut()})},t)},_scheduleCaptionForFadeOut:function(){var e=this;this._captionVisible&&this._captionViews.length>0&&(this._hideCaptionTaskHandle=setTimeout(function(){e._fadeOutCaption(function(){})},n))},_getHUDViewLayer:function(){return this.slideshowView.hudView.layer},_getCaptionViewLayer:function(){return this.slideshowView.captionView.layer},_collectJQueryElementsForViews:function(e){var t=$(),n=e.length;for(var r=0;r<n;r++)t=t.add(e[r].layer);return t},_getAllJQueryHUDElements:function(){var e=this._jqueryHUDElements
;return e||(e=this._jqueryHUDElements=this._collectJQueryElementsForViews(this._hudViews)),e},_getAllJQueryCaptionElements:function(){var e=this._jqueryCaptionElements;return e||(e=this._jqueryCaptionElements=this._collectJQueryElementsForViews(this._captionViews)),e},_getAllJQueryElements:function(){var e=this._allJQueryElements;return e||(e=$(),e=e.add(this._getAllJQueryHUDElements()),e=e.add(this._getAllJQueryCaptionElements()),this._allJQueryElements=e),e},_clearAllScheduledTasks:function(){this._hideHUDTaskHandle&&clearTimeout(this._hideHUDTaskHandle),this._hideCaptionTaskHandle&&clearTimeout(this._hideCaptionTaskHandle),this._hideHUDTaskHandle=null,this._hideCaptionTaskHandle=null},_fadeOutHUD:function(t){var n=this._getAllJQueryHUDElements();this._hudVisible=!1,n.finish();var r=!1;n.fadeOut(e,function(){r||(r=!0,t())})},_fadeOutCaption:function(t){var n=this._getAllJQueryCaptionElements();this._captionVisible=!1,n.finish();var r=!1;n.fadeOut(e,function(){r||(r=!0,t())})}})}(),Photos.timeLocalizer=Core.Object.create({localize:function(e){var t=e.getHours(),n=e.getMinutes(),r="",i="_Stream.BatchSummary.TimeFormat".loc();return i.match(/p/)&&(r=t>=12?"_PM".loc():"_AM".loc(),t===0?t=12:t!==12&&(t%=12)),i.replace("hh",t).replace("mm",n<10?"0"+n:n).replace("p",r)}});var MIN_LOAD_TIME=30;Photos.Tracer=Core.Object.extend({feedbackStatsService:null,imageLoadeeLoadedImageForURL:function(e,t,n,r){if(r<MIN_LOAD_TIME)return;var i=this.feedbackStatsService,s=n.match(/^https?:\/\/([\w\-\.]+)/)[1];i.report("photoRequestInfo",{loadTime:r,sourceHost:s,imageWidth:t.width,imageHeight:t.height
,imageFileSize:e.requests[0].rep.fileSize})}}),Photos.videoDetector=CoreImage.VideoDetector.create({}),Photos.CanvasImageView=CoreImage.AbstractImageView.extend({className:"CanvasImageView",classNames:"canvas-image-view".w(),maxImageWidth:0,maxImageHeight:0,_generateCanvasElement:function(){if(!this.layer||this.canvas)return;var e=this.canvas=document.createElement("canvas"),t=e.getContext("2d"),n=t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||1,r=window.devicePixelRatio||1,i=r/n;this.backingRatio=n,this.deviceRatio=r,this.canvasMathMultiplier=i,t.scale(i,i),t.save(),e.width=this.get("maxImageWidth")*i,e.height=this.get("maxImageHeight")*i,e.style.position="absolute",e.style.zIndex="1",e.style.top="0px",e.style.left="0px",e.style.width="100%",e.style.height="100%",this.layer.appendChild(e),this.layer.style.top="0px",this.layer.style.left="0px",this.layer.style.right="0px",this.layer.style.bottom="0px"},fadeInIfFirstLoaded:B.msie===8||B.android?undefined:function(){if(this._lastImageExample||this._hasFaded)return;this._lastImageExample=this.currentImageExample;if(!this.isAppendedInWindow)return;this.set("fadeInAnimation",Anim.Fader.go({element:this.layer,from:0,to:1,duration:350,owner:this,unsetOnFinish:function(){this.owner.set("fadeInAnimation",null)}.observes("finish")})),this._hasFaded=YES}.observes("currentImageExample"),killFaderWhenRemoved:function(){this.isAppendedInWindow||(Anim.tellFinish(this.fadeInAnimation),this.setIfChanged("fadeInAnimation",null))}.observes("isAppendedInWindow"),_updateCanvas:function(
){if(!this.layer||!this.currentImageExample)return;this._generateCanvasElement();var e=this.currentImageExample,t=this.canvas,n=t.width,r=t.height,i=e.width,s=e.height,o=Photos.gridItemBoundaryTransformer.transformByFrame(i,s,n,r),u=t.getContext("2d");u.drawImage(e,o.translateX,o.translateY,o.width,o.height);var a=this;setTimeout(function(){a.turnOffIfHasGottenBiggestRepInRepSet()},0)}.observes("currentImageExample"),turnOffIfHasGottenBiggestRepInRepSet:function(){if(!this.hasSuccessfullyLoadedBiggestRepInRepSet||this.isOff)return;this.set("isOff",YES);var e=this.loadees[this.biggestRepSizeInRepSet];e&&e.unload&&e.unload()}}),require("mixins/photo_grid_item_image_view_support"),require("views/canvas_image"),Photos.CanvasPhotoGridItemImageView=Photos.CanvasImageView.extend(Photos.PhotoGridItemImageViewSupport,{widthBinding:"from:.maxImageWidth",heightBinding:"from:.maxImageHeight",shouldRespectPhotoAspectRatio:NO,gridItemWantsTemporaryImageOverlay:NO,wantsTemporaryImageOverlay:NO,isRecentlyAppendedInWindow:NO,gridItemWidth:NaN,gridItemHeight:NaN,sizeBiasForCurrentAndPreferredReps:function(){var e=this.photo;if(!e)return 0;var t=e.width,n=e.height,r=this.get("maxImageWidth"),i=this.get("maxImageHeight"),s=Photos.gridItemBoundaryTransformer.transformByFrame(t,n,r,i);return Math.max(s.width,s.height)},maxImageWidth:function(){var e=650;return Math.ceil(e/this.getPath("gridItem.maxColumnWidth")*this.getPath("gridItem.columnWidth"))}.property(),maxImageHeight:function(){var e=650,t=this.gridItem,n=Math.ceil(e/t.maxColumnWidth*t.rowHeight);return this.shouldRespectPhotoAspectRatio&&
(n*=Photos.gridItemPhotoHeightScalerStrategy.calculateForPhoto(this.photo)),n}.property(),_maintain_isRecentlyAppendedInWindow:function(){this.isAppendedInWindow?(this.setIfChanged("isRecentlyAppendedInWindow",YES),this._cancelRAIWUnset()):this._scheduleRAIWUnset()}.observes("isAppendedInWindow"),_scheduleRAIWUnset:function(){if(this._raiwUnsetTimeout)return;this._raiwUnsetTimeout=setTimeout(this._unsetRAIW,200)},_unsetRAIW:function(){var e=this;this._unsetRAIW=function(){e._cancelRAIWUnset(),e.setIfChanged("isRecentlyAppendedInWindow",NO)}}.observes("init"),_cancelRAIWUnset:function(){clearTimeout(this._raiwUnsetTimeout),this._raiwUnsetTimeout=null},_maintain_wantsTemporaryImageOverlay:function(){this.setIfChanged("wantsTemporaryImageOverlay",!!this.gridItemWantsTemporaryImageOverlay&&!this.fadeInAnimation)}.observes("gridItemWantsTemporaryImageOverlay","fadeInAnimation"),_provideTempImageOverlay:function(){if(!this.isRecentlyAppendedInWindow||!this.wantsTemporaryImageOverlay||!this.hasSuccessfullyLoadedBiggestRepInRepSet||!this.currentSrc||B.msie===8)return;if(this._pendingTempImage||this._currentTempImage)return;var e=this.reps[this.biggestRepSizeInRepSet].url;if(!e){this._wantsTemporaryImageOverlayInterval||(this._wantsTemporaryImageOverlayInterval=setInterval(this._pollWantsTemporaryImageOverlay,250));return}var t=Photos.imagePool.getInstance();this.setIfChanged("_pendingTempImage",t),t.src=e,t.onload=this._tempImageOverlayDidLoad}.observes("wantsTemporaryImageOverlay","isRecentlyAppendedInWindow","hasSuccessfullyLoadedBiggestRepInRepSet","currentSrc"),_wantsPollCount:0
,_pollWantsTemporaryImageOverlay:function(){var e=this;this._pollWantsTemporaryImageOverlay=function(){++e._wantsPollCount>=240&&e._clearWantsTemporaryImageOverlayPoll(YES),e.trigger("wantsTemporaryImageOverlay")}}.observes("init"),_clearWantsTemporaryImageOverlayPoll:function(e){if(!this.isRecentlyAppendedInWindow||this._pendingTempImage||this._currentTempImage||e===YES)clearInterval(this._wantsTemporaryImageOverlayInterval),this._wantsTemporaryImageOverlayInterval=null,this._wantsPollCount=0}.observes("isRecentlyAppendedInWindow","_pendingTempImage","_currentTempImage"),_cancelTempImageOverlay:function(){if(this.isRecentlyAppendedInWindow||this.wantsTemporaryImageOverlay||!this._pendingTempImage)return;var e=this._pendingTempImage;e&&(Photos.imagePool.disposeInstance(e),this.setIfChanged("_pendingTempImage",null))}.observes("isRecentlyAppendedInWindow","wantsTemporaryImageOverlay"),_removeTempImageOverlay:function(){if(!this.layer||this.isRecentlyAppendedInWindow||!this._currentTempImage)return;var e=this._currentTempImage;this.setIfChanged("_currentTempImage",null),e&&(e.parentNode&&e.parentNode.removeChild(e),Photos.imagePool.disposeInstance(e))}.observes("isRecentlyAppendedInWindow"),_tempImageOverlayDidLoad:function(){var e=this;this._tempImageOverlayDidLoad=function(){var t=e._pendingTempImage;e.setIfChanged("_pendingTempImage",null),e.setIfChanged("_currentTempImage",t),e.layer.appendChild(t),e.trigger("gridItemSizeDidChange")}}.observes("init"),doTempImageOverlayLayout:function(){var e=this._currentTempImage,t=this.canvas;if(!e||!t)return;var n=e.naturalWidth||e.width
,r=e.naturalHeight||e.height,i=t.width,s=t.height,o=this.gridItemWidth,u=this.gridItemHeight,a=Core.innerSizeInOuter(n,r,i,s,!0),f=a.width*o/i,l=a.height*u/s,c=e.style;c.top="0px",c.left=(o-f)/2+"px",c.width=f+"px",c.height=l+"px",c.zIndex=2,c.position="absolute"}.observes("gridItemSizeDidChange")}),Photos.imagePool={pool:[],totalInstanceCount:0,getInstance:function(){var e=this.pool.pop();return e?e:(this.totalInstanceCount++,new Image)},disposeInstance:function(e){e.src=Core.emptyImageSrc,e.onload=e.onerror=this._disposeOnLoadFunction},stats:function(){Core.debug("Total objects: "+this.totalInstanceCount+"\n"+"Active objects: "+(this.totalInstanceCount-this.pool.length)+"\n"+"Dormant objects: "+this.pool.length)},_disposeOnLoadFunction:function(){this.onload=this.onerror=null,Photos.imagePool.pool.push(this)}},Photos.DomImageView=CoreImage.AbstractImageView.extend({classNames:"dom-image-view".w(),shouldRetainImage:!1,_generateImageElement:function(){if(!this.layer||this.image)return;var e=this.image=document.createElement("img");e.style.position="absolute",this.layer.style.top="0px",this.layer.style.left="0px",this.layer.style.right="0px",this.layer.style.bottom="0px";var t=this;e.onload=function(){t.layer.appendChild(this),this.onload=null}},_updateToCurrentSrc:function(){if(!this.layer)return;var e=this.currentSrc,t=this.image;if(!e&&t){t.onload=t.onerror=null,t.src=Core.emptyImageSrc,t.parentNode&&t.parentNode.removeChild(t),t=this.image=null;return}if(!e)return;this._generateImageElement(),t=this.image,t.src=this.currentSrc;var n=this.cellSize,r=this.currentRep.width,i=
this.currentRep.height,s=this.get("maxImageWidth"),o=this.get("maxImageHeight");if(r===0||i===0)return;var u=Photos.gridItemBoundaryTransformer.transformByFrame(r,i,s,o);t.style.left=u.translateX+"px",t.style.top=u.translateY+"px",t.style.width=u.width+"px",t.style.height=u.height+"px"}.observes("currentSrc","cellSize","render"),unloadBigRepWhenRemoved:function(){if(this.isAppendedInWindow||!this.loadees)return;var e=this.loadees[this.biggestRepSizeInRepSet];if(!e)return;this.set("maximumRepSize",1),e.unload&&e.unload()}.observes("isAppendedInWindow"),reinstateBigGuyWhenAppended:function(){if(!this.isAppendedInWindow)return;this.set("maximumRepSize",Infinity)}.observes("isAppendedInWindow")}),require("mixins/photo_grid_item_image_view_support"),require("views/dom_image"),Photos.DomPhotoGridItemImageView=Photos.DomImageView.extend(Photos.PhotoGridItemImageViewSupport,{cellSize:0,gridItem:null,widthBinding:"from:.maxImageWidth",heightBinding:"from:.maxImageHeight",maxImageWidth:function(){var e=this.cellSize*this.getPath("gridItem.columnWidth");return e||512}.property(),maxImageHeight:function(){var e=this.gridItem,t=this.cellSize*e.rowHeight;return this.shouldRespectPhotoAspectRatio&&(t*=Photos.gridItemPhotoHeightScalerStrategy.calculateForPhoto(this.photo)),t||512}.property()}),Photos.ErrorPageView=Core.View.extend({_IGNORE_OBSERVATION_WARNINGS_FOR_PATHS:{"#owner":YES},errorType:null,title:null,caption:null,rootHTML:'<div class="error-page"><div class="body"><div class="image"></div><p class="title"></p><p class="caption"></p></div><div class="footer"><div class="logo" onclick="window.open(\''+"_URL.ApplePhotoStream"
.loc()+"');\"></div>"+'<div class="legal">'+"_ErrorPage.Footer.Legal".loc((new Date).getFullYear())+"</div>"+"</div>"+"</div>",bodyElement:"layer.firstChild",imageElemElement:"body.firstChild",titleElemElement:"body.childNodes.1",captionElemElement:"body.lastChild",footerElement:"layer.lastChild",renderTitle:function(){if(!this.titleElem)return;this.titleElem.innerHTML=this.title}.observes("render","title"),renderCaption:function(){if(!this.captionElem)return;this.captionElem.innerHTML=this.caption}.observes("render","caption"),renderErrorType:function(){if(!this.layer)return;var e=$(this.layer);this._lastErrorType&&e.removeClass(this._lastErrorType),this.errorType&&e.addClass(this.errorType),this._lastErrorType=this.errorType}.observes("render","errorType"),_updateClassNames:function(){$(this.layer).addClass(Photos.get("deviceMode"))}.observes("render")}),Photos.ExitSlideshowButtonView=Core.ButtonView.extend({rootHTML:'<div class="exit-slideshow"><div class="chevron"></div><span class="title"></span></div>',title:null,actionDelay:0,action:function(e){Photos.stateManager.sendAction("exitSlideshow")},maxWidth:function(){return widthForText(this.title,"SFNSText",20)+19}.property(),_updateTitle:function(){var e=this.layer;if(!e)return;var t=Core.escapeHTML(this.title),n=$(e).find(".title");n[0].innerHTML=t}.observes("render","title")}),WIDTH_FOR_TEXT_ELEMENT=document.createElement("span"),window.widthForText=function(e,t,n){var r=WIDTH_FOR_TEXT_ELEMENT,i=r.style;i.position="absolute",i.visibility="hidden",i.fontFamily=t||"",i.fontSize=n+"px"||"",r.innerHTML=Core.escapeHTML(e),document
.body.appendChild(r);var s=r.clientWidth;return document.body.removeChild(r),s},Photos.MissingPhotoNoticeView=Core.View.extend({rootHTML:'<div class="missing-image"><div class="icon"></div><div class="caption"></div></div>',iconElemElement:"layer.firstChild",captionElemElement:"layer.lastChild",caption:null,deviceMode:null,_updateClassNames:function(){if(!this.layer)return;var e;switch(this.get("deviceMode")){case Photos.DeviceMode.Desktop:e="desktop";break;case Photos.DeviceMode.Mobile:e="mobile"}$(this.layer).addClass(e)}.observes("render","deviceMode"),renderCaption:function(){if(!this.layer)return;this.captionElem.innerHTML=this.caption+""}.observes("caption","render")}),function(){Photos.PhotoGridItemView||(Photos.PhotoGridItemView={});var e=Photos.PhotoGridItemView;e.ImageViewController=Core.Object.extend(CoreImage.ImageViewDelegate,{photoGridItemView:null,photo:null,imageView:null,visibleRegion:null,scrollTracker:null,shouldResumeImageLoading:YES,hasAllRequiredImagesLoaded:NO,init:function(){this._establishReps=!0,arguments.callee.base.apply(this,arguments)},requiresPhotoDerivativesUpdated:function(){var e=this.visibleRegion,t=e.viewWithinVisibleRegion,n=e.viewInExtendedVisibleRegion,r=this.scrollTracker.scrollSpeed;if(this.hasAllRequiredImagesLoaded||this.imageView.get("isLoadingImage")||!t&&!n||r>3e3)return NO;var i=this.photo;return!!i&&(i.get("missingDerivativeUrls")||i.get("hasExpiredDerivatives"))}.property(),refresh:function(){this.visibleRegion.update();var e=this.visibleRegion,t=e.viewWithinVisibleRegion,n=e.viewInExtendedVisibleRegion,r=this.scrollTracker.scrollSpeed
;if(r>3e3||!t&&!n)return;this._updateImportance()},resumeImageLoadingIfNeeded:function(){if(this.hasAllRequiredImagesLoaded)return;var e=this.imageView;this.get("shouldResumeImageLoading")?e.resumeLoadingImageIfNeeded():e.pauseLoadingImageIfNeeded()},imageViewShouldAutomaticallyEstablishCurrentAndPreferredReps:function(e){return NO},imageViewWillPrepareImageLoadForRep:function(e,t){this.refresh()},imageViewImageValidToLoadForRep:function(e,t){return!e.photo.get("hasExpiredDerivatives")},imageViewImageLoadAbortedForRep:function(e,t){this.imageView._lastReps=null},imageViewFailedToLoadImageForRep:function(e,t){this._establishReps=!1,this.photoGridItemView.imageViewFailedToLoadImageForRep(e,t)},imageViewSuccessfullyLoadedImageForRep:function(e,t){this.photoGridItemView.imageViewSuccessfullyLoadedImageForRep(e,t)},imageViewShouldEstablishCurrentAndPreferredReps:function(e){return this._establishReps},_updateImportance:function(){var e=this.visibleRegion,t=this.imageView,n=this.photo,r=0,i=e.viewTopPosition;e.viewAllWithinVisibleRegion||e.viewOverflowingVisibleRegion?r=41e8-i:e.topOfViewInVisibleRegion?r=4e9-i:e.bottomOfViewInVisibleRegion?r=4e9+i:e.viewAboveVisibleRegion?r=i:e.viewBelowVisibleRegion&&(r=Math.floor(1/i*1e8));var s=t?t.preferredRep:null,o=n?n.smallestDerivative:null;s&&o&&s!==o&&(r-=5e8,t&&t.getPath("isSmallestSquare")&&(r-=5e8)),t&&t.set("importance",r),n&&n.set("importance",r)}})}(),require("views/photo_grid_item/image_view_controller"),function(){var e=Photos.PhotoGridItemView.ImageViewController;e.Desktop=e.extend({_maintainObserverFor_imageView_wantsTemporaryImageOverlay
:function(){var e=this.imageView;if(e===this._lastImageView)return;this._lastImageView&&this._lastImageView.unlisten("wantsTemporaryImageOverlay",this._handleChange_imageView_wantsTemporaryImageOverlay),e&&e.listen("wantsTemporaryImageOverlay",this._handleChange_imageView_wantsTemporaryImageOverlay),this._lastImageView=e}.observes("imageView"),_handleChange_imageView_wantsTemporaryImageOverlay:function(){var e=this;this._handleChange_imageView_wantsTemporaryImageOverlay=function(){if(!e.imageView||!e.imageView.wantsTemporaryImageOverlay||!e.imageView.get("isSmallestSquare"))return;if(e.photo.largestDerivative===e.photo.smallestDerivative)return;e.setIfChanged("hasAllRequiredImagesLoaded",NO),e.imageView.set("isOff",NO),e.imageView.reestablishingRepsIfNeeded(YES),setTimeout(t,10)};var t=function(){if(!e.imageView||!e.imageView.wantsTemporaryImageOverlay)return;e.resumeImageLoadingIfNeeded()}}.observes("init"),shouldLoadLargestDerivative:function(){var e=this.photo,t=e?e.get("smallestDerivative"):null,n=this.imageView;if(n&&n.wantsTemporaryImageOverlay)return YES;if(!t||!n)return NO;var r=n.get("maxImageWidth"),i=n.get("maxImageHeight"),s=0;return(r>i||r===i)&&t.width<r?s=Math.abs(r-t.width)/r:t.height<i&&(s=Math.abs(i-t.height)/i),s>.02}.property(),shouldResumeImageLoading:function(){return this._shouldFetchImageForRep(this.imageView.get("preferredRep"))}.property(),imageViewGetEstablishedCurrentRep:function(e){var t=this.photo,n=t.get("smallestDerivative"),r=t.get("largestDerivative");return e.hasImageForRep(r)||this._largestRepLoaded?r:e.hasImageForRep(n)||this._smallestRepLoaded?
n:null},imageViewGetEstablishedPreferredRep:function(e){var t=this.photo,n=t.get("smallestDerivative"),r=t.get("largestDerivative");return this._smallestRepLoaded&&this.get("shouldLoadLargestDerivative")?t.get("largestDerivative"):this._largestRepLoaded?null:t.get("smallestDerivative")},imageViewShouldImmediatelyStartLoadingImageForRep:function(e,t){return this._shouldFetchImageForRep(t)},imageViewSuccessfullyLoadedImageForRep:function(e,t){var n=this.get("photo");t===n.get("smallestDerivative")&&(this._smallestRepLoaded=!0,this.get("shouldLoadLargestDerivative")||this.set("hasAllRequiredImagesLoaded",!0)),t===n.get("largestDerivative")&&(this.set("hasAllRequiredImagesLoaded",!0),this._largestRepLoaded=!0),arguments.callee.base.apply(this,arguments)},_shouldFetchImageForRep:function(e){var t=this.visibleRegion,n=t.viewWithinVisibleRegion,r=t.viewInExtendedVisibleRegion,i=this.scrollTracker.scrollSpeed;if(i>3e3||!n&&!r)return NO;var s=this.photo,o=this.imageView,u=s.smallestDerivative===e,a=s.largestDerivative===e;return u&&i<=3e3&&(n||r)?YES:a&&i<=250&&n?YES:NO}})}(),require("views/photo_grid_item/image_view_controllers/desktop"),function(){var e=Photos.PhotoGridItemView.ImageViewController;e.IE8=e.Desktop.extend({shouldLoadLargestDerivative:NO})}(),require("views/photo_grid_item/image_view_controller"),function(){var e=Photos.PhotoGridItemView.ImageViewController;e.Mobile=e.extend({shouldResumeImageLoading:function(){var e=this.visibleRegion;return e.get("viewWithinVisibleRegion")||e.get("viewInExtendedVisibleRegion")}.property(),imageViewGetEstablishedCurrentRep:function(e
){return this._smallestRepLoaded?this.getPath("photo.smallestDerivative"):null},imageViewGetEstablishedPreferredRep:function(e){return this._smallestRepLoaded?null:this.photo.get("smallestDerivative")},imageViewShouldImmediatelyStartLoadingImageForRep:function(e,t){return this.get("shouldResumeImageLoading")},imageViewSuccessfullyLoadedImageForRep:function(e,t){t===this.photo.get("smallestDerivative")&&(this._smallestRepLoaded=!0,this.set("hasAllRequiredImagesLoaded",!0)),arguments.callee.base.apply(this,arguments)}})}(),function(){Photos.PhotoGridItemView||(Photos.PhotoGridItemView={});var e=Photos.PhotoGridItemView;e.VisibleRegion=Core.Object.extend({view:null,extendRegionTopDelta:0,extendedRegionBottomDelta:0,viewTopPosition:0,viewBottomPosition:0,topOfViewInVisibleRegion:NO,bottomOfViewInVisibleRegion:NO,viewOverflowingVisibleRegion:NO,viewAllWithinVisibleRegion:NO,viewWithinVisibleRegion:NO,viewInTopExtendedVisibleRegion:NO,viewInBottomExtendedVisibleRegion:NO,viewInExtendedVisibleRegion:NO,update:function(){var e=this.view,t=e.gridItem,n=B.mozilla||B.msie?document.documentElement:document.body,r=B.msie===8?n.clientHeight:window.innerHeight,i=Core.scrollTop(),s=Core.scrollHeight(),o=e.height,u=e.getAbsoluteTop(),a=u+o,f=u-i,l=f+o,c=f>=0&&f<=r,h=l>=0&&l<=r,p=f<0,d=l>r,v=c||h||p&&d;this._windowInnerHeight=r,this._bodyScrollTop=i,this._bodyScrollHeight=s,this._absViewTop=u,this._absViewBottom=a,this.viewTopPosition=f,this.viewBottomPosition=l,this.topOfViewInVisibleRegion=c,this.bottomOfViewInVisibleRegion=h,this.viewAboveVisibleRegion=!v&&!d,this.viewBelowVisibleRegion=!v&&!
p,this.viewOverflowingVisibleRegion=p&&d,this.viewAllWithinVisibleRegion=c&&h,this.viewWithinVisibleRegion=v,this._updateExtendedVisibleRegion()},_updateExtendedVisibleRegion:function(){var e=this._absViewTop,t=this._absViewBottom,n=this._bodyScrollTop,r=this._windowInnerHeight,i=this.extendRegionTopDelta,s=this.extendedRegionBottomDelta,o=e>=n-i&&t<=n,u=t<=n+r+s&&e>=n+r,a=o||u;this.viewInTopExtendedVisibleRegion=o,this.viewInBottomExtendedVisibleRegion=u,this.viewInExtendedVisibleRegion=a}})}(),Photos.PlaySlideshowToggleButtonView=Core.ButtonView.extend({rootHTML:'<span class="play-slideshow title"></span>',isPaused:!1,isEnabled:!1,playTitle:"",pauseTitle:"",playAria:"",pauseAria:"",action:function(){Photos.stateManager.sendAction("toggleShow")},_updateTitle:function(){this.layer.innerHTML=this.isPaused?this.pauseTitle:this.playTitle}.observes("render","isPaused"),_updateAriaLabel:function(){this.setIfChanged("ariaLabel",this.isPaused?this.playAria:this.pauseAria)}.observes("isPause","render")}),Photos.SpinnerView=Core.View.extend({rootHTML:'<div class="spinner"><div class="inner"></div></span>',size:null,top:null,left:null,center:NO,spin:null,handleRender:function(){if(!this.layer)return;var e=this,t=$(this.layer),n=this.layer.firstChild,r=this.size||Photos.SpinnerView.Size.Small;this.pos||(this.pos=0),t.addClass(r.type),this.spin?(Anim.tellStop(this._fader),this.set("isAppended",YES),this._spinnerInterval||(this._spinnerInterval=setInterval(function(){e.pos=(e.pos+1)%12,n.style.top=-e.pos*r.value+"px"},56)),setTimeout(function(){e.layer.style.opacity="",t.addClass("show")
.removeClass("hide")},0)):this.spin===!1&&this._spinnerInterval&&(this._fader=Anim.Fader.go({element:this.layer,from:1,to:0,duration:500,stopSpin:function(){clearInterval(e._spinnerInterval),e._spinnerInterval=undefined,t.addClass("hide").removeClass("show"),e.set("isAppended",NO)}.observes("finish")}))}.observes("spin","render","size"),adjustTop:function(){if(!this.layer||this.center)return;this.layer.style.top=this.top===null?null:this.top+"px"}.observes("top","render"),adjustLeft:function(){if(!this.layer||this.center)return;this.layer.style.left=this.left===null?null:this.left+"px"}.observes("left","render"),centerSpinner:function(){if(!this.layer||!this.center)return;$(this.layer).addClass("center")}.observes("center","render")}),Photos.SpinnerView.Size={Small:{type:"small",value:21},Large:{type:"large",value:42}},require("views/spinner"),Photos.SlideshowItemViewDelegate={isMixin:YES,isSlideshowItemViewDelegate:YES,imageViewExample:CoreImage.SlideshowPhotoMixin.imageView.extend({photo:null,establishReps:function(){var e=this.photo;if(!e||!e.get("largestDerivative"))this.set("done",!0),this.set("erred",!0),this.owner.showImageMissing();else{e.get("missingDerivativeUrls")||this.set("reps",e.get("derivatives"));var t=this;this._recDerivativesChanged||(this._recDerivativesChanged=function(){t.set("reps",this.get("derivatives"))}),this._prevRec!==e&&(this._prevRec&&this._prevRec.unlisten("derivatives",this._recDerivativesChanged),e.listen("derivatives",this._recDerivativesChanged),this._prevRec=e)}}.observes("photo","init")}),createImageViewForSlideshowItemView:function(e){var t=
this._createImageViewControllerForSlideHowItemView(e),n=this.imageViewExample,r=n.create({owner:e,photo:e.value,maximumRepSize:Infinity,delegate:t});return t.set("imageView",r),Photos.slideshowController.addImageViewController(t),r},_createImageViewControllerForSlideHowItemView:function(e){var t=Photos.SlideshowItemView.ImageViewController,n;Photos.get("deviceMode")===Photos.DeviceMode.Mobile?n=t.Mobile:n=t.Desktop;var r=n.create({slideshowItemView:e,photo:e.value});return r}},Photos.SlideshowItemView=Core.View.extend(Photos.SlideshowItemViewDelegate,CoreImage.SlideshowItemMixin,Core.PinchZoomability,CoreImage.SlideshowPhotoMixin,{typeInteger:Photos.SLIDESHOW_ITEM=1,classNames:"slideshow-item photo".w(),shouldAttemptToFillScreen:YES,missingImageParent:"layer",fadeInMissingImage:NO,doneLoadingImage:NO,erredLoadingImage:NO,shouldLockVerticalDragOnSwipe:YES,delegate:null,delegateValue:function(){var e=this.delegate;return e?e:this}.property(),isInSlideshowScope:function(){return this.owner.hasItemViewInScope(this)}.property(),positionRelativeToSlideshowCurrentItem:function(){return this.owner.positionOfItemRelativeToCurrentItem(this.value)}.property(),isCurrentView:function(){return this.owner.currentView===this}.property(),spinnerView:Photos.SpinnerView.extend({initiallyAppended:NO,center:YES,spin:NO,size:Photos.SpinnerView.Size.Large}),loadingImage:NO,missingImage:NO,imageView:null,ariaHideMe:function(){this.isVideo||this.layer.setAttribute("aria-hidden","true")}.observes("render"),_resetCanAllowZoom:function(){this.getPath("value.isVideo")&&(this.canAllowZoom=NO)}.observes("init"
),_createImageView:function(){var e=this.get("delegateValue"),t=e.createImageViewForSlideshowItemView(this);this.imageView=t,t.appendTo(this),this.doImageLayout()}.observes("render"),_handLoadingImageChange:function(){var e=this.loadingImage&&!this.missingImage&&this.isAppendedInWindow&&this===this.owner.currentView;this.spinnerView.set("spin",e),this.spinnerView.set("isAppended",e)}.observes("loadingImage","missingImage","isAppendedInWindow","didBecomeCurrent"),_handleMissingImageChange:function(){if(this._showingMissingImage)return;this.set("shouldAttemptToFillScreen",YES),this.set("shouldAvoidUpscaling",NO),this.setAvailableSize();var e=Photos.MissingPhotoNoticeView.create({classNames:"slideshow".w(),owner:this,caption:"_Slideshow.CannotLoadPhoto".loc(),deviceMode:Photos.get("deviceMode")});e.appendTo(this),this.isAppendedInWindow&&Anim.Fader.go({from:0,to:1,element:e.layer}),this._showingMissingImage=!0}.observes("missingImage"),fallBackOnMissingImage:function(){},removeMissingImage:function(){},shouldAutomaticallySize:function(){return!1},getSizeForFrame:function(e){var t=this.value,n={width:0,height:0},r;t.get("isVideo")?r=this._getVideoRepForValue(t):r=t.get("largestDerivative")||t.get("smallestDerivative");var i=t.width>t.height?"landscape":"portrait",s=r.width>r.height?"landscape":"portrait";i!==s?(n.width=r.height,n.height=r.width):(n.width=r.width,n.height=r.height);var o=n.width,u=n.height,a=e.width,f=e.height,l=o>a?a/o:1,c=u>f?f/u:1,h=l<c?l:c;return h!==1&&(n.width=o*h,n.height=u*h),n},_getVideoRepForValue:function(e){var t=e.videoDerivatives,n=null,r=null,i;for(
var s in t){i=t[s];if(!n||i.width<n.width)n=i;if(!r||i.width>r.width)r=i}var o=e.width>e.height?"landscape":"portrait",u=r,a=B.mozilla&&B.windows;if(this._isMobileDeviceMode()||(B.msie||a)&&o==="portrait")u=n;return u},_isMobileDeviceMode:function(){return Photos.get("deviceMode")===Photos.DeviceMode.Mobile},_isDesktopDeviceMode:function(){return Photos.get("deviceMode")===Photos.DeviceMode.Desktop},shouldAllowZoom:function(){return!this.value.get("isVideo")},notifySuccessfullyLoadedImageForRep:function(e){var t=this.slideshowController;t.slideshowItemViewDidSuccessfullyLoadImageForRep(this,e)},notifyFailedLoadedImageForRep:function(e){var t=this.slideshowController;t.slideshowItemViewDidFailToLoadImageForRep(this,e)}}),require("views/slideshow_item"),function(){Photos.SlideshowItemView||(Photos.SlideshowItemView={});var e=Photos.SlideshowItemView;e.ImageViewController=Core.Object.extend(CoreImage.ImageViewDelegate,{slideshowItemView:null,photo:null,imageView:null,shouldLoadLargestRep:YES,init:function(){this._establishReps=!0,arguments.callee.base.apply(this,arguments)},requiresPhotoDerivativesUpdated:function(){var e=this.photo;return!!e&&(e.get("missingDerivativeUrls")||e.get("hasExpiredDerivatives"))}.property(),updateImageViewIfNeeded:function(){var e=this.slideshowItemView,t=this.imageView,n=this.photo;e.get("isInSlideshowScope")?this._updateImportance():(t.abortImageLoad(),this._largeRepLoaded=!1,t.unloadImageForRep(n.largestDerivative)),t.reestablishingRepsIfNeeded()},imageViewImageValidToLoadForRep:function(e,t){return!e.photo.get("hasExpiredDerivatives")},imageViewImageLoadAbortedForRep
:function(e,t){this.imageView._lastReps=null},imageViewDidUnloadImageForRep:function(e,t){var n=this.photo;t===n.get("smallestDerivative")&&(this._smallRepLoaded=!1),t===n.get("largestDerivative")&&(this._largeRepLoaded=!1)},imageViewShouldAutomaticallyEstablishCurrentAndPreferredReps:function(e){return NO},imageViewFailedToLoadImageForRep:function(e,t){this._establishReps=!1,!this._smallRepLoaded&&!this._largeRepLoaded&&(this.slideshowItemView.set("missingImage",YES),this.slideshowItemView.notifyFailedLoadedImageForRep(t))},imageViewShouldEstablishCurrentAndPreferredReps:function(e){return this._establishReps},imageViewGetEstablishedCurrentRep:function(e){var t=e.photo;return this._largeRepLoaded?t.get("largestDerivative"):this._smallRepLoaded?t.get("smallestDerivative"):null},imageViewGetEstablishedPreferredRep:function(e){var t=this.slideshowItemView,n=this.photo;return this._smallRepLoaded?!this._largeRepLoaded&&this.get("shouldLoadLargestRep")?n.get("largestDerivative"):null:n.get("smallestDerivative")},imageViewWillPrepareImageLoadForRep:function(e,t){this._updateImportance(),!this._smallRepLoaded&&!this._largeRepLoaded&&this.slideshowItemView.set("loadingImage",YES)},imageViewSuccessfullyLoadedImageForRep:function(e,t){var n=e.photo;n.get("smallestDerivative")===t&&(this._smallRepLoaded=!0),n.get("largestDerivative")===t&&(this._largeRepLoaded=!0),this.slideshowItemView.set("loadingImage",NO),this.slideshowItemView.notifySuccessfullyLoadedImageForRep(t)},_updateImportance:function(){var e=this.slideshowItemView,t=this.imageView,n=this.photo,r=0,i=e.get("positionRelativeToSlideshowCurrentItem"
);i===0?r=4e9:i!==null?(r=1e9+Math.floor(1/Math.abs(i)*1e3),i>0&&(r+=i)):r=0;var s=t?t.preferredRep:null,o=n?n.smallestDerivative:null;s&&o&&s!==o&&(r-=1e8),t&&t.set("importance",r),n&&n.set("importance",r)}})}(),require("views/slideshow_item/image_view_controller"),function(){var e=Photos.SlideshowItemView.ImageViewController;e.Desktop=e.extend({shouldLoadLargestRep:function(){var e=this.slideshowItemView,t=e.get("positionRelativeToSlideshowCurrentItem");return t>=-1&&t<=2}.property()})}(),require("views/slideshow_item/image_view_controller"),function(){var e=Photos.SlideshowItemView.ImageViewController;e.Mobile=e.extend({shouldLoadLargestRep:function(){if((B.onlyiOS||B.android)&&window.screen.height>=568&&window.devicePixelRatio>=2){var e=this.slideshowItemView,t=e.get("positionRelativeToSlideshowCurrentItem");return t>=-1&&t<=2}return NO}.property()})}(),Photos.SlideshowVideoPlayerView=CoreImage.VideoPlayerView.extend({getVideoImplementationTypeForVideoFormat:function(e){var t=B.mobile&&B.silk;if(t||B.winXP||B.msie<=8)return CoreImage.VideoPlayerView.VIDEO_IMPL_NONE;var n=Photos.videoDetector.choices[e];switch(n){case"html5":return CoreImage.VideoPlayerView.VIDEO_IMPL_HTML5;case"quicktime":return CoreImage.VideoPlayerView.VIDEO_IMPL_QUICKTIME}return CoreImage.VideoPlayerView.VIDEO_IMPL_NONE},processUrlsForValue:function(e,t,n){var r=Photos.createVideoUrlsDataSource();r.processUrlsForValue(e,t,n)},getPreferredVideoRepForValue:function(e){var t=e.videoDerivatives,n=null,r=null,i;for(var s in t){i=t[s];if(!n||i.width<n.width)n=i;if(!r||i.width>r.width)r=i}var o=Photos.get("deviceMode"
)===Photos.DeviceMode.Mobile,u=e.width>e.height?"landscape":"portrait",a=r,f=B.mozilla&&B.windows;if(o||(B.msie||f)&&u==="portrait")a=n;return a}}),require("views/slideshow_video_player_view"),function(){Photos.SlideshowPageView=CoreImage.SlideshowView.extend({classNames:"slideshow-page full-width full-height".w(),typeInteger:Photos.SLIDESHOW,initiallyAppended:NO,preserveUpSlideGPULayers:B.iOS||B.safari,videoViewExample:Photos.SlideshowVideoPlayerView,init:function(){this._frameWidth=0,this._frameHeight=0,this.chromeManager=Photos.SlideshowChromeManager.create({slideshowView:this}),arguments.callee.base.apply(this,arguments)},adjustFrameSize:function(e,t){},hideZoomImageItem:function(){this.currentView&&(this.currentView.layer.style.display="none")},unhideZoomImageItem:function(){this.currentView&&(this.currentView.layer.style.display="")},getBigZoomInfo:function(){var e=this.currentView;return!e||!e.getBigZoomInfo?null:e.getBigZoomInfo()},clearSelfOnExit:function(){if(this.isShowing)return;this.set("currentItem",null)}.observes("didFinishTransition"),computeAvailableRectFromWindow:function(){this.suspendTriggers(),arguments.callee.base.apply(this,arguments),this.discardSuspendedTriggers(),this.resumeTriggers();var e=this.availableRect;(this._lastAvHeight!==(this._lastAvHeight=e.height)||this._lastAvWidth!==(this._lastAvWidth=e.width)||this._lastAvBottom!==(this._lastAvBottom=e.bottom)||this._lastAvTop!==(this._lastAvTop=e.top))&&this.trigger("availableRect")}.observes("Core.windowSize","render","currentItem"),hideOverflowOnEnter:function(){this.isShowing&&Core.bodyOverflowArbitrator
.requestHidden(this)}.observes("willEnterTransition"),unhideOverflowOnExit:function(){this.isShowing||Core.bodyOverflowArbitrator.withdrawRequest(this)}.observes("didFinishTransition"),hideSelfOnExit:function(e,t,n){if(e!==this)return;this.layer.setAttribute("aria-hidden","true")}.observes("didFinishTransition"),_fixAndroidScrolling:function(){if(!B.android||!this.isAppendedInWindow)return;Core.scrollTop(0)}.observes("isAppendedInWindow"),_updateChromeOnWillEnterTransition:function(e,t){e===this?this.willStartTransitionToHideSlideshowView():this.willStartTransitionToShowSlideshowView()}.observes("willEnterTransition"),_updateChromeOnDidFinishTransition:function(e,t){t===this?this.didFinishTransitionToShowSlideshowView():this.didFinishTransitionToHideSlideshowView()}.observes("didFinishTransition"),willStartTransitionToShowSlideshowView:function(){},willStartTransitionToHideSlideshowView:function(){},didFinishTransitionToShowSlideshowView:function(){},didFinishTransitionToHideSlideshowView:function(){}})}(),function(){Photos.XDesktopSlideshowHeaderView=Core.View.extend({classNames:"x-slideshow-header desktop".w(),rootHTML:'<div><div class="left-container"></div><div class="right-container"></div></div>',leftContainerElement:"layer.firstChild",rightContainerElement:"layer.lastChild",isPermanent:NO,currentItem:null,width:0,renderDidTrigger:function(){var e=this.leftContainer,t=this.rightContainer,n=this._exitButton=this._createExitButtonView(),r=this._slideshowButton=this._createSlideshowButtonView(),i=this._downloadButton=this._createDownloadButtonView(),s=this._fullscreenButton=
this._createFullscreenButtonView();n.append(e),r.append(t),i.append(t),CoreImage.get("fullScreenSupported")&&s.append(t),B.msie<=8&&$(this.layer).addClass("ie8")}.observes("render"),pointerClick:function(e){this.mouseClick()},mouseClick:function(e){Core.stopPropagatingEvent(e)},_createExitButtonView:function(){return Photos.ExitSlideshowButtonView.create({owner:this,titleBinding:"from:Photos.sessionInfoController.streamTitle"})},_createSlideshowButtonView:function(){return Photos.PlaySlideshowToggleButtonView.create({owner:this,isPausedBinding:"from:Photos.slideshowController.isPlaying",isEnabledBinding:"from:Photos.slideshowController.canPlay",playTitle:"_Slideshow.Desktop.Button.PlaySlideshow".loc(),pauseTitle:"_Slideshow.Desktop.Button.PauseSlideshow".loc(),playAria:"_Accessibility.Play".loc(),pauseAria:"_Accessibility.Pause".loc()})},_createDownloadButtonView:function(){return e.create({owner:this,itemBinding:".owner.currentItem"})},_createFullscreenButtonView:function(){return t.create({owner:this,isFullscreenBinding:"from:window.CoreImage.isFullScreen"})},_createNextItemButtonView:function(){return NextItemButtonView.create({owner:this})},_createPreviousItemButtonView:function(){return PreviousItemButtonView.create({owner:this})},_createItemDetailsView:function(){return ItemDetailsView.create({owner:this,itemBinding:".owner.currentItem"})},refreshLayout:function(){var e=this.width,t=15,n=8,r=this.rightContainer,i=this._exitButton.layer,s=this._exitButton.get("maxWidth");exitButtonWidth=s,rightContainerWidth=r.clientWidth;var o=rightContainerWidth+t,u=e-o;u<s?(exitButtonWidth=
s-(s-u),i.style.width=exitButtonWidth-n+"px"):i.style.width=""},_widthDidChange:function(){var e=this;setTimeout(function(){e.refreshLayout()},1)}.observes("width","Photos.slideshowController.isPlaying","window.CoreImage.isFullScreen")});var e=Core.ButtonView.extend({rootHTML:'<span class="download title">'+"_Slideshow.Desktop.Button.Download".loc()+"</span>",ariaLabel:"_Accessibility.Download".loc(),item:null,action:function(e){Photos.stateManager.sendAction("downloadItem",this.item)}}),t=Core.ButtonView.extend({rootHTML:'<span class="fullscreen title"></span>',isFullscreen:!1,actionDelay:0,action:function(){Photos.stateManager.sendAction("toggleFullscreenMode")},_upateTitle:function(){var e="_Slideshow.Desktop.Button.EnterFullscreen";this.isFullscreen&&(e="_Slideshow.Desktop.Button.ExitFullscreen"),this.layer.innerHTML=e.loc()}.observes("render","isFullscreen"),_updateAriaLabel:function(){this.setIfChanged("ariaLabel",this.isFullscreen?"_Accessibility.ExitFullscreen".loc():"_Accessibility.EnterFullscreen".loc())}.observes("isFullscreen")})}(),Photos.XSlideshowCaptionView=Core.View.extend({classNames:"x-slideshow-caption",mainContainerKey:"mainContainer",detailsContainerKey:"detailsContainer",item:null,_renderDidTrigger:function(){RIGHT_TO_LEFT&&$(this[this.detailsContainerKey]).addClass("rtl")}.observes("render"),_update:function(){var e=this.layer;if(!this.layer)return;var t=this.item,n=t?t.get("caption"):"",r=t?t.get("contributor"):null,i=t?t.get("dateCreated"):null,s=t?Photos.timeLocalizer.localize(new Date(i)):"",o=t?Photos.dateLocalizer.localize(new Date(i)):"",u="_DateTime"
.loc({date:o,time:s}),a="";RIGHT_TO_LEFT?a=this._captionDetailsRightToLeft(r,u):a=this._captionDetailsLeftToRight(r,u);var f=this[this.mainContainerKey],l=this[this.detailsContainerKey];f.innerHTML=Core.escapeHTML(n),l.innerHTML=a}.observes("item","render"),_captionDetailsLeftToRight:function(e,t){var n="";return e&&(n+='<span class="name">'+Core.escapeHTML(e.fullName)+"</span>  &middot; "),n+='<span class="datetime">'+t+"</span>",n},_captionDetailsRightToLeft:function(e,t){var n="";return n+='<span class="datetime">'+t+"</span>",e&&(n+=' &middot; <span class="name">'+Core.escapeHTML(e.localizeFullName())+"</span>"),n}}),require("views/slideshow_page"),require("views/x_slideshow_caption_view"),function(){var e=Core.transitionBank;Photos.XDesktopSlideshowPageView=Photos.SlideshowPageView.extend({classNames:"desktop",leftTransitioners:[[null,null],[null,B.android||B.silk?null:e.xFadeSlideLeft.extend({duration:250})]],rightTransitioners:[[null,null],[null,B.android||B.silk?null:e.xFadeSlideRight.extend({duration:250})]],init:function(){this._chromeManager=Photos.SlideshowChromeManager.create(),arguments.callee.base.apply(this,arguments)},adjustFrameSize:function(e,t){this._headerView.set("width",e),this._fadeInAllChrome()},_createAccessoriesViews:function(){var e=this._chromeManager,r=this._headerView=Photos.XDesktopSlideshowHeaderView.create({owner:this,currentItemBinding:"from:.owner.currentItem",showItemDetails:!1}),i=this._captionView=t.create({owner:this,itemBinding:"from:.owner.currentItem"}),s=this._itemDetailsView=n.create({owner:this,itemBinding:"from:.owner.currentItem"
}),o=this._prevItemButton=Photos.XPreviousSlideshowItemButtonView.create({owner:this}),u=this._nextItemButton=Photos.XNextSlideshowItemButtonView.create({owner:this});e.addHUDView(r),e.addHUDView(o),e.addHUDView(u),e.addHUDView(s),e.addCaptionView(i),r.append(this),o.append(this),u.append(this),this._updateCaptionDisplayForItem(this.currentItem)}.observes("render"),mouseMove:function(){this._fadeInAllChrome()},pointerMove:function(){this._fadeInAllChrome()},_fadeInAllChrome:function(){var e=this._chromeManager;e.fadeInAllChrome(),e.scheduleFadeOutSequence()},pointerExited:function(e){this.mouseExited()},mouseExited:function(e){if(navigator.pointerEnabled||navigator.msPointerEnabled)return;var t=e.toElement||e.relatedTarget;t===null&&this._chromeManager.fadeOutAllChrome()},pointerClick:function(e){this.mouseClick()},mouseClick:function(e){if(navigator.pointerEnabled||navigator.msPointerEnabled)return;this.get("isShowingVideo")||Photos.stateManager.sendAction("showNextPhoto")},_showCaptionOnCurrentItemChange:function(){var e=this._captionView,t=this._chromeManager;this._updateCaptionDisplayForItem(this.currentItem),e.get("isAppended")&&t.showCaption(),t.scheduleFadeOutSequence()}.observes("currentItem"),_updateCaptionDisplayForItem:function(e){var t=this._captionView,n=this._itemDetailsView,r;if(!t||!n)return;e?e.caption?(t.append(this),n.remove()):(t.remove(),n.append(this)):(t.remove(),n.remove())},willStartTransitionToShowSlideshowView:function(){this._chromeManager.showAllChrome()},willStartTransitionToHideSlideshowView:function(){this._chromeManager.stop()},didFinishTransitionToShowSlideshowView
:function(){window.scrollTo(0,0),this._chromeManager.scheduleFadeOutSequence()},didStartShowingVideo:function(){var e=this._captionView,t=this._itemDetailsView,n=this._chromeManager;n.hideCaption(),n.removeCaptionView(e),n.removeHUDView(t),e.remove(),t.remove()},didStopShowingVideo:function(){var e=this._chromeManager,t=this._captionView,n=this._itemDetailsView;this._updateCaptionDisplayForItem(this.currentItem),e.addCaptionView(this._captionView),e.addHUDView(this._itemDetailsView),e.scheduleFadeOutSequence()}});var t=Photos.XSlideshowCaptionView.extend({classNames:"desktop",rootHTML:'<div><p class="main"></p><p class="details"></p></div>',mainContainerElement:"layer.firstChild",detailsContainerElement:"layer.lastChild"}),n=Core.View.extend({classNames:"item-details",rootHTML:'<div><p class="user"></p><p class="date"></p></div>',userElemElement:"layer.firstChild",dateElemElement:"layer.lastChild",item:null,_renderDidTrigger:function(){RIGHT_TO_LEFT&&$(this.dateElem).addClass("rtl")}.observes("render"),_itemDidChange:function(){if(!this.layer)return;var e=this.item,t=e?e.get("contributor"):null,n=t?t.localizeFullName():"",r=e?e.get("dateCreated"):"",i=e?Photos.dateLocalizer.localize(new Date(r)):"",s=e?Photos.timeLocalizer.localize(new Date(r)):"",o="_DateTime".loc({date:i,time:s});this.userElem.innerHTML=n,this.dateElem.innerHTML=o}.observes("render","item")})}(),Photos.XStreamView=Core.View.extend({refresh:function(){this._absoluteTop=null},getAbsoluteTop:function(){var e=this._absoluteTop;return e===null&&(e=this.top+this.owner.getAbsoluteTop()),e}}),require("views/x_stream_view"
),Photos.XStreamBodyView=Photos.XStreamView.extend({classNames:"x-stream-body-view".w(),top:0,width:0,height:0,photoGroups:null,photoGroupMargin:30,photoGroupViewExample:null,insetLeft:0,insetRight:0,init:function(){arguments.callee.base.apply(this,arguments),this.photoGroups=[],this._photoGroupViews=[],this._height=100},refresh:function(){arguments.callee.base.apply(this,arguments);var e=this.layer;if(!e)return;var t=this._photoGroupViews,n=t.length,r=this.photoGroupMargin,i=0,s;for(var o=0;o<n;o++)s=t[o],s.refresh(),s.set("top",i),i+=s.get("height"),o<n-1&&(i+=r);e.style.height=i+"px",this.height=i},addPhotoGroups:function(e){this.photoGroups=this.photoGroups.concat(e);var t=this._photoGroupViews,n=e.length,r;for(var i=0;i<n;i++)group=e[i],r=this.createPhotoGroupViewForPhotoGroup(group),r.append(this),t.push(r)},createPhotoGroupViewForPhotoGroup:function(e){var t=this.photoGroupViewExample,n=t.create({owner:this,photoGroup:e});return n},_topDidChange:function(){var e=this.layer;if(!e)return;e.style.top=this.get("top")+"px"}.observes("top"),_widthDidChange:function(){var e=this.layer,t=this.insetLeft,n=this.insetRight,r=this.width-t-n;e&&(e.style.width=r+"px",e.style.marginLeft=Math.floor(r/2)*-1+"px");var i=this._photoGroupViews,s=i.length;for(var o=0;o<s;o++)i[o].set("width",r)}.observes("width")}),require("views/x_stream_view"),function(){var e=15,t=Infinity,n=10,r=20,i=768,s=1024;Photos.XDesktopStreamPhotoGroupView=Photos.XStreamView.extend({classNames:"x-stream-photo-group-view desktop".w(),photoGroup:null,top:0,width:0,height:0,maxWidth:1e3,init:function(){arguments.callee
.base.apply(this,arguments);var e=this._infoView=this._createInfoView(),t=this._blocksView=this._createBlocksView();e.append(this),t.append(this)},refresh:function(){arguments.callee.base.apply(this,arguments);var e=this.width,t=this._blocksView,n=this._blocksMarginForWidth(e);t.set("margin",n),t.refresh();var r=this.height=t.get("height"),i=this.layer;i.style.height=r+"px"},_blocksMarginForWidth:function(e){if(e<=i)return n;if(e>=s)return r;var t=s-i,o=r-n,u=s-e,a=r-Math.ceil(o*u/t);return a},_topDidChange:function(){var e=this.layer;if(!e)return;e.style.top=this.get("top")+"px"}.observes("top"),_createInfoView:function(){var e=Photos.XDesktopStreamPhotoGroupInfoView.create({owner:this,photoGroup:this.photoGroup});return e},_createBlocksView:function(){var e=Photos.XStreamPhotoGroupBlocksContainerView.create({owner:this,photoGroup:this.photoGroup});return e},_widthDidChange:function(){var n=this._infoView,r=this._blocksView,i=this.width,s=t,o=i-(s+e);o<260&&(o=260,s=i-(o+e)),s<390&&(s=390,o=i-(s+e)),o<160&&(o=160,s=i-(o+e)),n.set("width",o),r.set("width",s)}.observes("width")})}(),require("views/x_stream_body_view"),require("views/x_desktop_stream_photo_group_view"),Photos.XDesktopStreamBodyView=Photos.XStreamBodyView.extend({classNames:"desktop".w(),photoGroupMargin:33,insetLeft:15,insetRight:15,maxWidth:1e3,photoGroupViewExample:Photos.XDesktopStreamPhotoGroupView,createPhotoGroupViewForPhotoGroup:function(e){var t=arguments.callee.base.apply(this,arguments),n=this.insetLeft,r=this.rightInset,i=this.maxWidth-n-r;return t.set("maxWidth",i),t}}),Photos.XStreamHeaderView=Core
.View.extend({classNames:"x-stream-header-view".w(),photoGroups:null,title:null,author:null,top:0,width:0,height:0,ariaRole:"banner",init:function(){arguments.callee.base.apply(this,arguments);var e=this._thumbnailView=this.createThumbnailView();e.append(this)},refresh:function(){},_photoGroupsDidChange:function(){var e=this.photoGroups,t=this._thumbnailView;t.set("photoGroups",e)}.observes("photoGroups")}),require("views/x_stream_header_view"),function(){var e=500;Photos.XDesktopStreamHeaderView=Photos.XStreamHeaderView.extend({height:45,rootHTML:'<div class="desktop"><div class="body"></div><div class="icon"></div><div class="background"></div></div>',bodyElemElement:"layer.firstChild",init:function(){arguments.callee.base.apply(this,arguments);var t=new n,r=this;t.duration=e,t.onend=function(){r._scrollToTopAnimDidEnd()},this._scrollToTopAnim=t},_update:function(){if(!this.layer)return;var e=this.bodyElem,t=Core.escapeHTML(this.title),n=this.author,r=n?Core.escapeHTML(n.firstName):null,i=n?Core.escapeHTML(n.lastName):null;e.innerHTML="_Stream.Header.ByTitle.Desktop".loc(t,r,i)}.observes("render","title","author"),createThumbnailView:function(){var e=Photos.XThumbnailView.create({owner:this,width:25,height:29});return e},pointerClick:function(e){this.mouseClick()},mouseClick:function(){if(!this._isScrollingToTop){this._isScrollingToTop=!0;var e=this._scrollToTopAnim;e.distance=Core.scrollTop(),e.run()}},_scrollToTopAnimDidEnd:function(){this._isScrollingToTop=!1}});var t=1e3/30,n=function(){var e=this;this._requestAnimationFrameCallback=function(){e._nextStep()}};n.prototype=
{duration:0,onend:null,run:function(){if(this._running)return;this._running=!0,this._startTime=Date.now(),this._requestAnimationFrame(this._requestAnimationFrameCallback)},step:function(e){var t=this.distance,n=this.duration,r=t-Math.ceil(t*e/n);r>=0&&window.scrollTo(0,r)},complete:function(){window.scrollTo(0,0)},_nextStep:function(){var e=Date.now(),t=e-this._startTime,n=this.duration;t>=n?(this.complete(),this._running=!1,this.onend()):(this.step(t),this._requestAnimationFrame(this._requestAnimationFrameCallback))},_requestAnimationFrame:function(e){var n=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame;n?n(e):setTimeout(e,t)}}}(),require("views/x_stream_view"),function(){function e(e,t,n){if(n>1)return;Photos.feedbackStatsService.report("streamViewInfo",{action:"adjustFrameSize",time:t})}function t(e,t,n){if(n>1)return;Photos.feedbackStatsService.report("streamViewInfo",{action:"addPhotoGroups",time:t})}Photos.XStreamPageView=Photos.XStreamView.extend({classNames:"x-stream-page-view".w(),initiallyAppended:NO,streamTitle:null,streamAuthor:null,delegate:null,photoGroups:null,typeInteger:Photos.STREAM,init:function(){this._adjustFrameSizeCallCount=0,this._addPhotoGroupsCallCount=0,arguments.callee.base.apply(this,arguments),this._frameHeight=null,this._frameWidth=null,this.photoGroups=[];var e=this.headerView=this.createHeaderView(),t=this.footerView=this.createFooterView(),n=this.bodyView=this.createBodyView();e.append(this),t.append(this),n.append(this)},adjustFrameSize:function(t,n){var r=this._adjustFrameSizeCallCount+=1,
i=(new Date).getTime(),s=this._frameWidth,o=this._frameHeight;this._frameWidth=t,this._frameHeight=n;var u=this.getBodyWidthForFrameWidth(t);s!==t?(this.headerView.set("width",t),this.footerView.set("width",t),this.bodyView.set("width",u),this.headerView.refresh(),this.bodyView.refresh(),this.footerView.refresh(),this.refresh()):o!==n&&this.refresh();var a=(new Date).getTime();e(this,a-i,r)},getBodyWidthForFrameWidth:function(e){return e},getAbsoluteTop:function(){return 0},refresh:function(){var e=this.headerView,t=this.footerView,n=this.bodyView,r=e.height,i=n.height,s=t.height,o=this.marginForHeader(),u=this.marginForFooter(),a=0,f=r+o,l=f+i+u,c=l+s;e.set("top",a),n.set("top",f);var h=this._frameHeight;if(c<h){var p=h-c;l+=p,c=h}t.set("top",l),this._height=c;var d=this.layer;d.style.height=c+"px"},addPhotoGroups:function(e){var n=this._addPhotoGroupsCallCount+=1,r=(new Date).getTime();this.photoGroups=this.photoGroups.concat(e),this.bodyView.addPhotoGroups(e),this.headerView.set("photoGroups",e);var i=(new Date).getTime();t(this,i-r,n)},marginForHeader:function(){return 20},marginForFooter:function(){return 15},createHeaderView:function(){return null},createFooterView:function(){return null},createBodyView:function(){return null},_adjustFooterView:function(){}})}(),require("views/x_stream_page_view"),function(){var e=Infinity,t=400;Photos.XDesktopStreamPageView=Photos.XStreamPageView.extend({classNames:"desktop".w(),marginForFooter:function(){return 30},getBodyWidthForFrameWidth:function(n){return Math.max(t,Math.min(e,n))},createHeaderView:function(){return Photos.XDesktopStreamHeaderView
.create({owner:this,titleBinding:"from:.owner.streamTitle",authorBinding:"from:.owner.streamAuthor"})},createFooterView:function(){return Photos.XDesktopStreamFooterView.create({owner:this})},createBodyView:function(){return Photos.XDesktopStreamBodyView.create({owner:this,maxWidth:e})}})}(),function(){Photos.XMobileSlideshowHeaderView=Core.View.extend({classNames:"x-slideshow-header mobile".w(),rootHTML:'<div><div class="left-container"></div><div class="right-container"></div></div>',leftContainerElement:"layer.firstChild",rightContainerElement:"layer.lastChild",isPermanent:NO,currentItem:null,width:0,_renderDidTrigger:function(){var e=this.leftContainer,t=this.rightContainer,n=this._exitButton=this._createExitButtonView(),r=this._slideshowButton=this._createSlideshowButtonView(),i=this._counterLabel=this._createCounterLabelView();n.append(e),r.append(t),i.append(this)}.observes("render"),touchStart:function(e){Core.stopPropagatingEvent(e)},touchEnd:function(e){Core.stopPropagatingEvent(e)},touchMove:function(e){Core.stopPropagatingEvent(e)},_createExitButtonView:function(){return Photos.ExitSlideshowButtonView.create({owner:this,titleBinding:"from:Photos.sessionInfoController.streamTitle"})},_createSlideshowButtonView:function(){return Photos.PlaySlideshowToggleButtonView.create({owner:this,isPausedBinding:"from:Photos.slideshowController.isPlaying",isEnabledBinding:"from:Photos.slideshowController.canPlay",playTitle:"_Slideshow.Mobile.Button.PlaySlideshow".loc(),pauseTitle:"_Slideshow.Mobile.Button.PauseSlideshow".loc(),playAria:"_Accessibility.Play".loc(),pauseAria:"_Accessibility.Pause"
.loc()})},_createCounterLabelView:function(){return e.create({owner:this,itemsBinding:"Photos.sortedPhotosController.photos"})},refreshLayout:function(){var e=this.width,t=15,n=15,r=8,i=this.rightContainer,s=this._exitButton.layer,o=this._counterLabel.layer,u=this._exitButton.get("maxWidth");exitButtonWidth=u,rightContainerWidth=i.clientWidth,counterLabelWidth=o.clientWidth;var a=rightContainerWidth+counterLabelWidth+t+n,f=e-a;f<u?(exitButtonWidth=u-(u-f),s.style.width=exitButtonWidth-r+"px"):s.style.width="";var l=Math.floor(e/2)-Math.floor(counterLabelWidth/2);l<exitButtonWidth+t&&(l=exitButtonWidth+t),o.style.left=l+"px"},_widthDidChange:function(){var e=this;setTimeout(function(){e.refreshLayout()},1)}.observes("width","Photos.slideshowController.isPlaying"),_currentItemDidChange:function(){if(!this._counterLabel)return;this._counterLabel.set("currentItem",this.currentItem),this.refreshLayout()}.observes("currentItem")});var e=Core.View.extend({classNames:"counter-label title",currentItem:null,items:null,_updateLabel:function(){if(!this.layer)return;var e=this.items,t=this.currentItem,n="";if(e&&t){var r=e.indexOf(t);n="_Slideshow.Mobile.Counter".loc(r+1,e.length)}this.layer.innerHTML=n}.observes("render","items","currentItem")})}(),require("views/slideshow_page"),require("views/x_slideshow_caption_view"),function(){var e=Core.transitionBank,t=e.slideLeft&&e.slideLeft.extend({tween:Anim.tweens.QUADRATIC_OUT,duration:200})||null,n=e.slideRight&&e.slideRight.extend({tween:Anim.tweens.QUADRATIC_OUT,duration:200})||null;Photos.XMobileSlideshowPageView=Photos.SlideshowPageView
.extend({classNames:"mobile",leftSwipeTransitioners:[[null,null],[null,t]],rightSwipeTransitioners:[[null,null],[null,n]],init:function(){this._chromeManager=Photos.SlideshowChromeManager.create(),arguments.callee.base.apply(this,arguments)},adjustFrameSize:function(e,t){this._headerView.set("width",e)},_createAccessoriesViews:function(){var e=this._chromeManager,t=this._headerView=Photos.XMobileSlideshowHeaderView.create({owner:this,currentItemBinding:"from:.owner.currentItem"}),n=this._captionView=r.create({owner:this,itemBinding:"from:.owner.currentItem"});this._prevItemButton=Photos.XPreviousSlideshowItemButtonView.create({owner:this}),this._nextItemButton=Photos.XNextSlideshowItemButtonView.create({owner:this}),e.addHUDView(t),e.addCaptionView(n),t.append(this),n.append(this)}.observes("render"),touchStart:function(e){return this._touchTapStarted||(this._touchTapStarted=!0,this._touchTapStartEvent=e),arguments.callee.base.apply(this,arguments)},touchEnd:function(e){if(this._touchTapStarted){var t=this._chromeManager,n=e.timeStamp-this._touchTapStartEvent.timeStamp;if(n<250){window.scrollTo(0,0);if(t.get("hudIsVisible"))t.fadeOutAllChrome();else{var r=0,i=this;t.fadeInAllChrome({step:function(e,t){r===1&&i._headerView.refreshLayout(),r++}}),t.scheduleFadeOutSequence()}}this._touchTapStarted=!1,this._touchTapStartEvent=null}return arguments.callee.base.apply(this,arguments)},touchMove:function(e){var t=this._chromeManager;return t.get("hudIsVisible")&&(t.showAllChrome(),t.scheduleFadeOutSequence()),this._touchTapStarted=!1,arguments.callee.base.apply(this,arguments)},willStartTransitionToShowSlideshowView
:function(){this._chromeManager.showAllChrome()},didFinishTransitionToShowSlideshowView:function(){this._headerView.refreshLayout(),this._chromeManager.scheduleFadeOutSequence()},didStartShowingVideo:function(){this._captionView.remove(),this._prevItemButton.append(this),this._nextItemButton.append(this),this._chromeManager.removeCaptionView(this._captionView),this._chromeManager.addHUDView(this._prevItemButton),this._chromeManager.addHUDView(this._nextItemButton)},didStopShowingVideo:function(){this._captionView.append(this),this._prevItemButton.remove(),this._nextItemButton.remove(),this._chromeManager.addCaptionView(this._captionView),this._chromeManager.removeHUDView(this._prevItemButton),this._chromeManager.removeHUDView(this._nextItemButton)}});var r=Photos.XSlideshowCaptionView.extend({classNames:"mobile",rootHTML:'<div><p class="main"></p><p class="details"></p></div>',mainContainerElement:"layer.firstChild",detailsContainerElement:"layer.lastChild"})}(),require("views/x_stream_view"),Photos.XMobileStreamPhotoGroupView=Photos.XStreamView.extend({classNames:"x-stream-photo-group-view mobile".w(),photoGroup:null,top:0,width:0,height:0,multipleContributors:function(){return Photos.photosController.get("hasMultipleContributors")}.property(),init:function(){arguments.callee.base.apply(this,arguments);var e=this._infoView=this._createInfoView(),t=this._blocksView=this._createBlocksView();e.append(this),t.top=e.height,t.append(this)},refresh:function(){arguments.callee.base.apply(this,arguments);var e=this._infoView,t=this._blocksView;t.refresh();var n=this.height=e.height+
t.height;this.layer.style.height=n+"px"},_topDidChange:function(){var e=this.layer;if(!e)return;e.style.top=this.get("top")+"px"}.observes("top"),_createInfoView:function(){var e=this.get("multipleContributors"),t;e?t=Photos.XMobileStreamPhotoGroupMultiContributorInfoView:t=Photos.XMobileStreamPhotoGroupSingleContributorInfoView;var n=t.create({owner:this,photoGroup:this.photoGroup});return n},_createBlocksView:function(){var e=Photos.XStreamPhotoGroupBlocksContainerView.create({owner:this,photoGroup:this.photoGroup,margin:4});return e},_widthDidChange:function(){this._blocksView.set("width",this.width)}.observes("width")}),require("views/x_stream_body_view"),require("views/x_mobile_stream_photo_group_view"),Photos.XMobileStreamBodyView=Photos.XStreamBodyView.extend({classNames:"mobile".w(),photoGroupMargin:20,photoGroupViewExample:Photos.XMobileStreamPhotoGroupView}),require("views/x_stream_header_view"),Photos.XMobileStreamHeaderView=Photos.XStreamHeaderView.extend({height:50,rootHTML:'<div class="mobile"><div class="body"><p class="title"></p><p class="author"></p></div><div class="icon"></div></div>',bodyElemElement:"layer.firstChild",titleElemElement:"layer.firstChild.firstChild",authorElemElement:"layer.firstChild.lastChild",_update:function(){if(!this.layer)return;var e=this.titleElem,t=this.authorElem,n=Core.escapeHTML(this.title),r=this.author,i=r?Core.escapeHTML(r.firstName):null,s=r?Core.escapeHTML(r.lastName):null;e.innerHTML=n,t.innerHTML="_Stream.Header.ByTitle.Mobile".loc(i,s)}.observes("render","title","author"),createThumbnailView:function(){var e=Photos.XThumbnailView
.create({owner:this,width:29,height:31});return e}}),require("views/x_stream_page_view"),function(){Photos.XMobileStreamPageView=Photos.XStreamPageView.extend({classNames:"mobile".w(),marginForFooter:function(){return 15},createHeaderView:function(){return Photos.XMobileStreamHeaderView.create({owner:this,titleBinding:"from:.owner.streamTitle",authorBinding:"from:.owner.streamAuthor"})},createFooterView:function(){return Photos.XMobileStreamFooterView.create({owner:this})},createBodyView:function(){return Photos.XMobileStreamBodyView.create({owner:this})}})}(),Photos.XNextSlideshowItemButtonView=Core.ButtonView.extend({classNames:"x-next-slideshow-item",ariaLabel:"_Accessibility.Next".loc(),isEnabledBinding:"from:Photos.slideshowController.canShowNextItem",allowEventPropogation:!1,action:function(){Photos.stateManager.sendAction("showNextPhoto")}}),Photos.XPreviousSlideshowItemButtonView=Core.ButtonView.extend({classNames:"x-previous-slideshow-item",ariaLabel:"_Accessibility.Previous".loc(),isEnabledBinding:"from:Photos.slideshowController.canShowPrevItem",allowEventPropogation:!1,action:function(){Photos.stateManager.sendAction("showPreviousPhoto")}}),Photos.XStreamFooterView=Core.View.extend({classNames:"x-stream-footer-view".w(),top:0,width:0,height:0,ariaRole:"contentinfo",refresh:function(){},_renderTriggered:function(){var e=this.layer;e.style.height=this.height+"px"}.observes("render"),_topDidChange:function(){var e=this.layer;if(!e)return;e.style.top=this.top+"px"}.observes("top","render")}),Photos.XDesktopStreamFooterView=Photos.XStreamFooterView.extend({height:74,rootHTML
:'<div class="desktop"><div class="privacy text">'+'<a href="%@" target="_blank">%@</a>'.fmt("_URL.PrivacyPolicy".loc(),"_Stream.Footer.PrivacyPolicy".loc())+"</div>"+'<a href="%@" target="_blank"><div class="icon"></div></a>'.fmt("_URL.ApplePhotoStream".loc())+'<div class="terms text">'+'<a href="%@" target="_blank">%@</a>'.fmt("_URL.TermsOfService".loc(),"_Stream.Footer.TermsOfService".loc())+"</div>"+"</div>"}),Photos.XMobileStreamFooterView=Photos.XStreamFooterView.extend({height:80,rootHTML:'<div class="mobile">'+'<a href="%@" target="_blank"><div class="icon"></div></a>'.fmt("_URL.ApplePhotoStream".loc())+'<div class="body">'+'<a href="%@" target="_blank">%@</a>'.fmt("_URL.PrivacyPolicy".loc(),"_Stream.Footer.PrivacyPolicy".loc())+" &middot; "+'<a href="%@" target="_blank">%@</a>'.fmt("_URL.TermsOfService".loc(),"_Stream.Footer.TermsOfService".loc())+"</div>"+"</div>"}),require("views/canvas_image"),function(){var e=0;Photos.XPhotoGridItemViewDelegate={isMixin:YES,isPhotoGridItemViewDelegate:YES,deviceModeBinding:"from:window.Photos.deviceMode",createVisibleRegionForPhotoGridItemView:function(e){var t=Photos.PhotoGridItemView.VisibleRegion.create({view:e});if(Photos.get("deviceMode")===Photos.DeviceMode.Mobile){var n=window.screen.height,r=window.screen.width,i=Math.floor(Math.max(n,r)/2);t.set("extendRegionTopDelta",i),t.set("extendedRegionBottomDelta",i)}else t.set("extendRegionTopDelta",window.screen.height),t.set("extendedRegionBottomDelta",window.screen.height*2);return t},createImageViewForPhotoGridItemView:function(e){var t=Photos.CanvasPhotoGridItemImageView;if(
B.msie===8||B.mobile)t=Photos.DomPhotoGridItemImageView;if(B.onlyiOS>=6){var n=e.photo,r=n.width,i=n.height,s=r>i?r/i:i/r;s>=2&&(t=Photos.DomPhotoGridItemImageView)}var o=this._createImageViewControllerForPhotoGridItemView(e),u=t.create({owner:e,photo:e.photo,delegate:o,gridItem:e,cellSizeBinding:"from:.owner.gridUnit",maximumRepSize:Infinity,shouldRespectPhotoAspectRatio:e.shouldRespectPhotoAspectRatio});return o.set("imageView",u),o.resumeImageLoadingIfNeeded(),Photos.photoGridItemImageViewControllers.addController(o),u},_createImageViewControllerForPhotoGridItemView:function(e){var t=Photos.PhotoGridItemView.ImageViewController;return Photos.get("deviceMode")===Photos.DeviceMode.Mobile?t=t.Mobile:B.msie===8?t=t.IE8:t=t.Desktop,t.create({photoGridItemView:e,photo:e.photo,visibleRegion:e.get("visibleRegion"),scrollTracker:Photos.scrollTracker})}},Photos.XStreamPhotoGridItemView=Core.ButtonView.extend(Photos.XPhotoGridItemViewDelegate,{classNames:"x-stream-photo-grid-item-view".w(),photo:null,gridUnit:0,maxColumnWidth:0,maxRowHeight:0,rowTop:0,rowHeight:0,columnLeft:0,columnWidth:0,inset:0,top:0,left:0,height:0,width:0,delegate:null,controller:null,shouldRespectPhotoAspectRatio:NO,isSteadilyOnScreen:NO,wantsTemporaryImageOverlay:NO,imageViewClass:null,init:function(){this._hasImageRepLoaded=!1,this._isMissingImage=!1,arguments.callee.base.apply(this,arguments)},delegateValue:function(){return this.get("delegate")||this}.property(),visibleRegion:function(){if(!this._visibleRegion){var e=this.get("delegateValue");this._visibleRegion=e.createVisibleRegionForPhotoGridItemView(this
)}return this._visibleRegion}.property(),getAbsoluteTop:function(){var e=this._absoluteTop;return e===null&&(e=this.top+this.owner.getAbsoluteTop()),e},refresh:function(){arguments.callee.base.apply(this,arguments);if(!this.imageView){var e=this.imageView=this._createImageView();e.appendTo(this)}this._absoluteTop=null;var t=this.maxRowHeight,n=this.maxColumnWidth,r=this.rowTop,i=this.rowHeight,s=this.columnLeft,o=this.columnWidth,u=this.gridUnit,a=this.top=u*r,f=this.left=u*s,l=this.width=u*o,c=u*i;this.shouldRespectPhotoAspectRatio&&(c*=Photos.gridItemPhotoHeightScalerStrategy.calculateForPhoto(this.photo)),this.height=c;var h=this.inset,p=r>0?a+h:a,d=s>0?f+h:f,v=i<t?c-h:c,m=o<n?l-h:l;r>0&&r+i<t&&(v-=h),s>0&&s+o<n&&(m-=h);var g=this.layer.style;g.top=p+"px",g.left=d+"px",g.width=m+"px",g.height=v+"px",this.imageView&&(this.imageView.setIfChanged("gridItemWidth",m),this.imageView.setIfChanged("gridItemHeight",v),this.imageView.trigger("gridItemSizeDidChange"))},_createImageView:function(){var t,n=this.photo.get("isVideo");if(B.mobile&&n&&e>=5)t=Core.View.create({owner:this});else{var r=this.get("delegateValue");t=r.createImageViewForPhotoGridItemView(this)}return this.setIfChanged("imageViewClass",t._type),n&&e++,this.photo.get("isVideo")&&$(this.layer).append('<div class="video-play"></div>'),t},_applyDeviceModeClassName:function(){this.layer.className+=this._isDesktopDevice()?" desktop":" mobile"}.observes("render"),_isDesktopDevice:function(){return Photos.get("deviceMode")===Photos.DeviceMode.Desktop},_addCaptionIfNeeded:function(){if(!this.layer||B.mobile)return;var e=this
.getPath("photo.caption");if(!e)return;var t=!!this.isMouseOver||!!B.mobile,n=this.captionContainer;n||((this.captionContainer=n=document.createElement("div")).className="caption-container",n.innerHTML='<p class="caption"></p>',this.captionElem=n.firstChild,this.captionElem.innerHTML=Core.escapeHTML(e),Anim.setOpacity(n,0),this.layer.appendChild(n)),Anim.Fader.go({element:n,to:0+t,speed:4+4*t})}.observes("render","photo","isMouseOver"),isMouseOver:NO,pointerEntered:function(){this.mouseEntered()},mouseEntered:function(){arguments.callee.base.apply(this,arguments),this.setIfChanged("isMouseOver",YES)},mouseExited:function(){arguments.callee.base.apply(this,arguments),this.setIfChanged("isMouseOver",NO)},action:function(){var e=this;this.mouseExited(),setTimeout(function(){Photos.stateManager.sendAction("showPhoto",e.photo)},150)},computeAriaLabel:function(){var e=this.layer,t=this.photo;if(!e)return;if(!t){e.removeAttribute("aria-label");return}var n=t.caption,r=new Date(t.dateCreated),i="_Accessibility.CaptionlessGridPhotoButtonSummary";n&&(i="_Accessibility.CaptionedGridPhotoButtonSummary");var s=i.loc({index:this.owner.indexForPhoto(t)+1,setSize:t.getPath("ownerGroup.photos.length"),date:Photos.dateLocalizer.localize(r),time:Photos.timeLocalizer.localize(r),caption:n});this.setIfChanged("ariaLabel",s)}.observes("render","photo"),imageViewFailedToLoadImageForRep:function(e,t){!this._hasImageRepLoaded&&!this._isMissingImage&&(this._isMissingImage=!0,this._removeImageView(),this._showMissingImage())},imageViewSuccessfullyLoadedImageForRep:function(e,t){this._hasImageRepLoaded=!0
},_removeImageView:function(){var e=this.imageView;e&&e.remove()},_showMissingImage:function(){this.photo.get("isVideo")&&$(this.layer).find(".video-play").remove();var e=document.createElement("DIV");e.className="missing-image",this._missingImageElement=this.missingElem,this.layer.appendChild(e),this._isDesktopDevice()&&Anim.Fader.go({from:0,to:1,element:e})},_maintain_isSteadilyOnScreen:function(){if(!this.isAppendedInWindow)this.setIfChanged("isSteadilyOnScreen",NO);else{var e=this.getAbsoluteTop()-Core.scrollTop();this.setIfChanged("isSteadilyOnScreen",e<Core.windowSize.height&&e+this.height>0&&Math.abs(Photos.scrollTracker.scrollSpeed)===0)}}.observes("isAppendedInWindow","Core.windowSize","Core.windowScroll","Photos.scrollTracker.scrollSpeed"),_maintain_wantsTemporaryImageOverlay:function(){this.setIfChanged("wantsTemporaryImageOverlay",!!(B.desktop&&this.isSteadilyOnScreen&&Core.windowSize.width>1024&&this.imageViewClass===Photos.CanvasPhotoGridItemImageView))}.observes("isSteadilyOnScreen","imageViewClass","Core.windowSize"),_handleChange_wantsTemporaryImageOverlay:function(){this.imageView&&this.imageView.setIfChanged("gridItemWantsTemporaryImageOverlay",this.wantsTemporaryImageOverlay)}.observes("wantsTemporaryImageOverlay")})}(),require("views/x_stream_view"),Photos.XStreamPhotoGroupBlockView=Photos.XStreamView.extend({classNames:"x-stream-photo-group-block-view".w(),index:0,top:0,width:0,height:0,showContent:!1,photosStartIndex:0,refresh:function(){arguments.callee.base.apply(this,arguments);var e=this.layer,t=this.height;e&&(e.style.height=t+"px")},_topDidChange
:function(){var e=this.layer,t=this.top;e&&(e.style.top=t+"px")}.observes("top"),_adjustLayerForShowContentChange:function(){var e=this.layer;if(!e)return;this.showContent?$(e).addClass("visible").removeClass("not-visible"):$(e).addClass("not-visible").removeClass("visible")}.observes("render","showContent"),indexForPhoto:function(e){return 0}}),require("views/x_stream_view"),Photos.XStreamPhotoGroupBlocksContainerView=Photos.XStreamView.extend({classNames:"x-stream-photo-group-blocks-container-view".w(),photoGroup:null,width:0,top:0,margin:0,height:0,init:function(){arguments.callee.base.apply(this,arguments);var e=this.photoGroup,t=this._blockViews=this._createBlockViewsForPhotoGroup(e),n=t.length,r,i=Photos.streamPhotoGroupBlockViewsController;for(var s=0;s<n;s++)r=t[s],r.append(this),i.addView(r)},refresh:function(){arguments.callee.base.apply(this,arguments);var e=0,t=this._blockViews,n=t.length,r=this.margin,i;for(var s=0;s<n;s++)i=t[s],i.set("top",e),i.set("margin",r),i.refresh(),e+=i.get("height"),s<n-1&&(e+=r);this.height=e;var o=this.layer,u=o.style;u.height=e+"px",u.top=this.top+"px"},_createBlockViewsForPhotoGroup:function(e){var t=e.get("photos"),n=t.length,r=[],i;if(t.length===1)return i=Photos.XStreamPhotoGroupPreserveAspectBlockView.create({owner:this,photo:t[0]}),r.push(i),r;var s=this._partitionPhotosIntoBlocks(t),o=s.length,u=this.margin,a,f=0;for(var l=0;l<o;l++)a=s[l],photo=a[0],a.length===1&&(photo.get("isWideLandscape")||photo.get("isVideo"))?i=Photos.XStreamPhotoGroupPreserveAspectBlockView.create({index:l,owner:this,photo:photo,photosStartIndex:f}):i=
Photos.XStreamPhotoGroupGridBlockView.create({owner:this,photos:a,index:l,margin:u,photosStartIndex:f}),f+=a.length,r.push(i);return r},_partitionPhotosIntoBlocks:function(e){var t=e.length,n=[],r=[],i,s;n.push(r);for(s=0;s<t;s++)i=e[s],i.get("isWideLandscape")||i.get("isVideo")?(r.length===0?r.push(i):n.push([i]),s<t-1&&(r=[],n.push(r))):r.push(i);var o=n.length,u=[];for(s=0;s<o;s++)u=u.concat(this._partitionPhotoBlock(n[s]));return u},_partitionPhotoBlock:function(e){var t=e.length,n=[],r;for(var i=0;i<t;i++)i%6===0&&(r=[],n.push(r)),r.push(e[i]);return n},_widthDidChange:function(){var e=this.layer,t=this.width;e&&(e.style.width=t+"px");var n=this._blockViews,r=n.length;for(var i=0;i<r;i++)n[i].set("width",t)}.observes("width")}),require("views/x_stream_photo_group_block_view"),function(){Photos.XStreamPhotoGroupGridBlockView=Photos.XStreamPhotoGroupBlockView.extend({classNames:"x-grid".w(),photos:null,margin:0,init:function(){arguments.callee.base.apply(this,arguments);var e=this.photos,t=this._photoItemViews=this._createPhotoItemViewsForPhotos(e),n=t.length;this._applyGridLayoutToViewsForBlockIndex(t,this.index)},refresh:function(){arguments.callee.base.apply(this,arguments);var e=this._photoItemViews,t=e.length,n=this.width,r=Math.round(n/6),i=this.margin,s=Math.round(i/2),o,u=0,a,f;for(var l=0;l<t;l++)o=e[l],o.set("gridUnit",r),o.set("inset",s),o.refresh(),a=o.top,f=o.height,a+f>u&&(u=a+f);this.height=u;var c=this.layer.style;c.height=u+"px"},indexForPhoto:function(e){return this.photos.indexOf(e)+this.photosStartIndex},_createPhotoItemViewsForPhotos:function(e){var t=
e.length,n=[],r,i=this.showPhotoItems,s=this.inset;for(var o=0;o<t;o++)r=Photos.XStreamPhotoGridItemView.create({owner:this,photo:e[o]}),n.push(r);return n},_applyGridLayoutToViewsForBlockIndex:function(e,t){var n=u[e.length-1];n.applyLayoutToViewsForBlockIndex(e,t)},_showContentDidChange:function(){var e=this.showContent,t=this._photoItemViews,n=t.length,r;for(var i=0;i<n;i++)r=t[i],e?r.append(this):r.remove()}.observes("showContent")});var e=function(){};e.prototype={LAYOUT_RULES:null,applyLayoutToViewsForBlockIndex:function(e,t){var n=this.getRulesForViewsForIndex(e,t),r=n.maxColumnWidth,i=n.maxRowHeight,s=n.gridMaxtrix,o=e.length,u,a;for(var f=0;f<o;f++)u=e[f],a=s[f],u.maxColumnWidth=r,u.maxRowHeight=i,u.rowTop=a.top,u.columnLeft=a.left,u.columnWidth=a.width,u.rowHeight=a.height},getRulesForViewsForIndex:function(e,t){return this.LAYOUT_RULES}};var t=new e;t.LAYOUT_RULES={maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:6,height:6}]};var n=new e;n.LAYOUT_RULES={portrait:{maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:3,height:6},{top:0,left:3,width:3,height:6}]},landscape:{maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:6,height:3},{top:3,left:0,width:6,height:3}]},portraitPriority:{maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:6,height:6},{top:6,left:0,width:6,height:3}]},landscapePriority:{maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:6,height:3},{top:3,left:0,width:6,height:6}]}},n.getRulesForViewsForIndex=function(e,t){var n=e[0],r=e[1],i=n.photo,s=r.photo,o=i.get("orientation"),
u=s.get("orientation"),a;return o===Photos.PhotoRecord.LANDSCAPE?u===Photos.PhotoRecord.LANDSCAPE?a=this.LAYOUT_RULES.landscape:a=this.LAYOUT_RULES.landscapePriority:u===Photos.PhotoRecord.PORTRAIT?a=this.LAYOUT_RULES.portrait:a=this.LAYOUT_RULES.portraitPriority,a};var r=new e;r.LAYOUT_RULES={portrait:{maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:3,height:6},{top:0,left:3,width:3,height:3},{top:3,left:3,width:3,height:3}]},landscape:{maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:6,height:3},{top:3,left:0,width:3,height:3},{top:3,left:3,width:3,height:3}]}},r.getRulesForViewsForIndex=function(e,t){var n=e[0],r=n.photo,i=r.get("orientation"),s;return i===Photos.PhotoRecord.LANDSCAPE?s=this.LAYOUT_RULES.landscape:s=this.LAYOUT_RULES.portrait,s};var i=new e;i.LAYOUT_RULES={maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:3,height:3},{top:0,left:3,width:3,height:3},{top:3,left:0,width:3,height:3},{top:3,left:3,width:3,height:3}]};var s=new e;s.LAYOUT_RULES={maxColumnWidth:6,maxRowHeight:12,gridMaxtrix:[{top:0,left:0,width:3,height:3},{top:0,left:3,width:3,height:3},{top:3,left:0,width:3,height:3},{top:3,left:3,width:3,height:3},{top:6,left:0,width:6,height:6}]};var o=new e;o.LAYOUT_RULES={even:{maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:4,height:4},{top:0,left:4,width:2,height:2},{top:2,left:4,width:2,height:2},{top:4,left:0,width:2,height:2},{top:4,left:2,width:2,height:2},{top:4,left:4,width:2,height:2}]},odd:{maxColumnWidth:6,maxRowHeight:6,gridMaxtrix:[{top:0,left:0,width:2,height:2},{top:2,left:0,width
:2,height:2},{top:0,left:2,width:4,height:4},{top:4,left:0,width:2,height:2},{top:4,left:2,width:2,height:2},{top:4,left:4,width:2,height:2}]}},o.getRulesForViewsForIndex=function(e,t){var n;return t%2===0?n=this.LAYOUT_RULES.even:n=this.LAYOUT_RULES.odd,n};var u=[t,n,r,i,s,o]}(),function(){Photos.XStreamPhotoGroupInfoView=Core.View.extend({classNames:"x-stream-photo-group-info-view".w(),photoGroup:null,descriptionElemKey:"descriptionElem",dateTimeElemKey:"dateTimeElem",_renderDidTrigger:function(){RIGHT_TO_LEFT&&$(this[this.dateTimeElemKey]).addClass("rtl")}.observes("render"),_updateLayer:function(){this._updateDescriptionInfo(),this._updateDateTimeInfo()}.observes("render","photoGroup"),_updateDescriptionInfo:function(){var e=this[this.descriptionElemKey];e.innerHTML=this.descriptionForPhotoGroup(this.photoGroup)},_updateDateTimeInfo:function(){var e=this[this.dateTimeElemKey];e.innerHTML=this.dateTimeForPhotoGroup(this.photoGroup)},descriptionForPhotoGroup:function(e){return""},dateTimeForPhotoGroup:function(e){var t=new Date(e.dateCreated),n=Photos.dateLocalizer.localize(t),r=Photos.timeLocalizer.localize(t),i="_DateTime".loc({time:r,date:n});return i}})}(),Photos.XDesktopStreamPhotoGroupInfoView=Photos.XStreamPhotoGroupInfoView.extend({classNames:"desktop".w(),rootHTML:'<div><p class="description"></p><p class="when"></p></div>',descriptionElemElement:"layer.firstChild",dateTimeElemElement:"layer.lastChild",width:0,multipleContributors:function(){return Photos.photosController.get("hasMultipleContributors")}.property(),streamAuthor:function(){return Photos.sessionInfoController
.get("user")}.property(),descriptionForPhotoGroup:function(e){var t=e.get("stillPhotoCount"),n=e.get("videoCount"),r=e.get("contributor")||this.get("streamAuthor"),i=this.get("multipleContributors"),s=r.firstName,o=r.lastName,u=r.localizeFullName(),a=Core.escapeHTML(i?u:s),f="_Stream.BatchSummary.Count.Contributor"+(i?".Multi":".Single"),l,c;return t>1&&n===0?(l=e.get("containsOnlyPanoramicPhotos")?".Panoramas":".Photos",c=(f+l).loc(a,t)):t===1&&n===0?(l=e.get("containsOnlyPanoramicPhotos")?".OnePanorama":".OnePhoto",c=(f+l).loc(a)):t===0&&n>1?c=(f+".Videos").loc(a,n):t===0&&n===1?c=(f+".OneVideo").loc(a):t>1&&n>1?c=(f+".PhotosAndVideos").loc(a,t,n):t>1&&n===1?c=(f+".PhotosAndOneVideo").loc(a,t):t===1&&n>1?c=(f+".OnePhotoAndVideos").loc(a,n):t===1&&n===1&&(c=(f+".OnePhotoAndOneVideo").loc(a)),c},_widthDidChange:function(){var e=this.layer,t=this.width;e&&(e.style.width=t+"px")}.observes("width")}),Photos.XMobileStreamPhotoGroupSingleContributorInfoView=Photos.XStreamPhotoGroupInfoView.extend({classNames:"mobile single".w(),rootHTML:'<div><p class="when"></p><p class="description"></p></div>',dateTimeElemElement:"layer.firstChild",descriptionElemElement:"layer.lastChild",height:30,descriptionForPhotoGroup:function(e){var t="_Stream.BatchSummary.Count.Plain",n=e.get("stillPhotoCount"),r=e.get("videoCount"),i,s;return n===0&&r===1?i=(t+".OneVideo").loc(r):n===1&&r===0?(s=e.get("containsOnlyPanoramicPhotos")?".OnePanorama":".OnePhoto",i=(t+s).loc()):n>=1&&r>=1||r>1?i=(t+".Items").loc(n+r):n>1&&r===0&&(i=(t+".Photos").loc(n)),i}}),Photos.XMobileStreamPhotoGroupMultiContributorInfoView=
Photos.XStreamPhotoGroupInfoView.extend({classNames:"mobile multi".w(),height:48,rootHTML:'<div><p class="description"></p><p class="when"></p></div>',descriptionElemElement:"layer.firstChild",dateTimeElemElement:"layer.lastChild",descriptionForPhotoGroup:function(e){var t="_Stream.BatchSummary.Count.Contributor.Multi",n=e.get("stillPhotoCount"),r=e.get("videoCount"),i=e.get("contributor")||this.get("streamAuthor"),s=Core.escapeHTML(i.localizeFullName()),o,u;return n===0&&r===1?o=(t+".OneVideo").loc(s,r):n===1&&r===0?(u=e.get("containsOnlyPanoramicPhotos")?".OnePanorama":".OnePhoto",o=(t+u).loc(s)):n>=1&&r>=1||r>1?o=(t+".Items").loc(s,n+r):n>1&&r===0&&(o=(t+".Photos").loc(s,n)),o}}),require("views/x_stream_photo_group_block_view"),Photos.XStreamPhotoGroupPreserveAspectBlockView=Photos.XStreamPhotoGroupBlockView.extend({classNames:"x-preserve-aspect".w(),photo:null,init:function(){arguments.callee.base.apply(this,arguments);var e=this._photoItemView=Photos.XStreamPhotoGridItemView.create({owner:this,photo:this.photo,shouldRespectPhotoAspectRatio:YES,maxColumnWidth:6,maxRowHeight:6,rowTop:0,columnLeft:0,columnWidth:6,rowHeight:6})},refresh:function(){arguments.callee.base.apply(this,arguments);var e=this.width,t=Math.round(e/6),n=this._photoItemView;n.set("gridUnit",t),n.refresh();var r=this.height=n.height,i=this.layer;i.style.height=r+"px"},_showContentDidChange:function(){var e=this._photoItemView;this.showContent?e.append(this):e.remove()}.observes("showContent"),indexForPhoto:function(e){return this.photosStartIndex}}),function(){var e=3,t=1;Photos.XThumbnailView=Core.View
.extend({classNames:"x-thumbnail-view desktop".w(),rootHTML:'<div aria-hidden="true"><div class="decorations"><div class="band1"></div><div class="band2"></div></div><div class="container"></div></div>',width:0,height:0,photoGroups:null,imageContainerElement:"layer.lastChild",init:function(){arguments.callee.base.apply(this,arguments);var e=this._imageView=this._createImageView();e.append(this)},_renderTriggered:function(){var e=this.layer,t=e.style,n=this.width,r=this.height;t.width=n+"px",t.height=r+"px"}.observes("render"),_photoGroupsDidChange:function(){if(!this.layer)return;var e=this.photoGroups,t=e?e.length:0,n=this._imageView,r=t>0?e[0].photos[0]:null;r&&n.set("photo",r)}.observes("render","photoGroups"),_createImageView:function(){var n=this.width,r=this.height-t-e,i=Photos.CanvasImageView;B.msie<=8&&(i=Photos.DomImageView);var s=i.create(Photos.PhotoGridItemImageViewSupport,{owner:this,maxImageWidth:n,maxImageHeight:r,width:n,height:r,importance:Math.pow(2,32)-1,appendInto:"imageContainer",maximumRepSize:300});return s}})}(),require("core"),require("views/x_stream_page_view"),require("views/x_desktop_slideshow_page_view"),require("views/x_mobile_slideshow_page_view"),function(){function i(){var e=Photos.page.streamView.layer;e.style.border="1px solid black",setTimeout(s,1e3)}function s(){var e=Photos.page.streamView.layer;e.style.border=null}var e=CoreImage.transitionBank,t=Core.transitionBank,n=B.mobile?Photos.XMobileSlideshowPageView:Photos.XDesktopSlideshowPageView,r=Photos.get("deviceMode")===Photos.DeviceMode.Desktop?Photos.XDesktopStreamPageView:Photos.XMobileStreamPageView
;Photos.page=Core.WorkspaceView.create({classNames:"wrapper".w(),initiallyAppended:NO,allowInterruption:NO,nowShowingBinding:"from:Photos.workspaceController.nowShowing",transitioningOverflow:"visible",tabNames:Photos.tabNames,rootHTML:"<div></div>",transitioners:[[null,null,null],[null,null,t.xFadeFrom],[null,t.xFadeTo,null]],streamView:r.extend({deviceModeBinding:"from:Photos.deviceMode",streamTitleBinding:"from:Photos.sessionInfoController.streamTitle",streamAuthorBinding:"from:Photos.sessionInfoController.user"}),slideshowView:n.extend({controller:Photos.slideshowController,itemSetBinding:"from:.controller.itemSet",currentItemBinding:".controller.currentItem",isLoadingBinding:"to:.controller.isLoading",delegate:Photos.slideshowController,itemViewsScopeLookAheadCountBinding:"from:.controller.itemViewsScopeLookAheadCount",itemViewsScopeLookBehindCountBinding:"from:.controller.itemViewsScopeLookBehindCount"}),touchStart:function(){},_onWillRunTransition:function(e,t,n){var r=this.streamView,i=this.slideshowView;e===r&&(this._stremViewScrollTop=Photos.windowController.bodyScrollTop);if(t===i){var s=i.layer.style,o="translate3d(0,0,0)";s.position="fixed",s.webkitTransform=o,s.transform=o,s.msTransform=o,s.mozTransform=o,i.append(this)}else t===r&&r.append(this)}.observes("willRunTransition"),shouldAutomaticallyStartTransitionFromViewToView:function(e,t){return t===this.streamView&&e===this.slideshowView?!1:!0},didNotAutomaticallyStartTransitionFromViewToView:function(e,t,n){var r=this;setTimeout(function(){r._stremViewScrollTop&&window.scrollTo(0,r._stremViewScrollTop),setTimeout
(function(){e.start()},0)})},_onDidFinishRunningTransition:function(e,t){var n=this.streamView,r=this.slideshowView;e&&setTimeout(function(){e.remove()},0),t===n&&this.__forceStreamViewRedraw__&&(this.__forceStreamViewRedraw__=!1,setTimeout(i,1e3))}.observes("didFinishRunningTransition")}),Photos.errorPage=Photos.ErrorPageView.create({initiallyAppended:NO,titleBinding:"from:Photos.errorController.title",captionBinding:"from:Photos.errorController.caption",errorTypeBinding:"from:Photos.errorController.errorType"})}(),require("core"),function(){function t(){if(B.s.msie>=8)return!0;if(B.desktop)if(B.s.safari>=5||B.s.chrome>=27||B.s.mozilla>=21)return!0;if(B.mobile){if(B.iOS>=5)return!0;if(B.android&&(B.s.chrome>=18||B.s.safari>=4||B.s.mozilla>=21))return!0;if(B.silk)return!0}var e=window.navigator,t=e?e.userAgent:null;return t&&t.indexOf("QuickLook")>=0?!0:!1}var e="http://www.icloud.com/unsupported_browser/";Photos.mixin({main:function(){if(!t()){window.location=e;return}if(!Photos.environmentController.get("hasValidEnvironment")){window.location="_URL.ApplePhotoStream".loc();return}Core.errorCatcher.delegate=Photos.errorCatcherController;var n=Photos.FeedbackStatsService.create({appName:APP_NAME,appendedStats:{streamToken:Photos.environmentController.getPath("handler.token")}});n.addStream(Photos.RemoteFeedbackStatsStream.create()),Photos.feedbackStatsService=n;var r=Photos.tracer=Photos.Tracer.create({feedbackStatsService:n});CoreImage.Loadee.tracer=r,n.start(),Core.addEvent(window,"beforeunload",function(){Core.Request.send({type:"POST",url:"https://feedbackws.icloud.com/reportStats"
,isAsync:NO,withCredentials:NO,body:{stats:[{sessionDuration:(new Date).getTime()-__APP_INIT_START_TIME__,statName:"session",appName:n.appName,sessionID:n.sessionID()}]}})}),Photos.feedbackStatsService.report("appInfo",{buildMode:BUILD_INFO.buildMode,buildNumber:BUILD_INFO.buildNumber,buildLocale:BUILD_INFO.buildLocale,deviceMode:Photos.get("deviceMode"),screenHeight:window.screen.availHeight,screenWidth:window.screen.availWidth}),Photos.feedbackStatsService.report("mainEntryInfo",{loadTime:(new Date).getTime()-__APP_INIT_START_TIME__});var i=document.getElementById("loading");i&&i.parentNode.removeChild(i),Browser.addBodyClassNames(),Core.useGPU&&(document.body.className+=" gpu-enabled");var s=Photos.createPhotoStreamDataSource({delegate:Photos.photosController});Photos.set("dataSource",s);var o=Photos.stateManager.create({traceBinding:"from:window.Photos.trace"});this.configureImageThreadConnections(),Photos.stateManager=o,Photos.stallStateManagerStart||o.start(),Photos.environmentController.startDetectingExternalEnvironmentChanges()}.observes("window.Core.windowDidLoad"),configureImageThreadConnections:function(){var e=CoreImage.imageLoader.threads;if(e.length<4)return;var t=function(e){if(!e.isRequest)return NO;var t=e.rep,n=t?t._key:null,r=parseInt(n,0);return r>=1e3};for(var n=0;n<=2;n+=1)e[n].ignoreTester=t}})}();